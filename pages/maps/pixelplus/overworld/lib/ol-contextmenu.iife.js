/*!
  * ol-contextmenu - v5.4.0
  * https://github.com/jonataswalker/ol-contextmenu
  * Built: Fri Mar 08 2024 12:11:47 GMT+0000 (Coordinated Universal Time)
  */var ContextMenu=function(e,t){"use strict";f=Object.defineProperty,g=(e,t,n)=>t in e?f(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,s=(e,t,n)=>(g(e,typeof t!="symbol"?t+"":t,n),n),c={exports:{}};function l(){}l.prototype={on:function(e,t,n){var s=this.e||(this.e={});return(s[e]||(s[e]=[])).push({fn:t,ctx:n}),this},once:function(e,t,n){var o=this;function s(){o.off(e,s),t.apply(n,arguments)}return s._=t,this.on(e,s,n)},emit:function(e){var s=[].slice.call(arguments,1),n=((this.e||(this.e={}))[e]||[]).slice(),t=0,o=n.length;for(t;t<o;t++)n[t].fn.apply(n[t].ctx,s);return this},off:function(e,t){var n,a,o=this.e||(this.e={}),s=o[e],i=[];if(s&&t)for(n=0,a=s.length;n<a;n++)s[n].fn!==t&&s[n].fn._!==t&&i.push(s[n]);return i.length?o[e]=i:delete o[e],this}},c.exports=l;var s,c,f,g,j=c.exports.TinyEmitter=l,u=(e=>(e.CONTEXTMENU="contextmenu",e.CLICK="click",e.DBLCLICK="dblclick",e))(u||{}),i=(e=>(e.BEFOREOPEN="beforeopen",e.OPEN="open",e.CLOSE="close",e.ADD_MENU_ENTRY="add-menu-entry",e))(i||{});class h extends t{constructor(e){super(e.type,e.map,e.originalEvent)}}const v={width:150,scrollAt:4,eventType:u.CONTEXTMENU,defaultItems:!0,items:[]},o="ol-ctx-menu",n={namespace:o,container:`${o}-container`,separator:`${o}-separator`,submenu:`${o}-submenu`,hidden:`${o}-hidden`,icon:`${o}-icon`,zoomIn:`${o}-zoom-in`,zoomOut:`${o}-zoom-out`,unselectable:"ol-unselectable"},m=[{text:"Zoom In",classname:`${n.zoomIn} ${n.icon}`,callback:(e,t)=>{const n=t.getView();n.animate({zoom:Number(n.getZoom())+1,duration:700,center:e.coordinate})}},{text:"Zoom Out",classname:`${n.zoomOut} ${n.icon}`,callback:(e,t)=>{const n=t.getView();n.animate({zoom:Number(n.getZoom())-1,duration:700,center:e.coordinate})}}];function a(e){const n=document.createDocumentFragment(),t=document.createElement("div");for(t.innerHTML=e;t.firstChild;)n.append(t.firstChild);return n}function b(e){const t=document.importNode(e),o=e.offsetWidth;t.style.cssText=`position: fixed; top: 0; left: 0; overflow: auto; visibility: hidden; pointer-events: none; height: unset; max-height: unset; width: ${o}px`;const i=a("<span>Foo</span>"),r=a("<span>Foo</span>"),n=document.createElement("li"),s=document.createElement("li");n.append(i),s.append(r),t.append(n),t.append(s),e.parentNode?.append(t);const c=t.offsetHeight/2;return e.parentNode?.removeChild(t),c}function p({parentNode:e,item:t,isSubmenu:s=!1,isInsideSubmenu:o=!1,emitter:r}){const c=`_${Math.random().toString(36).slice(2,11)}`;if(typeof t!="string"&&"text"in t){const d=`<span>${t.text}</span>`,u=a(d),l=document.createElement("li");t.classname=t.classname||"",t.icon&&(t.classname===""?t.classname=n.icon:t.classname.includes(n.icon)===!1&&(t.classname+=` ${n.icon}`),l.setAttribute("style",`background-image:url(${t.icon})`)),l.id=c,l.className=t.classname,l.append(u),e.append(l);const h={id:c,isSubmenu:s,isInsideSubmenu:o,isSeparator:!1,callback:"callback"in t?t.callback:null,data:"data"in t?t.data:null};return r.emit(i.ADD_MENU_ENTRY,h,l),l}const d=`<li id="${c}" class="${n.separator}"><hr></li>`,u=a(d);e.append(u);const l=e.lastChild,h={id:c,isSubmenu:!1,isInsideSubmenu:!1,isSeparator:!0,callback:null,data:null};return r.emit(i.ADD_MENU_ENTRY,h,l),l}function d({container:e,items:t,menuWidth:s,isInsideSubmenu:o,emitter:i}){t.forEach(t=>{if(typeof t!="string"&&"items"in t&&Array.isArray(t.items)){const a=p({parentNode:e,item:t,isSubmenu:!0,emitter:i});a.classList.add(n.submenu);const o=document.createElement("ul");o.classList.add(n.container),o.style.width=`${s}px`,a.append(o),d({emitter:i,menuWidth:s,container:o,items:t.items,isInsideSubmenu:!0})}else p({parentNode:e,item:t,isSubmenu:!1,isInsideSubmenu:o,emitter:i})})}function r(e,t){if(!e)throw new Error(t)}class y extends e{constructor(e={}){r(typeof e=="object","@param `opts` should be object type!");const t=document.createElement("div");super({element:t}),s(this,"map"),s(this,"emitter",new j),s(this,"container"),s(this,"coordinate",[]),s(this,"pixel",[]),s(this,"contextMenuEventListener"),s(this,"entryCallbackEventListener"),s(this,"mapMoveListener"),s(this,"lineHeight",0),s(this,"disabled"),s(this,"opened"),s(this,"items",[]),s(this,"menuEntries",new Map),s(this,"options"),this.options={...v,...e};const o=document.createElement("ul");t.append(o),t.style.width=`${this.options.width}px`,t.classList.add(n.container,n.unselectable,n.hidden),this.container=t,this.contextMenuEventListener=e=>{this.handleContextMenu(e)},this.entryCallbackEventListener=e=>{this.handleEntryCallback(e)},this.mapMoveListener=()=>{this.handleMapMove()},this.disabled=!1,this.opened=!1,window.addEventListener("beforeunload",()=>{this.removeListeners()},{once:!0})}clear(){for(const e of this.menuEntries.keys())this.removeMenuEntry(e);this.container.replaceChildren(),this.container.append(document.createElement("ul"))}enable(){this.disabled=!1}disable(){this.disabled=!0}getDefaultItems(){return m}countItems(){return this.menuEntries.size}extend(e){r(Array.isArray(e),"@param `items` should be an Array."),d({items:e,emitter:this.emitter,menuWidth:this.options.width,container:this.container.firstElementChild})}closeMenu(){this.opened=!1,this.container.classList.add(n.hidden),this.dispatchEvent(i.CLOSE)}isOpen(){return this.opened}updatePosition(e){r(Array.isArray(e),"@param `pixel` should be an Array."),this.isOpen()&&(this.pixel=e,this.positionContainer())}pop(){const e=Array.from(this.menuEntries.keys()).pop();e&&this.removeMenuEntry(e)}shift(){const e=Array.from(this.menuEntries.keys()).shift();e&&this.removeMenuEntry(e)}push(e){e&&this.extend([e])}setMap(e){if(super.setMap(e),e){this.map=e,e.getViewport().addEventListener(this.options.eventType,this.contextMenuEventListener,!1),e.on("movestart",()=>{this.handleMapMove()}),this.emitter.on(i.ADD_MENU_ENTRY,(e,t)=>{this.handleAddMenuEntry(e,t)},this),this.items=this.options.defaultItems?this.options.items.concat(m):this.options.items,d({items:this.items,emitter:this.emitter,menuWidth:this.options.width,container:this.container.firstElementChild});const t=this.getMenuEntriesLength();this.lineHeight=t>0?this.container.offsetHeight/t:b(this.container)}else this.removeListeners(),this.clear()}removeListeners(){this.map.getViewport().removeEventListener(this.options.eventType,this.contextMenuEventListener,!1),this.emitter.off(i.ADD_MENU_ENTRY)}removeMenuEntry(e){let t=document.getElementById(e);t?.remove(),t=null,this.menuEntries.delete(e)}handleContextMenu(e){this.coordinate=this.map.getEventCoordinate(e),this.pixel=this.map.getEventPixel(e),this.dispatchEvent(new h({map:this.map,originalEvent:e,type:i.BEFOREOPEN})),!this.disabled&&(this.options.eventType===u.CONTEXTMENU&&(e.stopPropagation(),e.preventDefault()),setTimeout(()=>{this.openMenu(e)}),e.target?.addEventListener("pointerdown",e=>{this.opened&&(e.stopPropagation(),this.closeMenu())},{once:!0}))}openMenu(e){this.opened=!0,this.positionContainer(),this.container.classList.remove(n.hidden),this.dispatchEvent(new h({map:this.map,originalEvent:e,type:i.OPEN}))}getMenuEntriesLength(){return Array.from(this.menuEntries).filter(([,e])=>e.isSeparator===!1&&e.isSubmenu===!1&&e.isInsideSubmenu===!1).length}positionContainer(){const s=this.map.getSize()||[0,0],t={w:s[0]-this.pixel[0],h:s[1]-this.pixel[1]},r=this.getMenuEntriesLength(),e={w:this.container.offsetWidth,h:Math.round(this.lineHeight*r)},c=t.w>=e.w?this.pixel[0]+5:this.pixel[0]-e.w;this.container.style.left=`${c}px`,this.container.style.top=t.h>=e.h?`${this.pixel[1]-10}px`:`${this.pixel[1]-e.h}px`,this.container.style.right="auto",this.container.style.bottom="auto",t.w-=e.w;const o=e=>Array.from(e.children).filter(e=>e.tagName==="LI"&&e.classList.contains(n.submenu));let i=0;const a=(s,r)=>{i+=1,o(s).forEach(s=>{const l=r>=e.w?e.w-8:(e.w+8)*-1,c=s.querySelector(`ul.${n.container}`),d=Math.round(this.lineHeight*Array.from(c.children).filter(e=>e.tagName==="LI").length);c.style.left=`${l}px`,c.style.right="auto",c.style.top=t.h>=d+e.h?"0":`-${c.offsetHeight-25}px`,c.style.bottom="auto",c.style.zIndex=String(i),o(c).length>0&&a(c,r-e.w)})};a(this.container.firstElementChild,t.w)}handleMapMove(){this.closeMenu()}handleEntryCallback(e){e.preventDefault(),e.stopPropagation();const n=e.currentTarget,t=this.menuEntries.get(n.id);if(!t)return;const s={data:t.data,coordinate:this.coordinate};this.closeMenu(),t.callback?.(s,this.map)}handleAddMenuEntry(e,t){this.menuEntries.set(e.id,e),this.positionContainer(),"callback"in e&&typeof e.callback=="function"&&t.addEventListener("click",this.entryCallbackEventListener,!1)}}return y}(ol.control.Control,ol.MapBrowserEvent)