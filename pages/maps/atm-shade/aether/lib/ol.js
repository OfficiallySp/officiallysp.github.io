var ol=function(){"use strict";class ue{constructor(e){this.propagationStopped,this.defaultPrevented,this.type=e,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}function R4(e){e.stopPropagation()}Xn="propertychange";class Zo{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}function B4(e,t,n){let o,i;n=n||_t;let s=0,a=e.length,r=!1;for(;s<a;)o=s+(a-s>>1),i=+n(e[o],t),i<0?s=o+1:(a=o,r=!i);return r?s:~s}function _t(e,t){return e>t?1:e<t?-1:0}function u0(e,t){return e<t?1:e>t?-1:0}function ci(e,t,n){if(e[0]<=t)return 0;const s=e.length;if(t<=e[s-1])return s-1;if("function"==typeof n){for(let o=1;o<s;++o){const i=e[o];if(i===t)return o;if(i<t)return n(t,e[o-1],i)>0?o-1:o}return s-1}if(n>0){for(let n=1;n<s;++n)if(e[n]<t)return n-1;return s-1}if(n<0){for(let n=1;n<s;++n)if(e[n]<=t)return n;return s-1}for(let n=1;n<s;++n){if(e[n]==t)return n;if(e[n]<t)return e[n-1]-t<t-e[n]?n-1:n}return s-1}function g0(e,t,n){for(;t<n;){const s=e[t];e[t]=e[n],e[n]=s,++t,--n}}function z(e,t){const n=Array.isArray(t)?t:[t],s=n.length;for(let t=0;t<s;t++)e[e.length]=n[t]}function Ct(e,t){const n=e.length;if(n!==t.length)return!1;for(let s=0;s<n;s++)if(e[s]!==t[s])return!1;return!0}function L0(e,t,n){const s=t||_t;return e.every(function(t,o){if(0===o)return!0;const i=s(e[o-1],t);return!(i>0||n&&0===i)})}function Je(){return!0}function Qn(){return!1}function is(){}function Rl(e){let t,n,s,o=!1;return function(){const i=Array.prototype.slice.call(arguments);return o&&this===s&&Ct(i,n)||(o=!0,s=this,n=i,t=e.apply(this,arguments)),t}}function yl(e){return function(){let t;try{t=e()}catch(e){return Promise.reject(e)}return t instanceof Promise?t:Promise.resolve(t)}()}function Kn(e){for(const t in e)delete e[t]}function it(e){let t;for(t in e)return!1;return!t}class Ss extends Zo{constructor(e){super(),this.eventTarget_=e,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(e,t){if(!e||!t)return;const n=this.listeners_||(this.listeners_={}),s=n[e]||(n[e]=[]);s.includes(t)||s.push(t)}dispatchEvent(e){const r="string"==typeof e,t=r?e:e.type,n=this.listeners_&&this.listeners_[t];if(!n)return;const s=r?new ue(e):e;s.target||(s.target=this.eventTarget_||this);const o=this.dispatching_||(this.dispatching_={}),a=this.pendingRemovals_||(this.pendingRemovals_={});let i;t in o||(o[t]=0,a[t]=0),++o[t];for(let e=0,t=n.length;e<t;++e)if(i="handleEvent"in n[e]?n[e].handleEvent(s):n[e].call(this,s),!1===i||s.propagationStopped){i=!1;break}if(0==--o[t]){let e=a[t];for(delete a[t];e--;)this.removeEventListener(t,is);delete o[t]}return i}disposeInternal(){this.listeners_&&Kn(this.listeners_)}getListeners(e){return this.listeners_&&this.listeners_[e]||void 0}hasListener(e){return!!this.listeners_&&(e?e in this.listeners_:Object.keys(this.listeners_).length>0)}removeEventListener(e,t){if(!this.listeners_)return;const n=this.listeners_[e];if(!n)return;const s=n.indexOf(t);-1!==s&&(this.pendingRemovals_&&e in this.pendingRemovals_?(n[s]=is,++this.pendingRemovals_[e]):(n.splice(s,1),0===n.length&&delete this.listeners_[e]))}}var e,u,Xn,A="change",f7="error",Il="contextmenu",Ht="click",u7="dblclick",d7="dragenter",Y5="dragover",H2="drop",ul="keydown",V2="keypress",W2="load",t3="touchmove",yi="wheel",dt,ut,je,to,Vs,st,wr,_4,x4,C4,jr,hi,Da,Ma,c4,a4,Nc,s2,K8;function m(e,t,n,s,o){if(s&&s!==e&&(n=n.bind(s)),o){const s=n;n=function(){e.removeEventListener(t,n),s.apply(this,arguments)}}const i={target:e,type:t,listener:n};return e.addEventListener(t,n),i}function Hs(e,t,n,s){return m(e,t,n,s,!0)}function T(e){e&&e.target&&(e.target.removeEventListener(e.type,e.listener),Kn(e))}class co extends Ss{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(A)}getRevision(){return this.revision_}onInternal(e,t){if(Array.isArray(e)){const n=e.length,s=new Array(n);for(let o=0;o<n;++o)s[o]=m(this,e[o],t);return s}return m(this,e,t)}onceInternal(e,t){let n;if(Array.isArray(e)){const s=e.length;n=new Array(s);for(let o=0;o<s;++o)n[o]=Hs(this,e[o],t)}else n=Hs(this,e,t);return t.ol_key=n,n}unInternal(e,t){const n=t.ol_key;if(n)n3(n);else if(Array.isArray(e))for(let n=0,s=e.length;n<s;++n)this.removeEventListener(e[n],t);else this.removeEventListener(e,t)}}function n3(e){if(Array.isArray(e))for(let t=0,n=e.length;t<n;++t)T(e[t]);else T(e)}function g(){throw new Error("Unimplemented abstract method.")}co.prototype.on,co.prototype.once,co.prototype.un;let I5=0;function c(e){return e.ol_uid||(e.ol_uid=String(++I5))}class Ul extends ue{constructor(e,t,n){super(e),this.key=t,this.oldValue=n}}class Ye extends co{constructor(e){super(),this.on,this.once,this.un,c(this),this.values_=null,void 0!==e&&this.setProperties(e)}get(e){let t;return this.values_&&this.values_.hasOwnProperty(e)&&(t=this.values_[e]),t}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(e,t){let n;n=`change:${e}`,this.hasListener(n)&&this.dispatchEvent(new Ul(n,e,t)),n=Xn,this.hasListener(n)&&this.dispatchEvent(new Ul(n,e,t))}addChangeListener(e,t){this.addEventListener(`change:${e}`,t)}removeChangeListener(e,t){this.removeEventListener(`change:${e}`,t)}set(e,t,n){const s=this.values_||(this.values_={});if(n)s[e]=t;else{const n=s[e];s[e]=t,n!==t&&this.notify(e,n)}}setProperties(e,t){for(const n in e)this.set(n,e[n],t)}applyProperties(e){e.values_&&Object.assign(this.values_||(this.values_={}),e.values_)}unset(e,t){if(this.values_&&e in this.values_){const n=this.values_[e];delete this.values_[e],it(this.values_)&&(this.values_=null),t||this.notify(e,n)}}}dt="add",ut="remove";const l3="length";class Ci extends ue{constructor(e,t,n){super(e),this.element=t,this.index=n}}class me extends Ye{constructor(e,t){if(super(),this.on,this.once,this.un,t=t||{},this.unique_=!!t.unique,this.array_=e||[],this.unique_)for(let e=0,t=this.array_.length;e<t;++e)this.assertUnique_(this.array_[e],e);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(e){for(let t=0,n=e.length;t<n;++t)this.push(e[t]);return this}forEach(e){const t=this.array_;for(let n=0,s=t.length;n<s;++n)e(t[n],n,t)}getArray(){return this.array_}item(e){return this.array_[e]}getLength(){return this.get(l3)}insertAt(e,t){if(e<0||e>this.getLength())throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t),this.array_.splice(e,0,t),this.updateLength_(),this.dispatchEvent(new Ci(dt,t,e))}pop(){return this.removeAt(this.getLength()-1)}push(e){this.unique_&&this.assertUnique_(e);const t=this.getLength();return this.insertAt(t,e),this.getLength()}remove(e){const t=this.array_;for(let n=0,s=t.length;n<s;++n)if(t[n]===e)return this.removeAt(n)}removeAt(e){if(e<0||e>=this.getLength())return;const t=this.array_[e];return this.array_.splice(e,1),this.updateLength_(),this.dispatchEvent(new Ci(ut,t,e)),t}setAt(e,t){if(e>=this.getLength())return void this.insertAt(e,t);if(e<0)throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t,e);const n=this.array_[e];this.array_[e]=t,this.dispatchEvent(new Ci(ut,n,e)),this.dispatchEvent(new Ci(dt,t,e))}updateLength_(){this.set(l3,this.array_.length)}assertUnique_(e,t){for(let n=0,s=this.array_.length;n<s;++n)if(this.array_[n]===e&&n!==t)throw new Error("Duplicate item added to a unique collection")}}var ne=0,gt=1,L=2,Z=3,J=4;function Kl(e){return Math.pow(e,3)}function Hn(e){return 1-Kl(1-e)}function Wc(e){return 3*e*e-2*e*e*e}function C3(e){return e}class fs extends Ss{constructor(e,t,n){super(),n=n||{},this.tileCoord=e,this.state=t,this.interimTile=null,this.key="",this.transition_=void 0===n.transition?250:n.transition,this.transitionStarts_={},this.interpolate=!!n.interpolate}changed(){this.dispatchEvent(A)}release(){this.state===Z&&this.setState(J)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){let e=this.interimTile;if(!e)return this;do{if(e.getState()==L)return this.transition_=0,e;e=e.interimTile}while(e)return this}refreshInterimChain(){let e=this.interimTile;if(!e)return;let t=this;do{if(e.getState()==L){e.interimTile=null;break}e.getState()==gt?t=e:e.getState()==ne?t.interimTile=e.interimTile:t=e,e=t.interimTile}while(e)}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(e){if(this.state!==Z&&this.state>e)throw new Error("Tile load sequence violation");this.state=e,this.changed()}load(){g()}getAlpha(e,t){if(!this.transition_)return 1;let n=this.transitionStarts_[e];if(n){if(-1===n)return 1}else n=t,this.transitionStarts_[e]=n;const s=t-n+1e3/60;return s>=this.transition_?1:Kl(s/this.transition_)}inTransition(e){return!!this.transition_&&-1!==this.transitionStarts_[e]}endTransition(e){this.transition_&&(this.transitionStarts_[e]=-1)}}const es="undefined"!=typeof navigator&&void 0!==navigator.userAgent?navigator.userAgent.toLowerCase():"",rh=es.includes("firefox"),qm=es.includes("safari")&&!es.includes("chrom"),e8=qm&&(es.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(es)),j8=es.includes("webkit")&&!es.includes("edge"),Ic=es.includes("macintosh"),Hc="undefined"!=typeof devicePixelRatio?devicePixelRatio:1,ed="undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof OffscreenCanvas&&self instanceof WorkerGlobalScope,Pc="undefined"!=typeof Image&&Image.prototype.decode,M8="function"==typeof createImageBitmap,cd=function(){let e=!1;try{const t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch{}return e}();function K(e,t,n,s){let o;return o=n&&n.length?n.shift():ed?new OffscreenCanvas(e||300,t||300):document.createElement("canvas"),e&&(o.width=e),t&&(o.height=t),o.getContext("2d",s)}let ld;function Ei(){return ld||(ld=K(1,1)),ld}function zn(e){const t=e.canvas;t.width=1,t.height=1,e.clearRect(0,0,1,1)}function $8(e){let t=e.offsetWidth;const n=getComputedStyle(e);return t+=parseInt(n.marginLeft,10)+parseInt(n.marginRight,10),t}function Y8(e){let t=e.offsetHeight;const n=getComputedStyle(e);return t+=parseInt(n.marginTop,10)+parseInt(n.marginBottom,10),t}function Bs(e,t){const n=t.parentNode;n&&n.replaceChild(e,t)}function ki(e){return e&&e.parentNode?e.parentNode.removeChild(e):null}function ud(e){for(;e.lastChild;)e.removeChild(e.lastChild)}function hf(e,t){const n=e.childNodes;for(let i=0;;++i){const s=n[i],o=t[i];if(!s&&!o)break;s!==o&&(s?o?e.insertBefore(o,s):(e.removeChild(s),--i):e.appendChild(o))}}function Mi(e){return e instanceof Image||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageBitmap?e:null}function Ac(e){return e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Float32Array||e instanceof DataView?e:null}let Jo=null;function mf(e){Jo||(Jo=K(e.width,e.height,void 0,{willReadFrequently:!0}));const t=Jo.canvas,n=e.width;t.width!==n&&(t.width=n);const s=e.height;return t.height!==s&&(t.height=s),Jo.clearRect(0,0,n,s),Jo.drawImage(e,0,0),Jo.getImageData(0,0,n,s).data}const yp=[256,256];class Cc extends fs{constructor(e){const t=ne;super(e.tileCoord,t,{transition:e.transition,interpolate:e.interpolate}),this.loader_=e.loader,this.data_=null,this.error_=null,this.size_=e.size||null}getSize(){if(this.size_)return this.size_;const e=Mi(this.data_);return e?[e.width,e.height]:yp}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==ne&&this.state!==Z)return;this.state=gt,this.changed();const e=this;this.loader_().then(function(t){e.data_=t,e.state=L,e.changed()}).catch(function(t){e.error_=t,e.state=Z,e.changed()})}}function x(e,t){if(!e)throw new Error(t)}class N extends Ye{constructor(e){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),e)if("function"==typeof e.getSimplifiedGeometry){const t=e;this.setGeometry(t)}else{const t=e;this.setProperties(t)}}clone(){const e=new N(this.hasProperties()?this.getProperties():null);e.setGeometryName(this.getGeometryName());const t=this.getGeometry();t&&e.setGeometry(t.clone());const n=this.getStyle();return n&&e.setStyle(n),e}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(T(this.geometryChangeKey_),this.geometryChangeKey_=null);const e=this.getGeometry();e&&(this.geometryChangeKey_=m(e,A,this.handleGeometryChange_,this)),this.changed()}setGeometry(e){this.set(this.geometryName_,e)}setStyle(e){this.style_=e,this.styleFunction_=e?bf(e):void 0,this.changed()}setId(e){this.id_=e,this.changed()}setGeometryName(e){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=e,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function bf(e){if("function"==typeof e)return e;let t;return Array.isArray(e)?t=e:(x("function"==typeof e.getZIndex,"Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),t=[e]),function(){return t}}const fd=new Array(6);function T6(){return[1,0,0,1,0,0]}function hc(e){return Yo(e,1,0,0,1,0,0)}function dn(e,t){const n=e[0],s=e[1],o=e[2],i=e[3],h=e[4],m=e[5],a=t[0],r=t[1],c=t[2],l=t[3],d=t[4],u=t[5];return e[0]=n*a+o*r,e[1]=s*a+i*r,e[2]=n*c+o*l,e[3]=s*c+i*l,e[4]=n*d+o*u+h,e[5]=s*d+i*u+m,e}function Yo(e,t,n,s,o,i,a){return e[0]=t,e[1]=n,e[2]=s,e[3]=o,e[4]=i,e[5]=a,e}function Ui(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function R(e,t){const n=t[0],s=t[1];return t[0]=e[0]*n+e[2]*s+e[4],t[1]=e[1]*n+e[3]*s+e[5],t}function e6(e,t){const n=Math.cos(t),s=Math.sin(t);return dn(e,Yo(fd,n,s,-s,n,0,0))}function qs(e,t,n){return dn(e,Yo(fd,t,0,0,n,0,0))}function Ko(e,t,n){return dn(e,Yo(fd,1,0,0,1,t,n))}function Le(e,t,n,s,o,i,a,r){const c=Math.sin(i),l=Math.cos(i);return e[0]=s*l,e[1]=o*c,e[2]=-s*c,e[3]=o*l,e[4]=a*s*l-r*s*c+t,e[5]=a*o*c+r*o*l+n,e}function Kt(e,t){const n=d6(t);x(0!==n,"Transformation matrix cannot be inverted");const s=t[0],o=t[1],i=t[2],a=t[3],r=t[4],c=t[5];return e[0]=a/n,e[1]=-o/n,e[2]=-i/n,e[3]=s/n,e[4]=(i*c-a*r)/n,e[5]=-(s*c-o*r)/n,e}function d6(e){return e[0]*e[3]-e[1]*e[2]}const Uf=[1e6,1e6,1e6,1e6,2,2];function yd(e){return"matrix("+e.map((e,t)=>Math.round(e*Uf[t])/Uf[t]).join(", ")+")"}je={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function oe(e){const t=If();for(let n=0,s=e.length;n<s;++n)vs(t,e[n]);return t}function Fe(e,t,n){return n?(n[0]=e[0]-t,n[1]=e[1]-t,n[2]=e[2]+t,n[3]=e[3]+t,n):[e[0]-t,e[1]-t,e[2]+t,e[3]+t]}function _d(e,t){return t?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t):e.slice()}function Gn(e,t,n){let s,o;return s=t<e[0]?e[0]-t:e[2]<t?t-e[2]:0,o=n<e[1]?e[1]-n:e[3]<n?n-e[3]:0,s*s+o*o}function qe(e,t){return Zr(e,t[0],t[1])}function xe(e,t){return e[0]<=t[0]&&t[2]<=e[2]&&e[1]<=t[1]&&t[3]<=e[3]}function Zr(e,t,n){return e[0]<=t&&t<=e[2]&&e[1]<=n&&n<=e[3]}function Qr(e,t){const i=e[0],a=e[1],r=e[2],c=e[3],s=t[0],o=t[1];let n=je.UNKNOWN;return s<i?n|=je.LEFT:s>r&&(n|=je.RIGHT),o<a?n|=je.BELOW:o>c&&(n|=je.ABOVE),n===je.UNKNOWN&&(n=je.INTERSECTING),n}function If(){return[1/0,1/0,-1/0,-1/0]}function Ge(e,t,n,s,o){return o?(o[0]=e,o[1]=t,o[2]=n,o[3]=s,o):[e,t,n,s]}function mn(e){return Ge(1/0,1/0,-1/0,-1/0,e)}function hs(e,t){const n=e[0],s=e[1];return Ge(n,s,n,s,t)}function Gr(e,t,n,s,o){return Td(mn(o),e,t,n,s)}function Ue(e,t){return e[0]==t[0]&&e[2]==t[2]&&e[1]==t[1]&&e[3]==t[3]}function Pf(e,t,n){return Math.abs(e[0]-t[0])<n&&Math.abs(e[2]-t[2])<n&&Math.abs(e[1]-t[1])<n&&Math.abs(e[3]-t[3])<n}function Cd(e,t){return t[0]<e[0]&&(e[0]=t[0]),t[2]>e[2]&&(e[2]=t[2]),t[1]<e[1]&&(e[1]=t[1]),t[3]>e[3]&&(e[3]=t[3]),e}function vs(e,t){t[0]<e[0]&&(e[0]=t[0]),t[0]>e[2]&&(e[2]=t[0]),t[1]<e[1]&&(e[1]=t[1]),t[1]>e[3]&&(e[3]=t[1])}function kd(e,t){for(let n=0,s=t.length;n<s;++n)vs(e,t[n]);return e}function Td(e,t,n,s,o){for(;n<s;n+=o)Ff(e,t[n],t[n+1]);return e}function Tf(e,t){for(let n=0,s=t.length;n<s;++n)kd(e,t[n]);return e}function Ff(e,t,n){e[0]=Math.min(e[0],t),e[1]=Math.min(e[1],n),e[2]=Math.max(e[2],t),e[3]=Math.max(e[3],n)}function Br(e,t){let n;return n=t(xn(e)),n||(n=t(Ws(e)),n||(n=t(Rs(e)),n||(n=t(ht(e)),n||!1)))}function Nn(e){let t=0;return Ft(e)||(t=b(e)*W(e)),t}function xn(e){return[e[0],e[1]]}function Ws(e){return[e[2],e[1]]}function _e(e){return[(e[0]+e[2])/2,(e[1]+e[3])/2]}function Mf(e,t){let n;if("bottom-left"===t)n=xn(e);else if("bottom-right"===t)n=Ws(e);else if("top-left"===t)n=ht(e);else{if("top-right"!==t)throw new Error("Invalid corner");n=Rs(e)}return n}function Po(e,t,n,s,o){const[i,a,r,c,l,d,u,h]=Hr(e,t,n,s);return Ge(Math.min(i,r,l,u),Math.min(a,c,d,h),Math.max(i,r,l,u),Math.max(a,c,d,h),o)}function Hr(e,t,n,s){const d=t*s[0]/2,u=t*s[1]/2,h=Math.cos(n),m=Math.sin(n),o=d*h,i=d*m,a=u*h,r=u*m,c=e[0],l=e[1];return[c-o+r,l-i-a,c-o-r,l-i+a,c+o-r,l+i+a,c+o+r,l+i-a,c-o+r,l-i-a]}function W(e){return e[3]-e[1]}function ce(e,t,n){const s=n||[1/0,1/0,-1/0,-1/0];return U(e,t)?(e[0]>t[0]?s[0]=e[0]:s[0]=t[0],e[1]>t[1]?s[1]=e[1]:s[1]=t[1],e[2]<t[2]?s[2]=e[2]:s[2]=t[2],e[3]<t[3]?s[3]=e[3]:s[3]=t[3]):mn(s),s}function ht(e){return[e[0],e[3]]}function Rs(e){return[e[2],e[3]]}function b(e){return e[2]-e[0]}function U(e,t){return e[0]<=t[2]&&e[2]>=t[0]&&e[1]<=t[3]&&e[3]>=t[1]}function Ft(e){return e[2]<e[0]||e[3]<e[1]}function Sf(e,t){return t?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t):e}function Rr(e,t){const n=(e[2]-e[0])/2*(t-1),s=(e[3]-e[1])/2*(t-1);e[0]-=n,e[2]+=n,e[1]-=s,e[3]+=s}function kf(e,t,n){let s=!1;const o=Qr(e,t),i=Qr(e,n);if(o===je.INTERSECTING||i===je.INTERSECTING)s=!0;else{const u=e[0],h=e[1],m=e[2],f=e[3],p=t[0],g=t[1],c=n[0],l=n[1],d=(l-g)/(c-p);let a,r;i&je.ABOVE&&!(o&je.ABOVE)&&(a=c-(l-f)/d,s=a>=u&&a<=m),s||!(i&je.RIGHT)||o&je.RIGHT||(r=l-(c-m)*d,s=r>=h&&r<=f),s||!(i&je.BELOW)||o&je.BELOW||(a=c-(l-h)/d,s=a>=u&&a<=m),s||!(i&je.LEFT)||o&je.LEFT||(r=l-(c-u)*d,s=r>=h&&r<=f)}return s}function Fs(e,t,n,s){if(Ft(e))return mn(n);let o=[];if(s>1){const t=e[2]-e[0],n=e[3]-e[1];for(let i=0;i<s;++i)o.push(e[0]+t*i/s,e[1],e[2],e[1]+n*i/s,e[2]-t*i/s,e[3],e[0],e[3]-n*i/s)}else o=[e[0],e[1],e[2],e[1],e[2],e[3],e[0],e[3]];t(o,o,2);const i=[],a=[];for(let e=0,t=o.length;e<t;e+=2)i.push(o[e]),a.push(o[e+1]);return function(e,t,n){return Ge(Math.min.apply(null,e),Math.min.apply(null,t),Math.max.apply(null,e),Math.max.apply(null,t),n)}(i,a,n)}function Lr(e,t){const n=t.getExtent(),s=_e(e);if(t.canWrapX()&&(s[0]<n[0]||s[0]>=n[2])){const t=b(n),o=Math.floor((s[0]-n[0])/t)*t;e[0]-=o,e[2]-=o}return e}function Dr(e,t,n){if(t.canWrapX()){const s=t.getExtent();if(!isFinite(e[0])||!isFinite(e[2]))return[[s[0],e[1],s[2],e[3]]];Lr(e,t);const o=b(s);if(b(e)>o&&!n)return[[s[0],e[1],s[2],e[3]]];if(e[0]<s[0])return[[e[0]+o,e[1],s[2],e[3]],[s[0],e[1],e[2],e[3]]];if(e[2]>s[2])return[[e[0],e[1],s[2],e[3]],[s[0],e[1],e[2]-o,e[3]]]}return[e]}const jp={9001:"m",9002:"ft",9003:"us-ft",9101:"radians",9102:"degrees"};function Dd(e){return jp[e]}const rs={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};class ns{constructor(e){this.code_=e.code,this.units_=e.units,this.extent_=void 0!==e.extent?e.extent:null,this.worldExtent_=void 0!==e.worldExtent?e.worldExtent:null,this.axisOrientation_=void 0!==e.axisOrientation?e.axisOrientation:"enu",this.global_=void 0!==e.global&&e.global,this.canWrapX_=!!this.global_&&!!this.extent_,this.getPointResolutionFunc_=e.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=e.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||rs[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(e){this.global_=e,this.canWrapX_=!!e&&!!this.extent_}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(e){this.defaultTileGrid_=e}setExtent(e){this.extent_=e,this.canWrapX_=!!this.global_&&!!e}setWorldExtent(e){this.worldExtent_=e}setGetPointResolution(e){this.getPointResolutionFunc_=e}getPointResolutionFunc(){return this.getPointResolutionFunc_}}const To=6378137,js=Math.PI*To,uf=[-js,-js,js,js],df=[-180,-85,180,85],ia=To*Math.log(Math.tan(Math.PI/2));class Do extends ns{constructor(e){super({code:e,units:"m",extent:uf,global:!0,worldExtent:df,getPointResolution:function(e,t){return e/Math.cosh(t[1]/To)}})}}const Vd=[new Do("EPSG:3857"),new Do("EPSG:102100"),new Do("EPSG:102113"),new Do("EPSG:900913"),new Do("http://www.opengis.net/def/crs/EPSG/0/3857"),new Do("http://www.opengis.net/gml/srs/epsg.xml#3857")];function z4(e,t,n){const s=e.length;n=n>1?n:2,void 0===t&&(t=n>2?e.slice():new Array(s));for(let o=0;o<s;o+=n){t[o]=js*e[o]/180;let i=To*Math.log(Math.tan(Math.PI*(+e[o+1]+90)/360));i>ia?i=ia:i<-ia&&(i=-ia),t[o+1]=i}return t}function x8(e,t,n){const s=e.length;n=n>1?n:2,void 0===t&&(t=n>2?e.slice():new Array(s));for(let o=0;o<s;o+=n)t[o]=180*e[o]/js,t[o+1]=360*Math.atan(Math.exp(e[o+1]/To))/Math.PI-90;return t}const O8=6378137,Yd=[-180,-90,180,90],b8=Math.PI*O8/180;class ks extends ns{constructor(e,t){super({code:e,units:"degrees",extent:Yd,axisOrientation:t,global:!0,metersPerUnit:b8,worldExtent:Yd})}}const Xd=[new ks("CRS:84"),new ks("EPSG:4326","neu"),new ks("urn:ogc:def:crs:OGC:1.3:CRS84"),new ks("urn:ogc:def:crs:OGC:2:84"),new ks("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new ks("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new ks("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let Ar={};function f8(){Ar={}}function m8(e){return Ar[e]||Ar[e.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function d8(e,t){Ar[e]=t}let yt={};function l8(){yt={}}function Gs(e,t,n){const s=e.getCode(),o=t.getCode();s in yt||(yt[s]={}),yt[s][o]=n}function Qd(e,t){let n;return e in yt&&t in yt[e]&&(n=yt[e][t]),n}function y(e,t,n){return Math.min(Math.max(e,t),n)}function Zd(e,t,n,s,o,i){const a=o-n,r=i-s;if(0!==a||0!==r){const c=((e-n)*a+(t-s)*r)/(a*a+r*r);c>1?(n=o,s=i):c>0&&(n+=a*c,s+=r*c)}return wt(e,t,n,s)}function wt(e,t,n,s){const o=n-e,i=s-t;return o*o+i*i}function a8(e){const t=e.length;for(let n=0;n<t;n++){let s=n,o=Math.abs(e[n][n]);for(let i=n+1;i<t;i++){const a=Math.abs(e[i][n]);a>o&&(o=a,s=i)}if(0===o)return null;const i=e[s];e[s]=e[n],e[n]=i;for(let s=n+1;s<t;s++){const o=-e[s][n]/e[n][n];for(let i=n;i<t+1;i++)n==i?e[s][i]=0:e[s][i]+=o*e[n][i]}}const n=new Array(t);for(let s=t-1;s>=0;s--){n[s]=e[s][t]/e[s][s];for(let o=s-1;o>=0;o--)e[o][t]-=e[o][s]*n[s]}return n}function ca(e){return 180*e/Math.PI}function we(e){return e*Math.PI/180}function ft(e,t){const n=e%t;return n*t<0?n+t:n}function $e(e,t,n){return e+n*(t-e)}function kn(e,t){const n=Math.pow(10,t);return Math.round(e*n)/n}function la(e,t){return Math.round(kn(e,t))}function Ps(e,t){return Math.floor(kn(e,t))}function en(e,t){return Math.ceil(kn(e,t))}function On(e,t,n){const o=void 0!==n?e.toFixed(n):""+e;let s=o.indexOf(".");return s=-1===s?o.length:s,s>t?o:new Array(1+t-s).join("0")+o}function xr(e,t){const n=(""+e).split("."),s=(""+t).split(".");for(let e=0;e<Math.max(n.length,s.length);e++){const t=parseInt(n[e]||"0",10),o=parseInt(s[e]||"0",10);if(t>o)return 1;if(o>t)return-1}return 0}function Jd(e,t){return e[0]+=+t[0],e[1]+=+t[1],e}function o8(e,t){const o=t.getRadius(),i=t.getCenter(),a=i[0],r=i[1];let n=e[0]-a;const s=e[1]-r;0===n&&0===s&&(n=1);const c=Math.sqrt(n*n+s*s);return[a+o*n/c,r+o*s/c]}function ha(e,t){const m=e[0],f=e[1],h=t[0],l=t[1],r=h[0],c=h[1],u=l[0],d=l[1],n=u-r,s=d-c,a=0===n&&0===s?0:(n*(m-r)+s*(f-c))/(n*n+s*s||0);let i,o;return a<=0?(i=r,o=c):a>=1?(i=u,o=d):(i=r+a*n,o=c+a*s),[i,o]}function ga(e,t,n){const r=ft(t+180,360)-180,c=Math.abs(3600*r),l=n||0;let i=Math.floor(c/3600),s=Math.floor((c-3600*i)/60),o=kn(c-3600*i-60*s,l);o>=60&&(o=0,s+=1),s>=60&&(s=0,i+=1);let a=i+"°";return 0===s&&0===o||(a+=" "+On(s,2)+"′"),0!==o&&(a+=" "+On(o,2,l)+"″"),0!==r&&(a+=" "+e.charAt(r<0?1:0)),a}function s8(e,t,n){return e?t.replace("{x}",e[0].toFixed(n)).replace("{y}",e[1].toFixed(n)):""}function at(e,t){let n=!0;for(let s=e.length-1;s>=0;--s)if(e[s]!=t[s]){n=!1;break}return n}function br(e,t){const n=Math.cos(t),s=Math.sin(t),o=e[0]*n-e[1]*s,i=e[1]*n+e[0]*s;return e[0]=o,e[1]=i,e}function eu(e,t){return e[0]*=t,e[1]*=t,e}function nt(e,t){const n=e[0]-t[0],s=e[1]-t[1];return n*n+s*s}function Lo(e,t){return Math.sqrt(nt(e,t))}function vr(e,t){return nt(e,ha(e,t))}function t8(e,t){return s8(e,"{x}, {y}",t)}function va(e,t){if(t.canWrapX()){const n=b(t.getExtent()),s=tu(e,t,n);s&&(e[0]-=s*n)}return e}function tu(e,t,n){const s=t.getExtent();let o=0;return t.canWrapX()&&(e[0]<s[0]||e[0]>s[2])&&(n=n||b(s),o=Math.floor((e[0]-s[0])/n)),o}const ba=6371008.8;function dr(e,t,n){n=n||ba;const s=we(e[1]),o=we(t[1]),i=(o-s)/2,a=we(t[0]-e[0])/2,r=Math.sin(i)*Math.sin(i)+Math.sin(a)*Math.sin(a)*Math.cos(s)*Math.cos(o);return 2*n*Math.atan2(Math.sqrt(r),Math.sqrt(1-r))}function nu(e,t){let n=0;for(let s=0,o=e.length;s<o-1;++s)n+=dr(e[s],e[s+1],t);return n}function cr(e,t){let s=0;const n=e.length;let o=e[n-1][0],i=e[n-1][1];for(let t=0;t<n;t++){const a=e[t][0],r=e[t][1];s+=we(a-o)*(2+Math.sin(we(i))+Math.sin(we(r))),o=a,i=r}return s*t*t/2}function Xm(e,t,n,s){s=s||ba;const o=we(e[1]),r=we(e[0]),i=t/s,a=Math.asin(Math.sin(o)*Math.cos(i)+Math.cos(o)*Math.sin(i)*Math.cos(n));return[ca(r+Math.atan2(Math.sin(n)*Math.sin(i)*Math.cos(o),Math.cos(i)-Math.sin(o)*Math.sin(a))),ca(a)]}const Aa={info:1,warn:2,error:3,none:4};let nr=Aa.info;function su(...e){nr>Aa.warn||console.warn(...e)}function Mo(...e){nr>Aa.error||console.error(...e)}let iu=!0;function au(e){iu=void 0!==e&&!e}function Za(e,t){if(void 0!==t)for(let n=0,s=e.length;n<s;++n)t[n]=e[n];else t=e.slice();return t}function Ta(e,t){if(void 0!==t&&e!==t){for(let n=0,s=e.length;n<s;++n)t[n]=e[n];e=t}return e}function cu(e){d8(e.getCode(),e),Gs(e,e,Za)}function Im(e){e.forEach(cu)}function d(e){return"string"==typeof e?m8(e):e||null}function Na(e,t,n,s){let o;const i=(e=d(e)).getPointResolutionFunc();if(i){if(o=i(t,n),s&&s!==e.getUnits()){const t=e.getMetersPerUnit();t&&(o=o*t/rs[s])}}else{const i=e.getUnits();if("degrees"==i&&!s||"degrees"==s)o=t;else{const a=De(e,d("EPSG:4326"));if(a===Ta&&"degrees"!==i)o=t*e.getMetersPerUnit();else{let e=[n[0]-t/2,n[1],n[0]+t/2,n[1],n[0],n[1]-t/2,n[0],n[1]+t/2];e=a(e,e,2),o=(dr(e.slice(0,2),e.slice(2,4))+dr(e.slice(4,6),e.slice(6,8)))/2}const r=s?rs[s]:e.getMetersPerUnit();void 0!==r&&(o/=r)}}return o}function qa(e){Im(e),e.forEach(function(t){e.forEach(function(e){t!==e&&Gs(t,e,Za)})})}function Hm(e,t,n,s){e.forEach(function(e){t.forEach(function(t){Gs(e,t,n),Gs(t,e,s)})})}function Ua(e,t){return e?"string"==typeof e?d(e):e:d(t)}function du(e){return function(t,n,s){const o=t.length;s=void 0!==s?s:2,n=void 0!==n?n:new Array(o);for(let i=0;i<o;i+=s){const a=e(t.slice(i,i+s)),r=a.length;for(let e=0,o=s;e<o;++e)n[i+e]=e>=r?t[i+e]:a[e]}return n}}function Lm(e,t,n,s){const o=d(e),i=d(t);Gs(o,i,du(n)),Gs(i,o,du(s))}function mu(e,t){const n=Jn(e,void 0!==t?t:"EPSG:3857","EPSG:4326"),s=n[0];return(s<-180||s>180)&&(n[0]=ft(s+180,360)-180),n}function Oe(e,t){if(e===t)return!0;const n=e.getUnits()===t.getUnits();return e.getCode()===t.getCode()?n:De(e,t)===Za&&n}function De(e,t){let n=Qd(e.getCode(),t.getCode());return n||(n=Ta),n}function pt(e,t){return De(d(e),d(t))}function Jn(e,t,n){return pt(t,n)(e,void 0,e.length)}function Ha(e,t,n,s){return Fs(e,pt(t,n),void 0,s)}let Ne=null;function ym(e){Ne=d(e)}function le(){return Ne}function un(e,t){return Ne?Jn(e,t,Ne):e}function I(e,t){return Ne?Jn(e,Ne,t):(iu&&!at(e,[0,0])&&e[0]>=-180&&e[0]<=180&&e[1]>=-90&&e[1]<=90&&(iu=!1,su("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),e)}function Tt(e,t){return Ne?Ha(e,t,Ne):e}function Pe(e,t){return Ne?Ha(e,Ne,t):e}function fu(e,t){if(!Ne)return e;const n=d(t).getMetersPerUnit(),s=Ne.getMetersPerUnit();return n&&s?e*n/s:e}function pm(e,t){if(!Ne)return e;const n=d(t).getMetersPerUnit(),s=Ne.getMetersPerUnit();return n&&s?e*s/n:e}function gu(e,t,n){return function(s){let i,o;if(e.canWrapX()){const t=e.getExtent(),a=b(t);o=tu(s=s.slice(0),e,a),o&&(s[0]=s[0]-o*a),s[0]=y(s[0],t[0],t[2]),s[1]=y(s[1],t[1],t[3]),i=n(s)}else i=n(s);return o&&t.canWrapX()&&(i[0]+=o*b(t.getExtent())),i}}function mm(){qa(Vd),qa(Xd),Hm(Xd,Vd,z4,x8)}function bt(e,t,n,s,o,i){i=i||[];let a=0;for(let r=t;r<n;r+=s){const c=e[r],l=e[r+1];i[a++]=o[0]*c+o[2]*l+o[4],i[a++]=o[1]*c+o[3]*l+o[5]}return i&&i.length!=a&&(i.length=a),i}function or(e,t,n,s,o,i,a){a=a||[];const c=Math.cos(o),l=Math.sin(o),d=i[0],u=i[1];let r=0;for(let o=t;o<n;o+=s){const i=e[o]-d,h=e[o+1]-u;a[r++]=d+i*c-h*l,a[r++]=u+i*l+h*c;for(let t=o+2;t<o+s;++t)a[r++]=e[t]}return a&&a.length!=r&&(a.length=r),a}function im(e,t,n,s,o,i,a,r){r=r||[];const l=a[0],d=a[1];let c=0;for(let a=t;a<n;a+=s){const u=e[a]-l,h=e[a+1]-d;r[c++]=l+o*u,r[c++]=d+i*h;for(let t=a+2;t<a+s;++t)r[c++]=e[t]}return r&&r.length!=c&&(r.length=c),r}function nm(e,t,n,s,o,i,a){a=a||[];let r=0;for(let c=t;c<n;c+=s){a[r++]=e[c]+o,a[r++]=e[c+1]+i;for(let t=c+2;t<c+s;++t)a[r++]=e[t]}return a&&a.length!=r&&(a.length=r),a}mm();const Jh=[1,0,0,1,0,0];class ur extends Ye{constructor(){super(),this.extent_=[1/0,1/0,-1/0,-1/0],this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=Rl((e,t,n)=>{if(!n)return this.getSimplifiedGeometry(t);const s=this.clone();return s.applyTransform(n),s.getSimplifiedGeometry(t)})}simplifyTransformed(e,t){return this.simplifyTransformedInternal(this.getRevision(),e,t)}clone(){return g()}closestPointXY(){return g()}containsXY(e,t){const n=this.getClosestPoint([e,t]);return n[0]===e&&n[1]===t}getClosestPoint(e,t){return t=t||[NaN,NaN],this.closestPointXY(e[0],e[1],t,1/0),t}intersectsCoordinate(e){return this.containsXY(e[0],e[1])}computeExtent(){return g()}getExtent(e){if(this.extentRevision_!=this.getRevision()){const e=this.computeExtent(this.extent_);(isNaN(e[0])||isNaN(e[1]))&&mn(e),this.extentRevision_=this.getRevision()}return Sf(this.extent_,e)}rotate(){g()}scale(){g()}simplify(e){return this.getSimplifiedGeometry(e*e)}getSimplifiedGeometry(){return g()}getType(){return g()}applyTransform(){g()}intersectsExtent(){return g()}translate(){g()}transform(e,t){const n=d(e),s="tile-pixels"==n.getUnits()?function(e,s,o){const r=n.getExtent(),i=n.getWorldExtent(),a=W(i)/W(r);return Le(Jh,i[0],i[3],a,-a,0,0,0),bt(e,0,e.length,o,Jh,s),pt(n,t)(e,s,o)}:pt(n,t);return this.applyTransform(s),this}}class jt extends ur{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(e){return Gr(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}getCoordinates(){return g()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&e<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=this.getSimplifiedGeometryInternal(e);return t.getFlatCoordinates().length<this.flatCoordinates.length?t:(this.simplifiedGeometryMaxMinSquaredTolerance=e,this)}getSimplifiedGeometryInternal(){return this}getStride(){return this.stride}setFlatCoordinates(e,t){this.stride=mo(e),this.layout=e,this.flatCoordinates=t}setCoordinates(){g()}setLayout(e,t,n){let s;if(e)s=mo(e);else{for(let e=0;e<n;++e){if(0===t.length)return this.layout="XY",void(this.stride=2);t=t[0]}s=t.length,e=Fn(s)}this.layout=e,this.stride=s}applyTransform(e){this.flatCoordinates&&(e(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())}rotate(e,t){const n=this.getFlatCoordinates();if(n){const s=this.getStride();or(n,0,n.length,s,e,t,n),this.changed()}}scale(e,t,n){void 0===t&&(t=e),n||(n=_e(this.getExtent()));const s=this.getFlatCoordinates();if(s){const o=this.getStride();im(s,0,s.length,o,e,t,n,s),this.changed()}}translate(e,t){const n=this.getFlatCoordinates();if(n){const s=this.getStride();nm(n,0,n.length,s,e,t,n),this.changed()}}}function Fn(e){let t;return 2==e?t="XY":3==e?t="XYZ":4==e&&(t="XYZM"),t}function mo(e){let t;return"XY"==e?t=2:"XYZ"==e||"XYM"==e?t=3:"XYZM"==e&&(t=4),t}function Zh(e,t,n){const s=e.getFlatCoordinates();if(!s)return null;const o=e.getStride();return bt(s,0,s.length,o,t,n)}function T4(e,t,n,s,o,i,a){const d=e[t],u=e[t+1],r=e[n]-d,c=e[n+1]-u;let l;if(0===r&&0===c)l=t;else{const h=((o-d)*r+(i-u)*c)/(r*r+c*c);if(h>1)l=n;else{if(h>0){for(let o=0;o<s;++o)a[o]=$e(e[t+o],e[n+o],h);return void(a.length=s)}l=t}}for(let t=0;t<s;++t)a[t]=e[l+t];a.length=s}function pr(e,t,n,s,o){let i=e[t],a=e[t+1];for(t+=s;t<n;t+=s){const r=e[t],c=e[t+1],l=wt(i,a,r,c);l>o&&(o=l),i=r,a=c}return o}function gr(e,t,n,s,o){for(let i=0,r=n.length;i<r;++i){const a=n[i];o=pr(e,t,a,s,o),t=a}return o}function Xh(e,t,n,s,o){for(let i=0,r=n.length;i<r;++i){const a=n[i];o=gr(e,t,a,s,o),t=a[a.length-1]}return o}function yr(e,t,n,s,o,i,a,r,c,l,d){if(t==n)return l;let u,h;if(0===o){if(h=wt(a,r,e[t],e[t+1]),h<l){for(u=0;u<s;++u)c[u]=e[t+u];return c.length=s,h}return l}d=d||[NaN,NaN];let m=t+s;for(;m<n;)if(T4(e,m-s,m,s,a,r,d),h=wt(a,r,d[0],d[1]),h<l){for(l=h,u=0;u<s;++u)c[u]=d[u];c.length=s,m+=s}else m+=s*Math.max((Math.sqrt(h)-Math.sqrt(l))/o|0,1);if(i&&(T4(e,n-s,t,s,a,r,d),h=wt(a,r,d[0],d[1]),h<l)){for(l=h,u=0;u<s;++u)c[u]=d[u];c.length=s}return l}function _r(e,t,n,s,o,i,a,r,c,l,d){d=d||[NaN,NaN];for(let u=0,m=n.length;u<m;++u){const h=n[u];l=yr(e,t,h,s,o,i,a,r,c,l,d),t=h}return l}function Bh(e,t,n,s,o,i,a,r,c,l,d){d=d||[NaN,NaN];for(let u=0,m=n.length;u<m;++u){const h=n[u];l=_r(e,t,h,s,o,i,a,r,c,l,d),t=h[h.length-1]}return l}function wu(e,t,n){for(let s=0,o=n.length;s<o;++s)e[t++]=n[s];return t}function io(e,t,n,s){for(let o=0,i=n.length;o<i;++o){const a=n[o];for(let n=0;n<s;++n)e[t++]=a[n]}return t}function oo(e,t,n,s,o){o=o||[];let i=0;for(let a=0,c=n.length;a<c;++a){const r=io(e,t,n[a],s);o[i++]=r,t=r}return o.length=i,o}function xu(e,t,n,s,o){o=o||[];let i=0;for(let r=0,c=n.length;r<c;++r){const a=oo(e,t,n[r],s,o[i]);0===a.length&&(a[0]=t),o[i++]=a,t=a[a.length-1]}return o.length=i,o}function so(e,t,n,s,o,i,a){const l=(n-t)/s;if(l<3){for(;t<n;t+=s)i[a++]=e[t],i[a++]=e[t+1];return a}const d=new Array(l);d[0]=1,d[l-1]=1;const c=[t,n-s];let r=0;for(;c.length>0;){const n=c.pop(),i=c.pop();let a=0;const l=e[i],u=e[i+1],h=e[n],m=e[n+1];for(let t=i+s;t<n;t+=s){const o=Zd(e[t],e[t+1],l,u,h,m);o>a&&(r=t,a=o)}a>o&&(d[(r-t)/s]=1,i+s<r&&c.push(i,r),r+s<n&&c.push(r,n))}for(let n=0;n<l;++n)d[n]&&(i[a++]=e[t+n*s],i[a++]=e[t+n*s+1]);return a}function Er(e,t,n,s,o,i,a,r){for(let c=0,d=n.length;c<d;++c){const l=n[c];a=so(e,t,l,s,o,i,a),r.push(a),t=l}return a}function Mh(e,t,n,s,o,i,a){if(n<=t+s){for(;t<n;t+=s)i[a++]=e[t],i[a++]=e[t+1];return a}let l=e[t],d=e[t+1];i[a++]=l,i[a++]=d;let r=l,c=d;for(t+=s;t<n;t+=s)r=e[t],c=e[t+1],wt(l,d,r,c)>o&&(i[a++]=r,i[a++]=c,l=r,d=c);return r==l&&c==d||(i[a++]=r,i[a++]=c),a}function qn(e,t){return t*Math.round(e/t)}function wh(e,t,n,s,o,i,a){if(t==n)return a;let r,c,l=qn(e[t],o),d=qn(e[t+1],o);t+=s,i[a++]=l,i[a++]=d;do if(r=qn(e[t],o),c=qn(e[t+1],o),(t+=s)==n)return i[a++]=r,i[a++]=c,a;while(r==l&&c==d)for(;t<n;){const m=qn(e[t],o),f=qn(e[t+1],o);if(t+=s,m==r&&f==c)continue;const u=r-l,h=c-d,p=m-l,g=f-d;u*g==h*p&&(u<0&&p<u||u==p||u>0&&p>u)&&(h<0&&g<h||h==g||h>0&&g>h)?(r=m,c=f):(i[a++]=r,i[a++]=c,l=r,d=c,r=m,c=f)}return i[a++]=r,i[a++]=c,a}function Fr(e,t,n,s,o,i,a,r){for(let c=0,d=n.length;c<d;++c){const l=n[c];a=wh(e,t,l,s,o,i,a),r.push(a),t=l}return a}function vh(e,t,n,s,o,i,a,r){for(let c=0,u=n.length;c<u;++c){const l=n[c],d=[];a=Fr(e,t,l,s,o,i,a,d),r.push(d),t=l[l.length-1]}return a}function Pt(e,t,n,s,o){o=void 0!==o?o:[];let i=0;for(let a=t;a<n;a+=s)o[i++]=e.slice(a,a+s);return o.length=i,o}function eo(e,t,n,s,o){o=void 0!==o?o:[];let i=0;for(let a=0,c=n.length;a<c;++a){const r=n[a];o[i++]=Pt(e,t,r,s,o[i]),t=r}return o.length=i,o}function Pr(e,t,n,s,o){o=void 0!==o?o:[];let i=0;for(let r=0,c=n.length;r<c;++r){const a=n[r];o[i++]=1===a.length&&a[0]===t?[]:eo(e,t,a,s,o[i]),t=a[a.length-1]}return o.length=i,o}function Ir(e,t,n,s){let o=0,i=e[n-s],a=e[n-s+1];for(;t<n;t+=s){const r=e[t],c=e[t+1];o+=a*r-i*c,i=r,a=c}return o/2}function Du(e,t,n,s){let o=0;for(let i=0,r=n.length;i<r;++i){const a=n[i];o+=Ir(e,t,a,s),t=a}return o}function dh(e,t,n,s){let o=0;for(let i=0,r=n.length;i<r;++i){const a=n[i];o+=Du(e,t,a,s),t=a[a.length-1]}return o}class Tn extends jt{constructor(e,t){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,void 0===t||Array.isArray(e[0])?this.setCoordinates(e,t):this.setFlatCoordinates(t,e)}clone(){return new Tn(this.flatCoordinates.slice(),this.layout)}closestPointXY(e,t,n,s){return s<Gn(this.getExtent(),e,t)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(pr(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),yr(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,e,t,n,s))}getArea(){return Ir(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return Pt(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(e){const t=[];return t.length=so(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0),new Tn(t,"XY")}getType(){return"LinearRing"}intersectsExtent(){return!1}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=io(this.flatCoordinates,0,e,this.stride),this.changed()}}class Y extends jt{constructor(e,t){super(),this.setCoordinates(e,t)}clone(){const e=new Y(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,n,s){const o=this.flatCoordinates,i=wt(e,t,o[0],o[1]);if(i<s){const e=this.stride;for(let t=0;t<e;++t)n[t]=o[t];return n.length=e,i}return s}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(e){return hs(this.flatCoordinates,e)}getType(){return"Point"}intersectsExtent(e){return Zr(e,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(e,t){this.setLayout(t,e,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=wu(this.flatCoordinates,0,e,this.stride),this.changed()}}function lh(e,t,n,s,o){return!Br(o,function(o){return!Pn(e,t,n,s,o[0],o[1])})}function Pn(e,t,n,s,o,i){let c=0,r=e[n-s],a=e[n-s+1];for(;t<n;t+=s){const d=e[t],l=e[t+1];a<=i?l>i&&(d-r)*(i-a)-(o-r)*(l-a)>0&&c++:l<=i&&(d-r)*(i-a)-(o-r)*(l-a)<0&&c--,r=d,a=l}return 0!==c}function Ur(e,t,n,s,o,i){if(0===n.length)return!1;if(!Pn(e,t,n[0],s,o,i))return!1;for(let t=1,a=n.length;t<a;++t)if(Pn(e,n[t-1],n[t],s,o,i))return!1;return!0}function ch(e,t,n,s,o,i){if(0===n.length)return!1;for(let a=0,c=n.length;a<c;++a){const r=n[a];if(Ur(e,t,r,s,o,i))return!0;t=r[r.length-1]}return!1}function qr(e,t,n,s,o,i,a){let r,v,h,c,d,u,m;const l=o[i+1],f=[];for(let o=0,a=n.length;o<a;++o){const i=n[o];for(c=e[i-s],u=e[i-s+1],r=t;r<i;r+=s)d=e[r],m=e[r+1],(l<=u&&m<=l||u<=l&&l<=m)&&(h=(l-u)/(m-u)*(d-c)+c,f.push(h)),c=d,u=m}let p=NaN,g=-1/0;for(f.sort(_t),c=f[0],r=1,v=f.length;r<v;++r){d=f[r];const o=Math.abs(d-c);o>g&&(h=(c+d)/2,Ur(e,t,n,s,h,l)&&(p=h,g=o)),c=d}return isNaN(p)&&(p=o[i]),a?(a.push(p,l,g),a):[p,l,g]}function Lu(e,t,n,s,o){let i=[];for(let a=0,c=n.length;a<c;++a){const r=n[a];i=qr(e,t,r,s,o,2*a,i),t=r[r.length-1]}return i}function Pu(e,t,n,s,o){let i;for(t+=s;t<n;t+=s)if(i=o(e.slice(t-s,t),e.slice(t,t+s)),i)return i;return!1}function Qi(e,t,n,s,o){const i=Td([1/0,1/0,-1/0,-1/0],e,t,n,s);return!!U(o,i)&&(!!xe(o,i)||i[0]>=o[0]&&i[2]<=o[2]||i[1]>=o[1]&&i[3]<=o[3]||Pu(e,t,n,s,function(e,t){return kf(o,e,t)}))}function th(e,t,n,s,o){for(let i=0,a=n.length;i<a;++i){if(Qi(e,t,n[i],s,o))return!0;t=n[i]}return!1}function Bu(e,t,n,s,o){return!!Qi(e,t,n,s,o)||!!Pn(e,t,n,s,o[0],o[1])||!!Pn(e,t,n,s,o[0],o[3])||!!Pn(e,t,n,s,o[2],o[1])||!!Pn(e,t,n,s,o[2],o[3])}function Ku(e,t,n,s,o){if(!Bu(e,t,n[0],s,o))return!1;if(1===n.length)return!0;for(let t=1,i=n.length;t<i;++t)if(lh(e,n[t-1],n[t],s,o)&&!Qi(e,n[t-1],n[t],s,o))return!1;return!0}function K3(e,t,n,s,o){for(let i=0,r=n.length;i<r;++i){const a=n[i];if(Ku(e,t,a,s,o))return!0;t=a[a.length-1]}return!1}function U3(e,t,n,s){for(;t<n-s;){for(let o=0;o<s;++o){const i=e[t+o];e[t+o]=e[n-s+o],e[n-s+o]=i}t+=s,n-=s}}function Ki(e,t,n,s){let o=0,i=e[n-s],a=e[n-s+1];for(;t<n;t+=s){const r=e[t],c=e[t+1];o+=(r-i)*(c+a),i=r,a=c}return 0===o?void 0:o>0}function ac(e,t,n,s,o){o=void 0!==o&&o;for(let i=0,c=n.length;i<c;++i){const r=n[i],a=Ki(e,t,r,s);if(0===i){if(o&&a||!o&&!a)return!1}else if(o&&!a||!o&&a)return!1;t=r}return!0}function qu(e,t,n,s,o){for(let a=0,r=n.length;a<r;++a){const i=n[a];if(!ac(e,t,i,s,o))return!1;i.length&&(t=i[i.length-1])}return!0}function Wi(e,t,n,s,o){o=void 0!==o&&o;for(let i=0,c=n.length;i<c;++i){const r=n[i],a=Ki(e,t,r,s);(0===i?o&&a||!o&&!a:o&&!a||!o&&a)&&U3(e,t,r,s),t=r}return t}function fc(e,t,n,s,o){for(let i=0,a=n.length;i<a;++i)t=Wi(e,t,n[i],s,o);return t}function Pi(e,t){const n=[];let s,i=0,o=0;for(let a=0,l=t.length;a<l;++a){const r=t[a],c=Ki(e,i,r,2);if(void 0===s&&(s=c),c===s)n.push(t.slice(o,a+1));else{if(0===n.length)continue;n[n.length-1].push(t[o])}o=a+1,i=r}return n}class ie extends jt{constructor(e,t,n){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,void 0!==t&&n?(this.setFlatCoordinates(t,e),this.ends_=n):this.setCoordinates(e,t)}appendLinearRing(e){this.flatCoordinates?z(this.flatCoordinates,e.getFlatCoordinates()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const e=new ie(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e}closestPointXY(e,t,n,s){return s<Gn(this.getExtent(),e,t)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(gr(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),_r(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,e,t,n,s))}containsXY(e,t){return Ur(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,t)}getArea(){return Du(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(e){let t;return void 0!==e?(t=this.getOrientedFlatCoordinates().slice(),Wi(t,0,this.ends_,this.stride,e)):t=this.flatCoordinates,eo(t,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const e=_e(this.getExtent());this.flatInteriorPoint_=qr(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new Y(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(e){return e<0||this.ends_.length<=e?null:new Tn(this.flatCoordinates.slice(0===e?0:this.ends_[e-1],this.ends_[e]),this.layout)}getLinearRings(){const s=this.layout,o=this.flatCoordinates,e=this.ends_,t=[];let n=0;for(let i=0,r=e.length;i<r;++i){const a=e[i],c=new Tn(o.slice(n,a),s);t.push(c),n=a}return t}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const e=this.flatCoordinates;ac(e,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=Wi(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(e){const t=[],n=[];return t.length=Fr(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(e),t,0,n),new ie(t,"XY",n)}getType(){return"Polygon"}intersectsExtent(e){return Ku(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]);const n=oo(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=0===n.length?0:n[n.length-1],this.changed()}}function V3(e,t,n,s){n=n||32;const o=[];for(let i=0;i<n;++i)z(o,Xm(e,t,2*Math.PI*i/n,s));return o.push(o[0],o[1]),new ie(o,"XY",[o.length])}function ps(e){if(Ft(e))throw new Error("Cannot create polygon from empty extent");const t=e[0],n=e[1],s=e[2],o=e[3],i=[t,n,t,o,s,o,s,n,t,n];return new ie(i,"XY",[i.length])}function Ni(e,t,n){t=t||32;const o=e.getStride(),c=e.getLayout(),i=e.getCenter(),a=o*(t+1),s=new Array(a);for(let e=0;e<a;e+=o){s[e]=0,s[e+1]=0;for(let t=2;t<o;t++)s[e+t]=i[t]}const l=[s.length],r=new ie(s,c,l);return Xu(r,i,e.getRadius(),n),r}function Xu(e,t,n,s){const o=e.getFlatCoordinates(),a=e.getStride(),i=o.length/a-1,r=s||0;for(let e=0;e<=i;++e){const s=e*a,c=r+2*ft(e,i)*Math.PI/i;o[s]=t[0]+n*Math.cos(c),o[s+1]=t[1]+n*Math.sin(c)}e.changed()}const L3="accuracy",T3="accuracyGeometry",M3="altitude",S3="altitudeAccuracy",f3="heading",o1="position",c1="projection",Q2="speed",m1="tracking",K2="trackingOptions",W5="error";class B2 extends ue{constructor(e){super(W5),this.code=e.code,this.message=e.message}}u={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};class wi extends Ss{constructor(e,t,n,s){super(),this.extent=e,this.pixelRatio_=n,this.resolution=t,this.state="function"==typeof s?u.IDLE:s,this.image_=null,this.loader="function"==typeof s?s:null}changed(){this.dispatchEvent(A)}getExtent(){return this.extent}getImage(){return this.image_}getPixelRatio(){return this.pixelRatio_}getResolution(){return this.resolution}getState(){return this.state}load(){if(this.state==u.IDLE&&this.loader){this.state=u.LOADING,this.changed();const e=this.getResolution(),t=Array.isArray(e)?e[0]:e;yl(()=>this.loader(this.getExtent(),t,this.getPixelRatio())).then(e=>{"image"in e&&(this.image_=e.image),"extent"in e&&(this.extent=e.extent),"resolution"in e&&(this.resolution=e.resolution),"pixelRatio"in e&&(this.pixelRatio_=e.pixelRatio),(e instanceof HTMLImageElement||e instanceof ImageBitmap||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement)&&(this.image_=e),this.state=u.LOADED}).catch(e=>{this.state=u.ERROR,console.error(e)}).finally(()=>this.changed())}}setImage(e){this.image_=e}setResolution(e){this.resolution=e}}function L2(e,t,n){const s=e;let o=!0,i=!1,a=!1;const r=[Hs(s,W2,function(){a=!0,i||t()})];return s.src&&Pc?(i=!0,s.decode().then(function(){o&&t()}).catch(function(){o&&(a?t():n())})):r.push(Hs(s,f7,n)),function(){o=!1,r.forEach(T)}}function N2(e,t){return new Promise((n,s)=>{function o(){a(),n(e)}function i(){a(),s(new Error("Image load error"))}function a(){e.removeEventListener("load",o),e.removeEventListener("error",i)}e.addEventListener("load",o),e.addEventListener("error",i),t&&(e.src=t)})}function j1(e,t){return t&&(e.src=t),e.src&&Pc?new Promise((t,n)=>e.decode().then(()=>t(e)).catch(s=>e.complete&&e.width?t(e):n(s))):N2(e)}function hn(e,t){return t&&(e.src=t),e.src&&Pc&&M8?e.decode().then(()=>createImageBitmap(e)).catch(t=>{if(e.complete&&e.width)return e;throw t}):j1(e)}class ol extends wi{constructor(e,t,n,s,o){super(e,t,n,void 0!==o?u.IDLE:u.LOADED),this.loader_=void 0!==o?o:null,this.canvas_=s,this.error_=null}getError(){return this.error_}handleLoad_(e){e?(this.error_=e,this.state=u.ERROR):this.state=u.LOADED,this.changed()}load(){this.state==u.IDLE&&(this.state=u.LOADING,this.changed(),this.loader_(this.handleLoad_.bind(this)))}getImage(){return this.canvas_}}class Qo extends fs{constructor(e,t,n,s,o,i){super(e,t,i),this.crossOrigin_=s,this.src_=n,this.key=n,this.image_=new Image,null!==s&&(this.image_.crossOrigin=s),this.unlisten_=null,this.tileLoadFunction_=o}getImage(){return this.image_}setImage(e){this.image_=e,this.state=L,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=Z,this.unlistenImage_(),this.image_=function(){const e=K(1,1);return e.fillStyle="rgba(0,0,0,0)",e.fillRect(0,0,1,1),e.canvas}(),this.changed()}handleImageLoad_(){const e=this.image_;e.naturalWidth&&e.naturalHeight?this.state=L:this.state=J,this.unlistenImage_(),this.changed()}load(){this.state==Z&&(this.state=ne,this.image_=new Image,null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==ne&&(this.state=gt,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=L2(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}class M2{constructor(e,t,n){this.decay_=e,this.minVelocity_=t,this.delay_=n,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(e,t){this.points_.push(e,t,Date.now())}end(){if(this.points_.length<6)return!1;const o=Date.now()-this.delay_,t=this.points_.length-3;if(this.points_[t+2]<o)return!1;let e=t-3;for(;e>0&&this.points_[e+2]>o;)e-=3;const i=this.points_[t+2]-this.points_[e+2];if(i<1e3/60)return!1;const n=this.points_[t]-this.points_[e],s=this.points_[t+1]-this.points_[e+1];return this.angle_=Math.atan2(s,n),this.initialVelocity_=Math.sqrt(n*n+s*s)/i,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}var il="opacity",_1="visible",A2="extent",w1="zIndex",x1="maxResolution",E1="minResolution",S1="maxZoom",M1="minZoom",Cl="source",N1="map";class $1 extends Ye{constructor(e){super(),this.on,this.once,this.un,this.background_=e.background;const t=Object.assign({},e);"object"==typeof e.properties&&(delete t.properties,Object.assign(t,e.properties)),t[il]=void 0!==e.opacity?e.opacity:1,x("number"==typeof t[il],"Layer opacity must be a number"),t[_1]=void 0===e.visible||e.visible,t[w1]=e.zIndex,t[x1]=void 0!==e.maxResolution?e.maxResolution:1/0,t[E1]=void 0!==e.minResolution?e.minResolution:0,t[M1]=void 0!==e.minZoom?e.minZoom:-1/0,t[S1]=void 0!==e.maxZoom?e.maxZoom:1/0,this.className_=void 0!==t.className?t.className:"ol-layer",delete t.className,this.setProperties(t),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(e){const t=this.state_||{layer:this,managed:void 0===e||e},n=this.getZIndex();return t.opacity=y(Math.round(100*this.getOpacity())/100,0,1),t.visible=this.getVisible(),t.extent=this.getExtent(),t.zIndex=void 0!==n||t.managed?n:1/0,t.maxResolution=this.getMaxResolution(),t.minResolution=Math.max(this.getMinResolution(),0),t.minZoom=this.getMinZoom(),t.maxZoom=this.getMaxZoom(),this.state_=t,t}getLayersArray(){return g()}getLayerStatesArray(){return g()}getExtent(){return this.get(A2)}getMaxResolution(){return this.get(x1)}getMinResolution(){return this.get(E1)}getMinZoom(){return this.get(M1)}getMaxZoom(){return this.get(S1)}getOpacity(){return this.get(il)}getSourceState(){return g()}getVisible(){return this.get(_1)}getZIndex(){return this.get(w1)}setBackground(e){this.background_=e,this.changed()}setExtent(e){this.set(A2,e)}setMaxResolution(e){this.set(x1,e)}setMinResolution(e){this.set(E1,e)}setMaxZoom(e){this.set(S1,e)}setMinZoom(e){this.set(M1,e)}setOpacity(e){x("number"==typeof e,"Layer opacity must be a number"),this.set(il,e)}setVisible(e){this.set(_1,e)}setZIndex(e){this.set(w1,e)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}var hl="prerender",ui="postrender",dl="precompose",W1="postcompose",U1="rendercomplete",Ae=0,ze=1,Qe={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};const K1=42,Ys=256;function Y1(e,t,n){return function(s,o,i,a,r){if(!s)return;if(!o&&!t)return s;const h=t?0:i[0]*o,m=t?0:i[1]*o,f=r?r[0]:0,p=r?r[1]:0;let c=e[0]+h/2+f,d=e[2]-h/2+f,l=e[1]+m/2+p,u=e[3]-m/2+p;c>d&&(c=(d+c)/2,d=c),l>u&&(l=(u+l)/2,u=l);let g=y(s[0],c,d),v=y(s[1],l,u);if(a&&n&&o){const e=30*o;g+=-e*Math.log(1+Math.max(0,c-s[0])/e)+e*Math.log(1+Math.max(0,s[0]-d)/e),v+=-e*Math.log(1+Math.max(0,l-s[1])/e)+e*Math.log(1+Math.max(0,s[1]-u)/e)}return[g,v]}}function K0(e){return e}function G1(e,t,n,s){const o=b(t)/n[0],i=W(t)/n[1];return s?Math.min(e,Math.max(o,i)):Math.min(e,Math.min(o,i))}function Z1(e,t,n){let s=Math.min(e,t);return s*=Math.log(1+50*Math.max(0,e/t-1))/50+1,n&&(s=Math.max(s,n),s/=Math.log(1+50*Math.max(0,n/e-1))/50+1),y(s,n/2,2*t)}function z0(e,t,n,s){return t=void 0===t||t,function(o,i,a,r){if(void 0!==o){const d=e[0],u=e[e.length-1],c=n?G1(d,n,a,s):d;if(r)return t?Z1(o,c,u):y(o,u,c);const h=Math.min(c,o),l=Math.floor(ci(e,h,i));return e[l]>c&&l<e.length-1?e[l+1]:e[l]}}}function F0(e,t,n,s,o,i){return s=void 0===s||s,n=void 0!==n?n:0,function(a,r,c,l){if(void 0!==a){const d=o?G1(t,o,c,i):t;if(l)return s?Z1(a,d,n):y(a,n,d);const u=1e-9,h=Math.ceil(Math.log(t/d)/Math.log(e)-u),m=-r*(.5-u)+.5,f=Math.min(d,a),p=Math.floor(Math.log(t/f)/Math.log(e)+m),g=Math.max(h,p);return y(t/Math.pow(e,g),n,d)}}}function J1(e,t,n,s,o){return n=void 0===n||n,function(i,a,r,c){if(void 0!==i){const a=s?G1(e,s,r,o):e;return n&&c?Z1(i,a,t):y(i,t,a)}}}function zc(e){if(void 0!==e)return 0}function t4(e){if(void 0!==e)return e}function A0(e){const t=2*Math.PI/e;return function(e,n){return n?e:void 0!==e?e=Math.floor(e/t+.5)*t:void 0}}function _0(e){const t=void 0===e?we(5):e;return function(e,n){return n||void 0===e?e:Math.abs(e)<=t?0:e}}class xt extends Ye{constructor(e){super(),this.on,this.once,this.un,e=Object.assign({},e),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=Ua(e.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,e.projection&&au(),e.center&&(e.center=I(e.center,this.projection_)),e.extent&&(e.extent=Pe(e.extent,this.projection_)),this.applyOptions_(e)}applyOptions_(e){const n=Object.assign({},e);for(const e in Qe)delete n[e];this.setProperties(n,!0);const t=j0(e);this.maxResolution_=t.maxResolution,this.minResolution_=t.minResolution,this.zoomFactor_=t.zoomFactor,this.resolutions_=e.resolutions,this.padding_=e.padding,this.minZoom_=t.minZoom;const s=y0(e),o=t.constraint,i=b0(e);this.constraints_={center:s,resolution:o,rotation:i},this.setRotation(void 0!==e.rotation?e.rotation:0),this.setCenterInternal(void 0!==e.center?e.center:null),void 0!==e.resolution?this.setResolution(e.resolution):void 0!==e.zoom&&this.setZoom(e.zoom)}get padding(){return this.padding_}set padding(e){let t=this.padding_;this.padding_=e;const n=this.getCenterInternal();if(n){const s=e||[0,0,0,0];t=t||[0,0,0,0];const o=this.getResolution(),i=o/2*(s[3]-t[3]+t[1]-s[1]),a=o/2*(s[0]-t[0]+t[2]-s[2]);this.setCenterInternal([n[0]+i,n[1]-a])}}getUpdatedOptions_(e){const t=this.getProperties();return void 0!==t.resolution?t.resolution=this.getResolution():t.zoom=this.getZoom(),t.center=this.getCenterInternal(),t.rotation=this.getRotation(),Object.assign({},t,e)}animate(){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const t=new Array(arguments.length);for(let n=0;n<t.length;++n){let e=arguments[n];e.center&&(e=Object.assign({},e),e.center=I(e.center,this.getProjection())),e.anchor&&(e=Object.assign({},e),e.anchor=I(e.anchor,this.getProjection())),t[n]=e}this.animateInternal.apply(this,t)}animateInternal(){let s,t=arguments.length;t>1&&"function"==typeof arguments[t-1]&&(s=arguments[t-1],--t);let n=0;for(;n<t&&!this.isDef();++n){const e=arguments[n];e.center&&this.setCenterInternal(e.center),void 0!==e.zoom?this.setZoom(e.zoom):e.resolution&&this.setResolution(e.resolution),void 0!==e.rotation&&this.setRotation(e.rotation)}if(n===t)return void(s&&wc(s,!0));let a=Date.now(),r=this.targetCenter_.slice(),o=this.targetResolution_,i=this.targetRotation_;const c=[];for(;n<t;++n){const l=arguments[n],e={start:a,complete:!1,anchor:l.anchor,duration:void 0!==l.duration?l.duration:1e3,easing:l.easing||Wc,callback:s};if(l.center&&(e.sourceCenter=r,e.targetCenter=l.center.slice(),r=e.targetCenter),void 0!==l.zoom?(e.sourceResolution=o,e.targetResolution=this.getResolutionForZoom(l.zoom),o=e.targetResolution):l.resolution&&(e.sourceResolution=o,e.targetResolution=l.resolution,o=e.targetResolution),void 0!==l.rotation){e.sourceRotation=i;const t=ft(l.rotation-i+Math.PI,2*Math.PI)-Math.PI;e.targetRotation=i+t,i=e.targetRotation}m0(e)?e.complete=!0:a+=e.duration,c.push(e)}this.animations_.push(c),this.setHint(Ae,1),this.updateAnimations_()}getAnimating(){return this.hints_[Ae]>0}getInteracting(){return this.hints_[ze]>0}cancelAnimations(){let e;this.setHint(Ae,-this.hints_[Ae]);for(let n=0,s=this.animations_.length;n<s;++n){const t=this.animations_[n];if(t[0].callback&&wc(t[0].callback,!1),!e)for(let n=0,o=t.length;n<o;++n){const s=t[n];if(!s.complete){e=s.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=e,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(void 0!==this.updateAnimationKey_&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const t=Date.now();let e=!1;for(let n=this.animations_.length-1;n>=0;--n){const s=this.animations_[n];let o=!0;for(let a=0,c=s.length;a<c;++a){const n=s[a];if(n.complete)continue;const l=t-n.start;let r=n.duration>0?l/n.duration:1;r>=1?(n.complete=!0,r=1):o=!1;const i=n.easing(r);if(n.sourceCenter){const e=n.sourceCenter[0],t=n.sourceCenter[1],s=n.targetCenter[0],o=n.targetCenter[1];this.nextCenter_=n.targetCenter;const a=e+i*(s-e),r=t+i*(o-t);this.targetCenter_=[a,r]}if(n.sourceResolution&&n.targetResolution){const e=1===i?n.targetResolution:n.sourceResolution+i*(n.targetResolution-n.sourceResolution);if(n.anchor){const t=this.getViewportSize_(this.getRotation()),s=this.constraints_.resolution(e,0,t,!0);this.targetCenter_=this.calculateCenterZoom(s,n.anchor)}this.nextResolution_=n.targetResolution,this.targetResolution_=e,this.applyTargetState_(!0)}if(void 0!==n.sourceRotation&&void 0!==n.targetRotation){const e=1===i?ft(n.targetRotation+Math.PI,2*Math.PI)-Math.PI:n.sourceRotation+i*(n.targetRotation-n.sourceRotation);if(n.anchor){const t=this.constraints_.rotation(e,!0);this.targetCenter_=this.calculateCenterRotate(t,n.anchor)}this.nextRotation_=n.targetRotation,this.targetRotation_=e}if(this.applyTargetState_(!0),e=!0,!n.complete)break}if(o){this.animations_[n]=null,this.setHint(Ae,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const e=s[0].callback;e&&wc(e,!0)}}this.animations_=this.animations_.filter(Boolean),e&&void 0===this.updateAnimationKey_&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(e,t){let n;const s=this.getCenterInternal();return void 0!==s&&(n=[s[0]-t[0],s[1]-t[1]],br(n,e-this.getRotation()),Jd(n,t)),n}calculateCenterZoom(e,t){let o;const n=this.getCenterInternal(),s=this.getResolution();return void 0!==n&&void 0!==s&&(o=[t[0]-e*(t[0]-n[0])/s,t[1]-e*(t[1]-n[1])/s]),o}getViewportSize_(e){const t=this.viewportSize_;if(e){const n=t[0],s=t[1];return[Math.abs(n*Math.cos(e))+Math.abs(s*Math.sin(e)),Math.abs(n*Math.sin(e))+Math.abs(s*Math.cos(e))]}return t}setViewportSize(e){this.viewportSize_=Array.isArray(e)?e.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const e=this.getCenterInternal();return e&&un(e,this.getProjection())}getCenterInternal(){return this.get(Qe.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(e){return void 0!==e?(e[0]=this.hints_[0],e[1]=this.hints_[1],e):this.hints_.slice()}calculateExtent(e){return Tt(this.calculateExtentInternal(e),this.getProjection())}calculateExtentInternal(e){e=e||this.getViewportSizeMinusPadding_();const t=this.getCenterInternal();x(t,"The view center is not defined");const n=this.getResolution();x(void 0!==n,"The view resolution is not defined");const s=this.getRotation();return x(void 0!==s,"The view rotation is not defined"),Po(t,n,s,e)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(e){this.applyOptions_(this.getUpdatedOptions_({maxZoom:e}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(e){this.applyOptions_(this.getUpdatedOptions_({minZoom:e}))}setConstrainResolution(e){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:e}))}getProjection(){return this.projection_}getResolution(){return this.get(Qe.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(e,t){return this.getResolutionForExtentInternal(Pe(e,this.getProjection()),t)}getResolutionForExtentInternal(e,t){t=t||this.getViewportSizeMinusPadding_();const n=b(e)/t[0],s=W(e)/t[1];return Math.max(n,s)}getResolutionForValueFunction(e){e=e||2;const t=this.getConstrainedResolution(this.maxResolution_),n=this.minResolution_,s=Math.log(t/n)/Math.log(e);return function(n){return t/Math.pow(e,n*s)}}getRotation(){return this.get(Qe.ROTATION)}getValueForResolutionFunction(e){const t=Math.log(e||2),n=this.getConstrainedResolution(this.maxResolution_),s=this.minResolution_,o=Math.log(n/s)/t;return function(e){return Math.log(n/e)/t/o}}getViewportSizeMinusPadding_(e){let n=this.getViewportSize_(e);const t=this.padding_;return t&&(n=[n[0]-t[1]-t[3],n[1]-t[0]-t[2]]),n}getState(){const n=this.getProjection(),s=this.getResolution(),o=this.getRotation();let e=this.getCenterInternal();const t=this.padding_;if(t){const n=this.getViewportSizeMinusPadding_();e=l4(e,this.getViewportSize_(),[n[0]/2+t[3],n[1]/2+t[0]],s,o)}return{center:e.slice(0),projection:void 0!==n?n:null,resolution:s,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:o,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let e;const t=this.getResolution();return void 0!==t&&(e=this.getZoomForResolution(t)),e}getZoomForResolution(e){let t,n,s=this.minZoom_||0;if(this.resolutions_){const o=ci(this.resolutions_,e,1);s=o,t=this.resolutions_[o],n=o==this.resolutions_.length-1?2:t/this.resolutions_[o+1]}else t=this.maxResolution_,n=this.zoomFactor_;return s+Math.log(t/e)/Math.log(n)}getResolutionForZoom(e){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;const t=y(Math.floor(e),0,this.resolutions_.length-2),n=this.resolutions_[t]/this.resolutions_[t+1];return this.resolutions_[t]/Math.pow(n,y(e-t,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,e-this.minZoom_)}fit(e,t){let n;if(x(Array.isArray(e)||"function"==typeof e.getSimplifiedGeometry,"Invalid extent or geometry provided as `geometry`"),Array.isArray(e))x(!Ft(e),"Cannot fit empty extent provided as `geometry`"),n=ps(Pe(e,this.getProjection()));else if("Circle"===e.getType()){const t=Pe(e.getExtent(),this.getProjection());n=ps(t),n.rotate(this.getRotation(),_e(t))}else{const t=le();n=t?e.clone().transform(t,this.getProjection()):e}this.fitInternal(n,t)}rotatedExtentForGeometry(e){const a=this.getRotation(),r=Math.cos(a),c=Math.sin(-a),t=e.getFlatCoordinates(),l=e.getStride();let n=1/0,s=1/0,o=-1/0,i=-1/0;for(let e=0,u=t.length;e<u;e+=l){const a=t[e]*r-t[e+1]*c,d=t[e]*c+t[e+1]*r;n=Math.min(n,a),s=Math.min(s,d),o=Math.max(o,a),i=Math.max(i,d)}return[n,s,o,i]}fitInternal(e,t){let i=(t=t||{}).size;i||(i=this.getViewportSizeMinusPadding_());const s=void 0!==t.padding?t.padding:[0,0,0,0],m=void 0!==t.nearest&&t.nearest;let a;a=void 0!==t.minResolution?t.minResolution:void 0!==t.maxZoom?this.getResolutionForZoom(t.maxZoom):0;const r=this.rotatedExtentForGeometry(e);let n=this.getResolutionForExtentInternal(r,[i[0]-s[1]-s[3],i[1]-s[0]-s[2]]);n=isNaN(n)?a:Math.max(n,a),n=this.getConstrainedResolution(n,m?0:1);const c=this.getRotation(),l=Math.sin(c),d=Math.cos(c),o=_e(r);o[0]+=(s[1]-s[3])/2*n,o[1]+=(s[0]-s[2])/2*n;const f=o[0]*d-o[1]*l,p=o[1]*d+o[0]*l,u=this.getConstrainedCenter([f,p],n),h=t.callback?t.callback:is;void 0!==t.duration?this.animateInternal({resolution:n,center:u,duration:t.duration,easing:t.easing},h):(this.targetResolution_=n,this.targetCenter_=u,this.applyTargetState_(!1,!0),wc(h,!0))}centerOn(e,t,n){this.centerOnInternal(I(e,this.getProjection()),t,n)}centerOnInternal(e,t,n){this.setCenterInternal(l4(e,t,n,this.getResolution(),this.getRotation()))}calculateCenterShift(e,t,n,s){let i;const o=this.padding_;if(o&&e){const a=this.getViewportSizeMinusPadding_(-n),r=l4(e,s,[a[0]/2+o[3],a[1]/2+o[0]],t,n);i=[e[0]-r[0],e[1]-r[1]]}return i}isDef(){return!!this.getCenterInternal()&&void 0!==this.getResolution()}adjustCenter(e){const t=un(this.targetCenter_,this.getProjection());this.setCenter([t[0]+e[0],t[1]+e[1]])}adjustCenterInternal(e){const t=this.targetCenter_;this.setCenterInternal([t[0]+e[0],t[1]+e[1]])}adjustResolution(e,t){t=t&&I(t,this.getProjection()),this.adjustResolutionInternal(e,t)}adjustResolutionInternal(e,t){const n=this.getAnimating()||this.getInteracting(),s=this.getViewportSize_(this.getRotation()),o=this.constraints_.resolution(this.targetResolution_*e,0,s,n);t&&(this.targetCenter_=this.calculateCenterZoom(o,t)),this.targetResolution_*=e,this.applyTargetState_()}adjustZoom(e,t){this.adjustResolution(Math.pow(this.zoomFactor_,-e),t)}adjustRotation(e,t){t&&(t=I(t,this.getProjection())),this.adjustRotationInternal(e,t)}adjustRotationInternal(e,t){const n=this.getAnimating()||this.getInteracting(),s=this.constraints_.rotation(this.targetRotation_+e,n);t&&(this.targetCenter_=this.calculateCenterRotate(s,t)),this.targetRotation_+=e,this.applyTargetState_()}setCenter(e){this.setCenterInternal(e&&I(e,this.getProjection()))}setCenterInternal(e){this.targetCenter_=e,this.applyTargetState_()}setHint(e,t){return this.hints_[e]+=t,this.changed(),this.hints_[e]}setResolution(e){this.targetResolution_=e,this.applyTargetState_()}setRotation(e){this.targetRotation_=e,this.applyTargetState_()}setZoom(e){this.setResolution(this.getResolutionForZoom(e))}applyTargetState_(e,t){const o=this.getAnimating()||this.getInteracting()||t,n=this.constraints_.rotation(this.targetRotation_,o),i=this.getViewportSize_(n),s=this.constraints_.resolution(this.targetResolution_,0,i,o),a=this.constraints_.center(this.targetCenter_,s,i,o,this.calculateCenterShift(this.targetCenter_,s,n,i));this.get(Qe.ROTATION)!==n&&this.set(Qe.ROTATION,n),this.get(Qe.RESOLUTION)!==s&&(this.set(Qe.RESOLUTION,s),this.set("zoom",this.getZoom(),!0)),a&&this.get(Qe.CENTER)&&at(this.get(Qe.CENTER),a)||this.set(Qe.CENTER,a),this.getAnimating()&&!e&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(e,t,n){e=void 0!==e?e:200;const r=t||0,s=this.constraints_.rotation(this.targetRotation_),i=this.getViewportSize_(s),o=this.constraints_.resolution(this.targetResolution_,r,i),a=this.constraints_.center(this.targetCenter_,o,i,!1,this.calculateCenterShift(this.targetCenter_,o,s,i));if(0===e&&!this.cancelAnchor_)return this.targetResolution_=o,this.targetRotation_=s,this.targetCenter_=a,void this.applyTargetState_();n=n||(0===e?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,this.getResolution()===o&&this.getRotation()===s&&this.getCenterInternal()&&at(this.getCenterInternal(),a)||(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:s,center:a,resolution:o,duration:e,easing:Hn,anchor:n}))}beginInteraction(){this.resolveConstraints(0),this.setHint(ze,1)}endInteraction(e,t,n){n=n&&I(n,this.getProjection()),this.endInteractionInternal(e,t,n)}endInteractionInternal(e,t,n){this.getInteracting()&&(this.setHint(ze,-1),this.resolveConstraints(e,t,n))}getConstrainedCenter(e,t){const n=this.getViewportSize_(this.getRotation());return this.constraints_.center(e,t||this.getResolution(),n)}getConstrainedZoom(e,t){const n=this.getResolutionForZoom(e);return this.getZoomForResolution(this.getConstrainedResolution(n,t))}getConstrainedResolution(e,t){t=t||0;const n=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(e,t,n)}}function wc(e,t){setTimeout(function(){e(t)},0)}function y0(e){if(void 0!==e.extent){const t=void 0===e.smoothExtentConstraint||e.smoothExtentConstraint;return Y1(e.extent,e.constrainOnlyCenter,t)}const t=Ua(e.projection,"EPSG:3857");if(!0!==e.multiWorld&&t.isGlobal()){const e=t.getExtent().slice();return e[0]=-1/0,e[2]=1/0,Y1(e,!1,!1)}return K0}function j0(e){let h,t,n,o=void 0!==e.minZoom?e.minZoom:0,i=void 0!==e.maxZoom?e.maxZoom:28;const s=void 0!==e.zoomFactor?e.zoomFactor:2,m=void 0!==e.multiWorld&&e.multiWorld,l=void 0===e.smoothResolutionConstraint||e.smoothResolutionConstraint,d=void 0!==e.showFullExtent&&e.showFullExtent,u=Ua(e.projection,"EPSG:3857"),c=u.getExtent();let r=e.constrainOnlyCenter,a=e.extent;if(m||a||!u.isGlobal()||(r=!1,a=c),void 0!==e.resolutions){const s=e.resolutions;t=s[o],n=void 0!==s[i]?s[i]:s[s.length-1],h=e.constrainResolution?z0(s,l,!r&&a,d):J1(t,n,l,!r&&a,d)}else{const m=(c?Math.max(b(c),W(c)):360*rs.degrees/u.getMetersPerUnit())/Ys/Math.pow(2,0),f=m/Math.pow(2,28);t=e.maxResolution,void 0!==t?o=0:t=m/Math.pow(s,o),n=e.minResolution,void 0===n&&(n=void 0!==e.maxZoom?void 0!==e.maxResolution?t/Math.pow(s,i):m/Math.pow(s,i):f),i=o+Math.floor(Math.log(t/n)/Math.log(s)),n=t/Math.pow(s,i-o),h=e.constrainResolution?F0(s,t,n,l,!r&&a,d):J1(t,n,l,!r&&a,d)}return{constraint:h,maxResolution:t,minResolution:n,minZoom:o,zoomFactor:s}}function b0(e){if(void 0===e.enableRotation||e.enableRotation){const t=e.constrainRotation;return void 0===t||!0===t?_0():!1===t?t4:"number"==typeof t?A0(t):t4}return zc}function m0(e){return!(e.sourceCenter&&e.targetCenter&&!at(e.sourceCenter,e.targetCenter))&&e.sourceResolution===e.targetResolution&&e.sourceRotation===e.targetRotation}function l4(e,t,n,s,o){const a=Math.cos(-o);let i=Math.sin(-o),r=e[0]*a-e[1]*i,c=e[1]*a+e[0]*i;return r+=(t[0]/2-n[0])*s,c+=(n[1]-t[1]/2)*s,i=-i,[r*a-c*i,c*a+r*i]}class ss extends $1{constructor(e){const t=Object.assign({},e);delete t.source,super(t),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,e.render&&(this.render=e.render),e.map&&this.setMap(e.map),this.addChangeListener(Cl,this.handleSourcePropertyChange_);const n=e.source?e.source:null;this.setSource(n)}getLayersArray(e){return(e=e||[]).push(this),e}getLayerStatesArray(e){return(e=e||[]).push(this.getLayerState()),e}getSource(){return this.get(Cl)||null}getRenderSource(){return this.getSource()}getSourceState(){const e=this.getSource();return e?e.getState():"undefined"}handleSourceChange_(){this.changed(),this.sourceReady_||"ready"!==this.getSource().getState()||(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(T(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const e=this.getSource();e&&(this.sourceChangeKey_=m(e,A,this.handleSourceChange_,this),"ready"===e.getState()&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0))),this.changed()}getFeatures(e){return this.renderer_?this.renderer_.getFeatures(e):Promise.resolve([])}getData(e){return this.renderer_&&this.rendered?this.renderer_.getData(e):null}isVisible(e){let t;const n=this.getMapInternal();let s;!e&&n&&(e=n.getView()),t=e instanceof xt?{viewState:e.getState(),extent:e.calculateExtent()}:e,!t.layerStatesArray&&n&&(t.layerStatesArray=n.getLayerGroup().getLayerStatesArray()),s=t.layerStatesArray?t.layerStatesArray.find(e=>e.layer===this):this.getLayerState();const o=this.getExtent();return pc(s,t.viewState)&&(!o||U(o,t.extent))}getAttributions(e){if(!this.isVisible(e))return[];let n;const s=this.getSource();if(s&&(n=s.getAttributions()),!n)return[];let t=n(e instanceof xt?e.getViewStateAndExtent():e);return Array.isArray(t)||(t=[t]),t}render(e,t){const n=this.getRenderer();return n.prepareFrame(e)?(this.rendered=!0,n.renderFrame(e,t)):null}unrender(){this.rendered=!1}getDeclutter(){}renderDeclutter(){}renderDeferred(e){const t=this.getRenderer();t&&t.renderDeferred(e)}setMapInternal(e){e||this.unrender(),this.set(N1,e)}getMapInternal(){return this.get(N1)}setMap(e){this.mapPrecomposeKey_&&(T(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),e||this.changed(),this.mapRenderKey_&&(T(this.mapRenderKey_),this.mapRenderKey_=null),e&&(this.mapPrecomposeKey_=m(e,dl,function(e){const t=e.frameState.layerStatesArray,n=this.getLayerState(!1);x(!t.some(function(e){return e.layer===n.layer}),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),t.push(n)},this),this.mapRenderKey_=m(this,A,e.render,e),this.changed())}setSource(e){this.set(Cl,e)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}disposeInternal(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),super.disposeInternal()}}function pc(e,t){if(!e.visible)return!1;const n=t.resolution;if(n<e.minResolution||n>=e.maxResolution)return!1;const s=t.zoom;return s>e.minZoom&&s<=e.maxZoom}function sv(e,t,n,s,o){r0(e,t,n||0,s||e.length-1,o||av)}function r0(e,t,n,s,o){for(;s>n;){if(s-n>600){var a=s-n+1,d=t-n+1,u=Math.log(a),c=.5*Math.exp(2*u/3),h=.5*Math.sqrt(u*c*(a-c)/a)*(d-a/2<0?-1:1);r0(e,t,Math.max(n,Math.floor(t-d*c/a+h)),Math.min(s,Math.floor(t+(a-d)*c/a+h)),o)}var l=e[t],r=n,i=s;for(Vi(e,n,t),o(e[s],l)>0&&Vi(e,n,s);r<i;){for(Vi(e,r,i),r++,i--;o(e[r],l)<0;)r++;for(;o(e[i],l)>0;)i--}0===o(e[n],l)?Vi(e,n,i):Vi(e,++i,s),i<=t&&(n=i+1),t<=i&&(s=i-1)}}function Vi(e,t,n){var s=e[t];e[t]=e[n],e[n]=s}function av(e,t){return e<t?-1:e>t?1:0}let m4=class{constructor(e=9){this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}all(){return this._all(this.data,[])}search(e){let t=this.data;const n=[];if(!Vr(e,t))return n;const o=this.toBBox,s=[];for(;t;){for(let a=0;a<t.children.length;a++){const i=t.children[a],r=t.leaf?o(i):i;Vr(e,r)&&(t.leaf?n.push(i):v4(e,r)?this._all(i,n):s.push(i))}t=s.pop()}return n}collides(e){let t=this.data;if(!Vr(e,t))return!1;const n=[];for(;t;){for(let s=0;s<t.children.length;s++){const o=t.children[s],i=t.leaf?this.toBBox(o):o;if(Vr(e,i)){if(t.leaf||v4(e,i))return!0;n.push(o)}}t=n.pop()}return!1}load(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(let t=0;t<e.length;t++)this.insert(e[t]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(this.data.height<t.height){const e=this.data;this.data=t,t=e}this._insert(t,this.data.height-t.height-1,!0)}else this.data=t;return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=no([]),this}remove(e,t){if(!e)return this;let n=this.data;const c=this.toBBox(e),s=[],r=[];let o,i,a;for(;n||s.length;){if(n||(n=s.pop(),i=s[s.length-1],o=r.pop(),a=!0),n.leaf){const o=cv(e,n.children,t);if(-1!==o)return n.children.splice(o,1),s.push(n),this._condense(s),this}a||n.leaf||!v4(n,c)?i?(o++,n=i.children[o],a=!1):n=null:(s.push(n),r.push(o),o=0,i=n,n=n.children[0])}return this}toBBox(e){return e}compareMinX(e,t){return e.minX-t.minX}compareMinY(e,t){return e.minY-t.minY}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,t){const n=[];for(;e;)e.leaf?t.push(...e.children):n.push(...e.children),e=n.pop();return t}_build(e,t,n,s){const a=n-t+1;let o,i=this._maxEntries;if(a<=i)return o=no(e.slice(t,n+1)),_o(o,this.toBBox),o;s||(s=Math.ceil(Math.log(a)/Math.log(i)),i=Math.ceil(a/Math.pow(i,s-1))),o=no([]),o.leaf=!1,o.height=s;const r=Math.ceil(a/i),c=r*Math.ceil(Math.sqrt(i));X4(e,t,n,c,this.compareMinX);for(let i=t;i<=n;i+=c){const a=Math.min(i+c-1,n);X4(e,i,a,r,this.compareMinY);for(let t=i;t<=a;t+=r){const n=Math.min(t+r-1,a);o.children.push(this._build(e,t,n,s-1))}}return _o(o,this.toBBox),o}_chooseSubtree(e,t,n,s){for(var o,i;s.push(t),!t.leaf&&s.length-1!==n;){let r,a=1/0,c=1/0;for(let l=0;l<t.children.length;l++){const s=t.children[l],n=g4(s),d=(o=e,i=s,(Math.max(i.maxX,o.maxX)-Math.min(i.minX,o.minX))*(Math.max(i.maxY,o.maxY)-Math.min(i.minY,o.minY))-n);d<c?(c=d,a=n<a?n:a,r=s):d===c&&n<a&&(a=n,r=s)}t=r||t.children[0]}return t}_insert(e,t,n){const o=n?e:this.toBBox(e),s=[],i=this._chooseSubtree(o,this.data,t,s);for(i.children.push(e),Yi(i,o);t>=0&&s[t].children.length>this._maxEntries;)this._split(s,t),t--;this._adjustParentBBoxes(o,s,t)}_split(e,t){const n=e[t],o=n.children.length,i=this._minEntries;this._chooseSplitAxis(n,i,o);const a=this._chooseSplitIndex(n,i,o),s=no(n.children.splice(a,n.children.length-a));s.height=n.height,s.leaf=n.leaf,_o(n,this.toBBox),_o(s,this.toBBox),t?e[t-1].children.push(s):this._splitRoot(n,s)}_splitRoot(e,t){this.data=no([e,t]),this.data.height=e.height+1,this.data.leaf=!1,_o(this.data,this.toBBox)}_chooseSplitIndex(e,t,n){let o,i=1/0,s=1/0;for(let a=t;a<=n-t;a++){const l=qi(e,0,a,this.toBBox),d=qi(e,a,n,this.toBBox),c=mv(l,d),r=g4(l)+g4(d);c<i?(i=c,o=a,s=r<s?r:s):c===i&&r<s&&(s=r,o=a)}return o||n-t}_chooseSplitAxis(e,t,n){const s=e.leaf?this.compareMinX:uv,o=e.leaf?this.compareMinY:hv;this._allDistMargin(e,t,n,s)<this._allDistMargin(e,t,n,o)&&e.children.sort(s)}_allDistMargin(e,t,n,s){e.children.sort(s);const o=this.toBBox,i=qi(e,0,t,o),a=qi(e,n-t,n,o);let r=sc(i)+sc(a);for(let s=t;s<n-t;s++){const a=e.children[s];Yi(i,e.leaf?o(a):a),r+=sc(i)}for(let s=n-t-1;s>=t;s--){const i=e.children[s];Yi(a,e.leaf?o(i):i),r+=sc(a)}return r}_adjustParentBBoxes(e,t,n){for(let s=n;s>=0;s--)Yi(t[s],e)}_condense(e){for(let n,t=e.length-1;t>=0;t--)0===e[t].children.length?t>0?(n=e[t-1].children,n.splice(n.indexOf(e[t]),1)):this.clear():_o(e[t],this.toBBox)}};function cv(e,t,n){if(!n)return t.indexOf(e);for(let s=0;s<t.length;s++)if(n(e,t[s]))return s;return-1}function _o(e,t){qi(e,0,e.children.length,t,e)}function qi(e,t,n,s,o){o||(o=no(null)),o.minX=1/0,o.minY=1/0,o.maxX=-1/0,o.maxY=-1/0;for(let i=t;i<n;i++){const a=e.children[i];Yi(o,e.leaf?s(a):a)}return o}function Yi(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function uv(e,t){return e.minX-t.minX}function hv(e,t){return e.minY-t.minY}function g4(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function sc(e){return e.maxX-e.minX+(e.maxY-e.minY)}function mv(e,t){const n=Math.max(e.minX,t.minX),s=Math.max(e.minY,t.minY),o=Math.min(e.maxX,t.maxX),i=Math.min(e.maxY,t.maxY);return Math.max(0,o-n)*Math.max(0,i-s)}function v4(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function Vr(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function no(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function X4(e,t,n,s,o){const i=[t,n];for(;i.length;){if((n=i.pop())-(t=i.pop())<=s)continue;const a=t+Math.ceil((n-t)/s/2)*s;sv(e,a,t,n,o),i.push(t,a,a,n)}}function j4(e){return e[0]>0&&e[1]>0}function y4(e,t,n){return void 0===n&&(n=[0,0]),n[0]=e[0]*t+.5|0,n[1]=e[1]*t+.5|0,n}function X(e,t){return Array.isArray(e)?e:(void 0===t?t=[e,e]:(t[0]=e,t[1]=e),t)}class kr{constructor(e){this.opacity_=e.opacity,this.rotateWithView_=e.rotateWithView,this.rotation_=e.rotation,this.scale_=e.scale,this.scaleArray_=X(e.scale),this.displacement_=e.displacement,this.declutterMode_=e.declutterMode}clone(){const e=this.getScale();return new kr({opacity:this.getOpacity(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return g()}getImage(){return g()}getHitDetectionImage(){return g()}getPixelRatio(){return 1}getImageState(){return g()}getImageSize(){return g()}getOrigin(){return g()}getSize(){return g()}setDisplacement(e){this.displacement_=e}setOpacity(e){this.opacity_=e}setRotateWithView(e){this.rotateWithView_=e}setRotation(e){this.rotation_=e}setScale(e){this.scale_=e,this.scaleArray_=X(e)}listenImageChange(){g()}load(){g()}unlistenImageChange(){g()}ready(){return Promise.resolve()}}to={name:"rgb",min:[0,0,0],max:[255,255,255],channel:["red","green","blue"],alias:["RGB"]},Vs={name:"xyz",min:[0,0,0],channel:["X","Y","Z"],alias:["XYZ","ciexyz","cie1931"],whitepoint:{2:{A:[109.85,100,35.585],C:[98.074,100,118.232],D50:[96.422,100,82.521],D55:[95.682,100,92.149],D65:[95.045592705167,100,108.9057750759878],D75:[94.972,100,122.638],F2:[99.187,100,67.395],F7:[95.044,100,108.755],F11:[100.966,100,64.37],E:[100,100,100]},10:{A:[111.144,100,35.2],C:[97.285,100,116.145],D50:[96.72,100,81.427],D55:[95.799,100,90.926],D65:[94.811,100,107.304],D75:[94.416,100,120.641],F2:[103.28,100,69.026],F7:[95.792,100,107.687],F11:[103.866,100,65.627],E:[100,100,100]}}},Vs.max=Vs.whitepoint[2].D65,Vs.rgb=function(e,t){t=t||Vs.whitepoint[2].E;var n,s,o,i=e[0]/t[0],a=e[1]/t[1],r=e[2]/t[2];return n=-.96924363628087*i+1.87596750150772*a+.041555057407175*r,s=.055630079696993*i+-.20397695888897*a+1.056971514242878*r,o=(o=3.240969941904521*i+-1.537383177570093*a+-.498610760293*r)>.0031308?1.055*Math.pow(o,1/2.4)-.055:o*=12.92,n=n>.0031308?1.055*Math.pow(n,1/2.4)-.055:n*=12.92,s=s>.0031308?1.055*Math.pow(s,1/2.4)-.055:s*=12.92,[255*(o=Math.min(Math.max(0,o),1)),255*(n=Math.min(Math.max(0,n),1)),255*(s=Math.min(Math.max(0,s),1))]},to.xyz=function(e,t){var n=e[0]/255,s=e[1]/255,o=e[2]/255,i=.21263900587151*(n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92)+.71516867876775*(s=s>.04045?Math.pow((s+.055)/1.055,2.4):s/12.92)+.072192315360733*(o=o>.04045?Math.pow((o+.055)/1.055,2.4):o/12.92),a=.019330818715591*n+.11919477979462*s+.95053215224966*o;return[(.41239079926595*n+.35758433938387*s+.18048078840183*o)*(t=t||Vs.whitepoint[2].E)[0],i*t[1],a*t[2]]},st=Vs,wr={name:"luv",min:[0,-134,-140],max:[100,224,122],channel:["lightness","u","v"],alias:["LUV","cieluv","cie1976"],xyz:function(e,t,n){var s,o,i,a,r,c,l,d,u;return s=e[0],l=e[1],d=e[2],0===s?[0,0,0]:(t=t||"D65",n=n||2,a=l/(13*s)+4*(c=st.whitepoint[n][t][0])/(c+15*(o=st.whitepoint[n][t][1])+3*(u=st.whitepoint[n][t][2]))||0,i=d/(13*s)+9*o/(c+15*o+3*u)||0,[9*(r=s>8?o*Math.pow((s+16)/116,3):o*s*.0011070564598794539)*a/(4*i)||0,r,r*(12-3*a-20*i)/(4*i)||0])}},st.luv=function(e,t,n){t=t||"D65",n=n||2;var s,o,i,a,r,l,d,m=4*(r=st.whitepoint[n][t][0])/(r+15*(o=st.whitepoint[n][t][1])+3*(d=st.whitepoint[n][t][2])),f=9*o/(r+15*o+3*d),u=4*(a=e[0])/(a+15*(s=e[1])+3*(l=e[2]))||0,h=9*s/(a+15*s+3*l)||0,c=s/o;return[i=c<=.008856451679035631?903.2962962962961*c:116*Math.pow(c,1/3)-16,13*i*(u-m),13*i*(h-f)]},_4={name:"lchuv",channel:["lightness","chroma","hue"],alias:["LCHuv","cielchuv"],min:[0,0,0],max:[100,100,360],luv:function(e){var t,s=e[0],n=e[1];return t=e[2]/360*2*Math.PI,[s,n*Math.cos(t),n*Math.sin(t)]},xyz:function(e){return wr.xyz(_4.luv(e))}};function O4(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}wr.lchuv=function(e){var o=e[0],t=e[1],n=e[2],i=Math.sqrt(t*t+n*n),s=360*Math.atan2(n,t)/2/Math.PI;return s<0&&(s+=360),[o,i,s]},st.lchuv=function(e){return wr.lchuv(st.luv(e))},x4=O4({aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}),C4={red:0,orange:60,yellow:120,green:180,blue:240,purple:300},jr={name:"hsl",min:[0,0,0],max:[360,100,100],channel:["hue","saturation","lightness"],alias:["HSL"],rgb:function(e){var t,n,o,i,r,l=e[0]/360,a=e[1]/100,s=e[2]/100,c=0;if(0===a)return[o=255*s,o,o];for(n=2*s-(i=s<.5?s*(1+a):s+a-s*a),r=[0,0,0];c<3;)(t=l+1/3*-(c-1))<0?t++:t>1&&t--,o=6*t<1?n+6*(i-n)*t:2*t<1?i:3*t<2?n+(i-n)*(2/3-t)*6:n,r[c++]=255*o;return r}};function bv(e){Array.isArray(e)&&e.raw&&(e=String.raw(...arguments)),e instanceof Number&&(e=+e);var n,t=function(e){var t,n,i,a,r,c,s=[],o=1;return"number"==typeof e?{space:"rgb",values:[e>>>16,(65280&e)>>>8,255&e],alpha:1}:"number"==typeof e?{space:"rgb",values:[e>>>16,(65280&e)>>>8,255&e],alpha:1}:(e=String(e).toLowerCase(),x4[e]?(s=x4[e].slice(),t="rgb"):"transparent"===e?(o=0,t="rgb",s=[0,0,0]):"#"===e[0]?(n=e.slice(1),i=n.length,o=1,i<=4?(s=[parseInt(n[0]+n[0],16),parseInt(n[1]+n[1],16),parseInt(n[2]+n[2],16)],4===i&&(o=parseInt(n[3]+n[3],16)/255)):(s=[parseInt(n[0]+n[1],16),parseInt(n[2]+n[3],16),parseInt(n[4]+n[5],16)],8===i&&(o=parseInt(n[6]+n[7],16)/255)),s[0]||(s[0]=0),s[1]||(s[1]=0),s[2]||(s[2]=0),t="rgb"):(a=/^((?:rgba?|hs[lvb]a?|hwba?|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms|oklch|oklab|color))\s*\(([^)]*)\)/.exec(e))?(r=a[1],c="cmyk"===(t=r.replace(/a$/,""))?4:"gray"===t?1:3,s=a[2].trim().split(/\s*[,/]\s*|\s+/),"color"===t&&(t=s.shift()),o=(s=s.map(function(e,n){if("%"===e[e.length-1])return e=parseFloat(e)/100,3===n?e:"rgb"===t?255*e:"h"===t[0]?100*e:"l"!==t[0]||n?"lab"===t?125*e:"lch"===t?n<2?150*e:360*e:"o"!==t[0]||n?"oklab"===t?.4*e:"oklch"===t?n<2?.4*e:360*e:e:e:100*e;if("h"===t[n]||2===n&&"h"===t[t.length-1]){if(void 0!==C4[e])return C4[e];if(e.endsWith("deg"))return parseFloat(e);if(e.endsWith("turn"))return 360*parseFloat(e);if(e.endsWith("grad"))return 360*parseFloat(e)/400;if(e.endsWith("rad"))return 180*parseFloat(e)/Math.PI}return"none"===e?0:parseFloat(e)})).length>c?s.pop():1):/[0-9](?:\s|\/|,)/.test(e)&&(s=e.match(/([0-9]+)/g).map(function(e){return parseFloat(e)}),t=e.match(/([a-z])/gi)?.join("")?.toLowerCase()||"rgb"),{space:t,values:s,alpha:o})}(e);if(!t.space)return[];const s="h"===t.space[0]?jr.min:to.min,o="h"===t.space[0]?jr.max:to.max;return(n=Array(3))[0]=Math.min(Math.max(t.values[0],s[0]),o[0]),n[1]=Math.min(Math.max(t.values[1],s[1]),o[1]),n[2]=Math.min(Math.max(t.values[2],s[2]),o[2]),"h"===t.space[0]&&(n=jr.rgb(n)),n.push(Math.min(Math.max(t.alpha,0),1)),n}function I4(e){return"string"==typeof e?e:sr(e)}to.hsl=function(e){var n,c,o=e[0]/255,i=e[1]/255,a=e[2]/255,s=Math.min(o,i,a),t=Math.max(o,i,a),r=t-s;return t===s?n=0:o===t?n=(i-a)/r:i===t?n=2+(a-o)/r:a===t&&(n=4+(o-i)/r),(n=Math.min(60*n,360))<0&&(n+=360),c=(s+t)/2,[n,100*(t===s?0:c<=.5?r/(t+s):r/(2-t-s)),100*c]};const _v=1024,ya={};let k4=0;function J8(e){if(4===e.length)return e;const t=e.slice();return t[3]=1,t}function Sl(e){const t=st.lchuv(to.xyz(e));return t[3]=e[3],t}function D4(e){const t=st.rgb(_4.xyz(e));return t[3]=e[3],t}function ar(e){if(ya.hasOwnProperty(e))return ya[e];if(k4>=_v){let e=0;for(const t in ya)0==(3&e++)&&(delete ya[t],--k4)}const t=bv(e);if(4!==t.length)throw new Error('Failed to parse "'+e+'" as color');for(const n of t)if(isNaN(n))throw new Error('Failed to parse "'+e+'" as color');return M4(t),ya[e]=t,++k4,t}function mt(e){return Array.isArray(e)?e:ar(e)}function M4(e){return e[0]=y(e[0]+.5|0,0,255),e[1]=y(e[1]+.5|0,0,255),e[2]=y(e[2]+.5|0,0,255),e[3]=y(e[3],0,1),e}function sr(e){let t=e[0];t!=(0|t)&&(t=t+.5|0);let n=e[1];n!=(0|n)&&(n=n+.5|0);let s=e[2];return s!=(0|s)&&(s=s+.5|0),"rgba("+t+","+n+","+s+","+(void 0===e[3]?1:Math.round(1e3*e[3])/1e3)+")"}function U4(e){try{return ar(e),!0}catch{return!1}}class d0{constructor(){this.cache_={},this.patternCache_={},this.cacheSize_=0,this.maxCacheSize_=32}clear(){this.cache_={},this.patternCache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let e=0;for(const t in this.cache_){const n=this.cache_[t];0!=(3&e++)||n.hasListener()||(delete this.cache_[t],delete this.patternCache_[t],--this.cacheSize_)}}}get(e,t,n){const s=er(e,t,n);return s in this.cache_?this.cache_[s]:null}getPattern(e,t,n){const s=er(e,t,n);return s in this.patternCache_?this.patternCache_[s]:null}set(e,t,n,s,o){const i=er(e,t,n),a=i in this.cache_;this.cache_[i]=s,o&&(s.getImageState()===u.IDLE&&s.load(),s.getImageState()===u.LOADING?s.ready().then(()=>{this.patternCache_[i]=Ei().createPattern(s.getImage(1),"repeat")}):this.patternCache_[i]=Ei().createPattern(s.getImage(1),"repeat")),a||++this.cacheSize_}setSize(e){this.maxCacheSize_=e,this.expire()}}function er(e,t,n){return t+":"+e+":"+(n?mt(n):"null")}const zt=new d0;let za=null;class h0 extends Ss{constructor(e,t,n,s,o){super(),this.hitDetectionImage_=null,this.image_=e,this.crossOrigin_=n,this.canvas_={},this.color_=o,this.imageState_=void 0===s?u.IDLE:s,this.size_=e&&e.width&&e.height?[e.width,e.height]:null,this.src_=t,this.tainted_,this.ready_=null}initializeImage_(){this.image_=new Image,null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(void 0===this.tainted_&&this.imageState_===u.LOADED){za||(za=K(1,1,void 0,{willReadFrequently:!0})),za.drawImage(this.image_,0,0);try{za.getImageData(0,0,1,1),this.tainted_=!1}catch{za=null,this.tainted_=!0}}return!0===this.tainted_}dispatchChangeEvent_(){this.dispatchEvent(A)}handleImageError_(){this.imageState_=u.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=u.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(e){return this.image_||this.initializeImage_(),this.replaceColor_(e),this.canvas_[e]?this.canvas_[e]:this.image_}getPixelRatio(e){return this.replaceColor_(e),this.canvas_[e]?e:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const e=this.size_[0],t=this.size_[1],n=K(e,t);n.fillRect(0,0,e,t),this.hitDetectionImage_=n.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===u.IDLE){this.image_||this.initializeImage_(),this.imageState_=u.LOADING;try{void 0!==this.src_&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&j1(this.image_,this.src_).then(e=>{this.image_=e,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(e){if(!this.color_||this.canvas_[e]||this.imageState_!==u.LOADED)return;const s=this.image_,n=document.createElement("canvas");n.width=Math.ceil(s.width*e),n.height=Math.ceil(s.height*e);const t=n.getContext("2d");t.scale(e,e),t.drawImage(s,0,0),t.globalCompositeOperation="multiply",t.fillStyle=I4(this.color_),t.fillRect(0,0,n.width/e,n.height/e),t.globalCompositeOperation="destination-in",t.drawImage(s,0,0),this.canvas_[e]=n}ready(){return this.ready_||(this.ready_=new Promise(e=>{this.imageState_===u.LOADED||this.imageState_===u.ERROR?e():this.addEventListener(A,function t(){this.imageState_!==u.LOADED&&this.imageState_!==u.ERROR||(this.removeEventListener(A,t),e())})})),this.ready_}}function Ya(e,t,n,s,o,i){let a=void 0===t?void 0:zt.get(t,n,o);return a||(a=new h0(e,e&&"src"in e?e.src||void 0:t,n,s,o),zt.set(t,n,o,a,i)),i&&a&&!zt.getPattern(t,n,o)&&zt.set(t,n,o,a,i),a}function Mt(e){return e?Array.isArray(e)?sr(e):"object"==typeof e&&"src"in e?function(e){if(!e.offset||!e.size)return zt.getPattern(e.src,"anonymous",e.color);const t=e.src+":"+e.offset,n=zt.getPattern(t,void 0,e.color);if(n)return n;const s=zt.get(e.src,"anonymous",null);if(s.getImageState()!==u.LOADED)return null;const o=K(e.size[0],e.size[1]);return o.drawImage(s.getImage(1),e.offset[0],e.offset[1],e.size[0],e.size[1],0,0,e.size[0],e.size[1]),Ya(o.canvas,t,void 0,u.LOADED,e.color,!0),zt.getPattern(t,void 0,e.color)}(e):e:null}const Ra="ol-hidden",p0="ol-selectable",At="ol-unselectable",i4="ol-unsupported",En="ol-control",Ia="ol-collapsed",q7=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z]+?)\\s*$`].join(""),"i"),n2=["style","variant","weight","size","lineHeight","family"],I1=function(e){const n=e.match(q7);if(!n)return null;const t={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"};for(let e=0,o=n2.length;e<o;++e){const s=n[e+1];void 0!==s&&(t[n2[e]]=s)}return t.families=t.family.split(/,\s?/),t},R1="10px sans-serif",He="#000",ds="round",Bt=[],ms="round",ko=10,Ao="#000",So="center",Fa="middle",Yn=[0,0,0,0],Vt=new Ye;let F1,zo=null;const ir={},h2=function(){const t="32px ",n=["monospace","serif"],a=n.length,s="wmytzilWMYTZIL@#/&?$%10";let e,o;function i(e,i,r){let c=!0;for(let l=0;l<a;++l){const d=n[l];if(o=Oa(e+" "+i+" "+t+d,s),r!=d){const n=Oa(e+" "+i+" "+t+r+","+d,s);c=c&&n!=o}}return!!c}function r(){let t=!0;const n=Vt.getKeys();for(let s=0,o=n.length;s<o;++s){const e=n[s];Vt.get(e)<100&&(i.apply(this,e.split(`
`))?(Kn(ir),zo=null,F1=void 0,Vt.set(e,100)):(Vt.set(e,Vt.get(e)+1,!0),t=!1))}t&&(clearInterval(e),e=void 0)}return function(t){const n=I1(t);if(!n)return;const s=n.families;for(let t=0,c=s.length;t<c;++t){const a=s[t],o=n.style+`
`+n.weight+`
`+a;void 0===Vt.get(o)&&(Vt.set(o,100,!0),i(n.style,n.weight,a)||(Vt.set(o,0,!0),void 0===e&&(e=setInterval(r,32))))}}}(),f2=function(){let e;return function(t){let n=ir[t];if(n==null){if(ed){const e=I1(t),s=p2(t,"Žg");n=(isNaN(Number(e.lineHeight))?1.2:Number(e.lineHeight))*(s.actualBoundingBoxAscent+s.actualBoundingBoxDescent)}else e||(e=document.createElement("div"),e.innerHTML="M",e.style.minHeight="0",e.style.maxHeight="none",e.style.height="auto",e.style.padding="0",e.style.border="none",e.style.position="absolute",e.style.display="block",e.style.left="-99999px"),e.style.font=t,document.body.appendChild(e),n=e.offsetHeight,document.body.removeChild(e);ir[t]=n}return n}}();function p2(e,t){return zo||(zo=K(1,1)),e!=F1&&(zo.font=e,F1=zo.font),zo.measureText(t)}function Oa(e,t){return p2(e,t).width}function O1(e,t,n){if(t in n)return n[t];const s=t.split(`
`).reduce((t,n)=>Math.max(t,Oa(e,n)),0);return n[t]=s,s}function S2(e,t){const i=[],a=[],r=[];let o=0,n=0,c=0,s=0;for(let l=0,d=t.length;l<=d;l+=2){const u=t[l];if(`
`===u||l===d){o=Math.max(o,n),r.push(n),n=0,c+=s,s=0;continue}const h=t[l+1]||e.font,m=Oa(h,u);i.push(m),n+=m;const f=f2(h);a.push(f),s=Math.max(s,f)}return{width:o,height:c,widths:i,heights:a,lineWidths:r}}function T2(e,t,n,s,o,i,a,r,c,l,d){e.save(),1!==n&&(void 0===e.globalAlpha?e.globalAlpha=e=>e.globalAlpha*=n:e.globalAlpha*=n),t&&e.transform.apply(e,t),s.contextInstructions?(e.translate(c,l),e.scale(d[0],d[1]),function(e,t){const n=e.contextInstructions;for(let e=0,s=n.length;e<s;e+=2)Array.isArray(n[e+1])?t[n[e]].apply(t,n[e+1]):t[n[e]]=n[e+1]}(s,e)):d[0]<0||d[1]<0?(e.translate(c,l),e.scale(d[0],d[1]),e.drawImage(s,o,i,a,r,0,0,a,r)):e.drawImage(s,o,i,a,r,c,l,a*d[0],r*d[1]),e.restore()}class mr extends kr{constructor(e){super({opacity:1,rotateWithView:void 0!==e.rotateWithView&&e.rotateWithView,rotation:void 0!==e.rotation?e.rotation:0,scale:void 0!==e.scale?e.scale:1,displacement:void 0!==e.displacement?e.displacement:[0,0],declutterMode:e.declutterMode}),this.canvases_,this.hitDetectionCanvas_=null,this.fill_=void 0!==e.fill?e.fill:null,this.origin_=[0,0],this.points_=e.points,this.radius_=e.radius,this.radius2_=e.radius2,this.angle_=void 0!==e.angle?e.angle:0,this.stroke_=void 0!==e.stroke?e.stroke:null,this.size_,this.renderOptions_,this.imageState_=this.fill_&&this.fill_.loading()?u.LOADING:u.LOADED,this.imageState_===u.LOADING&&this.ready().then(()=>this.imageState_=u.LOADED),this.render()}clone(){const e=this.getScale(),t=new mr({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(e)?e.slice():e,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return t.setOpacity(this.getOpacity()),t}getAnchor(){const e=this.size_,t=this.getDisplacement(),n=this.getScaleArray();return[e[0]/2-t[0]/n[0],e[1]/2+t[1]/n[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(e){this.fill_=e,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.createHitDetectionCanvas_(this.renderOptions_)),this.hitDetectionCanvas_}getImage(e){let t=this.canvases_[e];if(!t){const n=this.renderOptions_,s=K(n.size*e,n.size*e);this.draw_(n,s,e),t=s.canvas,this.canvases_[e]=t}return t}getPixelRatio(e){return e}getImageSize(){return this.size_}getImageState(){return this.imageState_}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius_}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(e){this.stroke_=e,this.render()}listenImageChange(){}load(){}unlistenImageChange(){}calculateLineJoinSize_(e,t,n){if(0===t||this.points_===1/0||"bevel"!==e&&"miter"!==e)return t;let s=this.radius_,o=void 0===this.radius2_?s:this.radius2_;if(s<o){const e=s;s=o,o=e}const g=void 0===this.radius2_?this.points_:2*this.points_,m=2*Math.PI/g,a=o*Math.sin(m),l=s-Math.sqrt(o*o-a*a),d=Math.sqrt(a*a+l*l),r=d/a;if("miter"===e&&r<=n)return r*t;const u=t/2/r,h=t/2*(l/d),c=Math.sqrt((s+u)*(s+u)+h*h)-s;if(void 0===this.radius2_||"bevel"===e)return 2*c;const i=s*Math.sin(m),f=o-Math.sqrt(s*s-i*i),p=Math.sqrt(i*i+f*f)/i;if(p<=n){const e=p*t/2-o-s;return 2*Math.max(c,e)}return 2*c}createRenderOptions(){let s,o=ds,e=ms,t=0,i=null,a=0,n=0;this.stroke_&&(s=Mt(this.stroke_.getColor()??Ao),n=this.stroke_.getWidth()??1,i=this.stroke_.getLineDash(),a=this.stroke_.getLineDashOffset()??0,e=this.stroke_.getLineJoin()??ms,o=this.stroke_.getLineCap()??ds,t=this.stroke_.getMiterLimit()??ko);const r=this.calculateLineJoinSize_(e,n,t),c=Math.max(this.radius_,this.radius2_||0);return{strokeStyle:s,strokeWidth:n,size:Math.ceil(2*c+r),lineCap:o,lineDash:i,lineDashOffset:a,lineJoin:e,miterLimit:t}}render(){this.renderOptions_=this.createRenderOptions();const e=this.renderOptions_.size;this.canvases_={},this.hitDetectionCanvas_=null,this.size_=[e,e]}draw_(e,t,n){if(t.scale(n,n),t.translate(e.size/2,e.size/2),this.createPath_(t),this.fill_){let e=this.fill_.getColor();null===e&&(e=He),t.fillStyle=Mt(e),t.fill()}e.strokeStyle&&(t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth,e.lineDash&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.lineCap=e.lineCap,t.lineJoin=e.lineJoin,t.miterLimit=e.miterLimit,t.stroke())}createHitDetectionCanvas_(e){let t;if(this.fill_){let n=this.fill_.getColor(),s=0;"string"==typeof n&&(n=mt(n)),null===n?s=1:Array.isArray(n)&&(s=4===n.length?n[3]:1),0===s&&(t=K(e.size,e.size),this.drawHitDetectionCanvas_(e,t))}return t?t.canvas:this.getImage(1)}createPath_(e){let t=this.points_;const n=this.radius_;if(t===1/0)e.arc(0,0,n,0,2*Math.PI);else{const s=void 0===this.radius2_?n:this.radius2_;void 0!==this.radius2_&&(t*=2);const o=this.angle_-Math.PI/2,i=2*Math.PI/t;for(let a=0;a<t;a++){const r=o+a*i,c=a%2==0?n:s;e.lineTo(c*Math.cos(r),c*Math.sin(r))}e.closePath()}}drawHitDetectionCanvas_(e,t){t.translate(e.size/2,e.size/2),this.createPath_(t),t.fillStyle=He,t.fill(),e.strokeStyle&&(t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth,e.lineDash&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.lineJoin=e.lineJoin,t.miterLimit=e.miterLimit,t.stroke())}ready(){return this.fill_?this.fill_.ready():Promise.resolve()}}class ja extends mr{constructor(e){super({points:1/0,fill:(e=e||{radius:5}).fill,radius:e.radius,stroke:e.stroke,scale:void 0!==e.scale?e.scale:1,rotation:void 0!==e.rotation?e.rotation:0,rotateWithView:void 0!==e.rotateWithView&&e.rotateWithView,displacement:void 0!==e.displacement?e.displacement:[0,0],declutterMode:e.declutterMode})}clone(){const e=this.getScale(),t=new ja({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return t.setOpacity(this.getOpacity()),t}setRadius(e){this.radius_=e,this.render()}}class ot{constructor(e){e=e||{},this.patternImage_=null,this.color_=null,void 0!==e.color&&this.setColor(e.color)}clone(){const e=this.getColor();return new ot({color:Array.isArray(e)?e.slice():e||void 0})}getColor(){return this.color_}setColor(e){if(null!==e&&"object"==typeof e&&"src"in e){const t=Ya(null,e.src,"anonymous",void 0,e.offset?null:e.color?e.color:null,!e.offset||!e.size);t.ready().then(()=>{this.patternImage_=null}),t.getImageState()===u.IDLE&&t.load(),t.getImageState()===u.LOADING&&(this.patternImage_=t)}this.color_=e}loading(){return!!this.patternImage_}ready(){return this.patternImage_?this.patternImage_.ready():Promise.resolve()}}class Ze{constructor(e){e=e||{},this.color_=void 0!==e.color?e.color:null,this.lineCap_=e.lineCap,this.lineDash_=void 0!==e.lineDash?e.lineDash:null,this.lineDashOffset_=e.lineDashOffset,this.lineJoin_=e.lineJoin,this.miterLimit_=e.miterLimit,this.width_=e.width}clone(){const e=this.getColor();return new Ze({color:Array.isArray(e)?e.slice():e||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(e){this.color_=e}setLineCap(e){this.lineCap_=e}setLineDash(e){this.lineDash_=e}setLineDashOffset(e){this.lineDashOffset_=e}setLineJoin(e){this.lineJoin_=e}setMiterLimit(e){this.miterLimit_=e}setWidth(e){this.width_=e}}class ve{constructor(e){e=e||{},this.geometry_=null,this.geometryFunction_=q2,void 0!==e.geometry&&this.setGeometry(e.geometry),this.fill_=void 0!==e.fill?e.fill:null,this.image_=void 0!==e.image?e.image:null,this.renderer_=void 0!==e.renderer?e.renderer:null,this.hitDetectionRenderer_=void 0!==e.hitDetectionRenderer?e.hitDetectionRenderer:null,this.stroke_=void 0!==e.stroke?e.stroke:null,this.text_=void 0!==e.text?e.text:null,this.zIndex_=e.zIndex}clone(){let e=this.getGeometry();return e&&"object"==typeof e&&(e=e.clone()),new ve({geometry:e??void 0,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer()??void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(e){this.renderer_=e}setHitDetectionRenderer(e){this.hitDetectionRenderer_=e}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(e){this.fill_=e}getImage(){return this.image_}setImage(e){this.image_=e}getStroke(){return this.stroke_}setStroke(e){this.stroke_=e}getText(){return this.text_}setText(e){this.text_=e}getZIndex(){return this.zIndex_}setGeometry(e){"function"==typeof e?this.geometryFunction_=e:"string"==typeof e?this.geometryFunction_=function(t){return t.get(e)}:e?void 0!==e&&(this.geometryFunction_=function(){return e}):this.geometryFunction_=q2,this.geometry_=e}setZIndex(e){this.zIndex_=e}}function $2(e){let t;if("function"==typeof e)t=e;else{let n;Array.isArray(e)?n=e:(x("function"==typeof e.getZIndex,"Expected an `Style` or an array of `Style`"),n=[e]),t=function(){return n}}return t}let p1=null;function f1(){if(!p1){const e=new ot({color:"rgba(255,255,255,0.4)"}),t=new Ze({color:"#3399CC",width:1.25});p1=[new ve({image:new ja({fill:e,stroke:t,radius:5}),fill:e,stroke:t})]}return p1}function Ro(){const e={},t=[255,255,255,1],n=[0,153,255,1];return e.Polygon=[new ve({fill:new ot({color:[255,255,255,.5]})})],e.MultiPolygon=e.Polygon,e.LineString=[new ve({stroke:new Ze({color:t,width:5})}),new ve({stroke:new Ze({color:n,width:3})})],e.MultiLineString=e.LineString,e.Circle=e.Polygon.concat(e.LineString),e.Point=[new ve({image:new ja({radius:6,fill:new ot({color:n}),stroke:new Ze({color:t,width:1.5})}),zIndex:1/0})],e.MultiPoint=e.Point,e.GeometryCollection=e.Polygon.concat(e.LineString,e.Point),e}function q2(e){return e.getGeometry()}function e3(e,t,n,s){return void 0!==n&&void 0!==s?[n/e,s/t]:void 0!==n?n/e:void 0!==s?s/t:1}class Vo extends kr{constructor(e){const o=void 0!==(e=e||{}).opacity?e.opacity:1,i=void 0!==e.rotation?e.rotation:0,a=void 0!==e.scale?e.scale:1,r=void 0!==e.rotateWithView&&e.rotateWithView;super({opacity:o,rotation:i,scale:a,displacement:void 0!==e.displacement?e.displacement:[0,0],rotateWithView:r,declutterMode:e.declutterMode}),this.anchor_=void 0!==e.anchor?e.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=void 0!==e.anchorOrigin?e.anchorOrigin:"top-left",this.anchorXUnits_=void 0!==e.anchorXUnits?e.anchorXUnits:"fraction",this.anchorYUnits_=void 0!==e.anchorYUnits?e.anchorYUnits:"fraction",this.crossOrigin_=void 0!==e.crossOrigin?e.crossOrigin:null;const t=void 0!==e.img?e.img:null;let s,n=e.src;if(x(void 0===n||!t,"`image` and `src` cannot be provided at the same time"),void 0!==n&&0!==n.length||!t||(n=t.src||c(t)),x(void 0!==n&&n.length>0,"A defined and non-empty `src` or `image` must be provided"),x(void 0===e.width&&void 0===e.height||void 0===e.scale,"`width` or `height` cannot be provided together with `scale`"),void 0!==e.src?s=u.IDLE:void 0!==t&&(s="complete"in t?t.complete?t.src?u.LOADED:u.IDLE:u.LOADING:u.LOADED),this.color_=void 0!==e.color?mt(e.color):null,this.iconImage_=Ya(t,n,this.crossOrigin_,s,this.color_),this.offset_=void 0!==e.offset?e.offset:[0,0],this.offsetOrigin_=void 0!==e.offsetOrigin?e.offsetOrigin:"top-left",this.origin_=null,this.size_=void 0!==e.size?e.size:null,void 0!==e.width||void 0!==e.height){let t,n;if(e.size)[t,n]=e.size;else{const s=this.getImage(1);if(s.width&&s.height)t=s.width,n=s.height;else if(s instanceof HTMLImageElement){this.initialOptions_=e;const t=()=>{if(this.unlistenImageChange(t),!this.initialOptions_)return;const n=this.iconImage_.getSize();this.setScale(e3(n[0],n[1],e.width,e.height))};return void this.listenImageChange(t)}}void 0!==t&&this.setScale(e3(t,n,e.width,e.height))}}clone(){let e,t,n;return this.initialOptions_?(t=this.initialOptions_.width,n=this.initialOptions_.height):(e=this.getScale(),e=Array.isArray(e)?e.slice():e),new Vo({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:e,width:t,height:n,size:null!==this.size_?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let e=this.normalizedAnchor_;if(!e){e=this.anchor_;const t=this.getSize();if("fraction"==this.anchorXUnits_||"fraction"==this.anchorYUnits_){if(!t)return null;e=this.anchor_.slice(),"fraction"==this.anchorXUnits_&&(e[0]*=t[0]),"fraction"==this.anchorYUnits_&&(e[1]*=t[1])}if("top-left"!=this.anchorOrigin_){if(!t)return null;e===this.anchor_&&(e=this.anchor_.slice()),"top-right"!=this.anchorOrigin_&&"bottom-right"!=this.anchorOrigin_||(e[0]=-e[0]+t[0]),"bottom-left"!=this.anchorOrigin_&&"bottom-right"!=this.anchorOrigin_||(e[1]=-e[1]+t[1])}this.normalizedAnchor_=e}const t=this.getDisplacement(),n=this.getScaleArray();return[e[0]-t[0]/n[0],e[1]+t[1]/n[1]]}setAnchor(e){this.anchor_=e,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(e){return this.iconImage_.getImage(e)}getPixelRatio(e){return this.iconImage_.getPixelRatio(e)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let e=this.offset_;if("top-left"!=this.offsetOrigin_){const t=this.getSize(),n=this.iconImage_.getSize();if(!t||!n)return null;e=e.slice(),"top-right"!=this.offsetOrigin_&&"bottom-right"!=this.offsetOrigin_||(e[0]=n[0]-t[0]-e[0]),"bottom-left"!=this.offsetOrigin_&&"bottom-right"!=this.offsetOrigin_||(e[1]=n[1]-t[1]-e[1])}return this.origin_=e,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const e=this.getScaleArray();return this.size_?this.size_[0]*e[0]:this.iconImage_.getImageState()==u.LOADED?this.iconImage_.getSize()[0]*e[0]:void 0}getHeight(){const e=this.getScaleArray();return this.size_?this.size_[1]*e[1]:this.iconImage_.getImageState()==u.LOADED?this.iconImage_.getSize()[1]*e[1]:void 0}setScale(e){delete this.initialOptions_,super.setScale(e)}listenImageChange(e){this.iconImage_.addEventListener(A,e)}load(){this.iconImage_.load()}unlistenImageChange(e){this.iconImage_.removeEventListener(A,e)}ready(){return this.iconImage_.ready()}}class Is{constructor(e){e=e||{},this.font_=e.font,this.rotation_=e.rotation,this.rotateWithView_=e.rotateWithView,this.scale_=e.scale,this.scaleArray_=X(void 0!==e.scale?e.scale:1),this.text_=e.text,this.textAlign_=e.textAlign,this.justify_=e.justify,this.repeat_=e.repeat,this.textBaseline_=e.textBaseline,this.fill_=void 0!==e.fill?e.fill:new ot({color:"#333"}),this.maxAngle_=void 0!==e.maxAngle?e.maxAngle:Math.PI/4,this.placement_=void 0!==e.placement?e.placement:"point",this.overflow_=!!e.overflow,this.stroke_=void 0!==e.stroke?e.stroke:null,this.offsetX_=void 0!==e.offsetX?e.offsetX:0,this.offsetY_=void 0!==e.offsetY?e.offsetY:0,this.backgroundFill_=e.backgroundFill?e.backgroundFill:null,this.backgroundStroke_=e.backgroundStroke?e.backgroundStroke:null,this.padding_=void 0===e.padding?null:e.padding,this.declutterMode_=e.declutterMode}clone(){const e=this.getScale();return new Is({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(e)?e.slice():e,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0,declutterMode:this.getDeclutterMode()})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}getDeclutterMode(){return this.declutterMode_}setOverflow(e){this.overflow_=e}setFont(e){this.font_=e}setMaxAngle(e){this.maxAngle_=e}setOffsetX(e){this.offsetX_=e}setOffsetY(e){this.offsetY_=e}setPlacement(e){this.placement_=e}setRepeat(e){this.repeat_=e}setRotateWithView(e){this.rotateWithView_=e}setFill(e){this.fill_=e}setRotation(e){this.rotation_=e}setScale(e){this.scale_=e,this.scaleArray_=X(void 0!==e?e:1)}setStroke(e){this.stroke_=e}setText(e){this.text_=e}setTextAlign(e){this.textAlign_=e}setJustify(e){this.justify_=e}setTextBaseline(e){this.textBaseline_=e}setBackgroundFill(e){this.backgroundFill_=e}setBackgroundStroke(e){this.backgroundStroke_=e}setPadding(e){this.padding_=e}}let qo=0;const Zn=0,Q=1<<qo++,l=1<<qo++,pe=1<<qo++,B=1<<qo++,be=1<<qo++,ct=1<<qo++,Ee=Math.pow(2,6)-1,R3={[Q]:"boolean",[l]:"number",[pe]:"string",[B]:"color",[be]:"number[]",[ct]:"size"},x5=Object.keys(R3).map(Number).sort(_t);function fe(e){const t=[];for(const n of x5)H3(e,n)&&t.push(R3[n]);return 0===t.length?"untyped":t.length<3?t.join(" or "):t.slice(0,-1).join(", ")+", or "+t[t.length-1]}function H3(e,t){return(e&t)===t}function vt(e,t){return!!(e&t)}function Ho(e,t){return e===t}class jn{constructor(e,t){this.type=e,this.value=t}}class Uu{constructor(e,t,...n){this.type=e,this.operator=t,this.args=n}}function $r(){return{variables:new Set,properties:new Set,featureId:!1,geometryType:!1,style:{}}}function V(e,t,n){switch(typeof e){case"boolean":return new jn(Q,e);case"number":return new jn(n===ct?ct:l,e);case"string":{let t=pe;return U4(e)&&(t|=B),Ho(t&n,Zn)||(t&=n),new jn(t,e)}}if(!Array.isArray(e))throw new Error("Expression must be an array or a primitive value");if(0===e.length)throw new Error("Empty expression");if("string"==typeof e[0])return function(e,t,n){const s=e[0],o=y5[s];if(!o)throw new Error(`Unknown operator: ${s}`);return o(e,t,n)}(e,t,n);for(const t of e)if("number"!=typeof t)throw new Error("Expected an array of numbers");let s=be;return 2===e.length?s|=ct:3!==e.length&&4!==e.length||(s|=B),n&&(s&=n),new jn(s,e)}const s={Get:"get",Var:"var",Concat:"concat",GeometryType:"geometry-type",Any:"any",All:"all",Not:"!",Resolution:"resolution",Zoom:"zoom",Time:"time",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match",Between:"between",Interpolate:"interpolate",Coalesce:"coalesce",Case:"case",In:"in",Number:"number",String:"string",Array:"array",Color:"color",Id:"id",Band:"band",Palette:"palette",ToString:"to-string"},y5={[s.Get]:E(([e,t])=>void 0!==t?function(e){switch(e){case"string":return pe;case"color":return B;case"number":return l;case"boolean":return Q;case"number[]":return be;default:throw new Error(`Unrecognized type hint: ${e}`)}}(t.value):Ee,M(1,2),function(e,t){const n=V(e[1],t);if(!(n instanceof jn))throw new Error("Expected a literal argument for get operation");if("string"!=typeof n.value)throw new Error("Expected a string argument for get operation");return t.properties.add(n.value),3===e.length?[n,V(e[2],t)]:[n]}),[s.Var]:E(([e])=>e.type,M(1,1),function(e,t,n,s){const o=e[1];if("string"!=typeof o)throw new Error("Expected a string argument for var operation");if(t.variables.add(o),!("variables"in t.style)||void 0===t.style.variables[o])return[new jn(Ee,o)];const a=t.style.variables[o],i=V(a,t);if(i.value=o,s&&!vt(s,i.type))throw new Error(`The variable ${o} has type ${fe(i.type)} but the following type was expected: ${fe(s)}`);return[i]}),[s.Id]:E(l|pe,Ji,function(e,t){t.featureId=!0}),[s.Concat]:E(pe,M(2,1/0),P(Ee)),[s.GeometryType]:E(pe,Ji,function(e,t){t.geometryType=!0}),[s.Resolution]:E(l,Ji),[s.Zoom]:E(l,Ji),[s.Time]:E(l,Ji),[s.Any]:E(Q,M(2,1/0),P(Q)),[s.All]:E(Q,M(2,1/0),P(Q)),[s.Not]:E(Q,M(1,1),P(Q)),[s.Equal]:E(Q,M(2,2),P(Ee),In),[s.NotEqual]:E(Q,M(2,2),P(Ee),In),[s.GreaterThan]:E(Q,M(2,2),P(Ee),In),[s.GreaterThanOrEqualTo]:E(Q,M(2,2),P(Ee),In),[s.LessThan]:E(Q,M(2,2),P(Ee),In),[s.LessThanOrEqualTo]:E(Q,M(2,2),P(Ee),In),[s.Multiply]:E(e=>{let t=l|B;for(let n=0;n<e.length;n++)t&=e[n].type;return t},M(2,1/0),P(l|B),In),[s.Coalesce]:E(e=>{let t=Ee;for(let n=1;n<e.length;n+=2)t&=e[n].type;return t&=e[e.length-1].type,t},M(2,1/0),P(Ee),In),[s.Divide]:E(l,M(2,2),P(l)),[s.Add]:E(l,M(2,1/0),P(l)),[s.Subtract]:E(l,M(2,2),P(l)),[s.Clamp]:E(l,M(3,3),P(l)),[s.Mod]:E(l,M(2,2),P(l)),[s.Pow]:E(l,M(2,2),P(l)),[s.Abs]:E(l,M(1,1),P(l)),[s.Floor]:E(l,M(1,1),P(l)),[s.Ceil]:E(l,M(1,1),P(l)),[s.Round]:E(l,M(1,1),P(l)),[s.Sin]:E(l,M(1,1),P(l)),[s.Cos]:E(l,M(1,1),P(l)),[s.Atan]:E(l,M(1,2),P(l)),[s.Sqrt]:E(l,M(1,1),P(l)),[s.Match]:E(e=>{let t=Ee;for(let n=2;n<e.length;n+=2)t&=e[n].type;return t&=e[e.length-1].type,t},M(4,1/0),Z3,function(e,t,n,s){const r=e.length-1,u=V(e[1],t);let o=u.type;const d=V(e[e.length-1],t);let a=void 0!==s?s&d.type:d.type;const i=new Array(r-2);for(let n=0;n<r-2;n+=2){const s=V(e[n+2],t),c=V(e[n+3],t);o&=s.type,a&=c.type,i[n]=s,i[n+1]=c}const c=pe|l|Q;if(!vt(c,o))throw new Error(`Expected an input of type ${fe(c)} for the interpolate operation, got ${fe(o)} instead`);if(o&=c,Ho(a,Zn))throw new Error("Could not find a common output type for the following match operation: "+JSON.stringify(e));for(let n=0;n<r-2;n+=2){const s=V(e[n+2],t,o),c=V(e[n+3],t,a);i[n]=s,i[n+1]=c}return[V(e[1],t,o),...i,V(e[e.length-1],t,a)]}),[s.Between]:E(Q,M(3,3),P(l)),[s.Interpolate]:E(e=>{let t=B|l;for(let n=3;n<e.length;n+=2)t&=e[n].type;return t},M(6,1/0),Z3,function(e,t){const r=e[1];let o;switch(r[0]){case"linear":o=1;break;case"exponential":if(o=r[1],"number"!=typeof o)throw new Error(`Expected a number base for exponential interpolation, got ${JSON.stringify(o)} instead`);break;default:o=null}if(!o)throw new Error(`Invalid interpolation type: ${JSON.stringify(r)}`);o=V(o,t);let i=V(e[2],t);if(!vt(l,i.type))throw new Error(`Expected an input of type number for the interpolate operation, got ${fe(i.type)} instead`);i=V(e[2],t,l);const a=new Array(e.length-3);for(let n=0;n<a.length;n+=2){let s=V(e[n+3],t);if(!vt(l,s.type))throw new Error(`Expected all stop input values in the interpolate operation to be of type number, got ${fe(s.type)} at position ${n+2} instead`);let o=V(e[n+4],t);if(!vt(l|B,o.type))throw new Error(`Expected all stop output values in the interpolate operation to be a number or color, got ${fe(o.type)} at position ${n+3} instead`);s=V(e[n+3],t,l),o=V(e[n+4],t,l|B),a[n]=s,a[n+1]=o}return[o,i,...a]}),[s.Case]:E(e=>{let t=Ee;for(let n=1;n<e.length;n+=2)t&=e[n].type;return t&=e[e.length-1].type,t},M(3,1/0),function(e){const s=e[0],n=e.length-1;if(n%2==0)throw new Error(`An odd amount of arguments was expected for operation ${s}, got ${JSON.stringify(n)} instead`)},function(e,t,n,s){const a=V(e[e.length-1],t,s);let i=void 0!==s?s&a.type:a.type;const o=new Array(e.length-1);for(let n=0;n<o.length-1;n+=2){const a=V(e[n+1],t),r=V(e[n+2],t,s);if(!vt(Q,a.type))throw new Error(`Expected all conditions in the case operation to be of type boolean, got ${fe(a.type)} at position ${n} instead`);i&=r.type,o[n]=a,o[n+1]=r}if(Ho(i,Zn))throw new Error("Could not find a common output type for the following case operation: "+JSON.stringify(e));for(let n=0;n<o.length-1;n+=2)o[n+1]=V(e[n+2],t,i);return o[o.length-1]=V(e[e.length-1],t,i),o}),[s.In]:E(Q,M(2,2),function(e,t){let n=e[2];if(!Array.isArray(n))throw new Error('The "in" operator was provided a literal value which was not an array as second argument.');if("string"==typeof n[0]){if("literal"!==n[0])throw new Error('For the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions.');if(!Array.isArray(n[1]))throw new Error('The "in" operator was provided a literal value which was not an array as second argument.');n=n[1]}let s=pe|l;const o=new Array(n.length);for(let e=0;e<o.length;e++){const i=V(n[e],t);s&=i.type,o[e]=i}if(Ho(s,Zn))throw new Error("Could not find a common type for the following in operation: "+JSON.stringify(e));const i=V(e[1],t,s);return[i,...o]}),[s.Number]:E(l,M(1,1/0),P(Ee)),[s.String]:E(pe,M(1,1/0),P(Ee)),[s.Array]:E(e=>2===e.length?be|ct:3===e.length||4===e.length?be|B:be,M(1,1/0),P(l)),[s.Color]:E(B,M(1,4),P(l)),[s.Band]:E(l,M(1,3),P(l)),[s.Palette]:E(B,M(2,2),function(e,t){const n=V(e[1],t,l);if(n.type!==l)throw new Error(`The first argument of palette must be an number, got ${fe(n.type)} instead`);const s=e[2];if(!Array.isArray(s))throw new Error("The second argument of palette must be an array");const o=new Array(s.length);for(let e=0;e<o.length;e++){const n=V(s[e],t,B);if(!(n instanceof jn))throw new Error(`The palette color at index ${e} must be a literal value`);if(!vt(n.type,B))throw new Error(`The palette color at index ${e} should be of type color, got ${fe(n.type)} instead`);o[e]=n}return[n,...o]}),[s.ToString]:E(pe,M(1,1),P(Q|l|pe|B))};function Ji(e){const n=e[0];if(1!==e.length)throw new Error(`Expected no arguments for ${n} operation`);return[]}function M(e,t){return function(n){const i=n[0],o=n.length-1;if(e===t){if(o!==e)throw new Error(`Expected ${e} argument${1===e?"":"s"} for ${i}, got ${o}`)}else if(o<e||o>t)throw new Error(`Expected ${t===1/0?`${e}or more`:`${e}to ${t}`} arguments for ${i}, got ${o}`)}}function P(e){return function(t,n){const i=t[0],s=t.length-1,o=new Array(s);for(let a=0;a<s;++a){const r=V(t[a+1],n);if(!vt(e,r.type)){const t=fe(e),n=fe(r.type);throw new Error(`Unexpected type for argument ${a} of ${i} operation, got ${t} but expected ${n}`)}r.type&=e,o[a]=r}return o}}function In(e,t,n){const a=e[0],o=e.length-1;let s=Ee;for(let e=0;e<n.length;++e)s&=n[e].type;if(s===Zn)throw new Error(`No common type could be found for arguments of ${a} operation`);const i=new Array(o);for(let n=0;n<o;++n)i[n]=V(e[n+1],t,s);return i}function Z3(e){const s=e[0],n=e.length-1;if(n%2==1)throw new Error(`An even amount of arguments was expected for operation ${s}, got ${JSON.stringify(n)} instead`)}function E(e,...t){return function(n,s,o){const r=n[0];let i=[];for(let e=0;e<t.length;e++)i=t[e](n,s,i,o)||i;let a="function"==typeof e?e(i):e;if(void 0!==o){if(!vt(a,o))throw new Error(`The following expression was expected to return ${fe(o)}, but returns ${fe(a)} instead: ${JSON.stringify(n)}`);a&=o}if(a===Zn)throw new Error(`No matching type was found for the following expression: ${JSON.stringify(n)}`);return new Uu(a,r,...i)}}function Jr(e){if(!e)return"";const t=e.getType();switch(t){case"Point":case"LineString":case"Polygon":return t;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return t.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return Jr(e.getGeometries()[0]);default:return""}}function p5(){return{variables:{},properties:{},resolution:NaN,featureId:null,geometryType:""}}function Wt(e,t,n){const s=V(e,n);if(!vt(t,s.type)){const e=fe(t),n=fe(s.type);throw new Error(`Expected expression to be of type ${e}, got ${n}`)}return Ot(s)}function Ot(e){if(e instanceof jn){if(e.type===B&&"string"==typeof e.value){const t=ar(e.value);return function(){return t}}return function(){return e.value}}const n=e.operator;switch(n){case s.Number:case s.String:case s.Coalesce:return function(e){const n=e.operator,o=e.args.length,i=new Array(o);for(let t=0;t<o;++t)i[t]=Ot(e.args[t]);switch(n){case s.Coalesce:return e=>{for(let t=0;t<o;++t){const n=i[t](e);if(n!=null)return n}throw new Error("Expected one of the values to be non-null")};case s.Number:case s.String:return e=>{for(let t=0;t<o;++t){const s=i[t](e);if(typeof s===n)return s}throw new Error(`Expected one of the values to be a ${n}`)};default:throw new Error(`Unsupported assertion operator ${n}`)}}(e);case s.Get:case s.Var:return function(e){const o=e.args[0],n=o.value;switch(e.operator){case s.Get:return e=>e.properties[n];case s.Var:return e=>e.variables[n];default:throw new Error(`Unsupported accessor operator ${e.operator}`)}}(e);case s.Id:return e=>e.featureId;case s.GeometryType:return e=>e.geometryType;case s.Concat:{const t=e.args.map(e=>Ot(e));return e=>"".concat(...t.map(t=>t(e).toString()))}case s.Resolution:return e=>e.resolution;case s.Any:case s.All:case s.Between:case s.In:case s.Not:return function(e){const i=e.operator,o=e.args.length,n=new Array(o);for(let t=0;t<o;++t)n[t]=Ot(e.args[t]);switch(i){case s.Any:return e=>{for(let t=0;t<o;++t)if(n[t](e))return!0;return!1};case s.All:return e=>{for(let t=0;t<o;++t)if(!n[t](e))return!1;return!0};case s.Between:return e=>{const t=n[0](e),s=n[1](e),o=n[2](e);return t>=s&&t<=o};case s.In:return e=>{const t=n[0](e);for(let s=1;s<o;++s)if(t===n[s](e))return!0;return!1};case s.Not:return e=>!n[0](e);default:throw new Error(`Unsupported logical operator ${i}`)}}(e);case s.Equal:case s.NotEqual:case s.LessThan:case s.LessThanOrEqualTo:case s.GreaterThan:case s.GreaterThanOrEqualTo:return function(e){const i=e.operator,n=Ot(e.args[0]),o=Ot(e.args[1]);switch(i){case s.Equal:return e=>n(e)===o(e);case s.NotEqual:return e=>n(e)!==o(e);case s.LessThan:return e=>n(e)<o(e);case s.LessThanOrEqualTo:return e=>n(e)<=o(e);case s.GreaterThan:return e=>n(e)>o(e);case s.GreaterThanOrEqualTo:return e=>n(e)>=o(e);default:throw new Error(`Unsupported comparison operator ${i}`)}}(e);case s.Multiply:case s.Divide:case s.Add:case s.Subtract:case s.Clamp:case s.Mod:case s.Pow:case s.Abs:case s.Floor:case s.Ceil:case s.Round:case s.Sin:case s.Cos:case s.Atan:case s.Sqrt:return function(e){const i=e.operator,o=e.args.length,n=new Array(o);for(let t=0;t<o;++t)n[t]=Ot(e.args[t]);switch(i){case s.Multiply:return e=>{let t=1;for(let s=0;s<o;++s)t*=n[s](e);return t};case s.Divide:return e=>n[0](e)/n[1](e);case s.Add:return e=>{let t=0;for(let s=0;s<o;++s)t+=n[s](e);return t};case s.Subtract:return e=>n[0](e)-n[1](e);case s.Clamp:return e=>{const t=n[0](e),s=n[1](e);if(t<s)return s;const o=n[2](e);return t>o?o:t};case s.Mod:return e=>n[0](e)%n[1](e);case s.Pow:return e=>Math.pow(n[0](e),n[1](e));case s.Abs:return e=>Math.abs(n[0](e));case s.Floor:return e=>Math.floor(n[0](e));case s.Ceil:return e=>Math.ceil(n[0](e));case s.Round:return e=>Math.round(n[0](e));case s.Sin:return e=>Math.sin(n[0](e));case s.Cos:return e=>Math.cos(n[0](e));case s.Atan:return 2===o?e=>Math.atan2(n[0](e),n[1](e)):e=>Math.atan(n[0](e));case s.Sqrt:return e=>Math.sqrt(n[0](e));default:throw new Error(`Unsupported numeric operator ${i}`)}}(e);case s.Case:return function(e){const n=e.args.length,s=new Array(n);for(let t=0;t<n;++t)s[t]=Ot(e.args[t]);return e=>{for(let t=0;t<n-1;t+=2)if(s[t](e))return s[t+1](e);return s[n-1](e)}}(e);case s.Match:return function(e){const s=e.args.length,n=new Array(s);for(let t=0;t<s;++t)n[t]=Ot(e.args[t]);return e=>{const t=n[0](e);for(let o=1;o<s;o+=2)if(t===n[o](e))return n[o+1](e);return n[s-1](e)}}(e);case s.Interpolate:return function(e){const s=e.args.length,n=new Array(s);for(let t=0;t<s;++t)n[t]=Ot(e.args[t]);return e=>{const a=n[0](e),o=n[1](e);let i,t;for(let c=2;c<s;c+=2){const l=n[c](e);let r=n[c+1](e);const d=Array.isArray(r);if(d&&(r=J8(r)),l>=o)return 2===c?r:d?f5(a,o,i,t,l,r):Zi(a,o,i,t,l,r);i=l,t=r}return t}}(e);case s.ToString:return function(e){const n=e.operator,o=e.args.length,i=new Array(o);for(let t=0;t<o;++t)i[t]=Ot(e.args[t]);if(n===s.ToString)return t=>{const n=i[0](t);return e.args[0].type===B?sr(n):n.toString()};throw new Error(`Unsupported convert operator ${n}`)}(e);default:throw new Error(`Unsupported operator ${n}`)}}function Zi(e,t,n,s,o,i){const a=o-n;if(0===a)return s;const r=t-n;return s+(1===e?r/a:(Math.pow(e,r)-1)/(Math.pow(e,a)-1))*(i-s)}function f5(e,t,n,s,o,i){if(0===o-n)return s;const r=Sl(s),c=Sl(i);let a=c[2]-r[2];return a>180?a-=360:a<-180&&(a+=360),M4(D4([Zi(e,t,n,r[0],o,c[0]),Zi(e,t,n,r[1],o,c[1]),r[2]+Zi(e,t,n,0,o,a),Zi(e,t,n,s[3],o,i[3])]))}function m5(){return!0}function gh(e){const n=$r(),s=yh(e,n),t={variables:{},properties:{},resolution:NaN,featureId:null,geometryType:""};return function(e,o){if(t.properties=e.getPropertiesInternal(),t.resolution=o,n.featureId){const n=e.getId();t.featureId=void 0!==n?n:null}return n.geometryType&&(t.geometryType=Jr(e.getGeometry())),s(t)}}function zu(e){const o=$r(),t=e.length,i=new Array(t);for(let n=0;n<t;++n)i[n]=lc(e[n],o);const n={variables:{},properties:{},resolution:NaN,featureId:null,geometryType:""},s=new Array(t);return function(e,a){if(n.properties=e.getPropertiesInternal(),n.resolution=a,o.featureId){const t=e.getId();n.featureId=void 0!==t?t:null}let r=0;for(let e=0;e<t;++e){const o=i[e](n);o&&(s[r]=o,r+=1)}return s.length=r,s}}function yh(e,t){const n=e.length,s=new Array(n);for(let i=0;i<n;++i){const o=e[i],r="filter"in o?Wt(o.filter,Q,t):m5;let a;if(Array.isArray(o.style)){const e=o.style.length;a=new Array(e);for(let n=0;n<e;++n)a[n]=lc(o.style[n],t)}else a=[lc(o.style,t)];s[i]={filter:r,styles:a}}return function(t){const o=[];let i=!1;for(let a=0;a<n;++a)if((0,s[a].filter)(t)&&(!e[a].else||!i)){i=!0;for(const n of s[a].styles){const e=n(t);e&&o.push(e)}}return o}}function lc(e,t){const s=$i(e,"",t),o=Bi(e,"",t),i=function(e,t){const n="text-",w=rn(e,n+"value",t);if(!w)return null;const h=$i(e,n,t),m=$i(e,n+"background-",t),a=Bi(e,n,t),r=Bi(e,n+"background-",t),c=rn(e,n+"font",t),l=We(e,n+"max-angle",t),d=We(e,n+"offset-x",t),u=We(e,n+"offset-y",t),o=Ii(e,n+"overflow",t),i=rn(e,n+"placement",t),f=We(e,n+"repeat",t),p=jc(e,n+"scale",t),g=Ii(e,n+"rotate-with-view",t),v=We(e,n+"rotation",t),b=rn(e,n+"align",t),j=rn(e,n+"justify",t),y=rn(e,n+"baseline",t),_=Oh(e,n+"padding",t),O=Oc(e,n+"declutter-mode"),s=new Is({declutterMode:O});return function(e){if(s.setText(w(e)),h&&s.setFill(h(e)),m&&s.setBackgroundFill(m(e)),a&&s.setStroke(a(e)),r&&s.setBackgroundStroke(r(e)),c&&s.setFont(c(e)),l&&s.setMaxAngle(l(e)),d&&s.setOffsetX(d(e)),u&&s.setOffsetY(u(e)),o&&s.setOverflow(o(e)),i){const t=i(e);if("point"!==t&&"line"!==t)throw new Error("Expected point or line for text-placement");s.setPlacement(t)}if(f&&s.setRepeat(f(e)),p&&s.setScale(p(e)),g&&s.setRotateWithView(g(e)),v&&s.setRotation(v(e)),b){const t=b(e);if("left"!==t&&"center"!==t&&"right"!==t&&"end"!==t&&"start"!==t)throw new Error("Expected left, right, center, start, or end for text-align");s.setTextAlign(t)}if(j){const t=j(e);if("left"!==t&&"right"!==t&&"center"!==t)throw new Error("Expected left, right, or center for text-justify");s.setJustify(t)}if(y){const t=y(e);if("bottom"!==t&&"top"!==t&&"middle"!==t&&"alphabetic"!==t&&"hanging"!==t)throw new Error("Expected bottom, top, middle, alphabetic, or hanging for text-baseline");s.setTextBaseline(t)}return _&&s.setPadding(_(e)),s}}(e,t),a=function(e,t){return"icon-src"in e?function(e,t){const n="icon-",o=n+"src",w=Hh(e[o],o),i=vc(e,n+"anchor",t),a=jc(e,n+"scale",t),r=We(e,n+"opacity",t),c=vc(e,n+"displacement",t),l=We(e,n+"rotation",t),d=Ii(e,n+"rotate-with-view",t),h=Ch(e,n+"anchor-origin"),u=Th(e,n+"anchor-x-units"),m=Th(e,n+"anchor-y-units"),f=function(e,t){const n=e[t];if(void 0===n)return;return Ih(n,t)}(e,n+"color"),p=function(e,t){const n=e[t];if(void 0===n)return;if("string"!=typeof n)throw new Error(`Expected a string for ${t}`);return n}(e,n+"cross-origin"),g=function(e,t){const n=e[t];if(void 0===n)return;return Fi(n,t)}(e,n+"offset"),v=Ch(e,n+"offset-origin"),b=yc(e,n+"width"),j=yc(e,n+"height"),y=function(e,t){const n=e[t];if(void 0===n)return;if("number"==typeof n)return X(n);if(!Array.isArray(n))throw new Error(`Expected a number or size array for ${t}`);if(2!==n.length||"number"!=typeof n[0]||"number"!=typeof n[1])throw new Error(`Expected a number or size array for ${t}`);return n}(e,n+"size"),_=Oc(e,n+"declutter-mode"),s=new Vo({src:w,anchorOrigin:h,anchorXUnits:u,anchorYUnits:m,color:f,crossOrigin:p,offset:g,offsetOrigin:v,height:j,width:b,size:y,declutterMode:_});return function(e){return r&&s.setOpacity(r(e)),c&&s.setDisplacement(c(e)),l&&s.setRotation(l(e)),d&&s.setRotateWithView(d(e)),a&&s.setScale(a(e)),i&&s.setAnchor(i(e)),s}}(e,t):"shape-points"in e?function(e,t){const n="shape-",u=n+"points",l=n+"radius",h=_u(e[u],u),m=_u(e[l],l),i=$i(e,n,t),a=Bi(e,n,t),r=jc(e,n+"scale",t),c=vc(e,n+"displacement",t),o=We(e,n+"rotation",t),d=Ii(e,n+"rotate-with-view",t),f=yc(e,n+"radius2"),p=yc(e,n+"angle"),g=Oc(e,n+"declutter-mode"),s=new mr({points:h,radius:m,radius2:f,angle:p,declutterMode:g});return function(e){return i&&s.setFill(i(e)),a&&s.setStroke(a(e)),c&&s.setDisplacement(c(e)),o&&s.setRotation(o(e)),d&&s.setRotateWithView(d(e)),r&&s.setScale(r(e)),s}}(e,t):"circle-radius"in e?function(e,t){const n="circle-",o=$i(e,n,t),i=Bi(e,n,t),a=We(e,n+"radius",t),r=jc(e,n+"scale",t),c=vc(e,n+"displacement",t),l=We(e,n+"rotation",t),d=Ii(e,n+"rotate-with-view",t),u=Oc(e,n+"declutter-mode"),s=new ja({radius:5,declutterMode:u});return function(e){return a&&s.setRadius(a(e)),o&&s.setFill(o(e)),i&&s.setStroke(i(e)),c&&s.setDisplacement(c(e)),l&&s.setRotation(l(e)),d&&s.setRotateWithView(d(e)),r&&s.setScale(r(e)),s}}(e,t):null}(e,t),r=We(e,"z-index",t);if(!(s||o||i||a||it(e)))throw new Error("No fill, stroke, point, or text symbolizer properties in style: "+JSON.stringify(e));const n=new ve;return function(e){let t=!0;if(s){const o=s(e);o&&(t=!1),n.setFill(o)}if(o){const s=o(e);s&&(t=!1),n.setStroke(s)}if(i){const s=i(e);s&&(t=!1),n.setText(s)}if(a){const s=a(e);s&&(t=!1),n.setImage(s)}return r&&n.setZIndex(r(e)),t?null:n}}function $i(e,t,n){let s;if(s=t+"fill-pattern-src"in e?function(e,t,n){const a=rn(e,t+"pattern-src",n),s=xh(e,t+"pattern-offset",n),o=xh(e,t+"pattern-size",n),i=Mu(e,t+"color",n);return function(e){return{src:a(e),offset:s&&s(e),size:o&&o(e),color:i&&i(e)}}}(e,t+"fill-",n):Mu(e,t+"fill-color",n),!s)return null;const o=new ot;return function(e){const t=s(e);return"none"===t?null:(o.setColor(t),o)}}function Bi(e,t,n){const o=We(e,t+"stroke-width",n),i=Mu(e,t+"stroke-color",n);if(!o&&!i)return null;const a=rn(e,t+"stroke-line-cap",n),r=rn(e,t+"stroke-line-join",n),c=Oh(e,t+"stroke-line-dash",n),l=We(e,t+"stroke-line-dash-offset",n),d=We(e,t+"stroke-miter-limit",n),s=new Ze;return function(e){if(i){const t=i(e);if("none"===t)return null;s.setColor(t)}if(o&&s.setWidth(o(e)),a){const t=a(e);if("butt"!==t&&"round"!==t&&"square"!==t)throw new Error("Expected butt, round, or square line cap");s.setLineCap(t)}if(r){const t=r(e);if("bevel"!==t&&"round"!==t&&"miter"!==t)throw new Error("Expected bevel, round, or miter line join");s.setLineJoin(t)}return c&&s.setLineDash(c(e)),l&&s.setLineDashOffset(l(e)),d&&s.setMiterLimit(d(e)),s}}function We(e,t,n){if(!(t in e))return;const s=Wt(e[t],l,n);return function(e){return _u(s(e),t)}}function rn(e,t,n){if(!(t in e))return null;const s=Wt(e[t],pe,n);return function(e){return Hh(s(e),t)}}function Ii(e,t,n){if(!(t in e))return null;const s=Wt(e[t],Q,n);return function(e){const n=s(e);if("boolean"!=typeof n)throw new Error(`Expected a boolean for ${t}`);return n}}function Mu(e,t,n){if(!(t in e))return null;const s=Wt(e[t],B|pe,n);return function(e){return Ih(s(e),t)}}function Oh(e,t,n){if(!(t in e))return null;const s=Wt(e[t],be,n);return function(e){return Fi(s(e),t)}}function vc(e,t,n){if(!(t in e))return null;const s=Wt(e[t],be,n);return function(e){const n=Fi(s(e),t);if(2!==n.length)throw new Error(`Expected two numbers for ${t}`);return n}}function xh(e,t,n){if(!(t in e))return null;const s=Wt(e[t],be,n);return function(e){return tm(s(e),t)}}function jc(e,t,n){if(!(t in e))return null;const s=Wt(e[t],be|l,n);return function(e){return function(e,t){return"number"==typeof e?e:tm(e,t)}(s(e),t)}}function yc(e,t){const n=e[t];if(void 0!==n){if("number"!=typeof n)throw new Error(`Expected a number for ${t}`);return n}}function Ch(e,t){const n=e[t];if(void 0!==n){if("bottom-left"!==n&&"bottom-right"!==n&&"top-left"!==n&&"top-right"!==n)throw new Error(`Expected bottom-left, bottom-right, top-left, or top-right for ${t}`);return n}}function Th(e,t){const n=e[t];if(void 0!==n){if("pixels"!==n&&"fraction"!==n)throw new Error(`Expected pixels or fraction for ${t}`);return n}}function Oc(e,t){const n=e[t];if(void 0!==n){if("string"!=typeof n)throw new Error(`Expected a string for ${t}`);if("declutter"!==n&&"obstacle"!==n&&"none"!==n)throw new Error(`Expected declutter, obstacle, or none for ${t}`);return n}}function Fi(e,t){if(!Array.isArray(e))throw new Error(`Expected an array for ${t}`);const n=e.length;for(let s=0;s<n;++s)if("number"!=typeof e[s])throw new Error(`Expected an array of numbers for ${t}`);return e}function Hh(e,t){if("string"!=typeof e)throw new Error(`Expected a string for ${t}`);return e}function _u(e,t){if("number"!=typeof e)throw new Error(`Expected a number for ${t}`);return e}function Ih(e,t){if("string"==typeof e)return e;const n=Fi(e,t),s=n.length;if(s<3||s>4)throw new Error(`Expected a color with 3 or 4 values for ${t}`);return n}function tm(e,t){const n=Fi(e,t);if(2!==n.length)throw new Error(`Expected an array of two numbers for ${t}`);return n}const sm="renderOrder";class Un extends ss{constructor(e){e=e||{};const t=Object.assign({},e);delete t.style,delete t.renderBuffer,delete t.updateWhileAnimating,delete t.updateWhileInteracting,super(t),this.declutter_=e.declutter?String(e.declutter):void 0,this.renderBuffer_=void 0!==e.renderBuffer?e.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(e.style),this.updateWhileAnimating_=void 0!==e.updateWhileAnimating&&e.updateWhileAnimating,this.updateWhileInteracting_=void 0!==e.updateWhileInteracting&&e.updateWhileInteracting}getDeclutter(){return this.declutter_}getFeatures(e){return super.getFeatures(e)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(sm)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(e,t){const n=this.getDeclutter();n in e.declutter==!1&&(e.declutter[n]=new m4(9)),this.getRenderer().renderDeclutter(e,t)}setRenderOrder(e){this.set(sm,e)}setStyle(e){this.style_=void 0===e?f1:e;const t=function(e){if(void 0===e)return f1;if(!e)return null;if("function"==typeof e)return e;if(e instanceof ve)return e;if(!Array.isArray(e))return zu([e]);if(0===e.length)return[];const t=e.length,n=e[0];if(n instanceof ve){const n=new Array(t);for(let s=0;s<t;++s){const o=e[s];if(!(o instanceof ve))throw new Error("Expected a list of style instances");n[s]=o}return n}if("style"in n){const n=new Array(t);for(let s=0;s<t;++s){const o=e[s];if(!("style"in o))throw new Error("Expected a list of rules with a style property");n[s]=o}return gh(n)}const s=e;return zu(s)}(e);this.styleFunction_=null===e?void 0:$2(t),this.changed()}}class vm extends Zo{constructor(e){super(),this.map_=e}dispatchRenderEvent(){g()}calculateMatrices2D(e){const t=e.viewState,n=e.coordinateToPixelTransform,s=e.pixelToCoordinateTransform;Le(n,e.size[0]/2,e.size[1]/2,1/t.resolution,-1/t.resolution,-t.rotation,-t.center[0],-t.center[1]),Kt(s,n)}forEachFeatureAtCoordinate(e,t,n,s,o,i,a,r){let l;const m=t.viewState;function p(e,t,n,s){return o.call(i,t,e?n:null,s)}const u=m.projection,g=va(e.slice(),u),d=[[0,0]];if(u.canWrapX()&&s){const e=b(u.getExtent());d.push([-e,0],[e,0])}const f=t.layerStatesArray,v=f.length,c=[],h=[];for(let s=0;s<d.length;s++)for(let i=v-1;i>=0;--i){const u=f[i],o=u.layer;if(o.hasRenderer()&&pc(u,m)&&a.call(r,o)){const i=o.getRenderer(),a=o.getSource();if(i&&a){const o=a.getWrapX()?g:e,r=p.bind(null,u.managed);h[0]=o[0]+d[s][0],h[1]=o[1]+d[s][1],l=i.forEachFeatureAtCoordinate(h,t,n,r,c)}if(l)return l}}if(0===c.length)return;const j=1/c.length;return c.forEach((e,t)=>e.distanceSq+=t*j),c.sort((e,t)=>e.distanceSq-t.distanceSq),c.some(e=>l=e.callback(e.feature,e.layer,e.geometry)),l}hasFeatureAtCoordinate(e,t,n,s,o,i){return void 0!==this.forEachFeatureAtCoordinate(e,t,n,s,Je,this,o,i)}getMap(){return this.map_}renderFrame(){g()}scheduleExpireIconCache(e){zt.canExpireCache()&&e.postRenderFunctions.push(f6)}}function f6(){zt.expire()}class $o extends ue{constructor(e,t,n,s){super(e),this.inversePixelTransform=t,this.frameState=n,this.context=s}}class Pm extends vm{constructor(e){super(e),this.fontChangeListenerKey_=m(Vt,Xn,e.redrawText.bind(e)),this.element_=document.createElement("div");const t=this.element_.style;t.position="absolute",t.width="100%",t.height="100%",t.zIndex="0",this.element_.className=At+" ol-layers";const n=e.getViewport();n.insertBefore(this.element_,n.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(e,t){const n=this.getMap();if(n.hasListener(e)){const s=new $o(e,void 0,t);n.dispatchEvent(s)}}disposeInternal(){T(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),super.disposeInternal()}renderFrame(e){if(!e)return void(this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1));this.calculateMatrices2D(e),this.dispatchRenderEvent(dl,e);const t=e.layerStatesArray.sort(function(e,t){return e.zIndex-t.zIndex});t.some(e=>e.layer instanceof Un&&e.layer.getDeclutter())&&(e.declutter={});const o=e.viewState;this.children_.length=0;const s=[];let n=null;for(let i=0,d=t.length;i<d;++i){const r=t[i];e.layerIndex=i;const c=r.layer,l=c.getSourceState();if(!pc(r,o)||"ready"!=l&&"undefined"!=l){c.unrender();continue}const a=c.render(e,n);a&&(a!==n&&(this.children_.push(a),n=a),s.push(r))}this.declutter(e,s),hf(this.element_,this.children_),this.dispatchRenderEvent(W1,e),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(e)}declutter(e,t){if(e.declutter){for(let n=t.length-1;n>=0;--n){const s=t[n],o=s.layer;o.getDeclutter()&&o.renderDeclutter(e,s)}t.forEach(t=>t.layer.renderDeferred(e))}}}class gn extends ue{constructor(e,t){super(e),this.layer=t}}const ru="layers";class No extends $1{constructor(e){e=e||{};const n=Object.assign({},e);delete n.layers;let t=e.layers;super(n),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(ru,this.handleLayersChanged_),t?Array.isArray(t)?t=new me(t.slice(),{unique:!0}):x("function"==typeof t.getArray,"Expected `layers` to be an array or a `Collection`"):t=new me(void 0,{unique:!0}),this.setLayers(t)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(T),this.layersListenerKeys_.length=0;const e=this.getLayers();this.layersListenerKeys_.push(m(e,dt,this.handleLayersAdd_,this),m(e,ut,this.handleLayersRemove_,this));for(const e in this.listenerKeys_)this.listenerKeys_[e].forEach(T);Kn(this.listenerKeys_);const t=e.getArray();for(let e=0,s=t.length;e<s;e++){const n=t[e];this.registerLayerListeners_(n),this.dispatchEvent(new gn("addlayer",n))}this.changed()}registerLayerListeners_(e){const t=[m(e,Xn,this.handleLayerChange_,this),m(e,A,this.handleLayerChange_,this)];e instanceof No&&t.push(m(e,"addlayer",this.handleLayerGroupAdd_,this),m(e,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[c(e)]=t}handleLayerGroupAdd_(e){this.dispatchEvent(new gn("addlayer",e.layer))}handleLayerGroupRemove_(e){this.dispatchEvent(new gn("removelayer",e.layer))}handleLayersAdd_(e){const t=e.element;this.registerLayerListeners_(t),this.dispatchEvent(new gn("addlayer",t)),this.changed()}handleLayersRemove_(e){const t=e.element,n=c(t);this.listenerKeys_[n].forEach(T),delete this.listenerKeys_[n],this.dispatchEvent(new gn("removelayer",t)),this.changed()}getLayers(){return this.get(ru)}setLayers(e){const t=this.getLayers();if(t){const e=t.getArray();for(let t=0,n=e.length;t<n;++t)this.dispatchEvent(new gn("removelayer",e[t]))}this.set(ru,e)}getLayersArray(e){return e=void 0!==e?e:[],this.getLayers().forEach(function(t){t.getLayersArray(e)}),e}getLayerStatesArray(e){const n=void 0!==e?e:[],o=n.length;this.getLayers().forEach(function(e){e.getLayerStatesArray(n)});const t=this.getLayerState();let s=t.zIndex;e||void 0!==t.zIndex||(s=0);for(let i=o,a=n.length;i<a;i++){const e=n[i];e.opacity*=t.opacity,e.visible=e.visible&&t.visible,e.maxResolution=Math.min(e.maxResolution,t.maxResolution),e.minResolution=Math.max(e.minResolution,t.minResolution),e.minZoom=Math.max(e.minZoom,t.minZoom),e.maxZoom=Math.min(e.maxZoom,t.maxZoom),void 0!==t.extent&&(void 0!==e.extent?e.extent=ce(e.extent,t.extent):e.extent=t.extent),void 0===e.zIndex&&(e.zIndex=s)}return n}getSourceState(){return"ready"}}class ys extends ue{constructor(e,t,n){super(e),this.map=t,this.frameState=void 0!==n?n:null}}class It extends ys{constructor(e,t,n,s,o,i){super(e,t,o),this.originalEvent=n,this.pixel_=null,this.coordinate_=null,this.dragging=void 0!==s&&s,this.activePointers=i}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(e){this.pixel_=e}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(e){this.coordinate_=e}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}}var C={SINGLECLICK:"singleclick",CLICK:Ht,DBLCLICK:u7,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},Bc="pointermove",ou="pointerdown",Gm="pointerup",Pg="pointerout";class c8 extends Ss{constructor(e,t){super(e),this.map_=e,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=void 0===t?1:t,this.down_=null;const n=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=n,this.pointerdownListenerKey_=m(n,ou,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=m(n,Bc,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(t3,this.boundHandleTouchMove_,!!cd&&{passive:!1})}emulateClick_(e){let t=new It(C.CLICK,this.map_,e);this.dispatchEvent(t),void 0!==this.clickTimeoutId_?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,t=new It(C.DBLCLICK,this.map_,e),this.dispatchEvent(t)):this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;const t=new It(C.SINGLECLICK,this.map_,e);this.dispatchEvent(t)},250)}updateActivePointers_(e){const t=e,n=t.pointerId;if(t.type==C.POINTERUP||t.type==C.POINTERCANCEL){{delete this.trackedTouches_[n];for(const e in this.trackedTouches_)if(this.trackedTouches_[e].target!==t.target){delete this.trackedTouches_[e];break}}}else t.type!=C.POINTERDOWN&&t.type!=C.POINTERMOVE||(this.trackedTouches_[n]=t);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(e){this.updateActivePointers_(e);const t=new It(C.POINTERUP,this.map_,e,void 0,void 0,this.activePointers_);this.dispatchEvent(t),this.emulateClicks_&&!t.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(e)&&this.emulateClick_(this.down_),0===this.activePointers_.length&&(this.dragListenerKeys_.forEach(T),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(e){return 0===e.button}handlePointerDown_(e){this.emulateClicks_=0===this.activePointers_.length,this.updateActivePointers_(e);const t=new It(C.POINTERDOWN,this.map_,e,void 0,void 0,this.activePointers_);if(this.dispatchEvent(t),this.down_=new PointerEvent(e.type,e),Object.defineProperty(this.down_,"target",{writable:!1,value:e.target}),0===this.dragListenerKeys_.length){const e=this.map_.getOwnerDocument();this.dragListenerKeys_.push(m(e,C.POINTERMOVE,this.handlePointerMove_,this),m(e,C.POINTERUP,this.handlePointerUp_,this),m(this.element_,C.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==e&&this.dragListenerKeys_.push(m(this.element_.getRootNode(),C.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(e){if(this.isMoving_(e)){this.updateActivePointers_(e),this.dragging_=!0;const t=new It(C.POINTERDRAG,this.map_,e,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(t)}}relayMoveEvent_(e){this.originalPointerMoveEvent_=e;const t=!!this.down_&&!!this.isMoving_(e);this.dispatchEvent(new It(C.POINTERMOVE,this.map_,e,t))}handleTouchMove_(e){const t=this.originalPointerMoveEvent_;t&&!t.defaultPrevented||"boolean"==typeof e.cancelable&&!0!==e.cancelable||e.preventDefault()}isMoving_(e){return this.dragging_||Math.abs(e.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(e.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(T(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(t3,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(T(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(T),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}}var Kc="postrender",Lg="movestart",_8="moveend",w8="loadstart",Q8="loadend",Qc="layergroup",Zc="size",Ls="target",lo="view";const _i=1/0;class ef{constructor(e,t){this.priorityFunction_=e,this.keyFunction_=t,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,Kn(this.queuedElements_)}dequeue(){const e=this.elements_,t=this.priorities_,n=e[0];1==e.length?(e.length=0,t.length=0):(e[0]=e.pop(),t[0]=t.pop(),this.siftUp_(0));const s=this.keyFunction_(n);return delete this.queuedElements_[s],n}enqueue(e){x(!(this.keyFunction_(e)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");const t=this.priorityFunction_(e);return t!=_i&&(this.elements_.push(e),this.priorities_.push(t),this.queuedElements_[this.keyFunction_(e)]=!0,this.siftDown_(0,this.elements_.length-1),!0)}getCount(){return this.elements_.length}getLeftChildIndex_(e){return 2*e+1}getRightChildIndex_(e){return 2*e+2}getParentIndex_(e){return e-1>>1}heapify_(){let e;for(e=(this.elements_.length>>1)-1;e>=0;e--)this.siftUp_(e)}isEmpty(){return 0===this.elements_.length}isKeyQueued(e){return e in this.queuedElements_}isQueued(e){return this.isKeyQueued(this.keyFunction_(e))}siftUp_(e){const n=this.elements_,t=this.priorities_,s=n.length,o=n[e],i=t[e],a=e;for(;e<s>>1;){const a=this.getLeftChildIndex_(e),o=this.getRightChildIndex_(e),i=o<s&&t[o]<t[a]?o:a;n[e]=n[i],t[e]=t[i],e=i}n[e]=o,t[e]=i,this.siftDown_(a,e)}siftDown_(e,t){const s=this.elements_,n=this.priorities_,i=s[t],o=n[t];for(;t>e;){const i=this.getParentIndex_(t);if(!(n[i]>o))break;s[t]=s[i],n[t]=n[i],t=i}s[t]=i,n[t]=o}reprioritize(){const a=this.priorityFunction_,e=this.elements_,i=this.priorities_;let t=0;const r=e.length;let n,s,o;for(s=0;s<r;++s)n=e[s],o=a(n),o==_i?delete this.queuedElements_[this.keyFunction_(n)]:(i[t]=o,e[t++]=n);e.length=t,i.length=t,this.heapify_()}}class Pd extends ef{constructor(e,t){super(function(t){return e.apply(null,t)},function(e){return e[0].getKey()}),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=t,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(e){const t=super.enqueue(e);return t&&e[0].addEventListener(A,this.boundHandleTileChange_),t}getTilesLoading(){return this.tilesLoading_}handleTileChange(e){const n=e.target,t=n.getState();if(t===L||t===Z||t===J){t!==Z&&n.removeEventListener(A,this.boundHandleTileChange_);const e=n.getKey();e in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[e],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(e,t){let o,n,s,i=0;for(;this.tilesLoading_<e&&i<t&&this.getCount()>0;)n=this.dequeue()[0],s=n.getKey(),o=n.getState(),o!==ne||s in this.tilesLoadingKeys_||(this.tilesLoadingKeys_[s]=!0,++this.tilesLoading_,++i,n.load())}}function cf(e,t,n,s,o){if(!e||!(n in e.wantedTiles))return _i;if(!e.wantedTiles[n][t.getKey()])return _i;const i=e.viewState.center,a=s[0]-i[0],r=s[1]-i[1];return 65536*Math.log(o)+Math.sqrt(a*a+r*r)/o}class Lt extends Ye{constructor(e){super();const t=e.element;!t||e.target||t.style.pointerEvents||(t.style.pointerEvents="auto"),this.element=t||null,this.target_=null,this.map_=null,this.listenerKeys=[],e.render&&(this.render=e.render),e.target&&this.setTarget(e.target)}disposeInternal(){ki(this.element),super.disposeInternal()}getMap(){return this.map_}setMap(e){this.map_&&ki(this.element);for(let e=0,t=this.listenerKeys.length;e<t;++e)T(this.listenerKeys[e]);this.listenerKeys.length=0,this.map_=e,e&&((this.target_?this.target_:e.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==is&&this.listenerKeys.push(m(e,Kc,this.render,this)),e.render())}render(){}setTarget(e){this.target_="string"==typeof e?document.getElementById(e):e}}class zf extends Lt{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=void 0===e.collapsed||e.collapsed,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=void 0!==e.collapsible,this.collapsible_=void 0===e.collapsible||e.collapsible,this.collapsible_||(this.collapsed_=!1);const t=void 0!==e.className?e.className:"ol-attribution",i=void 0!==e.tipLabel?e.tipLabel:"Attributions",a=void 0!==e.expandClassName?e.expandClassName:t+"-expand",n=void 0!==e.collapseLabel?e.collapseLabel:"›",r=void 0!==e.collapseClassName?e.collapseClassName:t+"-collapse";"string"==typeof n?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=n,this.collapseLabel_.className=r):this.collapseLabel_=n;const s=void 0!==e.label?e.label:"i";"string"==typeof s?(this.label_=document.createElement("span"),this.label_.textContent=s,this.label_.className=a):this.label_=s;const c=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=i,this.toggleButton_.appendChild(c),this.toggleButton_.addEventListener(Ht,this.handleClick_.bind(this),!1);const l=t+" "+At+" "+En+(this.collapsed_&&this.collapsible_?" "+Ia:"")+(this.collapsible_?"":" ol-uncollapsible"),o=this.element;o.className=l,o.appendChild(this.toggleButton_),o.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(e){const t=Array.from(new Set(this.getMap().getAllLayers().flatMap(t=>t.getAttributions(e)))),n=!this.getMap().getAllLayers().some(e=>e.getSource()&&!1===e.getSource().getAttributionsCollapsible());return this.overrideCollapsible_||this.setCollapsible(n),t}async updateElement_(e){if(!e)return void(this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1));const t=await Promise.all(this.collectSourceAttributions_(e).map(e=>yl(()=>e))),n=t.length>0;if(this.renderedVisible_!=n&&(this.element.style.display=n?"":"none",this.renderedVisible_=n),!Ct(t,this.renderedAttributions_)){ud(this.ulElement_);for(let e=0,s=t.length;e<s;++e){const n=document.createElement("li");n.innerHTML=t[e],this.ulElement_.appendChild(n)}this.renderedAttributions_=t}}handleClick_(e){e.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(Ia),this.collapsed_?Bs(this.collapseLabel_,this.label_):Bs(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(e){this.userCollapsed_=e,this.collapsible_&&this.collapsed_!==e&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(e){this.updateElement_(e.frameState)}}class Lf extends Lt{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target});const s=void 0!==e.className?e.className:"ol-rotate",n=void 0!==e.label?e.label:"⇧",o=void 0!==e.compassClassName?e.compassClassName:"ol-compass";this.label_=null,"string"==typeof n?(this.label_=document.createElement("span"),this.label_.className=o,this.label_.textContent=n):(this.label_=n,this.label_.classList.add(o));const a=e.tipLabel?e.tipLabel:"Reset rotation",t=document.createElement("button");t.className=s+"-reset",t.setAttribute("type","button"),t.title=a,t.appendChild(this.label_),t.addEventListener(Ht,this.handleClick_.bind(this),!1);const r=s+" "+At+" "+En,i=this.element;i.className=r,i.appendChild(t),this.callResetNorth_=e.resetNorth?e.resetNorth:void 0,this.duration_=void 0!==e.duration?e.duration:250,this.autoHide_=void 0===e.autoHide||e.autoHide,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(Ra)}handleClick_(e){e.preventDefault(),void 0!==this.callResetNorth_?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const e=this.getMap().getView();if(!e)return;const t=e.getRotation();void 0!==t&&(this.duration_>0&&t%(2*Math.PI)!=0?e.animate({rotation:0,duration:this.duration_,easing:Hn}):e.setRotation(0))}render(e){const n=e.frameState;if(!n)return;const t=n.viewState.rotation;if(t!=this.rotation_){const e="rotate("+t+"rad)";if(this.autoHide_){const e=this.element.classList.contains(Ra);e||0!==t?e&&0!==t&&this.element.classList.remove(Ra):this.element.classList.add(Ra)}this.label_.style.transform=e}this.rotation_=t}}class i6 extends Lt{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target});const s=void 0!==e.className?e.className:"ol-zoom",r=void 0!==e.delta?e.delta:1,c=void 0!==e.zoomInClassName?e.zoomInClassName:s+"-in",l=void 0!==e.zoomOutClassName?e.zoomOutClassName:s+"-out",o=void 0!==e.zoomInLabel?e.zoomInLabel:"+",i=void 0!==e.zoomOutLabel?e.zoomOutLabel:"–",d=void 0!==e.zoomInTipLabel?e.zoomInTipLabel:"Zoom in",u=void 0!==e.zoomOutTipLabel?e.zoomOutTipLabel:"Zoom out",t=document.createElement("button");t.className=c,t.setAttribute("type","button"),t.title=d,t.appendChild("string"==typeof o?document.createTextNode(o):o),t.addEventListener(Ht,this.handleClick_.bind(this,r),!1);const n=document.createElement("button");n.className=l,n.setAttribute("type","button"),n.title=u,n.appendChild("string"==typeof i?document.createTextNode(i):i),n.addEventListener(Ht,this.handleClick_.bind(this,-r),!1);const h=s+" "+At+" "+En,a=this.element;a.className=h,a.appendChild(t),a.appendChild(n),this.duration_=void 0!==e.duration?e.duration:250}handleClick_(e,t){t.preventDefault(),this.zoomByDelta_(e)}zoomByDelta_(e){const t=this.getMap().getView();if(!t)return;const n=t.getZoom();if(void 0!==n){const s=t.getConstrainedZoom(n+e);this.duration_>0?(t.getAnimating()&&t.cancelAnimations(),t.animate({zoom:s,duration:this.duration_,easing:Hn})):t.setZoom(s)}}}function o6(e){e=e||{};const t=new me;return(void 0===e.zoom||e.zoom)&&t.push(new i6(e.zoomOptions)),(void 0===e.rotate||e.rotate)&&t.push(new Lf(e.rotateOptions)),(void 0===e.attribution||e.attribution)&&t.push(new zf(e.attributionOptions)),t}hi="active";class Rt extends Ye{constructor(e){super(),this.on,this.once,this.un,e&&e.handleEvent&&(this.handleEvent=e.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(hi)}getMap(){return this.map_}handleEvent(){return!0}setActive(e){this.set(hi,e)}setMap(e){this.map_=e}}function Ef(e,t,n){const s=e.getCenterInternal();if(s){const o=[s[0]+t[0],s[1]+t[1]];e.animateInternal({duration:void 0!==n?n:250,easing:C3,center:e.getConstrainedCenter(o)})}}function ml(e,t,n,s){const o=e.getZoom();if(void 0===o)return;const i=e.getConstrainedZoom(o+t),a=e.getResolutionForZoom(i);e.getAnimating()&&e.cancelAnimations(),e.animate({resolution:a,anchor:n,duration:void 0!==s?s:250,easing:Hn})}class gf extends Rt{constructor(e){super(),e=e||{},this.delta_=e.delta?e.delta:1,this.duration_=void 0!==e.duration?e.duration:250}handleEvent(e){let t=!1;if(e.type==C.DBLCLICK){const n=e.originalEvent,s=e.map,o=e.coordinate,i=n.shiftKey?-this.delta_:this.delta_;ml(s.getView(),i,o,this.duration_),n.preventDefault(),t=!0}return!t}}class lt extends Rt{constructor(e){super(e=e||{}),e.handleDownEvent&&(this.handleDownEvent=e.handleDownEvent),e.handleDragEvent&&(this.handleDragEvent=e.handleDragEvent),e.handleMoveEvent&&(this.handleMoveEvent=e.handleMoveEvent),e.handleUpEvent&&(this.handleUpEvent=e.handleUpEvent),e.stopDown&&(this.stopDown=e.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(){return!1}handleDragEvent(){}handleEvent(e){if(!e.originalEvent)return!0;let t=!1;if(this.updateTrackedPointers_(e),this.handlingDownUpSequence){if(e.type==C.POINTERDRAG)this.handleDragEvent(e),e.originalEvent.preventDefault();else if(e.type==C.POINTERUP){const t=this.handleUpEvent(e);this.handlingDownUpSequence=t&&this.targetPointers.length>0}}else if(e.type==C.POINTERDOWN){const n=this.handleDownEvent(e);this.handlingDownUpSequence=n,t=this.stopDown(n)}else e.type==C.POINTERMOVE&&this.handleMoveEvent(e);return!t}handleMoveEvent(){}handleUpEvent(){return!1}stopDown(e){return e}updateTrackedPointers_(e){e.activePointers&&(this.targetPointers=e.activePointers)}}function gl(e){const t=e.length;let n=0,s=0;for(let o=0;o<t;o++)n+=e[o].clientX,s+=e[o].clientY;return{clientX:n/t,clientY:s/t}}function vl(){const t=arguments;return function(e){let n=!0;for(let s=0,o=t.length;s<o&&(n=n&&t[s](e),n);++s);return n}}const U8=function(e){const t=e.originalEvent;return t.altKey&&!t.metaKey&&!t.ctrlKey&&!t.shiftKey},V8=function(e){const t=e.originalEvent;return t.altKey&&!t.metaKey&&!t.ctrlKey&&t.shiftKey},B8=function(e){const t=e.map.getTargetElement(),n=e.map.getOwnerDocument().activeElement;return t.contains(n)},rd=function(e){return!e.map.getTargetElement().hasAttribute("tabindex")||B8(e)},$s=Je,od=function(e){const t=e.originalEvent;return 0==t.button&&!(j8&&Ic&&t.ctrlKey)},xl=Qn,Hl=function(e){return e.type==C.SINGLECLICK},El=function(e){const t=e.originalEvent;return!t.altKey&&!t.metaKey&&!t.ctrlKey&&!t.shiftKey},P4=function(e){const t=e.originalEvent;return Ic?t.metaKey:t.ctrlKey},sa=function(e){const t=e.originalEvent;return!t.altKey&&!t.metaKey&&!t.ctrlKey&&t.shiftKey},ju=function(e){const n=e.originalEvent,t=n.target.tagName;return"INPUT"!==t&&"SELECT"!==t&&"TEXTAREA"!==t&&!n.target.isContentEditable},Qs=function(e){const t=e.originalEvent;return x(void 0!==t,"mapBrowserEvent must originate from a pointer event"),"mouse"==t.pointerType},Fl=function(e){const t=e.originalEvent;return x(void 0!==t,"mapBrowserEvent must originate from a pointer event"),t.isPrimary&&0===t.button};class V4 extends lt{constructor(e){super({stopDown:Qn}),e=e||{},this.kinetic_=e.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const t=e.condition?e.condition:vl(El,Fl);this.condition_=e.onFocusOnly?vl(rd,t):t,this.noKinetic_=!1}handleDragEvent(e){const s=e.map;this.panning_||(this.panning_=!0,s.getView().beginInteraction());const n=this.targetPointers,t=s.getEventPixel(gl(n));if(n.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(t[0],t[1]),this.lastCentroid){const n=[this.lastCentroid[0]-t[0],t[1]-this.lastCentroid[1]],s=e.map.getView();eu(n,s.getResolution()),br(n,s.getRotation()),s.adjustCenterInternal(n)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=t,this.lastPointersCount_=n.length,e.originalEvent.preventDefault()}handleUpEvent(e){const n=e.map,t=n.getView();if(0===this.targetPointers.length){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const e=this.kinetic_.getDistance(),s=this.kinetic_.getAngle(),i=t.getCenterInternal(),o=n.getPixelFromCoordinateInternal(i),a=n.getCoordinateFromPixelInternal([o[0]-e*Math.cos(s),o[1]-e*Math.sin(s)]);t.animateInternal({center:t.getConstrainedCenter(a),duration:500,easing:Hn})}return this.panning_&&(this.panning_=!1,t.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(e){if(this.targetPointers.length>0&&this.condition_(e)){const t=e.map.getView();return this.lastCentroid=null,t.getAnimating()&&t.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}}class W4 extends lt{constructor(e){e=e||{},super({stopDown:Qn}),this.condition_=e.condition?e.condition:V8,this.lastAngle_=void 0,this.duration_=void 0!==e.duration?e.duration:250}handleDragEvent(e){if(!Qs(e))return;const t=e.map,n=t.getView();if(n.getConstraints().rotation===zc)return;const s=t.getSize(),o=e.pixel,i=Math.atan2(s[1]/2-o[1],o[0]-s[0]/2);if(void 0!==this.lastAngle_){const e=i-this.lastAngle_;n.adjustRotationInternal(-e)}this.lastAngle_=i}handleUpEvent(e){return!Qs(e)||(e.map.getView().endInteraction(this.duration_),!1)}handleDownEvent(e){return!!Qs(e)&&!!(od(e)&&this.condition_(e))&&(e.map.getView().beginInteraction(),this.lastAngle_=void 0,!0)}}class Q4 extends Zo{constructor(e){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+e,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const e=this.startPixel_,t=this.endPixel_,n="px",s=this.element_.style;s.left=Math.min(e[0],t[0])+n,s.top=Math.min(e[1],t[1])+n,s.width=Math.abs(t[0]-e[0])+n,s.height=Math.abs(t[1]-e[1])+n}setMap(e){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const e=this.element_.style;e.left="inherit",e.top="inherit",e.width="inherit",e.height="inherit"}this.map_=e,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(e,t){this.startPixel_=e,this.endPixel_=t,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){if(!this.map_)return;const t=this.startPixel_,n=this.endPixel_,e=[t,[t[0],n[1]],n,[n[0],t[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);e[4]=e[0].slice(),this.geometry_?this.geometry_.setCoordinates([e]):this.geometry_=new ie([e])}getGeometry(){return this.geometry_}}const rv="boxstart",W7="boxdrag",x7="boxend",B0="boxcancel";class ri extends ue{constructor(e,t,n){super(e),this.coordinate=t,this.mapBrowserEvent=n}}class G0 extends lt{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.box_=new Q4(e.className||"ol-dragbox"),this.minArea_=void 0!==e.minArea?e.minArea:64,e.onBoxEnd&&(this.onBoxEnd=e.onBoxEnd),this.startPixel_=null,this.condition_=e.condition?e.condition:od,this.boxEndCondition_=e.boxEndCondition?e.boxEndCondition:this.defaultBoxEndCondition}defaultBoxEndCondition(e,t,n){const s=n[0]-t[0],o=n[1]-t[1];return s*s+o*o>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(e){this.startPixel_&&(this.box_.setPixels(this.startPixel_,e.pixel),this.dispatchEvent(new ri(W7,e.coordinate,e)))}handleUpEvent(e){if(!this.startPixel_)return!1;this.box_.setMap(null);const t=this.boxEndCondition_(e,this.startPixel_,e.pixel);return t&&this.onBoxEnd(e),this.dispatchEvent(new ri(t?x7:B0,e.coordinate,e)),!1}handleDownEvent(e){return!!this.condition_(e)&&(this.startPixel_=e.pixel,this.box_.setMap(e.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new ri(rv,e.coordinate,e)),!0)}onBoxEnd(){}setActive(e){e||(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new ri(B0,this.startPixel_,null)),this.startPixel_=null)),super.setActive(e)}}class z2 extends G0{constructor(e){super({condition:(e=e||{}).condition?e.condition:sa,className:e.className||"ol-dragzoom",minArea:e.minArea}),this.duration_=void 0!==e.duration?e.duration:200,this.out_=void 0!==e.out&&e.out}onBoxEnd(){const n=this.getMap().getView();let t=this.getGeometry();if(this.out_){const s=n.rotatedExtentForGeometry(t),o=n.getResolutionForExtentInternal(s),e=n.getResolution()/o;t=t.clone(),t.scale(e*e)}n.fitInternal(t,{duration:this.duration_,easing:Hn})}}var D2="ArrowLeft",X5="ArrowUp",R2="ArrowRight",r3="ArrowDown";class y3 extends Rt{constructor(e){super(),e=e||{},this.defaultCondition_=function(e){return El(e)&&ju(e)},this.condition_=void 0!==e.condition?e.condition:this.defaultCondition_,this.duration_=void 0!==e.duration?e.duration:100,this.pixelDelta_=void 0!==e.pixelDelta?e.pixelDelta:128}handleEvent(e){let t=!1;if(e.type==ul){const s=e.originalEvent,n=s.key;if(this.condition_(e)&&(n==r3||n==D2||n==R2||n==X5)){const i=e.map.getView(),o=i.getResolution()*this.pixelDelta_;let a=0,r=0;n==r3?r=-o:n==D2?a=-o:n==R2?a=o:r=o;const c=[a,r];br(c,i.getRotation()),Ef(i,c,this.duration_),s.preventDefault(),t=!0}}return!t}}class $3 extends Rt{constructor(e){super(),e=e||{},this.condition_=e.condition?e.condition:function(e){return!P4(e)&&ju(e)},this.delta_=e.delta?e.delta:1,this.duration_=void 0!==e.duration?e.duration:100}handleEvent(e){let t=!1;if(e.type==ul||e.type==V2){const s=e.originalEvent,n=s.key;if(this.condition_(e)&&("+"===n||"-"===n)){const o=e.map,i="+"===n?this.delta_:-this.delta_;ml(o.getView(),i,void 0,this.duration_),s.preventDefault(),t=!0}}return!t}}class mh extends Rt{constructor(e){super(e=e||{}),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=void 0!==e.maxDelta?e.maxDelta:1,this.duration_=void 0!==e.duration?e.duration:250,this.timeout_=void 0!==e.timeout?e.timeout:80,this.useAnchor_=void 0===e.useAnchor||e.useAnchor,this.constrainResolution_=void 0!==e.constrainResolution&&e.constrainResolution;const t=e.condition?e.condition:$s;this.condition_=e.onFocusOnly?vl(rd,t):t,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const e=this.getMap();if(!e)return;e.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_)}handleEvent(e){if(!this.condition_(e))return!0;if(e.type!==yi)return!0;const i=e.map,s=e.originalEvent;let t;if(s.preventDefault(),this.useAnchor_&&(this.lastAnchor_=e.coordinate),e.type==yi&&(t=s.deltaY,rh&&s.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(t/=Hc),s.deltaMode===WheelEvent.DOM_DELTA_LINE&&(t*=40)),0===t)return!1;this.lastDelta_=t;const o=Date.now();void 0===this.startTime_&&(this.startTime_=o),(!this.mode_||o-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(t)<4?"trackpad":"wheel");const n=i.getView();if("trackpad"===this.mode_&&!n.getConstrainResolution()&&!this.constrainResolution_)return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(n.getAnimating()&&n.cancelAnimations(),n.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),n.adjustZoom(-t/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=o,!1;this.totalDelta_+=t;const a=Math.max(this.timeout_-(o-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,i),a),!1}handleWheelZoom_(e){const t=e.getView();t.getAnimating()&&t.cancelAnimations();let n=-y(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(t.getConstrainResolution()||this.constrainResolution_)&&(n=n?n>0?1:-1:0),ml(t,n,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(e){this.useAnchor_=e,e||(this.lastAnchor_=null)}}class kh extends lt{constructor(e){const t=e=e||{};t.stopDown||(t.stopDown=Qn),super(t),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=void 0!==e.threshold?e.threshold:.3,this.duration_=void 0!==e.duration?e.duration:250}handleDragEvent(e){let n=0;const s=this.targetPointers[0],o=this.targetPointers[1],i=Math.atan2(o.clientY-s.clientY,o.clientX-s.clientX);if(void 0!==this.lastAngle_){const e=i-this.lastAngle_;this.rotationDelta_+=e,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),n=e}this.lastAngle_=i;const t=e.map,a=t.getView();a.getConstraints().rotation!==zc&&(this.anchor_=t.getCoordinateFromPixelInternal(t.getEventPixel(gl(this.targetPointers))),this.rotating_&&(t.render(),a.adjustRotationInternal(n,this.anchor_)))}handleUpEvent(e){return!(this.targetPointers.length<2)||(e.map.getView().endInteraction(this.duration_),!1)}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}}class Dh extends lt{constructor(e){const t=e=e||{};t.stopDown||(t.stopDown=Qn),super(t),this.anchor_=null,this.duration_=void 0!==e.duration?e.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(e){let t=1;const s=this.targetPointers[0],o=this.targetPointers[1],i=s.clientX-o.clientX,a=s.clientY-o.clientY,r=Math.sqrt(i*i+a*a);void 0!==this.lastDistance_&&(t=this.lastDistance_/r),this.lastDistance_=r;const n=e.map,c=n.getView();1!=t&&(this.lastScaleDelta_=t),this.anchor_=n.getCoordinateFromPixelInternal(n.getEventPixel(gl(this.targetPointers))),n.render(),c.adjustResolutionInternal(t,this.anchor_)}handleUpEvent(e){if(this.targetPointers.length<2){const t=e.map.getView(),n=this.lastScaleDelta_>1?1:-1;return t.endInteraction(this.duration_,n),!1}return!0}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}}function Rh(e){e=e||{};const t=new me,n=new M2(-.005,.05,100);return(void 0===e.altShiftDragRotate||e.altShiftDragRotate)&&t.push(new W4),(void 0===e.doubleClickZoom||e.doubleClickZoom)&&t.push(new gf({delta:e.zoomDelta,duration:e.zoomDuration})),(void 0===e.dragPan||e.dragPan)&&t.push(new V4({onFocusOnly:e.onFocusOnly,kinetic:n})),(void 0===e.pinchRotate||e.pinchRotate)&&t.push(new kh),(void 0===e.pinchZoom||e.pinchZoom)&&t.push(new Dh({duration:e.zoomDuration})),(void 0===e.keyboard||e.keyboard)&&(t.push(new y3),t.push(new $3({delta:e.zoomDelta,duration:e.zoomDuration}))),(void 0===e.mouseWheelZoom||e.mouseWheelZoom)&&t.push(new mh({onFocusOnly:e.onFocusOnly,duration:e.zoomDuration})),(void 0===e.shiftDragZoom||e.shiftDragZoom)&&t.push(new z2({duration:e.zoomDuration})),t}function Ph(e){e instanceof ss?e.setMapInternal(null):e instanceof No&&e.getLayers().forEach(Ph)}function E8(e,t){if(e instanceof ss)e.setMapInternal(t);else if(e instanceof No){const n=e.getLayers().getArray();for(let e=0,s=n.length;e<s;++e)E8(n[e],t)}}let k8=class extends Ye{constructor(e){super(),e=e||{},this.on,this.once,this.un;const t=function(e){let i=null;void 0!==e.keyboardEventTarget&&(i="string"==typeof e.keyboardEventTarget?document.getElementById(e.keyboardEventTarget):e.keyboardEventTarget);const t={},a=e.layers&&"function"==typeof e.layers.getLayers?e.layers:new No({layers:e.layers});let s,o,n;return t[Qc]=a,t[Ls]=e.target,t[lo]=e.view instanceof xt?e.view:new xt,void 0!==e.controls&&(Array.isArray(e.controls)?s=new me(e.controls.slice()):(x("function"==typeof e.controls.getArray,"Expected `controls` to be an array or an `ol/Collection.js`"),s=e.controls)),void 0!==e.interactions&&(Array.isArray(e.interactions)?o=new me(e.interactions.slice()):(x("function"==typeof e.interactions.getArray,"Expected `interactions` to be an array or an `ol/Collection.js`"),o=e.interactions)),void 0!==e.overlays?Array.isArray(e.overlays)?n=new me(e.overlays.slice()):(x("function"==typeof e.overlays.getArray,"Expected `overlays` to be an array or an `ol/Collection.js`"),n=e.overlays):n=new me,{controls:s,interactions:o,keyboardEventTarget:i,overlays:n,values:t}}(e);this.renderComplete_,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=void 0!==e.maxTilesLoading?e.maxTilesLoading:16,this.pixelRatio_=void 0!==e.pixelRatio?e.pixelRatio:Hc,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=[1,0,0,1,0,0],this.pixelToCoordinateTransform_=[1,0,0,1,0,0],this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=e.moveTolerance,this.keyboardEventTarget_=t.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,this.resizeObserver_=new ResizeObserver(()=>this.updateSize()),this.controls=t.controls||o6(),this.interactions=t.interactions||Rh({onFocusOnly:!0}),this.overlays_=t.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new Pd(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(Qc,this.handleLayerGroupChanged_),this.addChangeListener(lo,this.handleViewChanged_),this.addChangeListener(Zc,this.handleSizeChanged_),this.addChangeListener(Ls,this.handleTargetChanged_),this.setProperties(t.values);const n=this;!e.view||e.view instanceof xt||e.view.then(function(e){n.setView(new xt(e))}),this.controls.addEventListener(dt,e=>{e.element.setMap(this)}),this.controls.addEventListener(ut,e=>{e.element.setMap(null)}),this.interactions.addEventListener(dt,e=>{e.element.setMap(this)}),this.interactions.addEventListener(ut,e=>{e.element.setMap(null)}),this.overlays_.addEventListener(dt,e=>{this.addOverlayInternal_(e.element)}),this.overlays_.addEventListener(ut,e=>{const t=e.element.getId();void 0!==t&&delete this.overlayIdIndex_[t.toString()],e.element.setMap(null)}),this.controls.forEach(e=>{e.setMap(this)}),this.interactions.forEach(e=>{e.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(e){this.getControls().push(e)}addInteraction(e){this.getInteractions().push(e)}addLayer(e){this.getLayerGroup().getLayers().push(e)}handleLayerAdd_(e){E8(e.layer,this)}addOverlay(e){this.getOverlays().push(e)}addOverlayInternal_(e){const t=e.getId();void 0!==t&&(this.overlayIdIndex_[t.toString()]=e),e.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(e,t,n){if(!this.frameState_||!this.renderer_)return;const s=this.getCoordinateFromPixelInternal(e),o=void 0!==(n=void 0!==n?n:{}).hitTolerance?n.hitTolerance:0,i=void 0!==n.layerFilter?n.layerFilter:Je,a=!1!==n.checkWrapped;return this.renderer_.forEachFeatureAtCoordinate(s,this.frameState_,o,a,t,null,i,null)}getFeaturesAtPixel(e,t){const n=[];return this.forEachFeatureAtPixel(e,function(e){n.push(e)},t),n}getAllLayers(){const e=[];return function t(n){n.forEach(function(n){n instanceof No?t(n.getLayers()):e.push(n)})}(this.getLayers()),e}hasFeatureAtPixel(e,t){if(!this.frameState_||!this.renderer_)return!1;const n=this.getCoordinateFromPixelInternal(e),s=void 0!==(t=void 0!==t?t:{}).layerFilter?t.layerFilter:Je,o=void 0!==t.hitTolerance?t.hitTolerance:0,i=!1!==t.checkWrapped;return this.renderer_.hasFeatureAtCoordinate(n,this.frameState_,o,i,s,null)}getEventCoordinate(e){return this.getCoordinateFromPixel(this.getEventPixel(e))}getEventCoordinateInternal(e){return this.getCoordinateFromPixelInternal(this.getEventPixel(e))}getEventPixel(e){const t=this.viewport_.getBoundingClientRect(),n=this.getSize(),o=t.width/n[0],i=t.height/n[1],s="changedTouches"in e?e.changedTouches[0]:e;return[(s.clientX-t.left)/o,(s.clientY-t.top)/i]}getTarget(){return this.get(Ls)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(e){return un(this.getCoordinateFromPixelInternal(e),this.getView().getProjection())}getCoordinateFromPixelInternal(e){const t=this.frameState_;return t?R(t.pixelToCoordinateTransform,e.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(e){const t=this.overlayIdIndex_[e.toString()];return void 0!==t?t:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(Qc)}setLayers(e){const t=this.getLayerGroup();if(e instanceof me)return void t.setLayers(e);const n=t.getLayers();n.clear(),n.extend(e)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const e=this.getLayerGroup().getLayerStatesArray();for(let t=0,i=e.length;t<i;++t){const n=e[t];if(!n.visible)continue;const s=n.layer.getRenderer();if(s&&!s.ready)return!0;const o=n.layer.getSource();if(o&&o.loading)return!0}return!1}getPixelFromCoordinate(e){const t=I(e,this.getView().getProjection());return this.getPixelFromCoordinateInternal(t)}getPixelFromCoordinateInternal(e){const t=this.frameState_;return t?R(t.coordinateToPixelTransform,e.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(Zc)}getView(){return this.get(lo)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const e=this.getTargetElement();return e?e.ownerDocument:document}getTilePriority(e,t,n,s){return cf(this.frameState_,e,t,n,s)}handleBrowserEvent(e,t){t=t||e.type;const n=new It(t,this,e);this.handleMapBrowserEvent(n)}handleMapBrowserEvent(e){if(!this.frameState_)return;const n=e.originalEvent,t=n.type;if(t===ou||t===yi||t===ul){const e=this.getOwnerDocument(),t=this.viewport_.getRootNode?this.viewport_.getRootNode():e,s=n.target;if(this.overlayContainerStopEvent_.contains(s)||!(t===e?e.documentElement:t).contains(s))return}if(e.frameState=this.frameState_,!1!==this.dispatchEvent(e)){const t=this.getInteractions().getArray().slice();for(let n=t.length-1;n>=0;n--){const s=t[n];if(s.getMap()!==this||!s.getActive()||!this.getTargetElement())continue;if(!s.handleEvent(e)||e.propagationStopped)break}}}handlePostRender(){const e=this.frameState_,t=this.tileQueue_;if(!t.isEmpty()){let n=this.maxTilesLoading_,s=n;if(e){const t=e.viewHints;if(t[Ae]||t[ze]){const t=Date.now()-e.time>8;n=t?0:8,s=t?0:2}}t.getTilesLoading()<n&&(t.reprioritize(),t.loadMoreTiles(n,s))}e&&this.renderer_&&!e.animate&&(!0===this.renderComplete_?(this.hasListener(U1)&&this.renderer_.dispatchRenderEvent(U1,e),!1===this.loaded_&&(this.loaded_=!0,this.dispatchEvent(new ys(Q8,this,e)))):!0===this.loaded_&&(this.loaded_=!1,this.dispatchEvent(new ys(w8,this,e))));const n=this.postRenderFunctions_;for(let t=0,s=n.length;t<s;++t)n[t](this,e);n.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let e=0,t=this.targetChangeHandlerKeys_.length;e<t;++e)T(this.targetChangeHandlerKeys_[e]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(Il,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(yi,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,ki(this.viewport_)}if(this.targetElement_){this.resizeObserver_.unobserve(this.targetElement_);const e=this.targetElement_.getRootNode();e instanceof ShadowRoot&&this.resizeObserver_.unobserve(e.host),this.setSize(void 0)}const t=this.getTarget(),e="string"==typeof t?document.getElementById(t):t;if(this.targetElement_=e,e){e.appendChild(this.viewport_),this.renderer_||(this.renderer_=new Pm(this)),this.mapBrowserEventHandler_=new c8(this,this.moveTolerance_);for(const e in C)this.mapBrowserEventHandler_.addEventListener(C[e],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(Il,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(yi,this.boundHandleBrowserEvent_,!!cd&&{passive:!1});const t=this.keyboardEventTarget_?this.keyboardEventTarget_:e;this.targetChangeHandlerKeys_=[m(t,ul,this.handleBrowserEvent,this),m(t,V2,this.handleBrowserEvent,this)];const n=e.getRootNode();n instanceof ShadowRoot&&this.resizeObserver_.observe(n.host),this.resizeObserver_.observe(e)}else this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(T(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(T(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const e=this.getView();e&&(this.updateViewportSize_(this.getSize()),this.viewPropertyListenerKey_=m(e,Xn,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=m(e,A,this.handleViewPropertyChanged_,this),e.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(T),this.layerGroupPropertyListenerKeys_=null);const e=this.getLayerGroup();e&&(this.handleLayerAdd_(new gn("addlayer",e)),this.layerGroupPropertyListenerKeys_=[m(e,Xn,this.render,this),m(e,A,this.render,this),m(e,"addlayer",this.handleLayerAdd_,this),m(e,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){const e=this.getLayerGroup().getLayerStatesArray();for(let t=0,s=e.length;t<s;++t){const n=e[t].layer;n.hasRenderer()&&n.getRenderer().handleFontsChanged()}}render(){this.renderer_&&void 0===this.animationDelayKey_&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(e){return this.getControls().remove(e)}removeInteraction(e){return this.getInteractions().remove(e)}removeLayer(e){return this.getLayerGroup().getLayers().remove(e)}handleLayerRemove_(e){Ph(e.layer)}removeOverlay(e){return this.getOverlays().remove(e)}renderFrame_(e){const n=this.getSize(),s=this.getView(),o=this.frameState_;let t=null;if(void 0!==n&&j4(n)&&s&&s.isDef()){const i=s.getHints(this.frameState_?this.frameState_.viewHints:void 0),o=s.getState();if(t={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutter:null,extent:Po(o.center,o.resolution,o.rotation,n),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:n,tileQueue:this.tileQueue_,time:e,usedTiles:{},viewState:o,viewHints:i,wantedTiles:{},mapId:c(this),renderTargets:{}},o.nextCenter&&o.nextResolution){const e=isNaN(o.nextRotation)?o.rotation:o.nextRotation;t.nextExtent=Po(o.nextCenter,o.nextResolution,e,n)}}(this.frameState_=t,this.renderer_.renderFrame(t),t)&&((t.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,t.postRenderFunctions),o)&&(!this.previousExtent_||!Ft(this.previousExtent_)&&!Ue(t.extent,this.previousExtent_))&&(this.dispatchEvent(new ys(Lg,this,o)),this.previousExtent_=mn(this.previousExtent_)),this.previousExtent_&&!t.viewHints[Ae]&&!t.viewHints[ze]&&!Ue(t.extent,this.previousExtent_)&&(this.dispatchEvent(new ys(_8,this,t)),_d(t.extent,this.previousExtent_))),this.dispatchEvent(new ys(Kc,this,t)),this.renderComplete_=this.hasListener(w8)||this.hasListener(Q8)||this.hasListener(U1)?!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady():void 0,this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(e){const t=this.getLayerGroup();t&&this.handleLayerRemove_(new gn("removelayer",t)),this.set(Qc,e)}setSize(e){this.set(Zc,e)}setTarget(e){this.set(Ls,e)}setView(e){if(!e||e instanceof xt)return void this.set(lo,e);this.set(lo,new xt);const t=this;e.then(function(e){t.setView(new xt(e))})}updateSize(){const e=this.getTargetElement();let t;if(e){const n=getComputedStyle(e),s=e.offsetWidth-parseFloat(n.borderLeftWidth)-parseFloat(n.paddingLeft)-parseFloat(n.paddingRight)-parseFloat(n.borderRightWidth),o=e.offsetHeight-parseFloat(n.borderTopWidth)-parseFloat(n.paddingTop)-parseFloat(n.paddingBottom)-parseFloat(n.borderBottomWidth);isNaN(s)||isNaN(o)||(t=[s,o],!j4(t)&&(e.offsetWidth||e.offsetHeight||e.getClientRects().length)&&su("No map visible because the map container's width or height are 0."))}const n=this.getSize();!t||n&&Ct(t,n)||(this.setSize(t),this.updateViewportSize_(t))}updateViewportSize_(e){const t=this.getView();t&&t.setViewportSize(e)}};const td="element",nd="map",sd="offset",Ol="position",id="positioning";class A8 extends Ye{constructor(e){super(),this.on,this.once,this.un,this.options=e,this.id=e.id,this.insertFirst=void 0===e.insertFirst||e.insertFirst,this.stopEvent=void 0===e.stopEvent||e.stopEvent,this.element=document.createElement("div"),this.element.className=void 0!==e.className?e.className:"ol-overlay-container "+p0,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=!0===e.autoPan?{}:e.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(td,this.handleElementChanged),this.addChangeListener(nd,this.handleMapChanged),this.addChangeListener(sd,this.handleOffsetChanged),this.addChangeListener(Ol,this.handlePositionChanged),this.addChangeListener(id,this.handlePositioningChanged),void 0!==e.element&&this.setElement(e.element),this.setOffset(void 0!==e.offset?e.offset:[0,0]),this.setPositioning(e.positioning||"top-left"),void 0!==e.position&&this.setPosition(e.position)}getElement(){return this.get(td)}getId(){return this.id}getMap(){return this.get(nd)||null}getOffset(){return this.get(sd)}getPosition(){return this.get(Ol)}getPositioning(){return this.get(id)}handleElementChanged(){ud(this.element);const e=this.getElement();e&&this.element.appendChild(e)}handleMapChanged(){this.mapPostrenderListenerKey&&(ki(this.element),T(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const e=this.getMap();if(e){this.mapPostrenderListenerKey=m(e,Kc,this.render,this),this.updatePixelPosition();const t=this.stopEvent?e.getOverlayContainerStopEvent():e.getOverlayContainer();this.insertFirst?t.insertBefore(this.element,t.childNodes[0]||null):t.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(e){this.set(td,e)}setMap(e){this.set(nd,e)}setOffset(e){this.set(sd,e)}setPosition(e){this.set(Ol,e)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(e){const t=this.getMap();if(!t||!t.getTargetElement()||!this.get(Ol))return;const n=this.getRect(t.getTargetElement(),t.getSize()),i=this.getElement(),s=this.getRect(i,[$8(i),Y8(i)]),o=void 0===(e=e||{}).margin?20:e.margin;if(!xe(n,s)){const a=s[0]-n[0],r=n[2]-s[2],c=s[1]-n[1],l=n[3]-s[3],i=[0,0];if(a<0?i[0]=a-o:r<0&&(i[0]=Math.abs(r)+o),c<0?i[1]=c-o:l<0&&(i[1]=Math.abs(l)+o),0!==i[0]||0!==i[1]){const o=t.getView().getCenterInternal(),n=t.getPixelFromCoordinateInternal(o);if(!n)return;const a=[n[0]+i[0],n[1]+i[1]],s=e.animation||{};t.getView().animateInternal({center:t.getCoordinateFromPixelInternal(a),duration:s.duration,easing:s.easing})}}}getRect(e,t){const n=e.getBoundingClientRect(),s=n.left+window.pageXOffset,o=n.top+window.pageYOffset;return[s,o,s+t[0],o+t[1]]}setPositioning(e){this.set(id,e)}setVisible(e){this.rendered.visible!==e&&(this.element.style.display=e?"":"none",this.rendered.visible=e)}updatePixelPosition(){const e=this.getMap(),t=this.getPosition();if(!e||!e.isRendered()||!t)return void this.setVisible(!1);const n=e.getPixelFromCoordinate(t),s=e.getSize();this.updateRenderedPosition(n,s)}updateRenderedPosition(e){const r=this.element.style,a=this.getOffset(),n=this.getPositioning();this.setVisible(!0);let s="0%",o="0%";"bottom-right"==n||"center-right"==n||"top-right"==n?s="-100%":"bottom-center"!=n&&"center-center"!=n&&"top-center"!=n||(s="-50%"),"bottom-left"==n||"bottom-center"==n||"bottom-right"==n?o="-100%":"center-left"!=n&&"center-center"!=n&&"center-right"!=n||(o="-50%");const i=`translate(${s}, ${o}) translate(${Math.round(e[0]+a[0])+"px"}, ${Math.round(e[1]+a[1])+"px"})`;this.rendered.transform_!=i&&(this.rendered.transform_=i,r.transform=i)}getOptions(){return this.options}}class _l{constructor(e){this.highWaterMark=void 0!==e?e:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(){for(;this.canExpireCache();)this.pop()}clear(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}containsKey(e){return this.entries_.hasOwnProperty(e)}forEach(e){let t=this.oldest_;for(;t;)e(t.value_,t.key_,this),t=t.newer}get(e){const n=this.entries_[e];return x(void 0!==n,"Tried to get a value for a key that does not exist in the cache"),n===this.newest_||(n===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(n.newer.older=n.older,n.older.newer=n.newer),n.newer=null,n.older=this.newest_,this.newest_.newer=n,this.newest_=n),n.value_}remove(e){const t=this.entries_[e];return x(void 0!==t,"Tried to get a value for a key that does not exist in the cache"),t===this.newest_?(this.newest_=t.older,this.newest_&&(this.newest_.newer=null)):t===this.oldest_?(this.oldest_=t.newer,this.oldest_&&(this.oldest_.older=null)):(t.newer.older=t.older,t.older.newer=t.newer),delete this.entries_[e],--this.count_,t.value_}getCount(){return this.count_}getKeys(){const t=new Array(this.count_);let e,n=0;for(e=this.newest_;e;e=e.older)t[n++]=e.key_;return t}getValues(){const t=new Array(this.count_);let e,n=0;for(e=this.newest_;e;e=e.older)t[n++]=e.value_;return t}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(e){return this.entries_[e]?.value_}pop(){const e=this.oldest_;return delete this.entries_[e.key_],e.newer&&(e.newer.older=null),this.oldest_=e.newer,this.oldest_||(this.newest_=null),--this.count_,e.value_}replace(e,t){this.get(e),this.entries_[e].value_=t}set(e,t){x(!(e in this.entries_),"Tried to set a value for a key that is used already");const n={key_:e,newer:null,older:this.newest_,value_:t};this.newest_?this.newest_.newer=n:this.oldest_=n,this.newest_=n,this.entries_[e]=n,++this.count_}setSize(e){this.highWaterMark=e}}function wo(e,t,n,s){return void 0!==s?(s[0]=e,s[1]=t,s[2]=n,s):[e,t,n]}function St(e,t,n){return e+"/"+t+"/"+n}function an(e){return St(e[0],e[1],e[2])}function G8(e){const[t,n,s]=e.substring(e.lastIndexOf("/")+1,e.length).split(",").map(Number);return St(t,n,s)}function hd(e){return e.split("/").map(Number)}function fl(e){return(e[1]<<e[0])+e[2]}function Of(e,t){const n=e[0],o=e[1],i=e[2];if(t.getMinZoom()>n||n>t.getMaxZoom())return!1;const s=t.getFullTileRange(n);return!s||s.containsXY(o,i)}class di extends _l{clear(){for(;this.getCount()>0;)this.pop().release();super.clear()}expireCache(e){for(;this.canExpireCache();){if(this.peekLast().getKey()in e)break;this.pop().release()}}pruneExceptNewestZ(){if(0===this.getCount())return;const e=hd(this.peekFirstKey())[0];this.forEach(t=>{t.tileCoord[0]!==e&&(this.remove(an(t.tileCoord)),t.release())})}}class fi{constructor(e,t,n,s){this.minX=e,this.maxX=t,this.minY=n,this.maxY=s}contains(e){return this.containsXY(e[1],e[2])}containsTileRange(e){return this.minX<=e.minX&&e.maxX<=this.maxX&&this.minY<=e.minY&&e.maxY<=this.maxY}containsXY(e,t){return this.minX<=e&&e<=this.maxX&&this.minY<=t&&t<=this.maxY}equals(e){return this.minX==e.minX&&this.minY==e.minY&&this.maxX==e.maxX&&this.maxY==e.maxY}extend(e){e.minX<this.minX&&(this.minX=e.minX),e.maxX>this.maxX&&(this.maxX=e.maxX),e.minY<this.minY&&(this.minY=e.minY),e.maxY>this.maxY&&(this.maxY=e.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(e){return this.minX<=e.maxX&&this.maxX>=e.minX&&this.minY<=e.maxY&&this.maxY>=e.minY}}function Xs(e,t,n,s,o){return void 0!==o?(o.minX=e,o.maxX=t,o.minY=n,o.maxY=s,o):new fi(e,t,n,s)}const l6=[];class Kf extends fs{constructor(e,t,n,s){super(e,t,{transition:0}),this.context_={},this.executorGroups={},this.loadingSourceTiles=0,this.hitDetectionImageData={},this.replayState_={},this.sourceTiles=[],this.errorTileKeys={},this.wantedResolution,this.getSourceTiles=s.bind(void 0,this),this.wrappedTileCoord=n}getContext(e){const t=c(e);return t in this.context_||(this.context_[t]=K(1,1,l6)),this.context_[t]}hasContext(e){return c(e)in this.context_}getImage(e){return this.hasContext(e)?this.getContext(e).canvas:null}getReplayState(e){const t=c(e);return t in this.replayState_||(this.replayState_[t]={dirty:!1,renderedRenderOrder:null,renderedResolution:NaN,renderedRevision:-1,renderedTileResolution:NaN,renderedTileRevision:-1,renderedTileZ:-1}),this.replayState_[t]}load(){this.getSourceTiles()}release(){for(const e in this.context_){const t=this.context_[e];zn(t),l6.push(t.canvas),delete this.context_[e]}super.release()}}let Vf,Bf=class extends fs{constructor(e,t,n,s,o,i){super(e,t,i),this.extent=null,this.format_=s,this.features_=null,this.loader_,this.projection=null,this.resolution,this.tileLoadFunction_=o,this.url_=n,this.key=n}getFormat(){return this.format_}getFeatures(){return this.features_}load(){this.state==ne&&(this.setState(gt),this.tileLoadFunction_(this,this.url_),this.loader_&&this.loader_(this.extent,this.resolution,this.projection))}onLoad(e){this.setFeatures(e)}onError(){this.setState(Z)}setFeatures(e){this.features_=e,this.setState(L)}setLoader(e){this.loader_=e}},Hf=!1;function Od(e,t,n,s,o,i,a){const r=new XMLHttpRequest;r.open("GET","function"==typeof e?e(n,s,o):e,!0),"arraybuffer"==t.getType()&&(r.responseType="arraybuffer"),r.withCredentials=Hf,r.onload=function(){if(!r.status||r.status>=200&&r.status<300){const e=t.getType();try{let s;"text"==e||"json"==e?s=r.responseText:"xml"==e?s=r.responseXML||r.responseText:"arraybuffer"==e&&(s=r.response),s?i(t.readFeatures(s,{extent:n,featureProjection:o}),t.readProjection(s)):a()}catch{a()}}else a()},r.onerror=a,r.send()}function xd(e,t){return function(n,s,o,i,a){const r=this;Od(e,t,n,s,o,function(e){r.addFeatures(e),void 0!==i&&i(e)},a||is)}}function Rf(){return[[-1/0,-1/0,1/0,1/0]]}function rl(e,t,n,s){const o=document.createElement("script"),i="olc_"+c(t);function a(){delete window[i],o.parentNode.removeChild(o)}o.async=!0,o.src=e+(e.includes("?")?"&":"?")+(s||"callback")+"="+i;const r=setTimeout(function(){a(),n&&n()},1e4);window[i]=function(e){clearTimeout(r),a(),t(e)},document.head.appendChild(o)}class Nf extends Error{constructor(e){super("Unexpected response status: "+e.status),this.name="ResponseError",this.response=e}}class Df extends Error{constructor(e){super("Failed to issue request"),this.name="ClientError",this.client=e}}function Sd(e){return new Promise(function(t,n){const s=new XMLHttpRequest;s.addEventListener("load",function(e){const s=e.target;if(!s.status||s.status>=200&&s.status<300){let e;try{e=JSON.parse(s.responseText)}catch(e){const t="Error parsing response text as JSON: "+e.message;return void n(new Error(t))}t(e)}else n(new Nf(s))}),s.addEventListener("error",function(e){n(new Df(e.target))}),s.open("GET",e),s.setRequestHeader("Accept","application/json"),s.send()})}function Md(e,t){return t.includes("://")?t:new URL(t,e).href}class Fd{drawCustom(){}drawGeometry(){}setStyle(){}drawCircle(){}drawFeature(){}drawGeometryCollection(){}drawLineString(){}drawMultiLineString(){}drawMultiPoint(){}drawMultiPolygon(){}drawPoint(){}drawPolygon(){}drawText(){}setFillStrokeStyle(){}setImageStyle(){}setTextStyle(){}}class al extends Fd{constructor(e,t,n,s,o,i,a){super(),this.context_=e,this.pixelRatio_=t,this.extent_=n,this.transform_=s,this.transformRotation_=s?kn(Math.atan2(s[1],s[0]),10):0,this.viewRotation_=o,this.squaredTolerance_=i,this.userTransform_=a,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=[1,0,0,1,0,0]}drawImages_(e,t,n,s){if(!this.image_)return;const a=bt(e,t,n,s,this.transform_,this.pixelCoordinates_),o=this.context_,r=this.tmpLocalTransform_,c=o.globalAlpha;1!=this.imageOpacity_&&(o.globalAlpha=c*this.imageOpacity_);let i=this.imageRotation_;0===this.transformRotation_&&(i-=this.viewRotation_),this.imageRotateWithView_&&(i+=this.viewRotation_);for(let e=0,s=a.length;e<s;e+=2){const t=a[e]-this.imageAnchorX_,n=a[e+1]-this.imageAnchorY_;if(0!==i||1!=this.imageScale_[0]||1!=this.imageScale_[1]){const e=t+this.imageAnchorX_,s=n+this.imageAnchorY_;Le(r,e,s,1,1,i,-e,-s),o.save(),o.transform.apply(o,r),o.translate(e,s),o.scale(this.imageScale_[0],this.imageScale_[1]),o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),o.restore()}else o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,t,n,this.imageWidth_,this.imageHeight_)}1!=this.imageOpacity_&&(o.globalAlpha=c)}drawText_(e,t,n,s){if(!this.textState_||""===this.text_)return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const a=bt(e,t,n,s,this.transform_,this.pixelCoordinates_),o=this.context_;let i=this.textRotation_;for(0===this.transformRotation_&&(i-=this.viewRotation_),this.textRotateWithView_&&(i+=this.viewRotation_);t<n;t+=s){const e=a[t]+this.textOffsetX_,r=a[t+1]+this.textOffsetY_;0!==i||1!=this.textScale_[0]||1!=this.textScale_[1]?(o.save(),o.translate(e-this.textOffsetX_,r-this.textOffsetY_),o.rotate(i),o.translate(this.textOffsetX_,this.textOffsetY_),o.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&o.strokeText(this.text_,0,0),this.textFillState_&&o.fillText(this.text_,0,0),o.restore()):(this.textStrokeState_&&o.strokeText(this.text_,e,r),this.textFillState_&&o.fillText(this.text_,e,r))}}moveToLineTo_(e,t,n,s,o){const a=this.context_,i=bt(e,t,n,s,this.transform_,this.pixelCoordinates_);a.moveTo(i[0],i[1]);let r=i.length;o&&(r-=2);for(let e=2;e<r;e+=2)a.lineTo(i[e],i[e+1]);return o&&a.closePath(),n}drawRings_(e,t,n,s){for(let o=0,i=n.length;o<i;++o)t=this.moveToLineTo_(e,t,n[o],s,!0);return t}drawCircle(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),U(this.extent_,e.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=Zh(e,this.transform_,this.pixelCoordinates_),s=t[2]-t[0],o=t[3]-t[1],i=Math.sqrt(s*s+o*o),n=this.context_;n.beginPath(),n.arc(t[0],t[1],i,0,2*Math.PI),this.fillState_&&n.fill(),this.strokeState_&&n.stroke()}""!==this.text_&&this.drawText_(e.getCenter(),0,2,2)}}setStyle(e){this.setFillStrokeStyle(e.getFill(),e.getStroke()),this.setImageStyle(e.getImage()),this.setTextStyle(e.getText())}setTransform(e){this.transform_=e}drawGeometry(e){switch(e.getType()){case"Point":this.drawPoint(e);break;case"LineString":this.drawLineString(e);break;case"Polygon":this.drawPolygon(e);break;case"MultiPoint":this.drawMultiPoint(e);break;case"MultiLineString":this.drawMultiLineString(e);break;case"MultiPolygon":this.drawMultiPolygon(e);break;case"GeometryCollection":this.drawGeometryCollection(e);break;case"Circle":this.drawCircle(e)}}drawFeature(e,t){const n=t.getGeometryFunction()(e);n&&(this.setStyle(t),this.drawGeometry(n))}drawGeometryCollection(e){const t=e.getGeometriesArray();for(let e=0,n=t.length;e<n;++e)this.drawGeometry(t[e])}drawPoint(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getFlatCoordinates(),n=e.getStride();this.image_&&this.drawImages_(t,0,t.length,n),""!==this.text_&&this.drawText_(t,0,t.length,n)}drawMultiPoint(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getFlatCoordinates(),n=e.getStride();this.image_&&this.drawImages_(t,0,t.length,n),""!==this.text_&&this.drawText_(t,0,t.length,n)}drawLineString(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),U(this.extent_,e.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const t=this.context_,n=e.getFlatCoordinates();t.beginPath(),this.moveToLineTo_(n,0,n.length,e.getStride(),!1),t.stroke()}if(""!==this.text_){const t=e.getFlatMidpoint();this.drawText_(t,0,2,2)}}}drawMultiLineString(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getExtent();if(U(this.extent_,t)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const t=this.context_,o=e.getFlatCoordinates();let n=0;const s=e.getEnds(),i=e.getStride();t.beginPath();for(let e=0,t=s.length;e<t;++e)n=this.moveToLineTo_(o,n,s[e],i,!1);t.stroke()}if(""!==this.text_){const t=e.getFlatMidpoints();this.drawText_(t,0,t.length,2)}}}drawPolygon(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),U(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=this.context_;t.beginPath(),this.drawRings_(e.getOrientedFlatCoordinates(),0,e.getEnds(),e.getStride()),this.fillState_&&t.fill(),this.strokeState_&&t.stroke()}if(""!==this.text_){const t=e.getFlatInteriorPoint();this.drawText_(t,0,2,2)}}}drawMultiPolygon(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),U(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=this.context_,o=e.getOrientedFlatCoordinates();let n=0;const s=e.getEndss(),i=e.getStride();t.beginPath();for(let e=0,t=s.length;e<t;++e){const a=s[e];n=this.drawRings_(o,n,a,i)}this.fillState_&&t.fill(),this.strokeState_&&t.stroke()}if(""!==this.text_){const t=e.getFlatInteriorPoints();this.drawText_(t,0,t.length,2)}}}setContextFillState_(e){const n=this.context_,t=this.contextFillState_;t?t.fillStyle!=e.fillStyle&&(t.fillStyle=e.fillStyle,n.fillStyle=e.fillStyle):(n.fillStyle=e.fillStyle,this.contextFillState_={fillStyle:e.fillStyle})}setContextStrokeState_(e){const n=this.context_,t=this.contextStrokeState_;t?(t.lineCap!=e.lineCap&&(t.lineCap=e.lineCap,n.lineCap=e.lineCap),Ct(t.lineDash,e.lineDash)||n.setLineDash(t.lineDash=e.lineDash),t.lineDashOffset!=e.lineDashOffset&&(t.lineDashOffset=e.lineDashOffset,n.lineDashOffset=e.lineDashOffset),t.lineJoin!=e.lineJoin&&(t.lineJoin=e.lineJoin,n.lineJoin=e.lineJoin),t.lineWidth!=e.lineWidth&&(t.lineWidth=e.lineWidth,n.lineWidth=e.lineWidth),t.miterLimit!=e.miterLimit&&(t.miterLimit=e.miterLimit,n.miterLimit=e.miterLimit),t.strokeStyle!=e.strokeStyle&&(t.strokeStyle=e.strokeStyle,n.strokeStyle=e.strokeStyle)):(n.lineCap=e.lineCap,n.setLineDash(e.lineDash),n.lineDashOffset=e.lineDashOffset,n.lineJoin=e.lineJoin,n.lineWidth=e.lineWidth,n.miterLimit=e.miterLimit,n.strokeStyle=e.strokeStyle,this.contextStrokeState_={lineCap:e.lineCap,lineDash:e.lineDash,lineDashOffset:e.lineDashOffset,lineJoin:e.lineJoin,lineWidth:e.lineWidth,miterLimit:e.miterLimit,strokeStyle:e.strokeStyle})}setContextTextState_(e){const n=this.context_,t=this.contextTextState_,s=e.textAlign?e.textAlign:So;t?(t.font!=e.font&&(t.font=e.font,n.font=e.font),t.textAlign!=s&&(t.textAlign=s,n.textAlign=s),t.textBaseline!=e.textBaseline&&(t.textBaseline=e.textBaseline,n.textBaseline=e.textBaseline)):(n.font=e.font,n.textAlign=s,n.textBaseline=e.textBaseline,this.contextTextState_={font:e.font,textAlign:s,textBaseline:e.textBaseline})}setFillStrokeStyle(e,t){if(e){const t=e.getColor();this.fillState_={fillStyle:Mt(t||He)}}else this.fillState_=null;if(t){const a=t.getColor(),e=t.getLineCap(),r=t.getLineDash(),c=t.getLineDashOffset(),n=t.getLineJoin(),s=t.getWidth(),o=t.getMiterLimit(),i=r||Bt;this.strokeState_={lineCap:void 0!==e?e:ds,lineDash:1===this.pixelRatio_?i:i.map(e=>e*this.pixelRatio_),lineDashOffset:(c||0)*this.pixelRatio_,lineJoin:void 0!==n?n:ms,lineWidth:(void 0!==s?s:1)*this.pixelRatio_,miterLimit:void 0!==o?o:ko,strokeStyle:Mt(a||Ao)}}else this.strokeState_=null}setImageStyle(e){let n;if(!e||!(n=e.getSize()))return void(this.image_=null);const t=e.getPixelRatio(this.pixelRatio_),s=e.getAnchor(),o=e.getOrigin();this.image_=e.getImage(this.pixelRatio_),this.imageAnchorX_=s[0]*t,this.imageAnchorY_=s[1]*t,this.imageHeight_=n[1]*t,this.imageOpacity_=e.getOpacity(),this.imageOriginX_=o[0],this.imageOriginY_=o[1],this.imageRotateWithView_=e.getRotateWithView(),this.imageRotation_=e.getRotation();const i=e.getScaleArray();this.imageScale_=[i[0]*this.pixelRatio_/t,i[1]*this.pixelRatio_/t],this.imageWidth_=n[0]*t}setTextStyle(e){if(e){const s=e.getFill();if(s){const e=s.getColor();this.textFillState_={fillStyle:Mt(e||He)}}else this.textFillState_=null;const t=e.getStroke();if(t){const i=t.getColor(),e=t.getLineCap(),a=t.getLineDash(),r=t.getLineDashOffset(),n=t.getLineJoin(),s=t.getWidth(),o=t.getMiterLimit();this.textStrokeState_={lineCap:void 0!==e?e:ds,lineDash:a||Bt,lineDashOffset:r||0,lineJoin:void 0!==n?n:ms,lineWidth:void 0!==s?s:1,miterLimit:void 0!==o?o:ko,strokeStyle:Mt(i||Ao)}}else this.textStrokeState_=null;const o=e.getFont(),i=e.getOffsetX(),a=e.getOffsetY(),r=e.getRotateWithView(),c=e.getRotation(),l=e.getScaleArray(),n=e.getText(),d=e.getTextAlign(),u=e.getTextBaseline();this.textState_={font:void 0!==o?o:R1,textAlign:void 0!==d?d:So,textBaseline:void 0!==u?u:Fa},this.text_=void 0!==n?Array.isArray(n)?n.reduce((e,t,n)=>e+(n%2?" ":t),""):n:"",this.textOffsetX_=void 0!==i?this.pixelRatio_*i:0,this.textOffsetY_=void 0!==a?this.pixelRatio_*a:0,this.textRotateWithView_=void 0!==r&&r,this.textRotation_=void 0!==c?c:0,this.textScale_=[this.pixelRatio_*l[0],this.pixelRatio_*l[1]]}else this.text_=""}}const ep=.5,vf={Point:function(e,t,n,s,o,i){const a=n.getImage(),r=n.getText(),c=r&&r.getText(),l=i&&a&&c?{}:void 0;if(a){if(a.getImageState()!=u.LOADED)return;const i=e.getBuilder(n.getZIndex(),"Image");i.setImageStyle(a,l),i.drawPoint(t,s,o)}if(c){const i=e.getBuilder(n.getZIndex(),"Text");i.setTextStyle(r,l),i.drawText(t,s,o)}},LineString:function(e,t,n,s,o){const a=n.getStroke();if(a){const i=e.getBuilder(n.getZIndex(),"LineString");i.setFillStrokeStyle(null,a),i.drawLineString(t,s,o)}const i=n.getText();if(i&&i.getText()){const a=e.getBuilder(n.getZIndex(),"Text");a.setTextStyle(i),a.drawText(t,s,o)}},Polygon:function(e,t,n,s,o){const a=n.getFill(),r=n.getStroke();if(a||r){const i=e.getBuilder(n.getZIndex(),"Polygon");i.setFillStrokeStyle(a,r),i.drawPolygon(t,s,o)}const i=n.getText();if(i&&i.getText()){const a=e.getBuilder(n.getZIndex(),"Text");a.setTextStyle(i),a.drawText(t,s,o)}},MultiPoint:function(e,t,n,s,o,i){const a=n.getImage(),c=a&&0!==a.getOpacity(),r=n.getText(),l=r&&r.getText(),d=i&&c&&l?{}:void 0;if(c){if(a.getImageState()!=u.LOADED)return;const i=e.getBuilder(n.getZIndex(),"Image");i.setImageStyle(a,d),i.drawMultiPoint(t,s,o)}if(l){const i=e.getBuilder(n.getZIndex(),"Text");i.setTextStyle(r,d),i.drawText(t,s,o)}},MultiLineString:function(e,t,n,s,o){const a=n.getStroke();if(a){const i=e.getBuilder(n.getZIndex(),"LineString");i.setFillStrokeStyle(null,a),i.drawMultiLineString(t,s,o)}const i=n.getText();if(i&&i.getText()){const a=e.getBuilder(n.getZIndex(),"Text");a.setTextStyle(i),a.drawText(t,s,o)}},MultiPolygon:function(e,t,n,s,o){const a=n.getFill(),r=n.getStroke();if(r||a){const i=e.getBuilder(n.getZIndex(),"Polygon");i.setFillStrokeStyle(a,r),i.drawMultiPolygon(t,s,o)}const i=n.getText();if(i&&i.getText()){const a=e.getBuilder(n.getZIndex(),"Text");a.setTextStyle(i),a.drawText(t,s,o)}},GeometryCollection:function(e,t,n,s,o,i){const r=t.getGeometriesArray();let a,c;for(a=0,c=r.length;a<c;++a)(0,vf[r[a].getType()])(e,r[a],n,s,o,i)},Circle:function(e,t,n,s,o){const a=n.getFill(),r=n.getStroke();if(a||r){const i=e.getBuilder(n.getZIndex(),"Circle");i.setFillStrokeStyle(a,r),i.drawCircle(t,s,o)}const i=n.getText();if(i&&i.getText()){const o=e.getBuilder(n.getZIndex(),"Text");o.setTextStyle(i),o.drawText(t,s)}}};function lf(e,t){return parseInt(c(e),10)-parseInt(c(t),10)}function vi(e,t){const n=Rd(e,t);return n*n}function Rd(e,t){return ep*e/t}function bi(e,t,n,s,o,i,a,r){const c=[],l=n.getImage();if(l){let t=!0;const e=l.getImageState();e==u.LOADED||e==u.ERROR?t=!1:e==u.IDLE&&l.load(),t&&c.push(l.ready())}const d=n.getFill();d&&d.loading()&&c.push(d.ready());const h=c.length>0;return h&&Promise.all(c).then(()=>o(null)),function(e,t,n,s,o,i,a){const c=n.getGeometryFunction()(t);if(!c)return;const r=c.simplifyTransformed(s,o),l=n.getRenderer();l?rf(e,r,n,t,a):(0,vf[r.getType()])(e,r,n,t,a,i)}(e,t,n,s,i,a,r),h}function rf(e,t,n,s,o){if("GeometryCollection"==t.getType()){const i=t.getGeometries();for(let t=0,a=i.length;t<a;++t)rf(e,i[t],n,s,o);return}e.getBuilder(n.getZIndex(),"Default").drawCustom(t,s,n.getRenderer(),n.getHitDetectionRenderer(),o)}function af(e){if(!(e.context instanceof CanvasRenderingContext2D))throw new Error("Only works for render events from Canvas 2D layers");const n=e.inversePixelTransform[0],s=e.inversePixelTransform[1],o=Math.sqrt(n*n+s*s),t=e.frameState,r=dn(e.inversePixelTransform.slice(),t.coordinateToPixelTransform),c=vi(t.viewState.resolution,o);let i;const a=le();return a&&(i=De(a,t.viewState.projection)),new al(e.context,o,t.extent,r,t.viewState.rotation,c,i)}let Bd;const Nt=[];function Z8(e,t,n,s,o){e.beginPath(),e.moveTo(0,0),e.lineTo(t,n),e.lineTo(s,o),e.closePath(),e.save(),e.clip(),e.fillRect(0,0,Math.max(t,s)+1,Math.max(n,o)),e.restore()}function Wd(e,t){return Math.abs(e[4*t]-210)>2||Math.abs(e[4*t+3]-191.25)>2}function uo(e,t,n,s){const i=Jn(n,t,e);let o=Na(t,s,n);const a=t.getMetersPerUnit();void 0!==a&&(o*=a);const r=e.getMetersPerUnit();void 0!==r&&(o/=r);const c=e.getExtent();if(!c||qe(c,i)){const t=Na(e,o,i)/o;isFinite(t)&&t>0&&(o/=t)}return o}function Kd(e,t,n,s){const i=_e(n);let o=uo(e,t,i,s);return(!isFinite(o)||o<=0)&&Br(n,function(n){return o=uo(e,t,n,s),isFinite(o)&&o>0}),o}function Gc(e,t,n,s,o,i,a,r,c,l,d,u,h,m){const f=K(Math.round(n*e),Math.round(n*t),Nt);if(u||(f.imageSmoothingEnabled=!1),0===c.length)return f.canvas;function y(e){return Math.round(e*n)/n}f.scale(n,n),f.globalCompositeOperation="lighter";const j=[1/0,1/0,-1/0,-1/0];let g;c.forEach(function(e){Cd(j,e.extent)});const p=n/s,_=(u?1:1+Math.pow(2,-24))/p;if(!h||1!==c.length||0!==l){if(g=K(Math.round(b(j)*p),Math.round(W(j)*p),Nt),u||(g.imageSmoothingEnabled=!1),o&&m){const e=(o[0]-j[0])*p,t=-(o[3]-j[3])*p,n=b(o)*p,s=W(o)*p;g.rect(e,t,n,s),g.clip()}c.forEach(function(e){if(e.image.width>0&&e.image.height>0){if(e.clipExtent){g.save();const t=(e.clipExtent[0]-j[0])*p,n=-(e.clipExtent[3]-j[3])*p,s=b(e.clipExtent)*p,o=W(e.clipExtent)*p;g.rect(u?t:Math.round(t),u?n:Math.round(n),u?s:Math.round(t+s)-Math.round(t),u?o:Math.round(n+o)-Math.round(n)),g.clip()}const t=(e.extent[0]-j[0])*p,n=-(e.extent[3]-j[3])*p,s=b(e.extent)*p,o=W(e.extent)*p;g.drawImage(e.image,l,l,e.image.width-2*l,e.image.height-2*l,u?t:Math.round(t),u?n:Math.round(n),u?s:Math.round(t+s)-Math.round(t),u?o:Math.round(n+o)-Math.round(n)),e.clipExtent&&g.restore()}})}const v=ht(a);return r.getTriangles().forEach(function(e){const o=e.source,s=e.target;let M=o[0][0],S=o[0][1],p=o[1][0],x=o[1][1],O=o[2][0],w=o[2][1];const l=y((s[0][0]-v[0])/i),m=y(-(s[0][1]-v[1])/i),r=y((s[1][0]-v[0])/i),a=y(-(s[1][1]-v[1])/i),C=y((s[2][0]-v[0])/i),E=y(-(s[2][1]-v[1])/i),k=M,A=S;M=0,S=0,p-=k,x-=A,O-=k,w-=A;const h=a8([[p,x,0,0,r-l],[O,w,0,0,C-l],[0,0,p,x,a-m],[0,0,O,w,E-m]]);if(!h)return;if(f.save(),f.beginPath(),function(){if(void 0===Bd){const e=K(6,6,Nt);e.globalCompositeOperation="lighter",e.fillStyle="rgba(210, 0, 0, 0.75)",Z8(e,4,5,4,0),Z8(e,4,5,0,5);const t=e.getImageData(0,0,3,3).data;Bd=Wd(t,0)||Wd(t,4)||Wd(t,8),zn(e),Nt.push(e.canvas)}return Bd}()||!u){f.moveTo(r,a);const e=4,t=l-r,n=m-a;for(let s=0;s<e;s++)f.lineTo(r+y((s+1)*t/e),a+y(s*n/(e-1))),s!=e-1&&f.lineTo(r+y((s+1)*t/e),a+y((s+1)*n/(e-1)));f.lineTo(C,E)}else f.moveTo(r,a),f.lineTo(l,m),f.lineTo(C,E);let d;if(f.clip(),f.transform(h[0],h[2],h[1],h[3],l,m),f.translate(j[0]-k,j[3]-A),g)d=g.canvas,f.scale(_,-_);else{const e=c[0],t=e.extent;d=e.image,f.scale(b(t)/d.width,-W(t)/d.height)}f.drawImage(d,0,0),f.restore()}),g&&(zn(g),Nt.push(g.canvas)),d&&(f.save(),f.globalCompositeOperation="source-over",f.strokeStyle="black",f.lineWidth=1,r.getTriangles().forEach(function(e){const s=e.target,o=(s[0][0]-v[0])/i,a=-(s[0][1]-v[1])/i,r=(s[1][0]-v[0])/i,c=-(s[1][1]-v[1])/i,l=(s[2][0]-v[0])/i,d=-(s[2][1]-v[1])/i;f.beginPath(),f.moveTo(r,c),f.lineTo(o,a),f.lineTo(l,d),f.closePath(),f.stroke()}),f.restore()),f.canvas}function xi(e){return Array.isArray(e)?Math.min(...e):e}const Gd=.5;class qc{constructor(e,t,n,s,o,i){this.sourceProj_=e,this.targetProj_=t;let a={};const u=pt(this.targetProj_,this.sourceProj_);this.transformInv_=function(e){const t=e[0]+"/"+e[1];return a[t]||(a[t]=u(e)),a[t]},this.maxSourceExtent_=s,this.errorThresholdSquared_=o*o,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!s&&!!this.sourceProj_.getExtent()&&b(s)>=b(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?b(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?b(this.targetProj_.getExtent()):null;const r=ht(n),c=Rs(n),l=Ws(n),d=xn(n),h=this.transformInv_(r),m=this.transformInv_(c),f=this.transformInv_(l),p=this.transformInv_(d),g=10+(i?Math.max(0,Math.ceil(Math.log2(Nn(n)/(i*i*256*256)))):0);if(this.addQuad_(r,c,l,d,h,m,f,p,g),this.wrapsXInSource_){let e=1/0;this.triangles_.forEach(function(t){e=Math.min(e,t.source[0][0],t.source[1][0],t.source[2][0])}),this.triangles_.forEach(t=>{if(Math.max(t.source[0][0],t.source[1][0],t.source[2][0])-e>this.sourceWorldWidth_/2){const n=[[t.source[0][0],t.source[0][1]],[t.source[1][0],t.source[1][1]],[t.source[2][0],t.source[2][1]]];n[0][0]-e>this.sourceWorldWidth_/2&&(n[0][0]-=this.sourceWorldWidth_),n[1][0]-e>this.sourceWorldWidth_/2&&(n[1][0]-=this.sourceWorldWidth_),n[2][0]-e>this.sourceWorldWidth_/2&&(n[2][0]-=this.sourceWorldWidth_);const s=Math.min(n[0][0],n[1][0],n[2][0]);Math.max(n[0][0],n[1][0],n[2][0])-s<this.sourceWorldWidth_/2&&(t.source=n)}})}a={}}addTriangle_(e,t,n,s,o,i){this.triangles_.push({source:[s,o,i],target:[e,t,n]})}addQuad_(e,t,n,s,o,i,a,r,c){const u=oe([o,i,a,r]),h=this.sourceWorldWidth_?b(u)/this.sourceWorldWidth_:null,m=this.sourceWorldWidth_,f=this.sourceProj_.canWrapX()&&h>.5&&h<1;let l=!1;if(c>0&&(this.targetProj_.isGlobal()&&this.targetWorldWidth_&&(l=b(oe([e,t,n,s]))/this.targetWorldWidth_>.25||l),!f&&this.sourceProj_.isGlobal()&&h&&(l=h>.25||l)),!l&&this.maxSourceExtent_&&isFinite(u[0])&&isFinite(u[1])&&isFinite(u[2])&&isFinite(u[3])&&!U(u,this.maxSourceExtent_))return;let d=0;if(!(l||isFinite(o[0])&&isFinite(o[1])&&isFinite(i[0])&&isFinite(i[1])&&isFinite(a[0])&&isFinite(a[1])&&isFinite(r[0])&&isFinite(r[1])))if(c>0)l=!0;else if(d=(isFinite(o[0])&&isFinite(o[1])?0:8)+(isFinite(i[0])&&isFinite(i[1])?0:4)+(isFinite(a[0])&&isFinite(a[1])?0:2)+(isFinite(r[0])&&isFinite(r[1])?0:1),1!=d&&2!=d&&4!=d&&8!=d)return;if(c>0){if(!l){const r=[(e[0]+n[0])/2,(e[1]+n[1])/2],s=this.transformInv_(r);let t;f?t=(ft(o[0],m)+ft(a[0],m))/2-ft(s[0],m):t=(o[0]+a[0])/2-s[0];const i=(o[1]+a[1])/2-s[1];l=t*t+i*i>this.errorThresholdSquared_}if(l){if(Math.abs(e[0]-n[0])<=Math.abs(e[1]-n[1])){const l=[(t[0]+n[0])/2,(t[1]+n[1])/2],u=this.transformInv_(l),d=[(s[0]+e[0])/2,(s[1]+e[1])/2],h=this.transformInv_(d);this.addQuad_(e,t,l,d,o,i,u,h,c-1),this.addQuad_(d,l,n,s,h,u,a,r,c-1)}else{const l=[(e[0]+t[0])/2,(e[1]+t[1])/2],u=this.transformInv_(l),d=[(n[0]+s[0])/2,(n[1]+s[1])/2],h=this.transformInv_(d);this.addQuad_(e,l,d,s,o,u,h,r,c-1),this.addQuad_(l,t,n,d,u,i,a,h,c-1)}return}}if(f){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}0==(11&d)&&this.addTriangle_(e,n,s,o,a,r),0==(14&d)&&this.addTriangle_(e,n,t,o,a,i),d&&(0==(13&d)&&this.addTriangle_(t,s,e,i,r,o),0==(7&d)&&this.addTriangle_(t,s,n,i,r,a))}calculateSourceExtent(){const e=[1/0,1/0,-1/0,-1/0];return this.triangles_.forEach(function(t){const o=t.source;vs(e,o[0]),vs(e,o[1]),vs(e,o[2])}),e}getTriangles(){return this.triangles_}}class Es extends fs{constructor(e,t,n,s,o,i,a,r,c,l,d,u){super(o,ne,u),this.renderEdges_=void 0!==d&&d,this.pixelRatio_=a,this.gutter_=r,this.canvas_=null,this.sourceTileGrid_=t,this.targetTileGrid_=s,this.wrappedTileCoord_=i||o,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0,this.clipExtent_=e.canWrapX()?e.getExtent():void 0;const v=s.getTileCoordExtent(this.wrappedTileCoord_),j=this.targetTileGrid_.getExtent();let h=this.sourceTileGrid_.getExtent();const g=j?ce(v,j):v;if(0===Nn(g))return void(this.state=J);const f=e.getExtent();f&&(h=h?ce(h,f):f);const _=s.getResolution(this.wrappedTileCoord_[0]),p=Kd(e,n,g,_);if(!isFinite(p)||p<=0)return void(this.state=J);const w=void 0!==l?l:Gd;if(this.triangulation_=new qc(e,n,g,h,p*w,_),0===this.triangulation_.getTriangles().length)return void(this.state=J);this.sourceZ_=t.getZForResolution(p);let m=this.triangulation_.calculateSourceExtent();if(h&&(e.canWrapX()?(m[1]=y(m[1],h[1],h[3]),m[3]=y(m[3],h[1],h[3])):m=ce(m,h)),Nn(m)){let n=0,s=0;e.canWrapX()&&(n=b(f),s=Math.floor((m[0]-f[0])/n)),Dr(m.slice(),e,!0).forEach(e=>{const o=t.getTileRangeForExtentAndZ(e,this.sourceZ_);for(let e=o.minX;e<=o.maxX;e++)for(let t=o.minY;t<=o.maxY;t++){const i=c(this.sourceZ_,e,t,a);if(i){const e=s*n;this.sourceTiles_.push({tile:i,offset:e})}}++s}),0===this.sourceTiles_.length&&(this.state=J)}else this.state=J}getImage(){return this.canvas_}reproject_(){const e=[];if(this.sourceTiles_.forEach(t=>{const n=t.tile;if(n&&n.getState()==L){const o=this.sourceTileGrid_.getTileCoordExtent(n.tileCoord);o[0]+=t.offset,o[2]+=t.offset;const s=this.clipExtent_?.slice();s&&(s[0]+=t.offset,s[2]+=t.offset),e.push({extent:o,clipExtent:s,image:n.getImage()})}}),this.sourceTiles_.length=0,0===e.length)this.state=Z;else{const n=this.wrappedTileCoord_[0],t=this.targetTileGrid_.getTileSize(n),s="number"==typeof t?t:t[0],o="number"==typeof t?t:t[1],i=this.targetTileGrid_.getResolution(n),a=this.sourceTileGrid_.getResolution(this.sourceZ_),r=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=Gc(s,o,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),i,r,this.triangulation_,e,this.gutter_,this.renderEdges_,this.interpolate),this.state=L}this.changed()}load(){if(this.state==ne){this.state=gt,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:t})=>{const n=t.getState();if(n==ne||n==gt){e++;const n=m(t,A,function(){const o=t.getState();o!=L&&o!=Z&&o!=J||(T(n),e--,0===e&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(n)}}),0===e?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:e}){e.getState()==ne&&e.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(T),this.sourcesListenerKeys_=null}release(){this.canvas_&&(zn(this.canvas_.getContext("2d")),Nt.push(this.canvas_),this.canvas_=null),super.release()}}var r8="tileloadstart",i8="tileloadend",n8="tileloaderror";class jo extends Ye{constructor(e){super(),this.projection=d(e.projection),this.attributions_=Zm(e.attributions),this.attributionsCollapsible_=void 0===e.attributionsCollapsible||e.attributionsCollapsible,this.loading=!1,this.state_=void 0!==e.state?e.state:"ready",this.wrapX_=void 0!==e.wrapX&&e.wrapX,this.interpolate_=!!e.interpolate,this.viewResolver=null,this.viewRejector=null;const t=this;this.viewPromise_=new Promise(function(e,n){t.viewResolver=e,t.viewRejector=n})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(e){this.attributions_=Zm(e),this.changed()}setState(e){this.state_=e,this.changed()}}function Zm(e){return e?Array.isArray(e)?function(){return e}:"function"==typeof e?e:function(){return[e]}:null}const yo=[0,0,0];class tn{constructor(e){let n;if(this.minZoom=void 0!==e.minZoom?e.minZoom:0,this.resolutions_=e.resolutions,x(L0(this.resolutions_,(e,t)=>t-e,!0),"`resolutions` must be sorted in descending order"),!e.origins)for(let e=0,t=this.resolutions_.length-1;e<t;++e)if(n){if(this.resolutions_[e]/this.resolutions_[e+1]!==n){n=void 0;break}}else n=this.resolutions_[e]/this.resolutions_[e+1];this.zoomFactor_=n,this.maxZoom=this.resolutions_.length-1,this.origin_=void 0!==e.origin?e.origin:null,this.origins_=null,void 0!==e.origins&&(this.origins_=e.origins,x(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const t=e.extent;void 0===t||this.origin_||this.origins_||(this.origin_=ht(t)),x(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,void 0!==e.tileSizes&&(this.tileSizes_=e.tileSizes,x(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=void 0!==e.tileSize?e.tileSize:this.tileSizes_?null:Ys,x(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=void 0!==t?t:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],void 0!==e.sizes?this.fullTileRanges_=e.sizes.map((e,n)=>{const s=new fi(Math.min(0,e[0]),Math.max(e[0]-1,-1),Math.min(0,e[1]),Math.max(e[1]-1,-1));if(t){const e=this.getTileRangeForExtentAndZ(t,n);s.minX=Math.max(e.minX,s.minX),s.maxX=Math.min(e.maxX,s.maxX),s.minY=Math.max(e.minY,s.minY),s.maxY=Math.min(e.maxY,s.maxY)}return s}):t&&this.calculateTileRanges_(t)}forEachTileCoord(e,t,n){const s=this.getTileRangeForExtentAndZ(e,t);for(let e=s.minX,o=s.maxX;e<=o;++e)for(let o=s.minY,i=s.maxY;o<=i;++o)n([t,e,o])}forEachTileCoordParentTileRange(e,t,n,s){let r,o,i,c=null,a=e[0]-1;for(2===this.zoomFactor_?(o=e[1],i=e[2]):c=this.getTileCoordExtent(e,s);a>=this.minZoom;){if(void 0!==o&&void 0!==i?(o=Math.floor(o/2),i=Math.floor(i/2),r=Xs(o,o,i,i,n)):r=this.getTileRangeForExtentAndZ(c,a,n),t(a,r))return!0;--a}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(e){return this.origin_?this.origin_:this.origins_[e]}getResolution(e){return this.resolutions_[e]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(e,t,n){if(e[0]<this.maxZoom){if(2===this.zoomFactor_){const n=2*e[1],s=2*e[2];return Xs(n,n+1,s,s+1,t)}const s=this.getTileCoordExtent(e,n||this.tmpExtent_);return this.getTileRangeForExtentAndZ(s,e[0]+1,t)}return null}getTileRangeForTileCoordAndZ(e,t,n){if(t>this.maxZoom||t<this.minZoom)return null;const i=e[0],s=e[1],o=e[2];if(t===i)return Xs(s,o,s,o,n);if(this.zoomFactor_){const e=Math.pow(this.zoomFactor_,t-i),a=Math.floor(s*e),r=Math.floor(o*e);return t<i?Xs(a,a,r,r,n):Xs(a,Math.floor(e*(s+1))-1,r,Math.floor(e*(o+1))-1,n)}const a=this.getTileCoordExtent(e,this.tmpExtent_);return this.getTileRangeForExtentAndZ(a,t,n)}getTileRangeForExtentAndZ(e,t,n){this.getTileCoordForXYAndZ_(e[0],e[3],t,!1,yo);const s=yo[1],o=yo[2];return this.getTileCoordForXYAndZ_(e[2],e[1],t,!0,yo),Xs(s,yo[1],o,yo[2],n)}getTileCoordCenter(e){const t=this.getOrigin(e[0]),n=this.getResolution(e[0]),s=X(this.getTileSize(e[0]),this.tmpSize_);return[t[0]+(e[1]+.5)*s[0]*n,t[1]-(e[2]+.5)*s[1]*n]}getTileCoordExtent(e,t){const o=this.getOrigin(e[0]),n=this.getResolution(e[0]),s=X(this.getTileSize(e[0]),this.tmpSize_),i=o[0]+e[1]*s[0]*n,a=o[1]-(e[2]+1)*s[1]*n;return Ge(i,a,i+s[0]*n,a+s[1]*n,t)}getTileCoordForCoordAndResolution(e,t,n){return this.getTileCoordForXYAndResolution_(e[0],e[1],t,!1,n)}getTileCoordForXYAndResolution_(e,t,n,s,o){const r=this.getZForResolution(n),c=n/this.getResolution(r),l=this.getOrigin(r),d=X(this.getTileSize(r),this.tmpSize_);let i=c*(e-l[0])/n/d[0],a=c*(l[1]-t)/n/d[1];return s?(i=en(i,5)-1,a=en(a,5)-1):(i=Ps(i,5),a=Ps(a,5)),wo(r,i,a,o)}getTileCoordForXYAndZ_(e,t,n,s,o){const r=this.getOrigin(n),c=this.getResolution(n),l=X(this.getTileSize(n),this.tmpSize_);let i=(e-r[0])/c/l[0],a=(r[1]-t)/c/l[1];return s?(i=en(i,5)-1,a=en(a,5)-1):(i=Ps(i,5),a=Ps(a,5)),wo(n,i,a,o)}getTileCoordForCoordAndZ(e,t,n){return this.getTileCoordForXYAndZ_(e[0],e[1],t,!1,n)}getTileCoordResolution(e){return this.resolutions_[e[0]]}getTileSize(e){return this.tileSize_?this.tileSize_:this.tileSizes_[e]}getFullTileRange(e){return this.fullTileRanges_?this.fullTileRanges_[e]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,e):null}getZForResolution(e,t){return y(ci(this.resolutions_,e,t||0),this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(e,t){return Bu(t,0,t.length,2,this.getTileCoordExtent(e))}calculateTileRanges_(e){const t=this.resolutions_.length,n=new Array(t);for(let s=this.minZoom;s<t;++s)n[s]=this.getTileRangeForExtentAndZ(e,s);this.fullTileRanges_=n}}class Um extends tn{constructor(e){super({extent:e.extent,origin:e.origin,origins:e.origins,resolutions:e.resolutions,tileSize:e.tileSize,tileSizes:e.tileSizes,sizes:e.sizes}),this.matrixIds_=e.matrixIds}getMatrixId(e){return this.matrixIds_[e]}getMatrixIds(){return this.matrixIds_}}function Wm(e,t,n){const c=[],l=[],i=[],u=[],h=[];n=void 0!==n?n:[];const o="TileMatrix",s="Identifier",a="ScaleDenominator",r="TopLeftCorner",m=d(e.SupportedCRS),f=m.getMetersPerUnit(),p="ne"==m.getAxisOrientation().substr(0,2);return e[o].sort(function(e,t){return t[a]-e[a]}),e[o].forEach(function(t){let d;if(d=!(n.length>0)||n.find(function(n){return t[s]==n[o]||!t[s].includes(":")&&e[s]+":"+t[s]===n[o]}),d){l.push(t[s]);const o=28e-5*t[a]/f,e=t.TileWidth,n=t.TileHeight;p?i.push([t[r][1],t[r][0]]):i.push(t[r]),c.push(o),u.push(e==n?e:[e,n]),h.push([t.MatrixWidth,t.MatrixHeight])}}),new Um({extent:t,origins:i,resolutions:c,matrixIds:l,tileSizes:u,sizes:h})}function Lc(e){let t=e.getDefaultTileGrid();return t||(t=Tm(e),e.setDefaultTileGrid(t)),t}function $m(e,t,n){const i=t[0],s=e.getTileCoordCenter(t),o=Yt(n);if(!qe(o,s)){const t=b(o),n=Math.ceil((o[0]-s[0])/t);return s[0]+=t*n,e.getTileCoordForCoordAndZ(s,i)}return t}function Vm(e,t,n,s){s=void 0!==s?s:"top-left";const o=Rm(e,t,n);return new tn({extent:e,origin:Mf(e,s),resolutions:o,tileSize:n})}function Mn(e){const t=e||{},n=t.extent||d("EPSG:3857").getExtent(),s={extent:n,minZoom:t.minZoom,tileSize:t.tileSize,resolutions:Rm(n,t.maxZoom,t.tileSize,t.maxResolution)};return new tn(s)}function Rm(e,t,n,s){t=void 0!==t?t:K1,n=X(void 0!==n?n:Ys);const a=W(e),r=b(e);s=s>0?s:Math.max(r/n[0],a/n[1]);const o=t+1,i=new Array(o);for(let e=0;e<o;++e)i[e]=s/Math.pow(2,e);return i}function Tm(e,t,n,s){return Vm(Yt(e),t,n,s)}function Yt(e){let t=(e=d(e)).getExtent();if(!t){const n=180*rs.degrees/e.getMetersPerUnit();t=Ge(-n,-n,n,n)}return t}class Ai extends jo{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:e.projection,state:e.state,wrapX:e.wrapX,interpolate:e.interpolate}),this.on,this.once,this.un,this.opaque_=void 0!==e.opaque&&e.opaque,this.tilePixelRatio_=void 0!==e.tilePixelRatio?e.tilePixelRatio:1,this.tileGrid=void 0!==e.tileGrid?e.tileGrid:null;const t=[256,256];this.tileGrid&&X(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),t),this.tileCache=new di(e.cacheSize||0),this.tmpSize=[0,0],this.key_=e.key||"",this.tileOptions={transition:e.transition,interpolate:e.interpolate},this.zDirection=e.zDirection?e.zDirection:0}canExpireCache(){return this.tileCache.canExpireCache()}expireCache(e,t){const n=this.getTileCacheForProjection(e);n&&n.expireCache(t)}forEachLoadedTile(e,t,n,s){const i=this.getTileCacheForProjection(e);if(!i)return!1;let a,r,o,c=!0;for(let e=n.minX;e<=n.maxX;++e)for(let l=n.minY;l<=n.maxY;++l)r=St(t,e,l),o=!1,i.containsKey(r)&&(a=i.get(r),o=a.getState()===L,o&&(o=!1!==s(a))),o||(c=!1);return c}getGutterForProjection(){return 0}getKey(){return this.key_}setKey(e){this.key_!==e&&(this.key_=e,this.changed())}getOpaque(){return this.opaque_}getResolutions(e){const t=e?this.getTileGridForProjection(e):this.tileGrid;return t?t.getResolutions():null}getTile(){return g()}getTileGrid(){return this.tileGrid}getTileGridForProjection(e){return this.tileGrid?this.tileGrid:Lc(e)}getTileCacheForProjection(e){const t=this.getProjection();return x(null===t||Oe(t,e),"A VectorTile source can only be rendered if it has a projection compatible with the view projection."),this.tileCache}getTilePixelRatio(){return this.tilePixelRatio_}getTilePixelSize(e,t,n){const i=this.getTileGridForProjection(n),s=this.getTilePixelRatio(t),o=X(i.getTileSize(e),this.tmpSize);return 1==s?o:y4(o,s,this.tmpSize)}getTileCoordForTileUrlFunction(e,t){t=void 0!==t?t:this.getProjection();const n=this.getTileGridForProjection(t);return this.getWrapX()&&t.isGlobal()&&(e=$m(n,e,t)),Of(e,n)?e:null}clear(){this.tileCache.clear()}refresh(){this.clear(),super.refresh()}updateCacheSize(e,t){const n=this.getTileCacheForProjection(t);e>n.highWaterMark&&(n.highWaterMark=e)}useTile(){}}class pu extends ue{constructor(e,t){super(e),this.tile=t}}function fm(e,t){const n=/\{z\}/g,s=/\{x\}/g,o=/\{y\}/g,i=/\{-y\}/g;return function(a){if(a)return e.replace(n,a[0].toString()).replace(s,a[1].toString()).replace(o,a[2].toString()).replace(i,function(){const n=a[0],e=t.getFullTileRange(n);if(!e)throw new Error("The {-y} placeholder requires a tile grid with extent");return(e.getHeight()-a[2]-1).toString()})}}function Sc(e,t){const n=e.length,s=new Array(n);for(let o=0;o<n;++o)s[o]=fm(e[o],t);return Xo(s)}function Xo(e){return 1===e.length?e[0]:function(t,n,s){if(!t)return;const o=ft(fl(t),e.length);return e[o](t,n,s)}}function Qh(){}function kc(e){const n=[];let t=/\{([a-z])-([a-z])\}/.exec(e);if(t){const o=t[1].charCodeAt(0),i=t[2].charCodeAt(0);let s;for(s=o;s<=i;++s)n.push(e.replace(t[0],String.fromCharCode(s)));return n}if(t=/\{(\d+)-(\d+)\}/.exec(e),t){const s=parseInt(t[2],10);for(let o=parseInt(t[1],10);o<=s;o++)n.push(e.replace(t[0],o.toString()));return n}return n.push(e),n}class Ec extends Ai{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tilePixelRatio:e.tilePixelRatio,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===Ec.prototype.tileUrlFunction,this.tileLoadFunction=e.tileLoadFunction,e.tileUrlFunction&&(this.tileUrlFunction=e.tileUrlFunction),this.urls=null,e.urls?this.setUrls(e.urls):e.url&&this.setUrl(e.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(e){const n=e.target,s=c(n),o=n.getState();let t;o==gt?(this.tileLoadingKeys_[s]=!0,t=r8):s in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[s],t=o==Z?n8:o==L?i8:void 0),t!=null&&this.dispatchEvent(new pu(t,n))}setTileLoadFunction(e){this.tileCache.clear(),this.tileLoadFunction=e,this.changed()}setTileUrlFunction(e,t){this.tileUrlFunction=e,this.tileCache.pruneExceptNewestZ(),void 0!==t?this.setKey(t):this.changed()}setUrl(e){const t=kc(e);this.urls=t,this.setUrls(t)}setUrls(e){this.urls=e;const t=e.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(Sc(e,this.tileGrid),t):this.setKey(t)}tileUrlFunction(){}useTile(e,t,n){const s=St(e,t,n);this.tileCache.containsKey(s)&&this.tileCache.get(s)}}class Dt extends Ec{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:d5,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX,transition:e.transition,interpolate:void 0===e.interpolate||e.interpolate,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.crossOrigin=void 0!==e.crossOrigin?e.crossOrigin:null,this.tileClass=void 0!==e.tileClass?e.tileClass:Qo,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=e.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){if(this.tileCache.canExpireCache())return!0;for(const e in this.tileCacheForProjection)if(this.tileCacheForProjection[e].canExpireCache())return!0;return!1}expireCache(e,t){const n=this.getTileCacheForProjection(e);this.tileCache.expireCache(this.tileCache==n?t:{});for(const s in this.tileCacheForProjection){const e=this.tileCacheForProjection[s];e.expireCache(e==n?t:{})}}getGutterForProjection(e){return this.getProjection()&&e&&!Oe(this.getProjection(),e)?0:this.getGutter()}getGutter(){return 0}getKey(){let e=super.getKey();return this.getInterpolate()||(e+=":disable-interpolation"),e}getOpaque(e){return!(this.getProjection()&&e&&!Oe(this.getProjection(),e))&&super.getOpaque(e)}getTileGridForProjection(e){const n=this.getProjection();if(this.tileGrid&&(!n||Oe(n,e)))return this.tileGrid;const t=c(e);return t in this.tileGridForProjection||(this.tileGridForProjection[t]=Lc(e)),this.tileGridForProjection[t]}getTileCacheForProjection(e){const n=this.getProjection();if(!n||Oe(n,e))return this.tileCache;const t=c(e);return t in this.tileCacheForProjection||(this.tileCacheForProjection[t]=new di(this.tileCache.highWaterMark)),this.tileCacheForProjection[t]}createTile_(e,t,n,s,o,i){const c=[e,t,n],l=this.getTileCoordForTileUrlFunction(c,o),a=l?this.tileUrlFunction(l,s,o):void 0,r=new this.tileClass(c,void 0!==a?ne:J,void 0!==a?a:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return r.key=i,r.addEventListener(A,this.handleTileChange.bind(this)),r}getTile(e,t,n,s,o){const i=this.getProjection();if(!i||!o||Oe(i,o))return this.getTileInternal(e,t,n,s,i||o);const c=this.getTileCacheForProjection(o),d=[e,t,n];let a;const l=an(d);c.containsKey(l)&&(a=c.get(l));const u=this.getKey();if(a&&a.key==u)return a;const h=this.getTileGridForProjection(i),m=this.getTileGridForProjection(o),f=this.getTileCoordForTileUrlFunction(d,o),r=new Es(i,h,o,m,d,f,this.getTilePixelRatio(s),this.getGutter(),(e,t,n,s)=>this.getTileInternal(e,t,n,s,i),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return r.key=u,a?(r.interimTile=a,r.refreshInterimChain(),c.replace(l,r)):c.set(l,r),r}getTileInternal(e,t,n,s,o){let i=null;const a=St(e,t,n),r=this.getKey();if(this.tileCache.containsKey(a)){if(i=this.tileCache.get(a),i.key!=r){const c=i;i=this.createTile_(e,t,n,s,o,r),c.getState()==ne?i.interimTile=c.interimTile:i.interimTile=c,i.refreshInterimChain(),this.tileCache.replace(a,i)}}else i=this.createTile_(e,t,n,s,o,r),this.tileCache.set(a,i);return i}setRenderReprojectionEdges(e){if(this.renderReprojectionEdges_!=e){this.renderReprojectionEdges_=e;for(const e in this.tileCacheForProjection)this.tileCacheForProjection[e].clear();this.changed()}}setTileGridForProjection(e,t){const n=d(e);if(n){const e=c(n);e in this.tileGridForProjection||(this.tileGridForProjection[e]=t)}}clear(){super.clear();for(const e in this.tileCacheForProjection)this.tileCacheForProjection[e].clear()}}function d5(e,t){e.getImage().src=t}function zh(e){const s=e[0],i=new Array(s);let t,n,o=1<<s-1;for(t=0;t<s;++t)n=48,e[1]&o&&(n+=1),e[2]&o&&(n+=2),i[t]=String.fromCharCode(n),o>>=1;return i.join("")}class si extends Dt{constructor(e){const t=void 0!==(e=e||{}).projection?e.projection:"EPSG:3857",n=void 0!==e.tileGrid?e.tileGrid:Mn({extent:Yt(t),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize});super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,opaque:e.opaque,projection:t,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:n,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:void 0===e.wrapX||e.wrapX,transition:e.transition,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.gutter_=void 0!==e.gutter?e.gutter:0}getGutter(){return this.gutter_}}class Di{constructor(e){this.rbush_=new m4(e),this.items_={}}insert(e,t){const n={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3],value:t};this.rbush_.insert(n),this.items_[c(t)]=n}load(e,t){const n=new Array(t.length);for(let s=0,r=t.length;s<r;s++){const o=e[s],i=t[s],a={minX:o[0],minY:o[1],maxX:o[2],maxY:o[3],value:i};n[s]=a,this.items_[c(i)]=a}this.rbush_.load(n)}remove(e){const t=c(e),n=this.items_[t];return delete this.items_[t],null!==this.rbush_.remove(n)}update(e,t){const n=this.items_[c(t)];Ue([n.minX,n.minY,n.maxX,n.maxY],e)||(this.remove(t),this.insert(e,t))}getAll(){return this.rbush_.all().map(function(e){return e.value})}getInExtent(e){const t={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]};return this.rbush_.search(t).map(function(e){return e.value})}forEach(e){return this.forEach_(this.getAll(),e)}forEachInExtent(e,t){return this.forEach_(this.getInExtent(e),t)}forEach_(e,t){let n;for(let s=0,o=e.length;s<o;s++)if(n=t(e[s]),n)return n;return n}isEmpty(){return it(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(e){const t=this.rbush_.toJSON();return Ge(t.minX,t.minY,t.maxX,t.maxY,e)}concat(e){this.rbush_.load(e.rbush_.all());for(const t in e.items_)this.items_[t]=e.items_[t]}}class Li extends jt{constructor(e,t,n){super(),void 0!==n&&void 0===t?this.setFlatCoordinates(n,e):(t=t||0,this.setCenterAndRadius(e,t,n))}clone(){const e=new Li(this.flatCoordinates.slice(),void 0,this.layout);return e.applyProperties(this),e}closestPointXY(e,t,n,s){const o=this.flatCoordinates,a=e-o[0],r=t-o[1],i=a*a+r*r;if(i<s){if(0===i)for(let e=0;e<this.stride;++e)n[e]=o[e];else{const e=this.getRadius()/Math.sqrt(i);n[0]=o[0]+e*a,n[1]=o[1]+e*r;for(let e=2;e<this.stride;++e)n[e]=o[e]}return n.length=this.stride,i}return s}containsXY(e,t){const n=this.flatCoordinates,s=e-n[0],o=t-n[1];return s*s+o*o<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(e){const t=this.flatCoordinates,n=t[this.stride]-t[0];return Ge(t[0]-n,t[1]-n,t[0]+n,t[1]+n,e)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const e=this.flatCoordinates[this.stride]-this.flatCoordinates[0],t=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return e*e+t*t}getType(){return"Circle"}intersectsExtent(e){if(U(e,this.getExtent())){const t=this.getCenter();return e[0]<=t[0]&&e[2]>=t[0]||e[1]<=t[1]&&e[3]>=t[1]||Br(e,this.intersectsCoordinate.bind(this))}return!1}setCenter(e){const t=this.stride,s=this.flatCoordinates[t]-this.flatCoordinates[0],n=e.slice();n[t]=n[0]+s;for(let s=1;s<t;++s)n[t+s]=e[s];this.setFlatCoordinates(this.layout,n),this.changed()}setCenterAndRadius(e,t,n){this.setLayout(n,e,0),this.flatCoordinates||(this.flatCoordinates=[]);const s=this.flatCoordinates;let o=wu(s,0,e,this.stride);s[o++]=s[0]+t;for(let e=1,t=this.stride;e<t;++e)s[o++]=s[e];s.length=o,this.changed()}getCoordinates(){return null}setCoordinates(){}setRadius(e){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+e,this.changed()}rotate(e,t){const n=this.getCenter(),s=this.getStride();this.setCenter(or(n,0,n.length,s,e,t,n)),this.changed()}}Li.prototype.transform;class ge extends ur{constructor(e){super(),this.geometries_=e,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(T),this.changeEventsKeys_.length=0}listenGeometriesChange_(){const e=this.geometries_;for(let t=0,n=e.length;t<n;++t)this.changeEventsKeys_.push(m(e[t],A,this.changed,this))}clone(){const e=new ge(Su(this.geometries_));return e.applyProperties(this),e}closestPointXY(e,t,n,s){if(s<Gn(this.getExtent(),e,t))return s;const o=this.geometries_;for(let i=0,a=o.length;i<a;++i)s=o[i].closestPointXY(e,t,n,s);return s}containsXY(e,t){const n=this.geometries_;for(let s=0,o=n.length;s<o;++s)if(n[s].containsXY(e,t))return!0;return!1}computeExtent(e){mn(e);const t=this.geometries_;for(let n=0,s=t.length;n<s;++n)Cd(e,t[n].getExtent());return e}getGeometries(){return Su(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let e=[];const t=this.geometries_;for(let n=0,s=t.length;n<s;++n)t[n].getType()===this.getType()?e=e.concat(t[n].getGeometriesArrayRecursive()):e.push(t[n]);return e}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&e<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=[],n=this.geometries_;let s=!1;for(let o=0,r=n.length;o<r;++o){const i=n[o],a=i.getSimplifiedGeometry(e);t.push(a),a!==i&&(s=!0)}return s?new ge(t):(this.simplifiedGeometryMaxMinSquaredTolerance=e,this)}getType(){return"GeometryCollection"}intersectsExtent(e){const t=this.geometries_;for(let n=0,s=t.length;n<s;++n)if(t[n].intersectsExtent(e))return!0;return!1}isEmpty(){return 0===this.geometries_.length}rotate(e,t){const n=this.geometries_;for(let s=0,o=n.length;s<o;++s)n[s].rotate(e,t);this.changed()}scale(e,t,n){n||(n=_e(this.getExtent()));const s=this.geometries_;for(let o=0,i=s.length;o<i;++o)s[o].scale(e,t,n);this.changed()}setGeometries(e){this.setGeometriesArray(Su(e))}setGeometriesArray(e){this.unlistenGeometriesChange_(),this.geometries_=e,this.listenGeometriesChange_(),this.changed()}applyTransform(e){const t=this.geometries_;for(let n=0,s=t.length;n<s;++n)t[n].applyTransform(e);this.changed()}translate(e,t){const n=this.geometries_;for(let s=0,o=n.length;s<o;++s)n[s].translate(e,t);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function Su(e){return e.map(e=>e.clone())}function Hi(e,t,n,s,o,i,a){let r,c;const l=(n-t)/s;if(1===l)r=t;else if(2===l)r=t,c=o;else if(0!==l){let l=e[t],d=e[t+1],u=0;const a=[0];for(let o=t+s;o<n;o+=s){const i=e[o],r=e[o+1];u+=Math.sqrt((i-l)*(i-l)+(r-d)*(r-d)),a.push(u),l=i,d=r}const h=o*u,i=B4(a,h);i<0?(c=(h-a[-i-2])/(a[-i-1]-a[-i-2]),r=t+(-i-2)*s):r=t+i*s}a=a>1?a:2,i=i||new Array(a);for(let t=0;t<a;++t)i[t]=void 0===r?NaN:void 0===c?e[r+t]:$e(e[r+t],e[r+s+t],c);return i}function cc(e,t,n,s,o,i){if(n==t)return null;let a;if(o<e[t+s-1])return i?(a=e.slice(t,t+s),a[s-1]=o,a):null;if(e[n-1]<o)return i?(a=e.slice(n-s,n),a[s-1]=o,a):null;if(o==e[t+s-1])return e.slice(t,t+s);let r=t/s,c=n/s;for(;r<c;){const t=r+c>>1;o<e[(t+1)*s-1]?c=t:r=t+1}const l=e[r*s-1];if(o==l)return e.slice((r-1)*s,(r-1)*s+s);const d=(o-l)/(e[(r+1)*s-1]-l);a=[];for(let t=0;t<s-1;++t)a.push($e(e[(r-1)*s+t],e[r*s+t],d));return a.push(o),a}function jh(e,t,n,s,o,i,a){if(a)return cc(e,t,n[n.length-1],s,o,i);let r;if(o<e[s-1])return i?(r=e.slice(0,s),r[s-1]=o,r):null;if(e[e.length-1]<o)return i?(r=e.slice(e.length-s),r[s-1]=o,r):null;for(let a=0,r=n.length;a<r;++a){const i=n[a];if(t!=i){if(o<e[t+s-1])return null;if(o<=e[i-1])return cc(e,t,i,s,o,!1);t=i}}return null}function rc(e,t,n,s){let o=e[t],i=e[t+1],a=0;for(let r=t+s;r<n;r+=s){const c=e[r],l=e[r+1];a+=Math.sqrt((c-o)*(c-o)+(l-i)*(l-i)),o=c,i=l}return a}class ee extends jt{constructor(e,t){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,void 0===t||Array.isArray(e[0])?this.setCoordinates(e,t):this.setFlatCoordinates(t,e)}appendCoordinate(e){z(this.flatCoordinates,e),this.changed()}clone(){const e=new ee(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,n,s){return s<Gn(this.getExtent(),e,t)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(pr(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),yr(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,e,t,n,s))}forEachSegment(e){return Pu(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}getCoordinateAtM(e,t){return"XYM"!=this.layout&&"XYZM"!=this.layout?null:(t=void 0!==t&&t,cc(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t))}getCoordinates(){return Pt(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(e,t){return Hi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,this.stride)}getLength(){return rc(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_??void 0),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(e){const t=[];return t.length=so(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0),new ee(t,"XY")}getType(){return"LineString"}intersectsExtent(e){return Qi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=io(this.flatCoordinates,0,e,this.stride),this.changed()}}class ke extends jt{constructor(e,t,n){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(e[0]))this.setCoordinates(e,t);else if(void 0!==t&&n)this.setFlatCoordinates(t,e),this.ends_=n;else{const t=e,n=[],s=[];for(let e=0,o=t.length;e<o;++e)z(n,t[e].getFlatCoordinates()),s.push(n.length);const o=0===t.length?this.getLayout():t[0].getLayout();this.setFlatCoordinates(o,n),this.ends_=s}}appendLineString(e){z(this.flatCoordinates,e.getFlatCoordinates().slice()),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const e=new ke(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e}closestPointXY(e,t,n,s){return s<Gn(this.getExtent(),e,t)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(gr(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),_r(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,e,t,n,s))}getCoordinateAtM(e,t,n){return"XYM"!=this.layout&&"XYZM"!=this.layout||0===this.flatCoordinates.length?null:(t=void 0!==t&&t,n=void 0!==n&&n,jh(this.flatCoordinates,0,this.ends_,this.stride,e,t,n))}getCoordinates(){return eo(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(e){return e<0||this.ends_.length<=e?null:new ee(this.flatCoordinates.slice(0===e?0:this.ends_[e-1],this.ends_[e]),this.layout)}getLineStrings(){const s=this.flatCoordinates,e=this.ends_,o=this.layout,t=[];let n=0;for(let i=0,r=e.length;i<r;++i){const a=e[i],c=new ee(s.slice(n,a),o);t.push(c),n=a}return t}getFlatMidpoints(){const e=[],s=this.flatCoordinates;let t=0;const n=this.ends_,o=this.stride;for(let i=0,r=n.length;i<r;++i){const a=n[i];z(e,Hi(s,t,a,o,.5)),t=a}return e}getSimplifiedGeometryInternal(e){const t=[],n=[];return t.length=Er(this.flatCoordinates,0,this.ends_,this.stride,e,t,0,n),new ke(t,"XY",n)}getType(){return"MultiLineString"}intersectsExtent(e){return th(this.flatCoordinates,0,this.ends_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]);const n=oo(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=0===n.length?0:n[n.length-1],this.changed()}}class tt extends jt{constructor(e,t){super(),t&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}appendPoint(e){z(this.flatCoordinates,e.getFlatCoordinates()),this.changed()}clone(){const e=new tt(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,n,s){if(s<Gn(this.getExtent(),e,t))return s;const o=this.flatCoordinates,i=this.stride;for(let a=0,c=o.length;a<c;a+=i){const r=wt(e,t,o[a],o[a+1]);if(r<s){s=r;for(let e=0;e<i;++e)n[e]=o[a+e];n.length=i}}return s}getCoordinates(){return Pt(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(e){const t=this.flatCoordinates.length/this.stride;return e<0||t<=e?null:new Y(this.flatCoordinates.slice(e*this.stride,(e+1)*this.stride),this.layout)}getPoints(){const e=this.flatCoordinates,s=this.layout,t=this.stride,n=[];for(let o=0,i=e.length;o<i;o+=t){const a=new Y(e.slice(o,o+t),s);n.push(a)}return n}getType(){return"MultiPoint"}intersectsExtent(e){const t=this.flatCoordinates,n=this.stride;for(let s=0,o=t.length;s<o;s+=n)if(Zr(e,t[s],t[s+1]))return!0;return!1}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=io(this.flatCoordinates,0,e,this.stride),this.changed()}}function Ru(e,t,n,s){const i=[];let o=[1/0,1/0,-1/0,-1/0];for(let a=0,c=n.length;a<c;++a){const r=n[a];o=Gr(e,t,r[0],s),i.push((o[0]+o[2])/2,(o[1]+o[3])/2),t=r[r.length-1]}return i}class Re extends jt{constructor(e,t,n){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!n&&!Array.isArray(e[0])){const s=e,o=[],i=[];for(let e=0,a=s.length;e<a;++e){const n=s[e],r=o.length,t=n.getEnds();for(let e=0,n=t.length;e<n;++e)t[e]+=r;z(o,n.getFlatCoordinates()),i.push(t)}t=0===s.length?this.getLayout():s[0].getLayout(),e=o,n=i}void 0!==t&&n?(this.setFlatCoordinates(t,e),this.endss_=n):this.setCoordinates(e,t)}appendPolygon(e){let t;if(this.flatCoordinates){const n=this.flatCoordinates.length;z(this.flatCoordinates,e.getFlatCoordinates()),t=e.getEnds().slice();for(let e=0,s=t.length;e<s;++e)t[e]+=n}else this.flatCoordinates=e.getFlatCoordinates().slice(),t=e.getEnds().slice(),this.endss_.push();this.endss_.push(t),this.changed()}clone(){const e=this.endss_.length,t=new Array(e);for(let n=0;n<e;++n)t[n]=this.endss_[n].slice();const n=new Re(this.flatCoordinates.slice(),this.layout,t);return n.applyProperties(this),n}closestPointXY(e,t,n,s){return s<Gn(this.getExtent(),e,t)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Xh(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Bh(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,e,t,n,s))}containsXY(e,t){return ch(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e,t)}getArea(){return dh(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(e){let t;return void 0!==e?(t=this.getOrientedFlatCoordinates().slice(),fc(t,0,this.endss_,this.stride,e)):t=this.flatCoordinates,Pr(t,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const e=Ru(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=Lu(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new tt(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const e=this.flatCoordinates;qu(e,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=fc(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(e){const t=[],n=[];return t.length=vh(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(e),t,0,n),new Re(t,"XY",n)}getPolygon(e){if(e<0||this.endss_.length<=e)return null;let t;if(0===e)t=0;else{const n=this.endss_[e-1];t=n[n.length-1]}const n=this.endss_[e].slice(),s=n[n.length-1];if(0!==t)for(let e=0,s=n.length;e<s;++e)n[e]-=t;return new ie(this.flatCoordinates.slice(t,s),this.layout,n)}getPolygons(){const s=this.layout,o=this.flatCoordinates,t=this.endss_,n=[];let e=0;for(let a=0,c=t.length;a<c;++a){const i=t[a].slice(),r=i[i.length-1];if(0!==e)for(let t=0,n=i.length;t<n;++t)i[t]-=e;const l=new ie(o.slice(e,r),s,i);n.push(l),e=r}return n}getType(){return"MultiPolygon"}intersectsExtent(e){return K3(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,3),this.flatCoordinates||(this.flatCoordinates=[]);const n=xu(this.flatCoordinates,0,e,this.stride,this.endss_);if(0===n.length)this.flatCoordinates.length=0;else{const e=n[n.length-1];this.flatCoordinates.length=0===e.length?0:e[e.length-1]}this.changed()}}const oh=[1,0,0,1,0,0];class Ce{constructor(e,t,n,s,o,i){this.styleFunction,this.extent_,this.id_=i,this.type_=e,this.flatCoordinates_=t,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=n||null,this.properties_=o,this.squaredTolerance_,this.stride_=s,this.simplifiedGeometry_}get(e){return this.properties_[e]}getExtent(){return this.extent_||(this.extent_="Point"===this.type_?hs(this.flatCoordinates_):Gr(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const e=_e(this.getExtent());this.flatInteriorPoints_=qr(this.flatCoordinates_,0,this.ends_,2,e,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const e=Pi(this.flatCoordinates_,this.ends_),t=Ru(this.flatCoordinates_,0,e,2);this.flatInteriorPoints_=Lu(this.flatCoordinates_,0,e,2,t)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=Hi(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const n=this.flatCoordinates_;let e=0;const t=this.ends_;for(let s=0,i=t.length;s<i;++s){const o=t[s],a=Hi(n,e,o,2,.5);z(this.flatMidpoints_,a),e=o}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(){return this}simplifyTransformed(){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return this.stride_}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(e){const n=(e=d(e)).getExtent(),t=e.getWorldExtent();if(n&&t){const e=W(t)/W(n);Le(oh,t[0],t[3],e,-e,0,0,0),bt(this.flatCoordinates_,0,this.flatCoordinates_.length,2,oh,this.flatCoordinates_)}}applyTransform(e){e(this.flatCoordinates_,this.flatCoordinates_,this.stride_)}clone(){return new Ce(this.type_,this.flatCoordinates_.slice(),this.ends_?.slice(),this.stride_,Object.assign({},this.properties_),this.id_)}getEnds(){return this.ends_}enableSimplifyTransformed(){return this.simplifyTransformed=Rl((e,t)=>{if(e===this.squaredTolerance_)return this.simplifiedGeometry_;this.simplifiedGeometry_=this.clone(),t&&this.simplifiedGeometry_.applyTransform(t);const n=this.simplifiedGeometry_.getFlatCoordinates();let s;switch(this.type_){case"LineString":n.length=so(n,0,this.simplifiedGeometry_.flatCoordinates_.length,this.simplifiedGeometry_.stride_,e,n,0),s=[n.length];break;case"MultiLineString":s=[],n.length=Er(n,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,e,n,0,s);break;case"Polygon":s=[],n.length=Fr(n,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,Math.sqrt(e),n,0,s)}return s&&(this.simplifiedGeometry_=new Ce(this.type_,n,s,2,this.properties_,this.id_)),this.squaredTolerance_=e,this.simplifiedGeometry_}),this}}function G3(e){const t=e.getType();switch(t){case"Point":return new Y(e.getFlatCoordinates());case"MultiPoint":return new tt(e.getFlatCoordinates(),"XY");case"LineString":return new ee(e.getFlatCoordinates(),"XY");case"MultiLineString":return new ke(e.getFlatCoordinates(),"XY",e.getEnds());case"Polygon":const n=e.getFlatCoordinates(),s=e.getEnds(),o=Pi(n,s);return o.length>1?new Re(n,"XY",o):new ie(n,"XY",s);default:throw new Error("Invalid geometry type:"+t)}}Ce.prototype.getFlatCoordinates=Ce.prototype.getOrientedFlatCoordinates;var $n="addfeature",$u="changefeature",Wu="clear",Ms="removefeature",_5="featuresloadstart",w5="featuresloadend",O5="featuresloaderror";class cn extends ue{constructor(e,t,n){super(e),this.feature=t,this.features=n}}class ws extends jo{constructor(e){super({attributions:(e=e||{}).attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:void 0===e.wrapX||e.wrapX}),this.on,this.once,this.un,this.loader_=is,this.format_=e.format,this.overlaps_=void 0===e.overlaps||e.overlaps,this.url_=e.url,void 0!==e.loader?this.loader_=e.loader:void 0!==this.url_&&(x(this.format_,"`format` must be set when `url` is set"),this.loader_=xd(this.url_,this.format_)),this.strategy_=void 0!==e.strategy?e.strategy:Rf;const s=void 0===e.useSpatialIndex||e.useSpatialIndex;let t,n;this.featuresRtree_=s?new Di:null,this.loadedExtentsRtree_=new Di,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null,Array.isArray(e.features)?n=e.features:e.features&&(t=e.features,n=t.getArray()),s||void 0!==t||(t=new me(n)),void 0!==n&&this.addFeaturesInternal(n),void 0!==t&&this.bindFeaturesCollection_(t)}addFeature(e){this.addFeatureInternal(e),this.changed()}addFeatureInternal(e){const t=c(e);if(!this.addToIndex_(t,e))return void(this.featuresCollection_&&this.featuresCollection_.remove(e));this.setupChangeEvents_(t,e);const n=e.getGeometry();if(n){const t=n.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(t,e)}else this.nullGeometryFeatures_[t]=e;this.dispatchEvent(new cn($n,e))}setupChangeEvents_(e,t){t instanceof Ce||(this.featureChangeKeys_[e]=[m(t,A,this.handleFeatureChange_,this),m(t,Xn,this.handleFeatureChange_,this)])}addToIndex_(e,t){let n=!0;if(void 0!==t.getId()){const e=String(t.getId());if(e in this.idIndex_)if(t instanceof Ce){const s=this.idIndex_[e];s instanceof Ce?Array.isArray(s)?s.push(t):this.idIndex_[e]=[s,t]:n=!1}else n=!1;else this.idIndex_[e]=t}return n&&(x(!(e in this.uidIndex_),"The passed `feature` was already added to the source"),this.uidIndex_[e]=t),n}addFeatures(e){this.addFeaturesInternal(e),this.changed()}addFeaturesInternal(e){const n=[],t=[],s=[];for(let n=0,o=e.length;n<o;n++){const s=e[n],i=c(s);this.addToIndex_(i,s)&&t.push(s)}for(let o=0,r=t.length;o<r;o++){const e=t[o],i=c(e);this.setupChangeEvents_(i,e);const a=e.getGeometry();if(a){const t=a.getExtent();n.push(t),s.push(e)}else this.nullGeometryFeatures_[i]=e}if(this.featuresRtree_&&this.featuresRtree_.load(n,s),this.hasListener($n))for(let e=0,n=t.length;e<n;e++)this.dispatchEvent(new cn($n,t[e]))}bindFeaturesCollection_(e){let t=!1;this.addEventListener($n,function(n){t||(t=!0,e.push(n.feature),t=!1)}),this.addEventListener(Ms,function(n){t||(t=!0,e.remove(n.feature),t=!1)}),e.addEventListener(dt,e=>{t||(t=!0,this.addFeature(e.element),t=!1)}),e.addEventListener(ut,e=>{t||(t=!0,this.removeFeature(e.element),t=!1)}),this.featuresCollection_=e}clear(e){if(e){for(const e in this.featureChangeKeys_)this.featureChangeKeys_[e].forEach(T);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){const e=e=>{this.removeFeatureInternal(e)};this.featuresRtree_.forEach(e);for(const e in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[e])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const t=new cn(Wu);this.dispatchEvent(t),this.changed()}forEachFeature(e){if(this.featuresRtree_)return this.featuresRtree_.forEach(e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureAtCoordinateDirect(e,t){const n=[e[0],e[1],e[0],e[1]];return this.forEachFeatureInExtent(n,function(n){const s=n.getGeometry();if(s instanceof Ce||s.intersectsCoordinate(e))return t(n)})}forEachFeatureInExtent(e,t){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(e,t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureIntersectingExtent(e,t){return this.forEachFeatureInExtent(e,function(n){const s=n.getGeometry();if(s instanceof Ce||s.intersectsExtent(e)){const e=t(n);if(e)return e}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let e;return this.featuresCollection_?e=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(e=this.featuresRtree_.getAll(),it(this.nullGeometryFeatures_)||z(e,Object.values(this.nullGeometryFeatures_))),e}getFeaturesAtCoordinate(e){const t=[];return this.forEachFeatureAtCoordinateDirect(e,function(e){t.push(e)}),t}getFeaturesInExtent(e,t){if(this.featuresRtree_){if(!(t&&t.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(e);const n=Dr(e,t);return[].concat(...n.map(e=>this.featuresRtree_.getInExtent(e)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(e,t){const o=e[0],i=e[1];let a=null;const r=[NaN,NaN];let n=1/0;const s=[-1/0,-1/0,1/0,1/0];return t=t||Je,this.featuresRtree_.forEachInExtent(s,function(e){if(t(e)){const t=e.getGeometry(),c=n;if(n=t instanceof Ce?0:t.closestPointXY(o,i,r,n),n<c){a=e;const t=Math.sqrt(n);s[0]=o-t,s[1]=i-t,s[2]=o+t,s[3]=i+t}}}),a}getExtent(e){return this.featuresRtree_.getExtent(e)}getFeatureById(e){const t=this.idIndex_[e.toString()];return void 0!==t?t:null}getFeatureByUid(e){const t=this.uidIndex_[e];return void 0!==t?t:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(e){const t=e.target,n=c(t),s=t.getGeometry();if(s){const e=s.getExtent();n in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[n],this.featuresRtree_&&this.featuresRtree_.insert(e,t)):this.featuresRtree_&&this.featuresRtree_.update(e,t)}else n in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(t),this.nullGeometryFeatures_[n]=t);const o=t.getId();if(void 0!==o){const e=o.toString();this.idIndex_[e]!==t&&(this.removeFromIdIndex_(t),this.idIndex_[e]=t)}else this.removeFromIdIndex_(t),this.uidIndex_[n]=t;this.changed(),this.dispatchEvent(new cn($u,t))}hasFeature(e){const t=e.getId();return void 0!==t?t in this.idIndex_:c(e)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&it(this.nullGeometryFeatures_):!this.featuresCollection_||0===this.featuresCollection_.getLength()}loadFeatures(e,t,n){const s=this.loadedExtentsRtree_,o=this.strategy_(e,t,n);for(let i=0,a=o.length;i<a;++i){const e=o[i];s.forEachInExtent(e,function(t){return xe(t.extent,e)})||(++this.loadingExtentsCount_,this.dispatchEvent(new cn(_5)),this.loader_.call(this,e,t,n,e=>{--this.loadingExtentsCount_,this.dispatchEvent(new cn(w5,void 0,e))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new cn(O5))}),s.insert(e,{extent:e.slice()}))}this.loading=!(this.loader_.length<4)&&this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(e){const n=this.loadedExtentsRtree_;let t;n.forEachInExtent(e,function(n){if(Ue(n.extent,e))return t=n,!0}),t&&n.remove(t)}removeFeatures(e){const t=[];for(let n=0,o=e.length;n<o;++n){const i=e[n],s=this.removeFeatureInternal(i);s&&t.push(s)}t.length>0&&this.changed()}removeFeature(e){if(!e)return;this.removeFeatureInternal(e)&&this.changed()}removeFeatureInternal(e){const t=c(e);if(!(t in this.uidIndex_))return;t in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[t]:this.featuresRtree_&&this.featuresRtree_.remove(e);const s=this.featureChangeKeys_[t];s?.forEach(T),delete this.featureChangeKeys_[t];const n=e.getId();if(void 0!==n){const s=n.toString(),t=this.idIndex_[s];t===e?delete this.idIndex_[s]:Array.isArray(t)&&(t.splice(t.indexOf(e),1),1===t.length&&(this.idIndex_[s]=t[0]))}return delete this.uidIndex_[t],this.hasListener(Ms)&&this.dispatchEvent(new cn(Ms,e)),e}removeFromIdIndex_(e){let t=!1;for(const s in this.idIndex_){const n=this.idIndex_[s];if(e instanceof Ce&&Array.isArray(n)&&n.includes(e))n.splice(n.indexOf(e),1);else if(this.idIndex_[s]===e){delete this.idIndex_[s],t=!0;break}}return t}setLoader(e){this.loader_=e}setUrl(e){x(this.format_,"`format` must be set when `url` is set"),this.url_=e,this.setLoader(xd(e,this.format_))}}class Nr extends Cc{constructor(e){super({tileCoord:e.tileCoord,loader:()=>Promise.resolve(new Uint8Array(4)),interpolate:e.interpolate,transition:e.transition}),this.pixelRatio_=e.pixelRatio,this.gutter_=e.gutter,this.reprojData_=null,this.reprojError_=null,this.reprojSize_=void 0,this.sourceTileGrid_=e.sourceTileGrid,this.targetTileGrid_=e.targetTileGrid,this.wrappedTileCoord_=e.wrappedTileCoord||e.tileCoord,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const s=e.sourceProj,o=s.getExtent(),a=e.sourceTileGrid.getExtent();this.clipExtent_=s.canWrapX()?a?ce(o,a):o:a;const c=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),l=this.targetTileGrid_.getExtent();let t=this.sourceTileGrid_.getExtent();const r=l?ce(c,l):c;if(0===Nn(r))return void(this.state=J);o&&(t=t?ce(t,o):o);const d=this.targetTileGrid_.getResolution(this.wrappedTileCoord_[0]),u=e.targetProj,i=Kd(s,u,r,d);if(!isFinite(i)||i<=0)return void(this.state=J);const h=void 0!==e.errorThreshold?e.errorThreshold:Gd;if(this.triangulation_=new qc(s,u,r,t,i*h,d),0===this.triangulation_.getTriangles().length)return void(this.state=J);this.sourceZ_=this.sourceTileGrid_.getZForResolution(i);let n=this.triangulation_.calculateSourceExtent();if(t&&(s.canWrapX()?(n[1]=y(n[1],t[1],t[3]),n[3]=y(n[3],t[1],t[3])):n=ce(n,t)),Nn(n)){let t=0,i=0;s.canWrapX()&&(t=b(o),i=Math.floor((n[0]-o[0])/t)),Dr(n.slice(),s,!0).forEach(n=>{const s=this.sourceTileGrid_.getTileRangeForExtentAndZ(n,this.sourceZ_),o=e.getTileFunction;for(let e=s.minX;e<=s.maxX;e++)for(let n=s.minY;n<=s.maxY;n++){const a=o(this.sourceZ_,e,n,this.pixelRatio_);if(a){const e=i*t;this.sourceTiles_.push({tile:a,offset:e})}}++i}),0===this.sourceTiles_.length&&(this.state=J)}else this.state=J}getSize(){return this.reprojSize_}getData(){return this.reprojData_}getError(){return this.reprojError_}reproject_(){const e=[];if(this.sourceTiles_.forEach(t=>{const s=t.tile;if(!s||s.getState()!==L)return;const g=s.getSize(),p=this.gutter_;let c;const j=Ac(s.getData());c=j||mf(Mi(s.getData()));const n=[g[0]+2*p,g[1]+2*p],b=c instanceof Float32Array,h=n[0]*n[1],a=b?Float32Array:Uint8Array,o=new a(c.buffer),d=a.BYTES_PER_ELEMENT,v=d*o.length/h,u=o.byteLength/n[1],m=Math.floor(u/d/n[0]),f=h*m;let l=o;if(o.length!==f){l=new a(f);let t=0,e=0;const s=n[0]*m;for(let i=0;i<n[1];++i){for(let n=0;n<s;++n)l[t++]=o[e+n];e+=u/d}}const r=this.sourceTileGrid_.getTileCoordExtent(s.tileCoord);r[0]+=t.offset,r[2]+=t.offset;const i=this.clipExtent_?.slice();i&&(i[0]+=t.offset,i[2]+=t.offset),e.push({extent:r,clipExtent:i,data:new Uint8Array(l.buffer),dataType:a,bytesPerPixel:v,pixelSize:n})}),this.sourceTiles_.length=0,0===e.length)this.state=Z;else{const i=this.wrappedTileCoord_[0],n=this.targetTileGrid_.getTileSize(i),a="number"==typeof n?n:n[0],r="number"==typeof n?n:n[1],c=this.targetTileGrid_.getResolution(i),l=this.sourceTileGrid_.getResolution(this.sourceZ_),d=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);let o,t;const s=e[0].bytesPerPixel;for(let u=Math.ceil(s/3)-1;u>=0;--u){const h=[];for(let i=0,f=e.length;i<f;++i){const n=e[i],a=n.data,c=n.pixelSize,l=c[0],d=c[1],r=K(l,d,Nt),m=r.createImageData(l,d),t=m.data;let o=3*u;for(let e=0,n=t.length;e<n;e+=4)t[e]=a[o],t[e+1]=a[o+1],t[e+2]=a[o+2],t[e+3]=255,o+=s;r.putImageData(m,0,0),h.push({extent:n.extent,clipExtent:n.clipExtent,image:r.canvas})}const m=Gc(a,r,this.pixelRatio_,l,this.sourceTileGrid_.getExtent(),c,d,this.triangulation_,h,this.gutter_,!1,!1,!1);for(let e=0,n=h.length;e<n;++e){const t=h[e].image.getContext("2d");zn(t),Nt.push(t.canvas)}const p=m.getContext("2d"),f=p.getImageData(0,0,m.width,m.height);zn(p),Nt.push(m),o||(t=new Uint8Array(s*f.width*f.height),o=new e[0].dataType(t.buffer));const i=f.data;let n=3*u;for(let e=0,o=i.length;e<o;e+=4)255===i[e+3]?(t[n]=i[e],t[n+1]=i[e+1],t[n+2]=i[e+2]):(t[n]=0,t[n+1]=0,t[n+2]=0),n+=s}this.reprojData_=o,this.reprojSize_=[Math.round(a*this.pixelRatio_),Math.round(r*this.pixelRatio_)],this.state=L}this.changed()}load(){if(this.state!==ne&&this.state!==Z)return;this.state=gt,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:t})=>{const n=t.getState();if(n!==ne&&n!==gt)return;e++;const s=m(t,A,function(){const n=t.getState();n!=L&&n!=Z&&n!=J||(T(s),e--,0===e&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(s)}),0===e?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:e}){e.getState()==ne&&e.load()})}unlistenSources_(){this.sourcesListenerKeys_.forEach(T),this.sourcesListenerKeys_=null}}class A3 extends Ai{constructor(e){const t=void 0===e.projection?"EPSG:3857":e.projection;let n=e.tileGrid;void 0===n&&t&&(n=Mn({extent:Yt(t),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize})),super({cacheSize:.1,attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:t,tileGrid:n,opaque:e.opaque,state:e.state,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate}),this.gutter_=void 0!==e.gutter?e.gutter:0,this.tileSize_=e.tileSize?X(e.tileSize):null,this.tileSizes_=null,this.tileLoadingKeys_={},this.loader_=e.loader,this.handleTileChange_=this.handleTileChange_.bind(this),this.bandCount=void 0===e.bandCount?4:e.bandCount,this.tileGridForProjection_={},this.tileCacheForProjection_={}}setTileSizes(e){this.tileSizes_=e}getTileSize(e){if(this.tileSizes_)return this.tileSizes_[e];if(this.tileSize_)return this.tileSize_;const t=this.getTileGrid();return t?X(t.getTileSize(e)):[256,256]}getGutterForProjection(e){const t=this.getProjection();return!t||Oe(t,e)?this.gutter_:0}setLoader(e){this.loader_=e}getReprojTile_(e,t,n,s,o){const i=this.getTileCacheForProjection(s),a=St(e,t,n);if(i.containsKey(a)){const e=i.get(a);if(e&&e.key==this.getKey())return e}const r=this.getTileGrid(),d=Math.max.apply(null,r.getResolutions().map((e,t)=>{const n=X(r.getTileSize(t)),s=this.getTileSize(t);return Math.max(s[0]/n[0],s[1]/n[1])})),u=this.getTileGridForProjection(o),h=this.getTileGridForProjection(s),c=[e,t,n],m=this.getTileCoordForTileUrlFunction(c,s),f=Object.assign({sourceProj:o,sourceTileGrid:u,targetProj:s,targetTileGrid:h,tileCoord:c,wrappedTileCoord:m,pixelRatio:d,gutter:this.getGutterForProjection(o),getTileFunction:(e,t,n,s)=>this.getTile(e,t,n,s,o)},this.tileOptions),l=new Nr(f);return l.key=this.getKey(),l}getTile(e,t,n,s,o){const a=this.getProjection();if(a&&o&&!Oe(a,o))return this.getReprojTile_(e,t,n,o,a);const c=this.getTileSize(e),r=St(e,t,n);if(this.tileCache.containsKey(r))return this.tileCache.get(r);const l=this.loader_,d=Object.assign({tileCoord:[e,t,n],loader:function(){return yl(function(){return l(e,t,n)})},size:c},this.tileOptions),i=new Cc(d);return i.key=this.getKey(),i.addEventListener(A,this.handleTileChange_),this.tileCache.set(r,i),i}handleTileChange_(e){const n=e.target,s=c(n),o=n.getState();let t;o==gt?(this.tileLoadingKeys_[s]=!0,t=r8):s in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[s],t=o==Z?n8:o==L?i8:void 0),t&&this.dispatchEvent(new pu(t,n))}getTileGridForProjection(e){const n=this.getProjection();if(this.tileGrid&&(!n||Oe(n,e)))return this.tileGrid;const t=c(e);return t in this.tileGridForProjection_||(this.tileGridForProjection_[t]=Lc(e)),this.tileGridForProjection_[t]}setTileGridForProjection(e,t){const n=d(e);if(n){const e=c(n);e in this.tileGridForProjection_||(this.tileGridForProjection_[e]=t)}}getTileCacheForProjection(e){const n=this.getProjection();if(!n||Oe(n,e))return this.tileCache;const t=c(e);return t in this.tileCacheForProjection_||(this.tileCacheForProjection_[t]=new di(.1)),this.tileCacheForProjection_[t]}expireCache(e,t){const n=this.getTileCacheForProjection(e);this.tileCache.expireCache(this.tileCache==n?t:{});for(const s in this.tileCacheForProjection_){const e=this.tileCacheForProjection_[s];e.expireCache(e==n?t:{})}}clear(){super.clear();for(const e in this.tileCacheForProjection_)this.tileCacheForProjection_[e].clear()}}function T5(e,t){if(!e)return!1;if(!0===e)return!0;if(3!==t.getSamplesPerPixel())return!1;const n=t.fileDirectory.PhotometricInterpretation,s=GeoTIFF.globals.photometricInterpretations;return n===s.CMYK||n===s.YCbCr||n===s.CIELab||n===s.ICCLab}const m3="STATISTICS_MAXIMUM",h3="STATISTICS_MINIMUM";let n1;function N5(e){try{return e.getBoundingBox()}catch{return[0,0,e.getWidth(),e.getHeight()]}}function R5(e){try{return e.getOrigin().slice(0,2)}catch{return[0,e.getHeight()]}}function P5(e,t){try{return e.getResolution(t)}catch{return[t.getWidth()/e.getWidth(),t.getHeight()/e.getHeight()]}}function H5(e){const t=e.geoKeys;if(!t)return null;if(t.ProjectedCSTypeGeoKey&&32767!==t.ProjectedCSTypeGeoKey){const n="EPSG:"+t.ProjectedCSTypeGeoKey;let e=d(n);if(!e){const s=Dd(t.ProjLinearUnitsGeoKey);s&&(e=new ns({code:n,units:s}))}return e}if(t.GeographicTypeGeoKey&&32767!==t.GeographicTypeGeoKey){const n="EPSG:"+t.GeographicTypeGeoKey;let e=d(n);if(!e){const s=Dd(t.GeogAngularUnitsGeoKey);s&&(e=new ns({code:n,units:s}))}return e}return null}function B5(e){return e.getImageCount().then(function(t){const n=new Array(t);for(let s=0;s<t;++s)n[s]=e.getImage(s);return Promise.all(n)})}function V5(e,t){let n;return n=e.blob?GeoTIFF.fromBlob(e.blob):e.overviews?GeoTIFF.fromUrls(e.url,e.overviews,t):GeoTIFF.fromUrl(e.url,t),n.then(B5)}function da(e,t,n,s,o){if(Array.isArray(e)){const i=e.length;if(!Array.isArray(t)||i!=t.length){const e=new Error(s);throw o(e),e}for(let a=0;a<i;++a)da(e[a],t[a],n,s,o)}else if(Math.abs(e-t)>n*e)throw new Error(s)}function $5(e){return e instanceof Int8Array?127:e instanceof Uint8Array||e instanceof Uint8ClampedArray?255:e instanceof Int16Array?32767:e instanceof Uint16Array?65535:e instanceof Int32Array?2147483647:e instanceof Uint32Array?4294967295:e instanceof Float32Array?34e37:255}class Y2 extends A3{constructor(e){super({state:"loading",tileGrid:null,projection:e.projection||null,opaque:e.opaque,transition:e.transition,interpolate:!1!==e.interpolate,wrapX:e.wrapX}),this.sourceInfo_=e.sources;const t=this.sourceInfo_.length;this.sourceOptions_=e.sourceOptions,this.sourceImagery_=new Array(t),this.sourceMasks_=new Array(t),this.resolutionFactors_=new Array(t),this.samplesPerPixel_,this.nodataValues_,this.metadata_,this.normalize_=!1!==e.normalize,this.addAlpha_=!1,this.error_=null,this.convertToRGB_=e.convertToRGB||!1,this.setKey(this.sourceInfo_.map(e=>e.url).join(","));const n=this,s=new Array(t);for(let e=0;e<t;++e)s[e]=V5(this.sourceInfo_[e],this.sourceOptions_);Promise.all(s).then(function(e){n.configure_(e)}).catch(function(e){Mo(e),n.error_=e,n.setState("error")})}getError(){return this.error_}determineProjection(e){const t=e[0];for(let e=t.length-1;e>=0;--e){const n=H5(t[e]);if(n){this.projection=n;break}}}configure_(e){let n,o,i,a,t;const c=new Array(e.length),r=new Array(e.length),l=new Array(e.length);let s=0;const d=e.length;for(let u=0;u<d;++u){const f=[],p=[];e[u].forEach(e=>{4==(4&(e.fileDirectory.NewSubfileType||0))?p.push(e):f.push(e)});const h=f.length;if(p.length>0&&p.length!==h)throw new Error(`Expected one mask per image found ${p.length} masks and ${h} images`);let v,g;const b=new Array(h),j=new Array(h),m=new Array(h);r[u]=new Array(h),l[u]=new Array(h);for(let n=0;n<h;++n){const e=f[n],a=e.getGDALNoData();l[u][n]=e.getGDALMetadata(0),r[u][n]=a;const i=this.sourceInfo_[u].bands;c[u]=i?i.length:e.getSamplesPerPixel();const s=h-(n+1);v||(v=N5(e)),g||(g=R5(e));const o=P5(e,f[0]);m[s]=o[0];const t=[e.getTileWidth(),e.getTileHeight()];t[0]!==t[1]&&t[1]<256&&(t[0]=256,t[1]=256),b[s]=t;const d=o[0]/Math.abs(o[1]);j[s]=[t[0],t[1]/d]}if(n?ce(n,v,n):n=v,o?da(o,g,0,`Origin mismatch for source ${u}, got [${g}] but expected [${o}]`,this.viewRejector):o=g,t){t.length-s>m.length&&(s=t.length-m.length);const e=t[t.length-1]/m[m.length-1];this.resolutionFactors_[u]=e;const n=m.map(t=>t*e),o=`Resolution mismatch for source ${u}, got [${n}] but expected [${t}]`;da(t.slice(s,t.length),n,.02,o,this.viewRejector)}else t=m,this.resolutionFactors_[u]=1;i?da(i.slice(s,i.length),j,.01,`Tile size mismatch for source ${u}`,this.viewRejector):i=j,a?da(a.slice(s,a.length),b,0,`Tile size mismatch for source ${u}`,this.viewRejector):a=b,this.sourceImagery_[u]=f.reverse(),this.sourceMasks_[u]=p.reverse()}for(let e=0,s=this.sourceImagery_.length;e<s;++e){const n=this.sourceImagery_[e];for(;n.length<t.length;)n.unshift(void 0)}this.getProjection()||this.determineProjection(e),this.samplesPerPixel_=c,this.nodataValues_=r,this.metadata_=l;t:for(let e=0;e<d;++e){if(void 0!==this.sourceInfo_[e].nodata){this.addAlpha_=!0;break}if(this.sourceMasks_[e].length){this.addAlpha_=!0;break}const t=r[e],n=this.sourceInfo_[e].bands;if(n){for(let e=0;e<n.length;++e)if(null!==t[n[e]-1]){this.addAlpha_=!0;break t}}else for(let e=0;e<t.length;++e)if(null!==t[e]){this.addAlpha_=!0;break t}}let u=this.addAlpha_?1:0;for(let e=0;e<d;++e)u+=c[e];this.bandCount=u;const h=new tn({extent:n,minZoom:s,origin:o,resolutions:t,tileSizes:i});this.tileGrid=h,this.setTileSizes(a),this.setLoader(this.loadTile_.bind(this)),this.setState("ready"),2===t.length?t=[t[0],t[1],t[1]/2]:1===t.length&&(t=[2*t[0],t[0],t[0]/2]),this.viewResolver({showFullExtent:!0,projection:this.projection,resolutions:t,center:un(_e(n),this.projection),extent:Tt(n,this.projection),zoom:1})}loadTile_(e,t,n){const s=this.getTileSize(e),i=this.sourceImagery_.length,o=new Array(2*i),a=this.nodataValues_,c=this.sourceInfo_,r=(n1||(n1=new GeoTIFF.Pool),n1);for(let l=0;l<i;++l){const d=c[l],u=this.resolutionFactors_[l],f=[Math.round(t*(s[0]*u)),Math.round(n*(s[1]*u)),Math.round((t+1)*(s[0]*u)),Math.round((n+1)*(s[1]*u))],m=this.sourceImagery_[l][e];let h,p;d.bands&&(h=d.bands.map(function(e){return e-1})),p="nodata"in d&&null!==d.nodata?d.nodata:h?h.map(function(e){return a[l][e]}):a[l];const g={window:f,width:s[0],height:s[1],samples:h,fillValue:p,pool:r,interleave:!1};T5(this.convertToRGB_,m)?o[l]=m.readRGB(g):o[l]=m.readRasters(g);const v=i+l,b=this.sourceMasks_[l][e];b?o[v]=b.readRasters({window:f,width:s[0],height:s[1],samples:[0],pool:r,interleave:!1}):o[v]=Promise.resolve(null)}return Promise.all(o).then(this.composeTile_.bind(this,s)).catch(function(e){throw Mo(e),e})}composeTile_(e,t){const h=this.metadata_,f=this.sourceInfo_,l=this.sourceImagery_.length,m=this.bandCount,u=this.samplesPerPixel_,d=this.nodataValues_,i=this.normalize_,a=this.addAlpha_,c=e[0]*e[1],r=c*m;let s;s=i?new Uint8Array(r):new Float32Array(r);let n=0;for(let e=0;e<c;++e){let r=a;for(let c=0;c<l;++c){const m=f[c];let g,b,p=m.min,v=m.max;if(i){const e=h[c][0];void 0===p&&(p=e&&h3 in e?parseFloat(e[h3]):(o=t[c][0])instanceof Int8Array?-128:o instanceof Int16Array?-32768:o instanceof Int32Array?-2147483648:o instanceof Float32Array?12e-39:0),void 0===v&&(v=e&&m3 in e?parseFloat(e[m3]):$5(t[c][0])),g=255/(v-p),b=-p*g}for(let o=0;o<u[c];++o){const l=t[c][o][e];let h;if(h=i?y(g*l+b,0,255):l,a){let e=m.nodata;if(void 0===e){let t;t=m.bands?m.bands[o]-1:o,e=d[c][t]}const t=isNaN(e);(!t&&l!==e||t&&!isNaN(l))&&(r=!1,s[n]=h)}else s[n]=h;n++}if(!r){const n=t[l+c];n&&!n[0][e]&&(r=!0)}}a&&(r||(s[n]=255),n++)}var o;return s}}Y2.prototype.getView;let h1=class extends Qo{constructor(e,t,n,s,o,i,a){super(t,n,s,o,i,a),this.zoomifyImage_=null,this.tileSize_=e}getImage(){if(this.zoomifyImage_)return this.zoomifyImage_;const e=super.getImage();if(this.state==L){const t=this.tileSize_;if(e.width==t[0]&&e.height==t[1])return this.zoomifyImage_=e,e;const n=K(t[0],t[1]);return n.drawImage(e,0,0),this.zoomifyImage_=n.canvas,n.canvas}return e}};const _n="version1",ma="version2",zs="version3",Ts={};Ts[_n]={level0:{supports:[],formats:[],qualities:["native"]},level1:{supports:["regionByPx","sizeByW","sizeByH","sizeByPct"],formats:["jpg"],qualities:["native"]},level2:{supports:["regionByPx","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByWh"],formats:["jpg","png"],qualities:["native","color","grey","bitonal"]}},Ts[ma]={level0:{supports:[],formats:["jpg"],qualities:["default"]},level1:{supports:["regionByPx","sizeByW","sizeByH","sizeByPct"],formats:["jpg"],qualities:["default"]},level2:{supports:["regionByPx","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByDistortedWh","sizeByWh"],formats:["jpg","png"],qualities:["default","bitonal"]}},Ts[zs]={level0:{supports:[],formats:["jpg"],qualities:["default"]},level1:{supports:["regionByPx","regionSquare","sizeByW","sizeByH","sizeByWh"],formats:["jpg"],qualities:["default"]},level2:{supports:["regionByPx","regionSquare","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByWh"],formats:["jpg","png"],qualities:["default"]}},Ts.none={none:{supports:[],formats:[],qualities:[]}};const q5=/^https?:\/\/library\.stanford\.edu\/iiif\/image-api\/(?:1\.1\/)?compliance\.html#level[0-2]$/,P2=/^https?:\/\/iiif\.io\/api\/image\/2\/level[0-2](?:\.json)?$/,Q5=/(^https?:\/\/iiif\.io\/api\/image\/3\/level[0-2](?:\.json)?$)|(^level[0-2]$)/,hr={};hr[_n]=function(e){let t=e.getComplianceLevelSupportedFeatures();return void 0===t&&(t=Ts[_n].level0),{url:void 0===e.imageInfo["@id"]?void 0:e.imageInfo["@id"].replace(/\/?(?:info\.json)?$/g,""),supports:t.supports,formats:[...t.formats,void 0===e.imageInfo.formats?[]:e.imageInfo.formats],qualities:[...t.qualities,void 0===e.imageInfo.qualities?[]:e.imageInfo.qualities],resolutions:e.imageInfo.scale_factors,tileSize:void 0!==e.imageInfo.tile_width?void 0!==e.imageInfo.tile_height?[e.imageInfo.tile_width,e.imageInfo.tile_height]:[e.imageInfo.tile_width,e.imageInfo.tile_width]:null!=e.imageInfo.tile_height?[e.imageInfo.tile_height,e.imageInfo.tile_height]:void 0}},hr[ma]=function(e){const t=e.getComplianceLevelSupportedFeatures(),n=Array.isArray(e.imageInfo.profile)&&e.imageInfo.profile.length>1,s=n&&e.imageInfo.profile[1].supports?e.imageInfo.profile[1].supports:[],o=n&&e.imageInfo.profile[1].formats?e.imageInfo.profile[1].formats:[],i=n&&e.imageInfo.profile[1].qualities?e.imageInfo.profile[1].qualities:[];return{url:e.imageInfo["@id"].replace(/\/?(?:info\.json)?$/g,""),sizes:void 0===e.imageInfo.sizes?void 0:e.imageInfo.sizes.map(function(e){return[e.width,e.height]}),tileSize:void 0===e.imageInfo.tiles?void 0:[e.imageInfo.tiles.map(function(e){return e.width})[0],e.imageInfo.tiles.map(function(e){return void 0===e.height?e.width:e.height})[0]],resolutions:void 0===e.imageInfo.tiles?void 0:e.imageInfo.tiles.map(function(e){return e.scaleFactors})[0],supports:[...t.supports,...s],formats:[...t.formats,...o],qualities:[...t.qualities,...i]}},hr[zs]=function(e){const t=e.getComplianceLevelSupportedFeatures(),n=void 0===e.imageInfo.extraFormats?t.formats:[...t.formats,...e.imageInfo.extraFormats],s=void 0!==e.imageInfo.preferredFormats&&Array.isArray(e.imageInfo.preferredFormats)&&e.imageInfo.preferredFormats.length>0?e.imageInfo.preferredFormats.filter(function(e){return["jpg","png","gif"].includes(e)}).reduce(function(e,t){return void 0===e&&n.includes(t)?t:e},void 0):void 0;return{url:e.imageInfo.id,sizes:void 0===e.imageInfo.sizes?void 0:e.imageInfo.sizes.map(function(e){return[e.width,e.height]}),tileSize:void 0===e.imageInfo.tiles?void 0:[e.imageInfo.tiles.map(function(e){return e.width})[0],e.imageInfo.tiles.map(function(e){return e.height})[0]],resolutions:void 0===e.imageInfo.tiles?void 0:e.imageInfo.tiles.map(function(e){return e.scaleFactors})[0],supports:void 0===e.imageInfo.extraFeatures?t.supports:[...t.supports,...e.imageInfo.extraFeatures],formats:n,qualities:void 0===e.imageInfo.extraQualities?t.qualities:[...t.qualities,...e.imageInfo.extraQualities],preferredFormat:s}};function _a(e){return e.toLocaleString("en",{maximumFractionDigits:10})}class C2 extends wi{constructor(e,t,n,s,o,i,a){let r=e.getExtent();r&&e.canWrapX()&&(r=r.slice(),r[0]=-1/0,r[2]=1/0);let c=t.getExtent();c&&t.canWrapX()&&(c=c.slice(),c[0]=-1/0,c[2]=1/0);const d=c?ce(n,c):n,h=uo(e,t,_e(d),s),m=new qc(e,t,d,r,.5*h,s),f=m.calculateSourceExtent(),l=Ft(f)?null:i(f,h,o),g=l?u.IDLE:u.EMPTY,p=l?l.getPixelRatio():1;super(n,s,p,g),this.targetProj_=t,this.maxSourceExtent_=r,this.triangulation_=m,this.targetResolution_=s,this.targetExtent_=n,this.sourceImage_=l,this.sourcePixelRatio_=p,this.interpolate_=a,this.canvas_=null,this.sourceListenerKey_=null}disposeInternal(){this.state==u.LOADING&&this.unlistenSource_(),super.disposeInternal()}getImage(){return this.canvas_}getProjection(){return this.targetProj_}reproject_(){const e=this.sourceImage_.getState();if(e==u.LOADED){const e=b(this.targetExtent_)/this.targetResolution_,t=W(this.targetExtent_)/this.targetResolution_;this.canvas_=Gc(e,t,this.sourcePixelRatio_,xi(this.sourceImage_.getResolution()),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_,!0)}this.state=e,this.changed()}load(){if(this.state==u.IDLE){this.state=u.LOADING,this.changed();const e=this.sourceImage_.getState();e==u.LOADED||e==u.ERROR?this.reproject_():(this.sourceListenerKey_=m(this.sourceImage_,A,function(){const t=this.sourceImage_.getState();t!=u.LOADED&&t!=u.ERROR||(this.unlistenSource_(),this.reproject_())},this),this.sourceImage_.load())}}unlistenSource_(){T(this.sourceListenerKey_),this.sourceListenerKey_=null}}const Et=4,e7="imageloadstart",t7="imageloadend",n7="imageloaderror";class _2 extends ue{constructor(e,t){super(e),this.image=t}}class Vn extends jo{constructor(e){super({attributions:e.attributions,projection:e.projection,state:e.state,interpolate:void 0===e.interpolate||e.interpolate}),this.on,this.once,this.un,this.loader=e.loader||null,this.resolutions_=void 0!==e.resolutions?e.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0,this.image=null,this.wantedExtent_,this.wantedResolution_,this.static_=!!e.loader&&0===e.loader.length,this.wantedProjection_=null}getResolutions(){return this.resolutions_}setResolutions(e){this.resolutions_=e}findNearestResolution(e){const t=this.getResolutions();return t&&(e=t[ci(t,e,0)]),e}getImage(e,t,n,s){const o=this.getProjection();if(!o||!s||Oe(o,s))return o&&(s=o),this.getImageInternal(e,t,n,s);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&Oe(this.reprojectedImage_.getProjection(),s)&&this.reprojectedImage_.getResolution()==t&&Ue(this.reprojectedImage_.getExtent(),e))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new C2(o,s,e,t,n,(e,t,n)=>this.getImageInternal(e,t,n,o),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}getImageInternal(e,t,n,s){if(this.loader){const o=Ca(e,t,n,1),i=this.findNearestResolution(t);if(this.image&&(this.static_||this.wantedProjection_===s&&(this.wantedExtent_&&xe(this.wantedExtent_,o)||xe(this.image.getExtent(),o))&&(this.wantedResolution_&&xi(this.wantedResolution_)===i||xi(this.image.getResolution())===i)))return this.image;this.wantedProjection_=s,this.wantedExtent_=o,this.wantedResolution_=i,this.image=new wi(o,i,n,this.loader),this.image.addEventListener(A,this.handleImageChange.bind(this))}return this.image}handleImageChange(e){const n=e.target;let t;switch(n.getState()){case u.LOADING:this.loading=!0,t=e7;break;case u.LOADED:this.loading=!1,t=t7;break;case u.ERROR:this.loading=!1,t=n7;break;default:return}this.hasListener(t)&&this.dispatchEvent(new _2(t,n))}}function xa(e,t){e.getImage().src=t}function Ca(e,t,n,s){const o=t/n,r=_e(e),i=en(b(e)/o,Et),a=en(W(e)/o,Et);return Po(r,o,0,[i+2*en((s-1)*i/2,Et),a+2*en((s-1)*a/2,Et)])}function Wn(e,t){const n=[];Object.keys(t).forEach(function(e){null!==t[e]&&void 0!==t[e]&&n.push(e+"="+encodeURIComponent(t[e]))});const s=n.join("&");return e=e.replace(/[?&]$/,""),(e+=e.includes("?")?"&":"?")+s}function T1(e,t,n,s,o,i){const a=o.getCode().split(/:(?=\d+$)/).pop(),r=n/s,c=[la(b(t)/r,Et),la(W(t)/r,Et)];return i.SIZE=c[0]+","+c[1],i.BBOX=t.join(","),i.BBOXSR=a,i.IMAGESR=a,i.DPI=Math.round(i.DPI?i.DPI*s:90*s),Wn(e.replace(/MapServer\/?$/,"MapServer/export").replace(/ImageServer\/?$/,"ImageServer/exportImage"),i)}function l2(e){const t=e.load?e.load:hn,n=d(e.projection||"EPSG:3857");return function(s,o,i){i=e.hidpi?i:1;const a={F:"image",FORMAT:"PNG32",TRANSPARENT:!0};Object.assign(a,e.params),s=Ca(s,o,i,e.ratio);const c=T1(e.url,s,o,i,n,a),r=new Image;return null!==e.crossOrigin&&(r.crossOrigin=e.crossOrigin),t(r,c).then(e=>{const t=b(s)/e.width*i;return{image:e,extent:s,resolution:t,pixelRatio:i}})}}function a7(e,t,n,s,o,i,a){const l=function(e,t,n,s){const o=b(e),i=W(e),a=t[0],r=t[1],c=.0254/s;return r*o>a*i?o*n/(a*c):i*n/(r*c)}(n,s,i,a),r=_e(n),c={OPERATION:o?"GETDYNAMICMAPOVERLAYIMAGE":"GETMAPIMAGE",VERSION:"2.0.0",LOCALE:"en",CLIENTAGENT:"ol/source/ImageMapGuide source",CLIP:"1",SETDISPLAYDPI:a,SETDISPLAYWIDTH:Math.round(s[0]),SETDISPLAYHEIGHT:Math.round(s[1]),SETVIEWSCALE:l,SETVIEWCENTERX:r[0],SETVIEWCENTERY:r[1]};return Object.assign(c,t),Wn(e,c)}function r2(e){const t=e.load||hn;return function(n,s,o){const i=new Image;null!==e.crossOrigin&&(i.crossOrigin=e.crossOrigin);const a=b(n=Ca(n,s,o,e.ratio))/s,r=W(n)/s,c=[a*o,r*o],l=a7(e.url,e.params,n,c,e.useOverlay,e.metersPerUnit||1,e.displayDpi||96);return t(i,l).then(e=>({image:e,extent:n,pixelRatio:o}))}}function a2(e){const s=e.load||hn,t=e.imageExtent,n=new Image;return null!==e.crossOrigin&&(n.crossOrigin=e.crossOrigin),()=>s(n,e.url).then(e=>{const s=b(t)/e.width,n=W(t)/e.height;return{image:e,extent:t,resolution:s!==n?[s,n]:n,pixelRatio:1}})}const La="1.3.0",o2=[101,101];function H1(e,t,n,s,o){o.WIDTH=n[0],o.HEIGHT=n[1];const r=s.getAxisOrientation();let i;const a=xr(o.VERSION,"1.3")>=0;return o[a?"CRS":"SRS"]=s.getCode(),i=a&&"ne"==r.substr(0,2)?[t[1],t[0],t[3],t[2]]:t,o.BBOX=i.join(","),Wn(e,o)}function Al(e,t,n,s,o,i,a){i=Object.assign({REQUEST:"GetMap"},i);const r=t/n,c=[la(b(e)/r,Et),la(W(e)/r,Et)];if(1!=n)switch(a){case"geoserver":const e=90*n+.5|0;"FORMAT_OPTIONS"in i?i.FORMAT_OPTIONS+=";dpi:"+e:i.FORMAT_OPTIONS="dpi:"+e;break;case"mapserver":i.MAP_RESOLUTION=90*n;break;case"carmentaserver":case"qgis":i.DPI=90*n;break;default:throw new Error("Unknown `serverType` configured")}return H1(o,e,c,s,i)}function Pa(e,t){return Object.assign({REQUEST:t,SERVICE:"WMS",VERSION:La,FORMAT:"image/png",STYLES:"",TRANSPARENT:!0},e)}function t2(e){const t=void 0===e.hidpi||e.hidpi,n=d(e.projection||"EPSG:3857"),s=e.ratio||1.5,o=e.load||hn;return(i,a,r)=>{i=Ca(i,a,r,s),1==r||t&&void 0!==e.serverType||(r=1);const l=Al(i,a,r,n,e.url,Pa(e.params,"GetMap"),e.serverType),c=new Image;return null!==e.crossOrigin&&(c.crossOrigin=e.crossOrigin),o(c,l).then(e=>({image:e,extent:i,pixelRatio:r}))}}function e2(e,t,n){if(void 0===e.url)return;const a=d(e.projection||"EPSG:3857"),o=Po(t,n,0,o2),s={QUERY_LAYERS:e.params.LAYERS,INFO_FORMAT:"application/json"};Object.assign(s,Pa(e.params,"GetFeatureInfo"),e.params);const r=Ps((t[0]-o[0])/n,Et),c=Ps((o[3]-t[1])/n,Et),i=xr(s.VERSION,"1.3")>=0;return s[i?"I":"X"]=r,s[i?"J":"Y"]=c,H1(e.url,o,o2,a,s)}function Q0(e,t){if(void 0===e.url)return;const n={SERVICE:"WMS",VERSION:La,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(void 0===e.params||void 0===e.params.LAYER){const t=e.params.LAYERS;if(!!Array.isArray(t)&&1!==t.length)return;n.LAYER=t}if(void 0!==t){const s=d(e.projection||"EPSG:3857").getMetersPerUnit()||1,o=28e-5;n.SCALE=t*s/o}return Object.assign(n,e.params),Wn(e.url,n)}const c7={"image/png":!0,"image/jpeg":!0,"image/gif":!0,"image/webp":!0},h7={"application/vnd.mapbox-vector-tile":!0,"application/geo+json":!0};function q1(e,t){if(!t.length)return e;const n=new URL(e,"file:/");if(n.pathname.split("/").includes("collections"))return Mo('The "collections" query parameter cannot be added to collection endpoints'),e;const s=t.map(e=>encodeURIComponent(e)).join(",");return n.searchParams.append("collections",s),`${e.split("?")[0]}?${decodeURIComponent(n.searchParams.toString())}`}function q0(e,t,n){let s,o;for(let i=0;i<e.length;++i){const n=e[i];if("item"===n.rel){if(n.type===t){s=n.href;break}(c7[n.type]||!o&&n.type.startsWith("image/"))&&(o=n.href)}}if(!s){if(!o)throw new Error('Could not find "item" link');s=o}return n&&(s=q1(s,n)),s}function W0(e,t,n,s){let o,i;const a={};for(let s=0;s<e.length;++s){const n=e[s];if(a[n.type]=n.href,"item"===n.rel){if(n.type===t){o=n.href;break}h7[n.type]&&(i=n.href)}}if(!o&&n)for(let e=0;e<n.length;++e){const t=n[e];if(a[t]){o=a[t];break}}if(!o){if(!i)throw new Error('Could not find "item" link');o=i}return s&&(o=q1(o,s)),o}function V0(e,t,n,s){let c=e.projection;if(!c&&(c=d(t.crs),!c))throw new Error(`Unsupported CRS: ${t.crs}`);const m=t.orderedAxes,v="en"!==(m?m.slice(0,2).map(e=>e.replace(/E|X|Lon/i,"e").replace(/N|Y|Lat/i,"n")).join(""):c.getAxisOrientation().substr(0,2)),r=t.tileMatrices,l={};for(let e=0;e<r.length;++e){const t=r[e];l[t.id]=t}const u={},i=[];if(s)for(let e=0;e<s.length;++e){const t=s[e],n=t.tileMatrix;i.push(n),u[n]=t}else for(let e=0;e<r.length;++e){const t=r[e].id;i.push(t)}const a=i.length,o=new Array(a),f=new Array(a),p=new Array(a),g=new Array(a),h=[-1/0,-1/0,1/0,1/0];for(let e=0;e<a;++e){const r=i[e],t=l[r],s=t.pointOfOrigin;o[e]=v?[s[1],s[0]]:s,f[e]=t.cellSize,p[e]=[t.matrixWidth,t.matrixHeight],g[e]=[t.tileWidth,t.tileHeight];const n=u[r];if(n){const r=t.cellSize*t.tileWidth,c=o[e][0]+n.minTileCol*r,l=o[e][0]+(n.maxTileCol+1)*r,s=t.cellSize*t.tileHeight;let i,a;"bottomLeft"===t.cornerOfOrigin?(i=o[e][1]+n.minTileRow*s,a=o[e][1]+(n.maxTileRow+1)*s):(i=o[e][1]-(n.maxTileRow+1)*s,a=o[e][1]-n.minTileRow*s),ce(h,[c,i,l,a],h)}}const b=new tn({origins:o,resolutions:f,sizes:p,tileSizes:g,extent:s?h:void 0}),j=e.context,y=e.url;return{grid:b,urlTemplate:n,urlFunction:function(e){if(!e)return;const r=i[e[0]],c=l[r],d="bottomLeft"===c.cornerOfOrigin,a={tileMatrix:r,tileCol:e[1],tileRow:d?-e[2]-1:e[2]};if(s){const e=u[c.id];if(a.tileCol<e.minTileCol||a.tileCol>e.maxTileCol||a.tileRow<e.minTileRow||a.tileRow>e.maxTileRow)return}Object.assign(a,j);const h=n.replace(/\{(\w+?)\}/g,function(e,t){return a[t]});return Md(y,h)}}}function Q1(e){return Sd(e.url).then(function(t){return function(e,t){const s=t.tileMatrixSetLimits;let n;if("map"===t.dataType)n=q0(t.links,e.mediaType,e.collections);else{if("vector"!==t.dataType)throw new Error('Expected tileset data type to be "map" or "vector"');n=W0(t.links,e.mediaType,e.supportedMediaTypes,e.collections)}if(t.tileMatrixSet)return V0(e,t.tileMatrixSet,n,s);const o=t.links.find(e=>"http://www.opengis.net/def/rel/ogc/1.0/tiling-scheme"===e.rel);if(!o)throw new Error("Expected http://www.opengis.net/def/rel/ogc/1.0/tiling-scheme link or tileMatrixSet");const i=o.href;return Sd(Md(e.url,i)).then(function(t){return V0(e,t,n,s)})}(e,t)})}class D0 extends Ec{constructor(e){const t=e.projection||"EPSG:3857",n=e.extent||Yt(t),s=e.tileGrid||Mn({extent:n,maxResolution:e.maxResolution,maxZoom:void 0!==e.maxZoom?e.maxZoom:22,minZoom:e.minZoom,tileSize:e.tileSize||512});super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,interpolate:!0,opaque:!1,projection:t,state:e.state,tileGrid:s,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:M0,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:void 0===e.wrapX||e.wrapX,transition:e.transition,zDirection:void 0===e.zDirection?1:e.zDirection}),this.format_=e.format?e.format:null,this.sourceTileCache=new di(this.tileCache.highWaterMark),this.overlaps_=null==e.overlaps||e.overlaps,this.tileClass=e.tileClass?e.tileClass:Bf,this.tileGrids_={}}getFeaturesInExtent(e){const t=[],n=this.tileCache;if(0===n.getCount())return t;const s=hd(n.peekFirstKey())[0],o=this.tileGrid;return n.forEach(function(n){if(n.tileCoord[0]!==s||n.getState()!==L)return;const i=n.getSourceTiles();for(let n=0,a=i.length;n<a;++n){const s=i[n],r=s.tileCoord;if(U(e,o.getTileCoordExtent(r))){const n=s.getFeatures();if(n)for(let s=0,i=n.length;s<i;++s){const o=n[s],a=o.getGeometry();U(e,a.getExtent())&&t.push(o)}}}}),t}getOverlaps(){return this.overlaps_}clear(){this.tileCache.clear(),this.sourceTileCache.clear()}expireCache(e,t){const n=this.getTileCacheForProjection(e),s=Object.keys(t).reduce((e,t)=>{const o=G8(t),s=n.peek(o);if(s){const t=s.sourceTiles;for(let n=0,s=t.length;n<s;++n)e[t[n].getKey()]=!0}return e},{});super.expireCache(e,t),this.sourceTileCache.expireCache(s)}getSourceTiles(e,t,n){if(n.getState()===ne){n.setState(gt);const i=n.wrappedTileCoord,a=this.getTileGridForProjection(t),s=a.getTileCoordExtent(i),l=i[0],r=a.getResolution(l);Fe(s,-r,s);const o=this.tileGrid,c=o.getExtent();c&&ce(s,c,s);const d=o.getZForResolution(r,this.zDirection);o.forEachTileCoord(s,d,s=>{const a=this.tileUrlFunction(s,e,t),i=this.sourceTileCache.containsKey(a)?this.sourceTileCache.get(a):new this.tileClass(s,a?ne:J,a,this.format_,this.tileLoadFunction);n.sourceTiles.push(i);const r=i.getState();if(r<L){const e=t=>{this.handleTileChange(t);const s=i.getState();if(s===L||s===Z){const t=i.getKey();t in n.errorTileKeys?i.getState()===L&&delete n.errorTileKeys[t]:n.loadingSourceTiles--,s===Z?n.errorTileKeys[t]=!0:i.removeEventListener(A,e),0===n.loadingSourceTiles&&n.setState(it(n.errorTileKeys)?L:Z)}};i.addEventListener(A,e),n.loadingSourceTiles++}r===ne&&(i.extent=o.getTileCoordExtent(s),i.projection=t,i.resolution=o.getResolution(s[0]),this.sourceTileCache.set(a,i),i.load())}),n.loadingSourceTiles||n.setState(n.sourceTiles.some(e=>e.getState()===Z)?Z:L)}return n.sourceTiles}getTile(e,t,n,s,o){const c=St(e,t,n),u=this.getKey();let r;if(this.tileCache.containsKey(c)&&(r=this.tileCache.get(c),r.key===u))return r;const h=[e,t,n];let i=this.getTileCoordForTileUrlFunction(h,o);const m=this.getTileGrid().getExtent(),l=this.getTileGridForProjection(o);if(i&&m){const t=l.getTileCoordExtent(i);Fe(t,-l.getResolution(e),t),U(m,t)||(i=null)}let d=!0;if(null!==i){const n=this.tileGrid,a=l.getResolution(e),r=n.getZForResolution(a,1),t=l.getTileCoordExtent(i);Fe(t,-a,t),n.forEachTileCoord(t,r,e=>{d=d&&!this.tileUrlFunction(e,s,o)})}const a=new Kf(h,d?J:ne,i,this.getSourceTiles.bind(this,s,o));return a.key=u,r?(a.interimTile=r,a.refreshInterimChain(),this.tileCache.replace(c,a)):this.tileCache.set(c,a),a}getTileGridForProjection(e){const n=e.getCode();let t=this.tileGrids_[n];if(!t){const s=this.tileGrid,e=s.getResolutions().slice(),o=e.map(function(e,t){return s.getOrigin(t)}),i=e.map(function(e,t){return s.getTileSize(t)}),a=K1+1;for(let t=e.length;t<a;++t)e.push(e[t-1]/2),o.push(o[t-1]),i.push(i[t-1]);t=new tn({extent:s.getExtent(),origins:o,resolutions:e,tileSizes:i}),this.tileGrids_[n]=t}return t}getTilePixelRatio(e){return e}getTilePixelSize(e,t,n){const s=X(this.getTileGridForProjection(n).getTileSize(e),this.tmpSize);return[Math.round(s[0]*t),Math.round(s[1]*t)]}updateCacheSize(e,t){super.updateCacheSize(2*e,t),this.sourceTileCache.highWaterMark=this.getTileCacheForProjection(t).highWaterMark}}function M0(e,t){e.setLoader(function(n,s,o){Od(t,e.getFormat(),n,s,o,e.onLoad.bind(e),e.onError.bind(e))})}const e4='&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.';class S0 extends ss{constructor(e){super(e=e||{})}}class n4 extends co{constructor(e){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=e}getFeatures(){return g()}getData(){return null}prepareFrame(){return g()}renderFrame(){return g()}loadedTileCallback(e,t,n){e[t]||(e[t]={}),e[t][n.tileCoord.toString()]=n}createLoadedTileFinder(e,t,n){return(s,o)=>{const i=this.loadedTileCallback.bind(this,n,s);return e.forEachLoadedTile(t,s,o,i)}}forEachFeatureAtCoordinate(){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(e){const t=e.target;t.getState()!==u.LOADED&&t.getState()!==u.ERROR||this.renderIfReadyAndVisible()}loadImage(e){let t=e.getState();return t!=u.LOADED&&t!=u.ERROR&&e.addEventListener(A,this.boundHandleImageChange_),t==u.IDLE&&(e.load(),t=e.getState()),t==u.LOADED}renderIfReadyAndVisible(){const e=this.getLayer();e&&e.getVisible()&&"ready"===e.getSourceState()&&e.changed()}renderDeferred(){}disposeInternal(){delete this.layer_,super.disposeInternal()}}class $a{constructor(){this.instructions_=[],this.zIndex=0,this.offset_=0,this.context_=new Proxy(Ei(),{get:(e,t)=>{if("function"==typeof Ei()[t])return this.instructions_[this.zIndex+this.offset_]||(this.instructions_[this.zIndex+this.offset_]=[]),this.instructions_[this.zIndex+this.offset_].push(t),this.pushMethodArgs_},set:(e,t,n)=>(this.instructions_[this.zIndex+this.offset_]||(this.instructions_[this.zIndex+this.offset_]=[]),this.instructions_[this.zIndex+this.offset_].push(t,n),!0)})}pushMethodArgs_=(...e)=>(this.instructions_[this.zIndex+this.offset_].push(e),this);pushFunction(e){this.instructions_[this.zIndex+this.offset_].push(e)}getContext(){return this.context_}draw(e){this.instructions_.forEach(t=>{for(let s=0,i=t.length;s<i;++s){const n=t[s];if("function"==typeof n){n(e);continue}const o=t[++s];if("function"==typeof e[n])e[n](...o);else{if("function"==typeof o){e[n]=o(e);continue}e[n]=o}}})}clear(){this.instructions_.length=0,this.zIndex=0,this.offset_=0}offset(){this.offset_=this.instructions_.length,this.zIndex=0}}const o4=[];let Oo=null;class Wa extends n4{constructor(e){super(e),this.container=null,this.renderedResolution,this.tempTransform=[1,0,0,1,0,0],this.pixelTransform=[1,0,0,1,0,0],this.inversePixelTransform=[1,0,0,1,0,0],this.context=null,this.deferredContext_=null,this.containerReused=!1,this.pixelContext_=null,this.frameState=null}getImageData(e,t,n){let s;Oo||(Oo=K(1,1,void 0,{willReadFrequently:!0})),Oo.clearRect(0,0,1,1);try{Oo.drawImage(e,t,n,1,1,0,0,1,1),s=Oo.getImageData(0,0,1,1).data}catch{return Oo=null,null}return s}getBackground(e){let t=this.getLayer().getBackground();return"function"==typeof t&&(t=t(e.viewState.resolution)),t||void 0}useContainer(e,t,n){const i=this.getLayer().getClassName();let o,s;if(e&&e.className===i&&(!n||e&&e.style.backgroundColor&&Ct(mt(e.style.backgroundColor),mt(n)))){const t=e.firstElementChild;t instanceof HTMLCanvasElement&&(s=t.getContext("2d"))}if(s&&s.canvas.style.transform===t?(this.container=e,this.context=s,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){o=document.createElement("div"),o.className=i;let e=o.style;e.position="absolute",e.width="100%",e.height="100%",s=K();const t=s.canvas;o.appendChild(t),e=t.style,e.position="absolute",e.left="0",e.transformOrigin="top left",this.container=o,this.context=s}this.containerReused||!n||this.container.style.backgroundColor||(this.container.style.backgroundColor=n)}clipUnrotated(e,t,n){const s=ht(n),o=Rs(n),i=Ws(n),a=xn(n);R(t.coordinateToPixelTransform,s),R(t.coordinateToPixelTransform,o),R(t.coordinateToPixelTransform,i),R(t.coordinateToPixelTransform,a);const r=this.inversePixelTransform;R(r,s),R(r,o),R(r,i),R(r,a),e.save(),e.beginPath(),e.moveTo(Math.round(s[0]),Math.round(s[1])),e.lineTo(Math.round(o[0]),Math.round(o[1])),e.lineTo(Math.round(i[0]),Math.round(i[1])),e.lineTo(Math.round(a[0]),Math.round(a[1])),e.clip()}prepareContainer(e,t){const a=e.extent,r=e.viewState.resolution,c=e.viewState.rotation,n=e.pixelRatio,s=Math.round(b(a)/r*n),o=Math.round(W(a)/r*n);Le(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/n,1/n,c,-s/2,-o/2),Kt(this.inversePixelTransform,this.pixelTransform);const i=yd(this.pixelTransform);if(this.useContainer(t,i,this.getBackground(e)),!this.containerReused){const e=this.context.canvas;e.width!=s||e.height!=o?(e.width=s,e.height=o):this.context.clearRect(0,0,s,o),i!==e.style.transform&&(e.style.transform=i)}}dispatchRenderEvent_(e,t,n){const s=this.getLayer();if(s.hasListener(e)){const o=new $o(e,this.inversePixelTransform,n,t);s.dispatchEvent(o)}}preRender(e,t){this.frameState=t,t.declutter||this.dispatchRenderEvent_(hl,e,t)}postRender(e,t){t.declutter||this.dispatchRenderEvent_(ui,e,t)}renderDeferredInternal(){}getRenderContext(e){return e.declutter&&!this.deferredContext_&&(this.deferredContext_=new $a),e.declutter?this.deferredContext_.getContext():this.context}renderDeferred(e){e.declutter&&(this.dispatchRenderEvent_(hl,this.context,e),e.declutter&&this.deferredContext_&&(this.deferredContext_.draw(this.context),this.deferredContext_.clear()),this.renderDeferredInternal(e),this.dispatchRenderEvent_(ui,this.context,e))}getRenderTransform(e,t,n,s,o,i,a){const c=o/2,l=i/2,r=s/t,d=-r,u=-e[0]+a,h=-e[1];return Le(this.tempTransform,c,l,r,d,-n,u,h)}disposeInternal(){delete this.frameState,super.disposeInternal()}}class r4 extends Wa{constructor(e){super(e),this.image_=null}getImage(){return this.image_?this.image_.getImage():null}prepareFrame(e){const s=e.layerStatesArray[e.layerIndex],a=e.pixelRatio,n=e.viewState,r=n.resolution,o=this.getLayer().getSource(),i=e.viewHints;let t=e.extent;if(void 0!==s.extent&&(t=ce(t,Pe(s.extent,n.projection))),!i[Ae]&&!i[ze]&&!Ft(t))if(o){const s=n.projection,e=o.getImage(t,r,a,s);e&&(this.loadImage(e)?this.image_=e:e.getState()===u.EMPTY&&(this.image_=null))}else this.image_=null;return!!this.image_}getData(e){const a=this.frameState;if(!a)return null;const c=this.getLayer(),s=R(a.pixelToCoordinateTransform,e.slice()),r=c.getExtent();if(r&&!qe(r,s))return null;const n=this.image_.getExtent(),t=this.image_.getImage(),l=b(n),o=Math.floor(t.width*((s[0]-n[0])/l));if(o<0||o>=t.width)return null;const d=W(n),i=Math.floor(t.height*((n[3]-s[1])/d));return i<0||i>=t.height?null:this.getImageData(t,o,i)}renderFrame(e,t){const r=this.image_,p=r.getExtent(),i=r.getResolution(),[f,m]=Array.isArray(i)?i:[i,i],s=r.getPixelRatio(),h=e.layerStatesArray[e.layerIndex],c=e.pixelRatio,d=e.viewState,v=d.center,g=d.resolution,O=c*f/(g*s),y=c*m/(g*s);this.prepareContainer(e,t);const w=this.context.canvas.width,_=this.context.canvas.height,n=this.getRenderContext(e);let l=!1,u=!0;if(h.extent){const t=Pe(h.extent,d.projection);u=U(t,e.extent),l=u&&!xe(t,e.extent),l&&this.clipUnrotated(n,e,t)}const o=r.getImage(),a=Le(this.tempTransform,w/2,_/2,O,y,0,s*(p[0]-v[0])/f,s*(v[1]-p[3])/m);this.renderedResolution=m*c/s;const b=o.width*a[0],j=o.height*a[3];if(this.getLayer().getSource().getInterpolate()||(n.imageSmoothingEnabled=!1),this.preRender(n,e),u&&b>=.5&&j>=.5){const t=a[4],s=a[5],e=h.opacity;1!==e&&(n.save(),n.globalAlpha=e),n.drawImage(o,0,0,+o.width,+o.height,t,s,b,j),1!==e&&n.restore()}return this.postRender(this.context,e),l&&n.restore(),n.imageSmoothingEnabled=!0,this.container}}class f0 extends S0{constructor(e){super(e)}createRenderer(){return new r4(this)}getData(e){return super.getData(e)}}Da="preload",Ma="useInterimTilesOnError";class u4 extends ss{constructor(e){e=e||{};const t=Object.assign({},e);delete t.preload,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un,this.setPreload(void 0!==e.preload?e.preload:0),this.setUseInterimTilesOnError(void 0===e.useInterimTilesOnError||e.useInterimTilesOnError)}getPreload(){return this.get(Da)}setPreload(e){this.set(Da,e)}getUseInterimTilesOnError(){return this.get(Ma)}setUseInterimTilesOnError(e){this.set(Ma,e)}getData(e){return super.getData(e)}}class h4 extends Wa{constructor(e){super(e),this.extentChanged=!0,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=[1/0,1/0,-1/0,-1/0],this.tmpTileRange_=new fi(0,0,0,0)}isDrawableTile(e){const n=this.getLayer(),t=e.getState(),s=n.getUseInterimTilesOnError();return t==L||t==J||t==Z&&!s}getTile(e,t,n,s){const a=s.pixelRatio,r=s.viewState.projection,i=this.getLayer();let o=i.getSource().getTile(e,t,n,a,r);return o.getState()==Z&&i.getUseInterimTilesOnError()&&i.getPreload()>0&&(this.newTiles_=!0),this.isDrawableTile(o)||(o=o.getInterimTile()),o}getData(e){const t=this.frameState;if(!t)return null;const r=this.getLayer(),s=R(t.pixelToCoordinateTransform,e.slice()),c=r.getExtent();if(c&&!qe(c,s))return null;const l=t.pixelRatio,d=t.viewState.projection,i=t.viewState,o=r.getRenderSource(),n=o.getTileGridForProjection(i.projection),a=o.getTilePixelRatio(t.pixelRatio);for(let e=n.getZForResolution(i.resolution);e>=n.getMinZoom();--e){const r=n.getTileCoordForCoordAndZ(s,e),t=o.getTile(e,r[1],r[2],l,d);if(!(t instanceof Qo||t instanceof Es)||t instanceof Es&&t.getState()===J)return null;if(t.getState()!==L)continue;const c=n.getOrigin(e),u=X(n.getTileSize(e)),h=n.getResolution(e),f=Math.floor(a*((s[0]-c[0])/h-r[1]*u[0])),p=Math.floor(a*((c[1]-s[1])/h-r[2]*u[1])),m=Math.round(a*o.getGutterForProjection(i.projection));return this.getImageData(t.getImage(),f+m,p+m)}return null}loadedTileCallback(e,t,n){return!!this.isDrawableTile(n)&&super.loadedTileCallback(e,t,n)}prepareFrame(){return!!this.getLayer().getSource()}renderFrame(e,t){const h=e.layerStatesArray[e.layerIndex],p=e.viewState,r=p.projection,z=p.resolution,b=p.center,x=p.rotation,m=e.pixelRatio,M=this.getLayer(),s=M.getSource(),P=s.getRevision(),i=s.getTileGridForProjection(r),o=i.getZForResolution(z,s.zDirection),l=i.getResolution(o);let j=e.extent;const N=e.viewState.resolution,u=s.getTilePixelRatio(m);this.prepareContainer(e,t);const w=this.context.canvas.width,E=this.context.canvas.height,C=h.extent&&Pe(h.extent,r);C&&(j=ce(j,Pe(h.extent,r)));const T=l*w/2/u,S=l*E/2/u,g=[b[0]-T,b[1]-S,b[0]+T,b[1]+S],_=i.getTileRangeForExtentAndZ(j,o),v={};v[o]={};const F=this.createLoadedTileFinder(s,r,v),A=this.tmpExtent,k=this.tmpTileRange_;this.newTiles_=!1;const D=x?Hr(p.center,N,x,e.size):void 0;for(let t=_.minX;t<=_.maxX;++t)for(let s=_.minY;s<=_.maxY;++s){if(x&&!i.tileCoordIntersectsViewport([o,t,s],D))continue;const n=this.getTile(o,t,s,e);if(this.isDrawableTile(n)){const t=c(this);if(n.getState()==L){v[o][n.tileCoord.toString()]=n;let e=n.inTransition(t);e&&1!==h.opacity&&(n.endTransition(t),e=!1),this.newTiles_||!e&&this.renderedTiles.includes(n)||(this.newTiles_=!0)}if(1===n.getAlpha(t,e.time))continue}const a=i.getTileCoordChildTileRange(n.tileCoord,k,A);let r=!1;a&&(r=F(o+1,a)),r||i.forEachTileCoordParentTileRange(n.tileCoord,F,k,A)}const y=l/z*m/u,n=this.getRenderContext(e);Le(this.tempTransform,w/2,E/2,y,y,0,-w/2,-E/2),C&&this.clipUnrotated(n,e,C),s.getInterpolate()||(n.imageSmoothingEnabled=!1),this.preRender(n,e),this.renderedTiles.length=0;let d,O,a,f=Object.keys(v).map(Number);f.sort(_t),1!==h.opacity||this.containerReused&&!s.getOpaque(e.viewState.projection)?(d=[],O=[]):f=f.reverse();for(let p=f.length-1;p>=0;--p){const t=f[p],j=s.getTilePixelSize(t,m,r),_=i.getResolution(t)/l,w=j[0]*_*y,x=j[1]*_*y,b=i.getTileCoordForCoordAndZ(ht(g),t),C=i.getTileCoordExtent(b),h=R(this.tempTransform,[u*(C[0]-g[0])/l,u*(g[3]-C[3])/l]),k=u*s.getGutterForProjection(r),E=v[t];for(const A in E){const l=E[A],y=l.tileCoord,p=b[1]-y[1],C=Math.round(h[0]-(p-1)*w),g=b[2]-y[2],_=Math.round(h[1]-(g-1)*x),i=Math.round(h[0]-p*w),r=Math.round(h[1]-g*x),m=C-i,u=_-r,v=o===t,j=v&&1!==l.getAlpha(c(this),e.time);let f=!1;if(!j)if(d){a=[i,r,i+m,r,i+m,r+u,i,r+u];for(let e=0,s=d.length;e<s;++e)if(o!==t&&t<O[e]){const t=d[e];U([i,r,i+m,r+u],[t[0],t[3],t[4],t[7]])&&(f||(n.save(),f=!0),n.beginPath(),n.moveTo(a[0],a[1]),n.lineTo(a[2],a[3]),n.lineTo(a[4],a[5]),n.lineTo(a[6],a[7]),n.moveTo(t[6],t[7]),n.lineTo(t[4],t[5]),n.lineTo(t[2],t[3]),n.lineTo(t[0],t[1]),n.clip())}d.push(a),O.push(t)}else n.clearRect(i,r,m,u);this.drawTileImage(l,e,i,r,m,u,k,v),d&&!j?(f&&n.restore(),this.renderedTiles.unshift(l)):this.renderedTiles.push(l),this.updateUsedTiles(e.usedTiles,s,l)}}return this.renderedRevision=P,this.renderedResolution=l,this.extentChanged=!this.renderedExtent_||!Ue(this.renderedExtent_,g),this.renderedExtent_=g,this.renderedPixelRatio=m,this.renderedProjection=r,this.manageTilePyramid(e,s,i,m,r,j,o,M.getPreload()),this.scheduleExpireCache(e,s),this.postRender(this.context,e),h.extent&&n.restore(),n.imageSmoothingEnabled=!0,this.container}drawTileImage(e,t,n,s,o,i,a,r){const d=this.getTileImage(e);if(!d)return;const l=this.getRenderContext(t),h=c(this),m=t.layerStatesArray[t.layerIndex],u=m.opacity*(r?e.getAlpha(h,t.time):1),f=u!==l.globalAlpha;f&&(l.save(),l.globalAlpha=u),l.drawImage(d,a,a,d.width-2*a,d.height-2*a,n,s,o,i),f&&l.restore(),u!==m.opacity?t.animate=!0:r&&e.endTransition(h)}getImage(){const e=this.context;return e?e.canvas:null}getTileImage(e){return e.getImage()}scheduleExpireCache(e,t){if(t.canExpireCache()){const n=function(e,t,n){const s=c(e);s in n.usedTiles&&e.expireCache(n.viewState.projection,n.usedTiles[s])}.bind(null,t);e.postRenderFunctions.push(n)}}updateUsedTiles(e,t,n){const s=c(t);s in e||(e[s]={}),e[s][n.getKey()]=!0}manageTilePyramid(e,t,n,s,o,i,a,r,l){const p=c(t);p in e.wantedTiles||(e.wantedTiles[p]={});const w=e.wantedTiles[p],v=e.tileQueue,y=n.getMinZoom(),g=e.viewState.rotation,_=g?Hr(e.viewState.center,e.viewState.resolution,g,e.size):void 0;let u,m,b,h,f,d,j=0;for(d=y;d<=a;++d)for(m=n.getTileRangeForExtentAndZ(i,d,m),b=n.getResolution(d),h=m.minX;h<=m.maxX;++h)for(f=m.minY;f<=m.maxY;++f)g&&!n.tileCoordIntersectsViewport([d,h,f],_)||(a-d<=r?(++j,u=t.getTile(d,h,f,s,o),u.getState()==ne&&(w[u.getKey()]=!0,v.isKeyQueued(u.getKey())||v.enqueue([u,p,n.getTileCoordCenter(u.tileCoord),b])),void 0!==l&&l(u)):t.useTile(d,h,f,o));t.updateCacheSize(j,o)}}class i0 extends u4{constructor(e){super(e)}createRenderer(){return new h4(this)}}let f4,o0=!0;try{new ImageData(10,10)}catch{o0=!1}function e0(e,t,n){if(o0)return new ImageData(e,t,n);f4||(f4=document.createElement("canvas").getContext("2d"));const s=f4.createImageData(t,n);return s.data.set(e),s}function Z4(e){let t=!0;try{new ImageData(10,10)}catch{t=!1}function n(e,n,s){return t?new ImageData(e,n,s):{data:e,width:n,height:s}}return function(t){const a=t.buffers,r=t.meta,d=t.imageOps,u=t.width,h=t.height,s=a.length,c=a[0].byteLength;if(d){const t=new Array(s);for(let e=0;e<s;++e)t[e]=n(new Uint8ClampedArray(a[e]),u,h);return e(t,r).data.buffer}const i=new Uint8ClampedArray(c),l=new Array(s),o=new Array(s);for(let e=0;e<s;++e)l[e]=new Uint8ClampedArray(a[e]),o[e]=[0,0,0,0];for(let t=0;t<c;t+=4){for(let e=0;e<s;++e){const n=l[e];o[e][0]=n[t],o[e][1]=n[t+1],o[e][2]=n[t+2],o[e][3]=n[t+3]}const n=e(o,r);i[t]=n[0],i[t+1]=n[1],i[t+2]=n[2],i[t+3]=n[3]}return i.buffer}}function fv(e,t){const n=Object.keys(e.lib||{}).map(function(t){return"const "+t+" = "+e.lib[t].toString()+";"}).concat(["const __minion__ = ("+Z4.toString()+")(",e.operation.toString(),");",'self.addEventListener("message", function(event) {',"  const buffer = __minion__(event.data);","  self.postMessage({buffer: buffer, meta: event.data.meta}, [buffer]);","});"]),s=new Worker("undefined"==typeof Blob?"data:text/javascript;base64,"+Buffer.from(n.join(`
`),"binary").toString("base64"):URL.createObjectURL(new Blob(n,{type:"text/javascript"})));return s.addEventListener("message",t),s}class G4 extends Zo{constructor(e){let t;super(),this._imageOps=!!e.imageOps,t=0===e.threads?0:this._imageOps?1:e.threads||1;const n=new Array(t);if(t)for(let s=0;s<t;++s)n[s]=fv(e,this._onWorkerMessage.bind(this,s));else n[0]=function(e,t){const s=Z4(e.operation);let n=!1;return{postMessage:function(e){setTimeout(function(){n||t({data:{buffer:s(e),meta:e.meta}})},0)},terminate:function(){n=!0}}}(e,this._onWorkerMessage.bind(this,0));this._workers=n,this._queue=[],this._maxQueueLength=e.queue||1/0,this._running=0,this._dataLookup={},this._job=null}process(e,t,n){this._enqueue({inputs:e,meta:t,callback:n}),this._dispatch()}_enqueue(e){for(this._queue.push(e);this._queue.length>this._maxQueueLength;)this._queue.shift().callback(null,null)}_dispatch(){if(this._running||0===this._queue.length)return;const e=this._queue.shift();this._job=e;const s=e.inputs[0].width,o=e.inputs[0].height,t=e.inputs.map(function(e){return e.data.buffer}),n=this._workers.length;if(this._running=n,1===n)return void this._workers[0].postMessage({buffers:t,meta:e.meta,imageOps:this._imageOps,width:s,height:o},t);const a=e.inputs[0].data.length,i=4*Math.ceil(a/4/n);for(let a=0;a<n;++a){const c=a*i,r=[];for(let e=0,n=t.length;e<n;++e)r.push(t[e].slice(c,c+i));this._workers[a].postMessage({buffers:r,meta:e.meta,imageOps:this._imageOps,width:s,height:o},r)}}_onWorkerMessage(e,t){this.disposed||(this._dataLookup[e]=t.data,--this._running,0===this._running&&this._resolveJob())}_resolveJob(){const e=this._job,t=this._workers.length;let n,s;if(1===t)n=new Uint8ClampedArray(this._dataLookup[0].buffer),s=this._dataLookup[0].meta;else{const o=e.inputs[0].data.length;n=new Uint8ClampedArray(o),s=new Array(t);const i=4*Math.ceil(o/4/t);for(let e=0;e<t;++e){const o=this._dataLookup[e].buffer,a=e*i;n.set(new Uint8ClampedArray(o),a),s[e]=this._dataLookup[e].meta}}this._job=null,this._dataLookup={},e.callback(null,e0(n,e.inputs[0].width,e.inputs[0].height),s),this._dispatch()}disposeInternal(){for(let e=0;e<this._workers.length;++e)this._workers[e].terminate();this._workers.length=0}}const pv="beforeoperations",gv="afteroperations";class w4 extends ue{constructor(e,t,n){super(e),this.extent=t.extent,this.resolution=t.viewState.resolution/t.pixelRatio,this.data=n}}class K4 extends Vn{constructor(e){super({projection:null}),this.on,this.once,this.un,this.processor_=null,this.operationType_=void 0!==e.operationType?e.operationType:"pixel",this.threads_=void 0!==e.threads?e.threads:1,this.layers_=function(e){const t=e.length,n=new Array(t);for(let s=0;s<t;++s)n[s]=yv(e[s]);return n}(e.sources);const n=this.changed.bind(this);for(let e=0,t=this.layers_.length;e<t;++e)this.layers_[e].addEventListener(A,n);var t;this.useResolutions_=null!==e.resolutions,this.tileQueue_=new Pd(function(){return 1},this.processSources_.bind(this)),this.requestedFrameState_,this.renderedImageCanvas_=null,this.renderedRevision_,this.frameState_={animate:!1,coordinateToPixelTransform:[1,0,0,1,0,0],declutter:null,extent:null,index:0,layerIndex:0,layerStatesArray:(t=this.layers_,t.map(function(e){return e.getLayerState()})),pixelRatio:1,pixelToCoordinateTransform:[1,0,0,1,0,0],postRenderFunctions:[],size:[0,0],tileQueue:this.tileQueue_,time:Date.now(),usedTiles:{},viewState:{rotation:0},viewHints:[],wantedTiles:{},mapId:c(this),renderTargets:{}},this.setAttributions(function(t){const n=[];for(let s=0,r=e.sources.length;s<r;++s){const o=e.sources[s],i=o instanceof jo?o:o.getSource();if(!i)continue;const a=i.getAttributions();if("function"==typeof a){const e=a(t);n.push.apply(n,e)}}return 0!==n.length?n:null}),void 0!==e.operation&&this.setOperation(e.operation,e.lib)}setOperation(e,t){this.processor_&&this.processor_.dispose(),this.processor_=new G4({operation:e,imageOps:"image"===this.operationType_,queue:1,lib:t,threads:this.threads_}),this.changed()}updateFrameState_(e,t,n){const s=Object.assign({},this.frameState_);s.viewState=Object.assign({},s.viewState);const o=_e(e);s.size[0]=Math.ceil(b(e)/t),s.size[1]=Math.ceil(W(e)/t),s.extent=[o[0]-s.size[0]*t/2,o[1]-s.size[1]*t/2,o[0]+s.size[0]*t/2,o[1]+s.size[1]*t/2],s.time=Date.now();const i=s.viewState;return i.center=o,i.projection=n,i.resolution=t,s}allSourcesReady_(){let e,t=!0;for(let n=0,s=this.layers_.length;n<s;++n)if(e=this.layers_[n].getSource(),!e||"ready"!==e.getState()){t=!1;break}return t}getImage(e,t,n,s){if(!this.allSourcesReady_())return null;this.tileQueue_.loadMoreTiles(16,16),t=this.findNearestResolution(t);const o=this.updateFrameState_(e,t,s);if(this.requestedFrameState_=o,this.renderedImageCanvas_){const e=this.renderedImageCanvas_.getResolution(),n=this.renderedImageCanvas_.getExtent();t===e&&Ue(o.extent,n)||(this.renderedImageCanvas_=null)}return this.renderedImageCanvas_&&this.getRevision()===this.renderedRevision_||this.processSources_(),o.animate&&requestAnimationFrame(this.changed.bind(this)),this.renderedImageCanvas_}processSources_(){const e=this.requestedFrameState_,t=this.layers_.length,n=new Array(t);for(let s=0;s<t;++s){e.layerIndex=s,e.renderTargets={};const o=vv(this.layers_[s],e);if(!o)return;n[s]=o}const s={};this.dispatchEvent(new w4(pv,e,s)),this.processor_.process(n,s,this.onWorkerComplete_.bind(this,e))}onWorkerComplete_(e,t,n,s){if(t||!n)return;const o=e.extent,i=e.viewState.resolution;if(i!==this.requestedFrameState_.viewState.resolution||!Ue(o,this.requestedFrameState_.extent))return;let a;this.renderedImageCanvas_?a=this.renderedImageCanvas_.getImage().getContext("2d"):(a=K(Math.round(b(o)/i),Math.round(W(o)/i)),this.renderedImageCanvas_=new ol(o,i,1,a.canvas)),a.putImageData(n,0,0),e.animate?requestAnimationFrame(this.changed.bind(this)):this.changed(),this.renderedRevision_=this.getRevision(),this.dispatchEvent(new w4(gv,e,s))}getResolutions(e){if(!this.useResolutions_)return null;let t=super.getResolutions();if(!t)for(let n=0,s=this.layers_.length;n<s;++n)if(t=this.layers_[n].getSource().getResolutions(e),t)break;return t}disposeInternal(){this.processor_&&this.processor_.dispose(),super.disposeInternal()}}K4.prototype.dispose;let Os=null;function vv(e,t){const a=e.getRenderer();if(!a)throw new Error("Unsupported layer type: "+e);if(!a.prepareFrame(t))return null;const n=t.size[0],s=t.size[1];if(0===n||0===s)return null;const i=a.renderFrame(t,null);let o;if(i instanceof HTMLCanvasElement)o=i;else{if(i&&(o=i.firstElementChild),!(o instanceof HTMLCanvasElement))throw new Error("Unsupported rendered element: "+o);if(o.width===n&&o.height===s)return o.getContext("2d").getImageData(0,0,n,s)}if(Os){const e=Os.canvas;e.width!==n||e.height!==s?Os=K(n,s,void 0,{willReadFrequently:!0}):Os.clearRect(0,0,n,s)}else Os=K(n,s,void 0,{willReadFrequently:!0});return Os.drawImage(o,0,0,n,s),Os.getImageData(0,0,n,s)}function yv(e){let t;return e instanceof jo?e instanceof Ai?t=new i0({source:e}):e instanceof Vn&&(t=new f0({source:e})):t=e,t}const wv={stamen_terrain:{extension:"png",opaque:!0},stamen_terrain_background:{extension:"png",opaque:!0},stamen_terrain_labels:{extension:"png",opaque:!1},stamen_terrain_lines:{extension:"png",opaque:!1},stamen_toner_background:{extension:"png",opaque:!0},stamen_toner:{extension:"png",opaque:!0},stamen_toner_labels:{extension:"png",opaque:!1},stamen_toner_lines:{extension:"png",opaque:!1},stamen_toner_lite:{extension:"png",opaque:!0},stamen_watercolor:{extension:"jpg",opaque:!0},alidade_smooth:{extension:"png",opaque:!0},alidade_smooth_dark:{extension:"png",opaque:!0},alidade_satellite:{extension:"png",opaque:!0},outdoors:{extension:"png",opaque:!0},osm_bright:{extension:"png",opaque:!0}},Ov={stamen_terrain:{minZoom:0,maxZoom:18,retina:!0},stamen_toner:{minZoom:0,maxZoom:20,retina:!0},stamen_watercolor:{minZoom:1,maxZoom:18,retina:!1}};class L4 extends fs{constructor(e,t,n,s,o,i){super(e,t),this.src_=n,this.extent_=s,this.preemptive_=o,this.grid_=null,this.keys_=null,this.data_=null,this.jsonp_=i}getImage(){return null}getData(e){if(!this.grid_||!this.keys_)return null;const o=(e[0]-this.extent_[0])/(this.extent_[2]-this.extent_[0]),i=(e[1]-this.extent_[1])/(this.extent_[3]-this.extent_[1]),n=this.grid_[Math.floor((1-i)*this.grid_.length)];if("string"!=typeof n)return null;let t=n.charCodeAt(Math.floor(o*n.length));t>=93&&t--,t>=35&&t--,t-=32;let s=null;if(t in this.keys_){const e=this.keys_[t];s=this.data_&&e in this.data_?this.data_[e]:e}return s}forDataAtCoordinate(e,t,n){this.state==J&&!0===n?(this.state=ne,Hs(this,A,function(){t(this.getData(e))},this),this.loadInternal_()):!0===n?setTimeout(()=>{t(this.getData(e))},0):t(this.getData(e))}getKey(){return this.src_}handleError_(){this.state=Z,this.changed()}handleLoad_(e){this.grid_=e.grid,this.keys_=e.keys,this.data_=e.data,this.state=L,this.changed()}loadInternal_(){if(this.state==ne)if(this.state=gt,this.jsonp_)rl(this.src_,this.handleLoad_.bind(this),this.handleError_.bind(this));else{const e=new XMLHttpRequest;e.addEventListener("load",this.onXHRLoad_.bind(this)),e.addEventListener("error",this.onXHRError_.bind(this)),e.open("GET",this.src_),e.send()}}onXHRLoad_(e){const t=e.target;if(!t.status||t.status>=200&&t.status<300){let e;try{e=JSON.parse(t.responseText)}catch{return void this.handleError_()}this.handleLoad_(e)}else this.handleError_()}onXHRError_(){this.handleError_()}load(){this.preemptive_?this.loadInternal_():this.setState(J)}}const xs=34962,As=34963,go=35044,wa=35048,F4=5126,N4=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function S4(e,t){t=Object.assign({preserveDrawingBuffer:!0,antialias:!e8},t);const n=N4.length;for(let s=0;s<n;++s)try{const n=e.getContext(N4[s],t);if(n)return n}catch{}return null}let A4=null;const Dn="http://www.w3.org/2001/XMLSchema-instance";function w(e,t){return os().createElementNS(e,t)}function Me(e,t){return E4(e,t,[]).join("")}function E4(e,t,n){if(e.nodeType==Node.CDATA_SECTION_NODE||e.nodeType==Node.TEXT_NODE)t?n.push(String(e.nodeValue).replace(/(\r\n|\r|\n)/g,"")):n.push(e.nodeValue);else{let s;for(s=e.firstChild;s;s=s.nextSibling)E4(s,t,n)}return n}function Xe(e){return"documentElement"in e}function $4(e,t,n){return e.getAttributeNS(t,n)||""}function et(e){return(new DOMParser).parseFromString(e,"application/xml")}function fa(e,t){return function(n,s){const o=e.call(void 0!==t?t:this,n,s);void 0!==o&&z(s[s.length-1],o)}}function h(e,t){return function(n,s){const o=e.call(void 0!==t?t:this,n,s);void 0!==o&&s[s.length-1].push(o)}}function v(e,t){return function(n,s){const o=e.call(void 0!==t?t:this,n,s);void 0!==o&&(s[s.length-1]=o)}}function G(e,t,n){return function(s,o){const i=e.call(void 0!==n?n:this,s,o);if(void 0!==i){const n=o[o.length-1],a=void 0!==t?t:s.localName;let e;a in n?e=n[a]:(e=[],n[a]=e),e.push(i)}}}function t(e,t,n){return function(s,o){const i=e.call(void 0!==n?n:this,s,o);void 0!==i&&(o[o.length-1][void 0!==t?t:s.localName]=i)}}function n(e,t){return function(n,s,o){e.call(void 0!==t?t:this,n,s,o),o[o.length-1].node.appendChild(n)}}function b4(e){let n,s;return function(t,o,i){if(void 0===n){n={};const o={};o[t.localName]=e,n[t.namespaceURI]=o,s=se(t.localName)}p4(n,s,o,i)}}function se(e,t){return function(n,s,o){const a=s[s.length-1].node;let i=e;return void 0===i&&(i=o),w(void 0!==t?t:a.namespaceURI,i)}}const ye=se();function Ie(e,t){const n=t.length,s=new Array(n);for(let o=0;o<n;++o)s[o]=e[t[o]];return s}function o(e,t,n){let s,o;for(n=void 0!==n?n:{},s=0,o=e.length;s<o;++s)n[e[s]]=t;return n}function Te(e,t,n,s){let o;for(o=t.firstElementChild;o;o=o.nextElementSibling){const i=e[o.namespaceURI];if(void 0!==i){const e=i[o.localName];void 0!==e&&e.call(s,o,n)}}}function i(e,t,n,s,o){return s.push(e),Te(t,n,s,o),s.pop()}function p4(e,t,n,s,o,i){const c=(void 0!==o?o:n).length;let r,a;for(let l=0;l<c;++l)r=n[l],void 0!==r&&(a=t.call(void 0!==i?i:this,r,s,void 0!==o?o[l]:void 0),void 0!==a&&e[a.namespaceURI][a.localName].call(i,a,r,s))}function _(e,t,n,s,o,i,a){return o.push(e),p4(t,n,s,o,i,a),o.pop()}let dc,uc;function c0(){return void 0===dc&&"undefined"!=typeof XMLSerializer&&(dc=new XMLSerializer),dc}function os(){return void 0===uc&&"undefined"!=typeof document&&(uc=document.implementation.createDocument("","",null)),uc}class d4 extends Ss{constructor(e){super(),this.tile,this.handleTileChange_=this.handleTileChange_.bind(this),this.gutter_=e.gutter||0,this.helper_=e.helper,this.loaded=!1,this.ready=!1}setTile(e){if(e!==this.tile)if(this.tile&&this.tile.removeEventListener(A,this.handleTileChange_),this.tile=e,this.loaded=e.getState()===L,this.loaded)this.uploadTile();else{if(e instanceof Qo){const t=e.getImage();t instanceof Image&&!t.crossOrigin&&(t.crossOrigin="anonymous")}e.addEventListener(A,this.handleTileChange_)}}uploadTile(){g()}setReady(){this.ready=!0,this.dispatchEvent(A)}handleTileChange_(){this.tile.getState()===L&&(this.loaded=!0,this.uploadTile())}disposeInternal(){this.tile.removeEventListener(A,this.handleTileChange_)}}const Y7=go;class on{constructor(e,t){this.array_=null,this.type_=e,x(e===xs||e===As,"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`"),this.usage_=void 0!==t?t:Y7}ofSize(e){return this.array_=new(bc(this.type_))(e),this}fromArray(e){return this.array_=bc(this.type_).from(e),this}fromArrayBuffer(e){return this.array_=new(bc(this.type_))(e),this}getType(){return this.type_}getArray(){return this.array_}getUsage(){return this.usage_}getSize(){return this.array_?this.array_.length:0}}function bc(e){switch(e){case xs:return Float32Array;case As:return Uint32Array;default:return Float32Array}}c4="webglcontextlost",a4="webglcontextrestored";class s4{constructor(e){this.gl_=e.webGlContext;const t=this.gl_;this.scaleRatio_=e.scaleRatio||1,this.renderTargetTexture_=t.createTexture(),this.renderTargetTextureSize_=null,this.frameBuffer_=t.createFramebuffer(),this.depthBuffer_=t.createRenderbuffer();const n=t.createShader(t.VERTEX_SHADER);t.shaderSource(n,e.vertexShader||`
  precision mediump float;
  
  attribute vec2 a_position;
  varying vec2 v_texCoord;
  varying vec2 v_screenCoord;
  
  uniform vec2 u_screenSize;
   
  void main() {
    v_texCoord = a_position * 0.5 + 0.5;
    v_screenCoord = v_texCoord * u_screenSize;
    gl_Position = vec4(a_position, 0.0, 1.0);
  }
`),t.compileShader(n);const s=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(s,e.fragmentShader||`
  precision mediump float;
   
  uniform sampler2D u_image;
  uniform float u_opacity;
   
  varying vec2 v_texCoord;
   
  void main() {
    gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;
  }
`),t.compileShader(s),this.renderTargetProgram_=t.createProgram(),t.attachShader(this.renderTargetProgram_,n),t.attachShader(this.renderTargetProgram_,s),t.linkProgram(this.renderTargetProgram_),this.renderTargetVerticesBuffer_=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,-1,1,1,-1,1]),t.STATIC_DRAW),this.renderTargetAttribLocation_=t.getAttribLocation(this.renderTargetProgram_,"a_position"),this.renderTargetUniformLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_screenSize"),this.renderTargetOpacityLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_opacity"),this.renderTargetTextureLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_image"),this.uniforms_=[],e.uniforms&&Object.keys(e.uniforms).forEach(n=>{this.uniforms_.push({value:e.uniforms[n],location:t.getUniformLocation(this.renderTargetProgram_,n)})})}getGL(){return this.gl_}init(){const t=this.getGL(),n=[t.drawingBufferWidth*this.scaleRatio_,t.drawingBufferHeight*this.scaleRatio_];if(t.bindFramebuffer(t.FRAMEBUFFER,this.getFrameBuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.getDepthBuffer()),t.viewport(0,0,n[0],n[1]),!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==n[0]||this.renderTargetTextureSize_[1]!==n[1]){this.renderTargetTextureSize_=n;const e=0,s=t.RGBA,o=0,i=t.RGBA,a=t.UNSIGNED_BYTE,r=null;t.bindTexture(t.TEXTURE_2D,this.renderTargetTexture_),t.texImage2D(t.TEXTURE_2D,e,s,n[0],n[1],o,i,a,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.renderTargetTexture_,0),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,n[0],n[1]),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.depthBuffer_)}}apply(e,t,n,s){const o=this.getGL(),i=e.size;if(o.bindFramebuffer(o.FRAMEBUFFER,t?t.getFrameBuffer():null),o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,this.renderTargetTexture_),!t){const t=c(o.canvas);if(!e.renderTargets[t]){const n=o.getContextAttributes();n&&n.preserveDrawingBuffer&&(o.clearColor(0,0,0,0),o.clearDepth(1),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT)),e.renderTargets[t]=!0}}o.disable(o.DEPTH_TEST),o.enable(o.BLEND),o.blendFunc(o.ONE,o.ONE_MINUS_SRC_ALPHA),o.viewport(0,0,o.drawingBufferWidth,o.drawingBufferHeight),o.bindBuffer(o.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),o.useProgram(this.renderTargetProgram_),o.enableVertexAttribArray(this.renderTargetAttribLocation_),o.vertexAttribPointer(this.renderTargetAttribLocation_,2,o.FLOAT,!1,0,0),o.uniform2f(this.renderTargetUniformLocation_,i[0],i[1]),o.uniform1i(this.renderTargetTextureLocation_,0);const a=e.layerStatesArray[e.layerIndex].opacity;o.uniform1f(this.renderTargetOpacityLocation_,a),this.applyUniforms(e),n&&n(o,e),o.drawArrays(o.TRIANGLES,0,6),s&&s(o,e)}getFrameBuffer(){return this.frameBuffer_}getDepthBuffer(){return this.depthBuffer_}applyUniforms(e){const t=this.getGL();let n,s=1;this.uniforms_.forEach(function(o){if(n="function"==typeof o.value?o.value(e):o.value,n instanceof HTMLCanvasElement||n instanceof ImageData)o.texture||(o.texture=t.createTexture()),t.activeTexture(t[`TEXTURE${s}`]),t.bindTexture(t.TEXTURE_2D,o.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),n instanceof ImageData?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,n.width,n.height,0,t.UNSIGNED_BYTE,new Uint8Array(n.data)):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n),t.uniform1i(o.location,s++);else if(Array.isArray(n))switch(n.length){case 2:return void t.uniform2f(o.location,n[0],n[1]);case 3:return void t.uniform3f(o.location,n[0],n[1],n[2]);case 4:return void t.uniform4f(o.location,n[0],n[1],n[2],n[3]);default:return}else"number"==typeof n&&t.uniform1f(o.location,n)})}}function K7(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function ln(e,t){return e[0]=t[0],e[1]=t[1],e[4]=t[2],e[5]=t[3],e[12]=t[4],e[13]=t[5],e}const $t={PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix",TIME:"u_time",ZOOM:"u_zoom",RESOLUTION:"u_resolution",ROTATION:"u_rotation",VIEWPORT_SIZE_PX:"u_viewportSizePx",PIXEL_RATIO:"u_pixelRatio",HIT_DETECTION:"u_hitDetection"},he={UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:F4},Mc={};function w0(e){return"shared/"+e}let O0=0;class x0 extends Zo{constructor(e){super(),e=e||{},this.boundHandleWebGLContextLost_=this.handleWebGLContextLost.bind(this),this.boundHandleWebGLContextRestored_=this.handleWebGLContextRestored.bind(this),this.canvasCacheKey_=e.canvasCacheKey?w0(e.canvasCacheKey):function(){const e="unique/"+O0;return O0+=1,e}(),this.gl_=function(e){let t=Mc[e];if(!t){const n=document.createElement("canvas");n.width=1,n.height=1,n.style.position="absolute",n.style.left="0",t={users:0,context:S4(n)},Mc[e]=t}return t.users+=1,t.context}(this.canvasCacheKey_),this.bufferCache_={},this.extensionCache_={},this.currentProgram_=null,this.needsToBeRecreated_=!1;const t=this.gl_.canvas;t.addEventListener(c4,this.boundHandleWebGLContextLost_),t.addEventListener(a4,this.boundHandleWebGLContextRestored_),this.offsetRotateMatrix_=[1,0,0,1,0,0],this.offsetScaleMatrix_=[1,0,0,1,0,0],this.tmpMat4_=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.uniformLocationsByProgram_={},this.attribLocationsByProgram_={},this.uniforms_=[],e.uniforms&&this.setUniforms(e.uniforms),this.postProcessPasses_=e.postProcesses?e.postProcesses.map(e=>new s4({webGlContext:this.gl_,scaleRatio:e.scaleRatio,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms})):[new s4({webGlContext:this.gl_})],this.shaderCompileErrors_=null,this.startTime_=Date.now()}setUniforms(e){this.uniforms_=[],this.addUniforms(e)}addUniforms(e){for(const t in e)this.uniforms_.push({name:t,value:e[t]})}canvasCacheKeyMatches(e){return this.canvasCacheKey_===w0(e)}getExtension(e){if(e in this.extensionCache_)return this.extensionCache_[e];const t=this.gl_.getExtension(e);return this.extensionCache_[e]=t,t}bindBuffer(e){const n=this.gl_,s=c(e);let t=this.bufferCache_[s];t||(t={buffer:e,webGlBuffer:n.createBuffer()},this.bufferCache_[s]=t),n.bindBuffer(e.getType(),t.webGlBuffer)}flushBufferData(e){const t=this.gl_;this.bindBuffer(e),t.bufferData(e.getType(),e.getArray(),e.getUsage())}deleteBuffer(e){const t=this.gl_,n=c(e),s=this.bufferCache_[n];s&&!t.isContextLost()&&t.deleteBuffer(s.webGlBuffer),delete this.bufferCache_[n]}disposeInternal(){const e=this.gl_.canvas;e.removeEventListener(c4,this.boundHandleWebGLContextLost_),e.removeEventListener(a4,this.boundHandleWebGLContextRestored_),function(e){const t=Mc[e];if(!t)return;if(t.users-=1,t.users>0)return;const n=t.context,s=n.getExtension("WEBGL_lose_context");s&&s.loseContext();const o=n.canvas;o.width=1,o.height=1,delete Mc[e]}(this.canvasCacheKey_),delete this.gl_}prepareDraw(e,t,n){const s=this.gl_,o=this.getCanvas(),i=e.size,a=e.pixelRatio;o.width===i[0]*a&&o.height===i[1]*a||(o.width=i[0]*a,o.height=i[1]*a,o.style.width=i[0]+"px",o.style.height=i[1]+"px");for(let t=this.postProcessPasses_.length-1;t>=0;t--)this.postProcessPasses_[t].init(e);s.bindTexture(s.TEXTURE_2D,null),s.clearColor(0,0,0,0),s.depthRange(0,1),s.clearDepth(1),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),s.enable(s.BLEND),s.blendFunc(s.ONE,t?s.ZERO:s.ONE_MINUS_SRC_ALPHA),n?(s.enable(s.DEPTH_TEST),s.depthFunc(s.LEQUAL)):s.disable(s.DEPTH_TEST)}bindTexture(e,t,n){const s=this.gl_;s.activeTexture(s.TEXTURE0+t),s.bindTexture(s.TEXTURE_2D,e),s.uniform1i(this.getUniformLocation(n),t)}prepareDrawToRenderTarget(e,t,n,s){const o=this.gl_,i=t.getSize();o.bindFramebuffer(o.FRAMEBUFFER,t.getFramebuffer()),o.bindRenderbuffer(o.RENDERBUFFER,t.getDepthbuffer()),o.viewport(0,0,i[0],i[1]),o.bindTexture(o.TEXTURE_2D,t.getTexture()),o.clearColor(0,0,0,0),o.depthRange(0,1),o.clearDepth(1),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT),o.enable(o.BLEND),o.blendFunc(o.ONE,n?o.ZERO:o.ONE_MINUS_SRC_ALPHA),s?(o.enable(o.DEPTH_TEST),o.depthFunc(o.LEQUAL)):o.disable(o.DEPTH_TEST)}drawElements(e,t){const n=this.gl_;this.getExtension("OES_element_index_uint");const s=n.UNSIGNED_INT,o=t-e,i=4*e;n.drawElements(n.TRIANGLES,o,s,i)}finalizeDraw(e,t,n){for(let s=0,o=this.postProcessPasses_.length;s<o;s++)s===o-1?this.postProcessPasses_[s].apply(e,null,t,n):this.postProcessPasses_[s].apply(e,this.postProcessPasses_[s+1])}getCanvas(){return this.gl_.canvas}getGL(){return this.gl_}applyFrameState(e){const t=e.size,n=e.viewState.rotation,s=e.pixelRatio;this.setUniformFloatValue($t.TIME,.001*(Date.now()-this.startTime_)),this.setUniformFloatValue($t.ZOOM,e.viewState.zoom),this.setUniformFloatValue($t.RESOLUTION,e.viewState.resolution),this.setUniformFloatValue($t.PIXEL_RATIO,s),this.setUniformFloatVec2($t.VIEWPORT_SIZE_PX,[t[0],t[1]]),this.setUniformFloatValue($t.ROTATION,n)}applyHitDetectionUniform(e){const t=this.getUniformLocation($t.HIT_DETECTION);this.getGL().uniform1i(t,e?1:0),e&&this.setUniformFloatValue($t.PIXEL_RATIO,.5)}applyUniforms(e){const n=this.gl_;let t,s=0;this.uniforms_.forEach(o=>{if(t="function"==typeof o.value?o.value(e):o.value,t instanceof HTMLCanvasElement||t instanceof HTMLImageElement||t instanceof ImageData||t instanceof WebGLTexture){t instanceof WebGLTexture&&!o.texture?(o.prevValue=void 0,o.texture=t):o.texture||(o.prevValue=void 0,o.texture=n.createTexture()),this.bindTexture(o.texture,s,o.name),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE);const e=!(t instanceof HTMLImageElement)||t.complete;t instanceof WebGLTexture||!e||o.prevValue===t||(o.prevValue=t,n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t)),s++}else if(Array.isArray(t)&&6===t.length)this.setUniformMatrixValue(o.name,ln(this.tmpMat4_,t));else if(Array.isArray(t)&&t.length<=4)switch(t.length){case 2:return void n.uniform2f(this.getUniformLocation(o.name),t[0],t[1]);case 3:return void n.uniform3f(this.getUniformLocation(o.name),t[0],t[1],t[2]);case 4:return void n.uniform4f(this.getUniformLocation(o.name),t[0],t[1],t[2],t[3]);default:return}else"number"==typeof t&&n.uniform1f(this.getUniformLocation(o.name),t)})}useProgram(e,t){this.gl_.useProgram(e),this.currentProgram_=e,this.applyFrameState(t),this.applyUniforms(t)}compileShader(e,t){const n=this.gl_,s=n.createShader(t);return n.shaderSource(s,e),n.compileShader(s),s}getProgram(e,t){const n=this.gl_,o=this.compileShader(e,n.FRAGMENT_SHADER),i=this.compileShader(t,n.VERTEX_SHADER),s=n.createProgram();if(n.attachShader(s,o),n.attachShader(s,i),n.linkProgram(s),!n.getShaderParameter(o,n.COMPILE_STATUS)){const e=`Fragment shader compilation failed: ${n.getShaderInfoLog(o)}`;throw new Error(e)}if(n.deleteShader(o),!n.getShaderParameter(i,n.COMPILE_STATUS)){const e=`Vertex shader compilation failed: ${n.getShaderInfoLog(i)}`;throw new Error(e)}if(n.deleteShader(i),!n.getProgramParameter(s,n.LINK_STATUS)){const e=`GL program linking failed: ${n.getProgramInfoLog(s)}`;throw new Error(e)}return s}getUniformLocation(e){const t=c(this.currentProgram_);return void 0===this.uniformLocationsByProgram_[t]&&(this.uniformLocationsByProgram_[t]={}),void 0===this.uniformLocationsByProgram_[t][e]&&(this.uniformLocationsByProgram_[t][e]=this.gl_.getUniformLocation(this.currentProgram_,e)),this.uniformLocationsByProgram_[t][e]}getAttributeLocation(e){const t=c(this.currentProgram_);return void 0===this.attribLocationsByProgram_[t]&&(this.attribLocationsByProgram_[t]={}),void 0===this.attribLocationsByProgram_[t][e]&&(this.attribLocationsByProgram_[t][e]=this.gl_.getAttribLocation(this.currentProgram_,e)),this.attribLocationsByProgram_[t][e]}makeProjectionTransform(e,t){const n=e.size,i=e.viewState.rotation,s=e.viewState.resolution,o=e.viewState.center;return Le(t,0,0,2/(s*n[0]),2/(s*n[1]),-i,-o[0],-o[1]),t}setUniformFloatValue(e,t){this.gl_.uniform1f(this.getUniformLocation(e),t)}setUniformFloatVec2(e,t){this.gl_.uniform2fv(this.getUniformLocation(e),t)}setUniformFloatVec4(e,t){this.gl_.uniform4fv(this.getUniformLocation(e),t)}setUniformMatrixValue(e,t){this.gl_.uniformMatrix4fv(this.getUniformLocation(e),!1,t)}enableAttributeArray_(e,t,n,s,o){const i=this.getAttributeLocation(e);i<0||(this.gl_.enableVertexAttribArray(i),this.gl_.vertexAttribPointer(i,t,n,!1,s,o))}enableAttributes(e){const n=C0(e);let t=0;for(let o=0;o<e.length;o++){const s=e[o];this.enableAttributeArray_(s.name,s.size,s.type||F4,n,t),t+=s.size*E0(s.type)}}handleWebGLContextLost(e){Kn(this.bufferCache_),this.currentProgram_=null,e.preventDefault()}handleWebGLContextRestored(){this.needsToBeRecreated_=!0}needsToBeRecreated(){return this.needsToBeRecreated_}createTexture(e,t,n){const s=this.gl_;n=n||s.createTexture();const o=s.RGBA,i=s.RGBA,a=s.UNSIGNED_BYTE;return s.bindTexture(s.TEXTURE_2D,n),t?s.texImage2D(s.TEXTURE_2D,0,o,i,a,t):s.texImage2D(s.TEXTURE_2D,0,o,e[0],e[1],0,i,a,null),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),n}}function C0(e){let t=0;for(let n=0;n<e.length;n++){const s=e[n];t+=s.size*E0(s.type)}return t}function E0(e){switch(e){case he.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case he.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case he.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case he.FLOAT:default:return Float32Array.BYTES_PER_ELEMENT}}class k0{constructor(e,t){this.name=e,this.data=t,this.texture_=null}getTexture(e){if(!this.texture_){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.data.length/4,1,0,e.RGBA,e.UNSIGNED_BYTE,this.data),this.texture_=t}return this.texture_}delete(e){this.texture_&&e.deleteTexture(this.texture_),this.texture_=null}}const Ut=new Uint8Array(4);class Fc{constructor(e,t){this.helper_=e;const n=e.getGL();this.texture_=n.createTexture(),this.framebuffer_=n.createFramebuffer(),this.depthbuffer_=n.createRenderbuffer(),this.size_=t||[1,1],this.data_=new Uint8Array(0),this.dataCacheDirty_=!0,this.updateSize_()}setSize(e){Ct(e,this.size_)||(this.size_[0]=e[0],this.size_[1]=e[1],this.updateSize_())}getSize(){return this.size_}clearCachedData(){this.dataCacheDirty_=!0}readAll(){if(this.dataCacheDirty_){const t=this.size_,e=this.helper_.getGL();e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer_),e.readPixels(0,0,t[0],t[1],e.RGBA,e.UNSIGNED_BYTE,this.data_),this.dataCacheDirty_=!1}return this.data_}readPixel(e,t){if(e<0||t<0||e>this.size_[0]||t>=this.size_[1])return Ut[0]=0,Ut[1]=0,Ut[2]=0,Ut[3]=0,Ut;this.readAll();const n=Math.floor(e)+(this.size_[1]-Math.floor(t)-1)*this.size_[0];return Ut[0]=this.data_[4*n],Ut[1]=this.data_[4*n+1],Ut[2]=this.data_[4*n+2],Ut[3]=this.data_[4*n+3],Ut}getTexture(){return this.texture_}getFramebuffer(){return this.framebuffer_}getDepthbuffer(){return this.depthbuffer_}updateSize_(){const t=this.size_,e=this.helper_.getGL();this.texture_=this.helper_.createTexture(t,null,this.texture_),e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer_),e.viewport(0,0,t[0],t[1]),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture_,0),e.bindRenderbuffer(e.RENDERBUFFER,this.depthbuffer_),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,t[0],t[1]),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,this.depthbuffer_),this.data_=new Uint8Array(t[0]*t[1]*4)}}Nc={exports:{}};function Uc(e,t,n){n=n||2;var o,i,a,r,c,l,d,u,m=t&&t.length,f=m?t[0]*n:e.length,s=T0(e,0,f,n,!0),h=[];if(!s||s.next===s.prev)return h;if(m&&(s=function(e,t,n,s){var o,i,r,a=[];for(o=0,r=t.length;o<r;o++)(i=T0(e,t[o]*s,o<r-1?t[o+1]*s:e.length,s,!1))===i.next&&(i.steiner=!0),a.push(j7(i));for(a.sort(O7),o=0;o<a.length;o++)n=_7(a[o],n);return n}(e,t,s,n)),e.length>80*n){o=r=e[0],i=c=e[1];for(a=n;a<f;a+=n)(l=e[a])<o&&(o=l),(d=e[a+1])<i&&(i=d),l>r&&(r=l),d>c&&(c=d);u=0!==(u=Math.max(r-o,c-i))?32767/u:0}return Oi(s,h,n,o,i,u,0),h}function T0(e,t,n,s,o){var i,a;if(o===B1(e,t,n,s)>0)for(i=t;i<n;i+=s)a=J0(i,e[i],e[i+1],a);else for(i=n-s;i>=t;i-=s)a=J0(i,e[i],e[i+1],a);return a&&nl(a,a.next)&&(li(a),a=a.next),a}function Ds(e,t){if(!e)return e;t||(t=e);var s,n=e;do if(s=!1,n.steiner||!nl(n,n.next)&&0!==re(n.prev,n,n.next))n=n.next;else{if(li(n),(n=t=n.prev)===n.next)break;s=!0}while(s||n!==t)return t}function Oi(e,t,n,s,o,i,a){if(e){!a&&i&&function(e,t,n,s){var o=e;do 0===o.z&&(o.z=X1(o.x,o.y,t,n,s)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next;while(o!==e)o.prevZ.nextZ=null,o.prevZ=null,function(e){var t,n,s,o,i,a,r,c,l=1;do{for(n=e,e=null,o=null,c=0;n;){for(c++,t=n,i=0,r=0;r<l&&(i++,t=t.nextZ);r++);for(a=l;i>0||a>0&&t;)0!==i&&(0===a||!t||n.z<=t.z)?(s=n,n=n.nextZ,i--):(s=t,t=t.nextZ,a--),o?o.nextZ=s:e=s,s.prevZ=o,o=s;n=t}o.nextZ=null,l*=2}while(c>1)}(o)}(e,s,o,i);for(var r,c,l=e;e.prev!==e.next;)if(c=e.prev,r=e.next,i?$7(e,s,o,i):U7(e))t.push(c.i/n|0),t.push(e.i/n|0),t.push(r.i/n|0),li(e),e=r.next,l=r.next;else if((e=r)===l){a?1===a?Oi(e=V7(Ds(e),t,n),t,n,s,o,i,2):2===a&&T7(e,t,n,s,o,i):Oi(Ds(e),t,n,s,o,i,1);break}}}function U7(e){var c=e.prev,d=e,l=e.next;if(re(c,d,l)>=0)return!1;for(var a=c.x,i=d.x,n=l.x,o=c.y,r=d.y,s=l.y,u=a<i?a<n?a:n:i<n?i:n,h=o<r?o<s?o:s:r<s?r:s,m=a>i?a>n?a:n:i>n?i:n,f=o>r?o>s?o:s:r>s?r:s,t=l.next;t!==c;){if(t.x>=u&&t.x<=m&&t.y>=h&&t.y<=f&&Uo(a,o,i,r,n,s,t.x,t.y)&&re(t.prev,t,t.next)>=0)return!1;t=t.next}return!0}function $7(e,t,n,s){var h=e.prev,b=e,m=e.next;if(re(h,b,m)>=0)return!1;for(var u=h.x,c=b.x,a=m.x,l=h.y,d=b.y,r=m.y,f=u<c?u<a?u:a:c<a?c:a,p=l<d?l<r?l:r:d<r?d:r,g=u>c?u>a?u:a:c>a?c:a,v=l>d?l>r?l:r:d>r?d:r,j=X1(f,p,t,n,s),y=X1(g,v,t,n,s),i=e.prevZ,o=e.nextZ;i&&i.z>=j&&o&&o.z<=y;){if(i.x>=f&&i.x<=g&&i.y>=p&&i.y<=v&&i!==h&&i!==m&&Uo(u,l,c,d,a,r,i.x,i.y)&&re(i.prev,i,i.next)>=0)return!1;if(i=i.prevZ,o.x>=f&&o.x<=g&&o.y>=p&&o.y<=v&&o!==h&&o!==m&&Uo(u,l,c,d,a,r,o.x,o.y)&&re(o.prev,o,o.next)>=0)return!1;o=o.nextZ}for(;i&&i.z>=j;){if(i.x>=f&&i.x<=g&&i.y>=p&&i.y<=v&&i!==h&&i!==m&&Uo(u,l,c,d,a,r,i.x,i.y)&&re(i.prev,i,i.next)>=0)return!1;i=i.prevZ}for(;o&&o.z<=y;){if(o.x>=f&&o.x<=g&&o.y>=p&&o.y<=v&&o!==h&&o!==m&&Uo(u,l,c,d,a,r,o.x,o.y)&&re(o.prev,o,o.next)>=0)return!1;o=o.nextZ}return!0}function V7(e,t,n){s=e;do{var s,i=s.prev,o=s.next.next;!nl(i,o)&&Y0(i,s,s.next,o)&&mi(i,o)&&mi(o,i)&&(t.push(i.i/n|0),t.push(s.i/n|0),t.push(o.i/n|0),li(s),li(s.next),s=e=o),s=s.next}while(s!==e)return Ds(s)}function T7(e,t,n,s,o,i){var r,c,a=e;do{for(r=a.next.next;r!==a.prev;){if(a.i!==r.i&&m7(a,r))return c=Z0(a,r),a=Ds(a,a.next),c=Ds(c,c.next),Oi(a,t,n,s,o,i,0),void Oi(c,t,n,s,o,i,0);r=r.next}a=a.next}while(a!==e)}function O7(e,t){return e.x-t.x}function _7(e,t){var s,n=function(e,t){var s,a,n=t,i=e.x,o=e.y,r=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y&&(a=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y),a<=i&&a>r&&(r=a,s=n.x<n.next.x?n:n.next,a===i)))return s;n=n.next}while(n!==t)if(!s)return null;var c,h=s,u=s.x,l=s.y,d=1/0,n=s;do i>=n.x&&n.x>=u&&i!==n.x&&Uo(o<l?i:r,o,u,l,o<l?r:i,o,n.x,n.y)&&(c=Math.abs(o-n.y)/(i-n.x),mi(n,e)&&(c<d||c===d&&(n.x>s.x||n.x===s.x&&y7(s,n)))&&(s=n,d=c)),n=n.next;while(n!==h)return s}(e,t);return n?(s=Z0(n,e),Ds(s,s.next),Ds(n,n.next)):t}function y7(e,t){return re(e.prev,e,t.prev)<0&&re(t.next,e,e.next)<0}function X1(e,t,n,s,o){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*o|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-s)*o|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function j7(e){var t=e,n=e;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==e)return n}function Uo(e,t,n,s,o,i,a,r){return(o-a)*(t-r)>=(e-a)*(i-r)&&(e-a)*(s-r)>=(n-a)*(t-r)&&(n-a)*(i-r)>=(o-a)*(s-r)}function m7(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&Y0(n,n.next,e,t))return!0;n=n.next}while(n!==e)return!1}(e,t)&&(mi(e,t)&&mi(t,e)&&function(e,t){var n=e,s=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;do n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(s=!s),n=n.next;while(n!==e)return s}(e,t)&&(re(e.prev,e,t.prev)||re(e,t.prev,t))||nl(e,t)&&re(e.prev,e,e.next)>0&&re(t.prev,t,t.next)>0)}function re(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function nl(e,t){return e.x===t.x&&e.y===t.y}function Y0(e,t,n,s){var o=ll(re(e,t,n)),i=ll(re(e,t,s)),a=ll(re(n,s,e)),r=ll(re(n,s,t));return o!==i&&a!==r||0===o&&!!sl(e,n,t)||0===i&&!!sl(e,s,t)||0===a&&!!sl(n,e,s)||0===r&&!!sl(n,t,s)}function sl(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function ll(e){return e>0?1:e<0?-1:0}function mi(e,t){return re(e.prev,e,e.next)<0?re(e,t,e.next)>=0&&re(e,e.prev,t)>=0:re(e,t,e.prev)<0||re(e,e.next,t)<0}function Z0(e,t){var s=new V1(e.i,e.x,e.y),n=new V1(t.i,t.x,t.y),o=e.next,i=t.prev;return e.next=t,t.prev=e,s.next=o,o.prev=s,n.next=s,s.prev=n,i.next=n,n.prev=i,n}function J0(e,t,n,s){var o=new V1(e,t,n);return s?(o.next=s.next,o.prev=s,s.next.prev=o,s.next=o):(o.prev=o,o.next=o),o}function li(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function V1(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function B1(e,t,n,s){for(var a=0,o=t,i=n-s;o<n;o+=s)a+=(e[i]-e[o])*(e[o+1]+e[i+1]),i=o;return a}Nc.exports=Uc,Nc.exports.default=Uc,Uc.deviation=function(e,t,n,s){var o,a,c,d,u,l=t&&t.length,f=l?t[0]*n:e.length,i=Math.abs(B1(e,0,f,n));if(l)for(o=0,c=t.length;o<c;o++)d=t[o]*n,u=o<c-1?t[o+1]*n:e.length,i-=Math.abs(B1(e,d,u,n));a=0;for(o=0;o<s.length;o+=3){var r=s[o]*n,h=s[o+1]*n,m=s[o+2]*n;a+=Math.abs((e[r]-e[m])*(e[h+1]-e[r+1])-(e[r]-e[h])*(e[m+1]-e[r+1]))}return 0===i&&0===a?0:Math.abs((a-i)/i)},Uc.flatten=function(e){for(var n,s,i=e[0][0].length,o={vertices:[],holes:[],dimensions:i},a=0,t=0;t<e.length;t++){for(n=0;n<e[t].length;n++)for(s=0;s<i;s++)o.vertices.push(e[t][n][s]);t>0&&(a+=e[t-1].length,o.holes.push(a))}return o},s2=O4(Nc.exports);const P1=.985,r7=[],L1={vertexPosition:0,indexPosition:0};function wl(e,t,n,s,o){e[t+0]=n,e[t+1]=s,e[t+2]=o}function D1(e,t){const n=256,s=255;return(t=t||[])[0]=Math.floor(e/n/n/n)/s,t[1]=Math.floor(e/n/n)%n/s,t[2]=Math.floor(e/n)%n/s,t[3]=e%n/s,t}function z1(e){let n=0;const t=256,s=255;return n+=Math.round(e[0]*t*t*t*s),n+=Math.round(e[1]*t*t*s),n+=Math.round(e[2]*t*s),n+=Math.round(e[3]*s),n}function d2(e,t,n){const s=n?e.LINEAR:e.NEAREST;e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,s),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,s)}function u2(e,t,n,s,o,i){const a=e.getGL();let l,d;n instanceof Float32Array?(l=a.FLOAT,e.getExtension("OES_texture_float"),d=null!==e.getExtension("OES_texture_float_linear")):(l=a.UNSIGNED_BYTE,d=!0),d2(a,t,i&&d);const u=n.byteLength/s[1];let r,c=1;switch(u%8==0?c=8:u%4==0?c=4:u%2==0&&(c=2),o){case 1:r=a.LUMINANCE;break;case 2:r=a.LUMINANCE_ALPHA;break;case 3:r=a.RGB;break;case 4:r=a.RGBA;break;default:throw new Error(`Unsupported number of bands: ${o}`)}const h=a.getParameter(a.UNPACK_ALIGNMENT);a.pixelStorei(a.UNPACK_ALIGNMENT,c),a.texImage2D(a.TEXTURE_2D,0,r,s[0],s[1],0,r,l,n),a.pixelStorei(a.UNPACK_ALIGNMENT,h)}let ei=null;class m2 extends d4{constructor(e){super(e),this.textures=[],this.renderSize_=X(e.grid.getTileSize(e.tile.tileCoord[0])),this.bandCount=NaN;const t=new on(xs,go);t.fromArray([0,1,1,1,1,0,0,0]),this.helper_.flushBufferData(t),this.coords=t,this.setTile(e.tile)}uploadTile(){const a=this.helper_,o=a.getGL(),t=this.tile;let n;this.textures.length=0,n=t instanceof Qo||t instanceof Es?t.getImage():t.getData();const h=Mi(n);if(h){const e=o.createTexture();return this.textures.push(e),this.bandCount=4,function(e,t,n,s){d2(e,t,s),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n)}(o,e,h,t.interpolate),void this.setReady()}n=Ac(n);const c=t.getSize(),e=[c[0]+2*this.gutter_,c[1]+2*this.gutter_],p=n instanceof Float32Array,i=e[0]*e[1],l=p?Float32Array:Uint8Array,d=l.BYTES_PER_ELEMENT,u=n.byteLength/e[1];this.bandCount=Math.floor(u/d/e[0]);const s=Math.ceil(this.bandCount/4);if(1===s){const s=o.createTexture();return this.textures.push(s),u2(a,s,n,e,this.bandCount,t.interpolate),void this.setReady()}const r=new Array(s);for(let e=0;e<s;++e){const t=o.createTexture();this.textures.push(t);const n=e<s-1?4:(this.bandCount-1)%4+1;r[e]=new l(i*n)}let m=0,f=0;const g=e[0]*this.bandCount;for(let t=0;t<e[1];++t){for(let e=0;e<g;++e){const o=n[f+e],a=Math.floor(m/this.bandCount),t=e%this.bandCount,s=r[Math.floor(t/4)];s[a*(s.length/i)+t%4]=o,++m}f+=u/d}for(let n=0;n<s;++n){const c=this.textures[n],o=r[n];u2(a,c,o,e,o.length/i,t.interpolate)}this.setReady()}disposeInternal(){const e=this.helper_.getGL();this.helper_.deleteBuffer(this.coords);for(let t=0;t<this.textures.length;++t)e.deleteTexture(this.textures[t]);this.tile.removeEventListener(A,this.handleTileChange_)}getImagePixelData_(e,t,n){const s=this.gutter_,i=this.renderSize_[0],a=this.renderSize_[1];ei||(ei=K(1,1,void 0,{willReadFrequently:!0})),ei.clearRect(0,0,1,1);const r=e.width-2*s,c=e.height-2*s,l=s+Math.floor(r*(t/i)),d=s+Math.floor(c*(n/a));let o;try{ei.drawImage(e,l,d,1,1,0,0,1,1),o=ei.getImageData(0,0,1,1).data}catch{return ei=null,null}return o}getArrayPixelData_(e,t,n,s){const o=this.gutter_,u=this.renderSize_[0],h=this.renderSize_[1],a=t[0],r=t[1],i=a+2*o,m=r+2*o,c=o+Math.floor(a*(n/u)),l=o+Math.floor(r*(s/h));if(e instanceof DataView){const t=e.byteLength/(i*m),n=t*(l*i+c),s=e.buffer.slice(n,n+t);return new DataView(s)}const d=this.bandCount*(l*i+c);return e.slice(d,d+this.bandCount)}getPixelData(e,t){if(!this.loaded)return null;if(this.tile instanceof Cc){const n=this.tile.getData(),s=Ac(n);if(s){const n=this.tile.getSize();return this.getArrayPixelData_(s,n,e,t)}return this.getImagePixelData_(Mi(n),e,t)}return this.getImagePixelData_(this.tile.getImage(),e,t)}}class ii extends n4{constructor(e,t){super(e),t=t||{},this.inversePixelTransform_=[1,0,0,1,0,0],this.pixelContext_=null,this.postProcesses_=t.postProcesses,this.uniforms_=t.uniforms,this.helper,e.addChangeListener(N1,this.removeHelper.bind(this)),this.dispatchPreComposeEvent=this.dispatchPreComposeEvent.bind(this),this.dispatchPostComposeEvent=this.dispatchPostComposeEvent.bind(this)}dispatchPreComposeEvent(e,t){const n=this.getLayer();if(n.hasListener(dl)){const s=new $o(dl,void 0,t,e);n.dispatchEvent(s)}}dispatchPostComposeEvent(e,t){const n=this.getLayer();if(n.hasListener(W1)){const s=new $o(W1,void 0,t,e);n.dispatchEvent(s)}}reset(e){this.uniforms_=e.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)}removeHelper(){this.helper&&(this.helper.dispose(),delete this.helper)}prepareFrame(e){if(this.getLayer().getRenderSource()){let t,n=!0,s=-1;for(let o=0,c=e.layerStatesArray.length;o<c;o++){const i=e.layerStatesArray[o].layer,a=i.getRenderer();if(!(a instanceof ii)){n=!0;continue}const r=i.getClassName();if((n||r!==t)&&(s+=1,n=!1),t=r,a===this)break}const o="map/"+e.mapId+"/group/"+s;this.helper&&this.helper.canvasCacheKeyMatches(o)&&!this.helper.needsToBeRecreated()||(this.removeHelper(),this.helper=new x0({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:o}),t&&(this.helper.getCanvas().className=t),this.afterHelperCreated())}return this.prepareFrameInternal(e)}afterHelperCreated(){}prepareFrameInternal(){return!0}disposeInternal(){this.removeHelper(),super.disposeInternal()}dispatchRenderEvent_(e,t,n){const s=this.getLayer();if(s.hasListener(e)){Le(this.inversePixelTransform_,0,0,n.pixelRatio,-n.pixelRatio,0,0,-n.size[1]);const o=new $o(e,this.inversePixelTransform_,n,t);s.dispatchEvent(o)}}preRender(e,t){this.dispatchRenderEvent_(hl,e,t)}postRender(e,t){this.dispatchRenderEvent_(ui,e,t)}}const A1={TILE_TRANSFORM:"u_tileTransform",TRANSITION_ALPHA:"u_transitionAlpha",DEPTH:"u_depth",RENDER_EXTENT:"u_renderExtent",PATTERN_ORIGIN:"u_patternOrigin",RESOLUTION:"u_resolution",ZOOM:"u_zoom",GLOBAL_ALPHA:"u_globalAlpha",PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix"},o7={};function v2(e){return 1/(e+2)}function b2(){return{tileIds:new Set,representationsByZ:{}}}function j2(e,t){return e.tileIds.has(c(t))}function y2(e,t,n){const s=e.representationsByZ;n in s||(s[n]=new Set),s[n].add(t),e.tileIds.add(c(t.tile))}function k1(e,t){const n=e.layerStatesArray[e.layerIndex];n.extent&&(t=ce(t,Pe(n.extent,e.viewState.projection)));const s=n.layer.getRenderSource();if(!s.getWrapX()){const n=s.getTileGridForProjection(e.viewState.projection).getExtent();n&&(t=ce(t,n))}return t}function kl(e,t){return`${e.getKey()},${an(t)}`}class C1 extends ii{constructor(e,t){super(e,{uniforms:t.uniforms,postProcesses:t.postProcesses}),this.renderComplete=!1,this.tileTransform_=[1,0,0,1,0,0],this.tempMat4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.tempTileRange_=new fi(0,0,0,0),this.tempTileCoord_=wo(0,0,0),this.tempSize_=[0,0];const n=void 0!==t.cacheSize?t.cacheSize:512;this.tileRepresentationCache=new _l(n),this.frameState=null,this.projection_=void 0}reset(e){super.reset({uniforms:e.uniforms})}isDrawableTile_(e){const n=this.getLayer(),t=e.getState(),s=n.getUseInterimTilesOnError();return t==L||t==J||t==Z&&!s}prepareFrameInternal(e){this.projection_?e.viewState.projection!==this.projection_&&(this.clearCache(),this.projection_=e.viewState.projection):this.projection_=e.viewState.projection;const t=this.getLayer().getRenderSource();return!!t&&!Ft(k1(e,e.extent))&&"ready"===t.getState()}createTileRepresentation(){return g()}enqueueTiles(e,t,n,s,o){const d=e.viewState,r=this.getLayer(),i=r.getRenderSource(),a=i.getTileGridForProjection(d.projection),m=i.getGutterForProjection(d.projection),l=c(i);l in e.wantedTiles||(e.wantedTiles[l]={});const f=e.wantedTiles[l],u=this.tileRepresentationCache,h=r.getMapInternal(),p=Math.max(n-o,a.getMinZoom(),a.getZForResolution(Math.min(r.getMaxResolution(),h?h.getView().getResolutionForZoom(Math.max(r.getMinZoom(),0)):a.getResolution(0)),i.zDirection));for(let o=n;o>=p;--o){const r=a.getTileRangeForExtentAndZ(t,o,this.tempTileRange_),c=a.getResolution(o);for(let t=r.minX;t<=r.maxX;++t)for(let p=r.minY;p<=r.maxY;++p){const v=wo(o,t,p,this.tempTileCoord_),g=kl(i,v);let n,h;if(u.containsKey(g)&&(n=u.get(g),h=n.tile),n&&n.tile.key===i.getKey()||(h=i.getTile(o,t,p,e.pixelRatio,d.projection)),j2(s,h))continue;if(n)if(this.isDrawableTile_(h))n.setTile(h);else{const e=h.getInterimTile();n.setTile(e)}else n=this.createTileRepresentation({tile:h,grid:a,helper:this.helper,gutter:m}),u.set(g,n);y2(s,n,o);const b=h.getKey();f[b]=!0,h.getState()===ne&&(e.tileQueue.isKeyQueued(b)||e.tileQueue.enqueue([h,l,a.getTileCoordCenter(v),c]))}}}beforeTilesRender(e,t){this.helper.prepareDraw(this.frameState,!t,!0)}beforeTilesMaskRender(){return!1}renderTile(){}renderTileMask(){}drawTile_(e,t,n,s,o,i,a){if(!t.ready)return;const u=t.tile.tileCoord,g=an(u),m=g in i?i[g]:1,l=a.getResolution(n),r=X(a.getTileSize(n),this.tempSize_),h=a.getOrigin(n),v=a.getTileCoordExtent(u),j=m<1?-1:v2(n);m<1&&(e.animate=!0);const c=e.viewState,C=c.center[0],O=c.center[1],d=r[0]+2*s,p=r[1]+2*s,y=d/p,_=(C-h[0])/(r[0]*l),w=(h[1]-O)/(r[1]*l),f=c.resolution/l,x=u[1],b=u[2];hc(this.tileTransform_),qs(this.tileTransform_,2/(e.size[0]*f/d),-2/(e.size[1]*f/d)),e6(this.tileTransform_,c.rotation),qs(this.tileTransform_,1,1/y),Ko(this.tileTransform_,(r[0]*(x-_)-s)/d,(r[1]*(b-w)-s)/p),this.renderTile(t,this.tileTransform_,e,o,l,r,h,v,j,s,m)}renderFrame(e){this.frameState=e,this.renderComplete=!0;const f=this.helper.getGL();this.preRender(f,e);const l=e.viewState,g=this.getLayer(),i=g.getRenderSource(),t=i.getTileGridForProjection(l.projection),m=i.getGutterForProjection(l.projection),r=k1(e,e.extent),s=t.getZForResolution(l.resolution,i.zDirection),n=b2(),u=g.getPreload();if(e.nextExtent){const s=t.getZForResolution(l.nextResolution,i.zDirection),o=k1(e,e.nextExtent);this.enqueueTiles(e,o,s,n,u)}this.enqueueTiles(e,r,s,n,0),u>0&&setTimeout(()=>{this.enqueueTiles(e,r,s-1,n,u-1)},0);const o={},h=c(this),b=e.time;let p=!1;for(const a of n.representationsByZ[s]){const e=a.tile;if((e instanceof Es||e instanceof Nr)&&e.getState()===J)continue;const i=e.tileCoord;if(a.ready){const t=e.getAlpha(h,b);if(1===t){e.endTransition(h);continue}p=!0,o[an(i)]=t}if(this.renderComplete=!1,this.findAltTiles_(t,i,s+1,n))continue;const r=t.getMinZoom();for(let e=s-1;e>=r;--e)if(this.findAltTiles_(t,i,e,n))break}const a=n.representationsByZ,d=Object.keys(a).map(Number).sort(u0);if(this.beforeTilesMaskRender(e))for(let e=0,s=d.length;e<s;++e){const n=d[e];for(const e of a[n]){const s=e.tile.tileCoord;if(an(s)in o)continue;const i=t.getTileCoordExtent(s);this.renderTileMask(e,n,i,v2(n))}}this.beforeTilesRender(e,p);for(let n=0,i=d.length;n<i;++n){const s=d[n];for(const n of a[s])an(n.tile.tileCoord)in o||this.drawTile_(e,n,s,m,r,o,t)}for(const n of a[s])an(n.tile.tileCoord)in o&&this.drawTile_(e,n,s,m,r,o,t);this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);const j=this.helper.getCanvas(),v=this.tileRepresentationCache;for(;v.canExpireCache();)v.pop().dispose();return e.postRenderFunctions.push(function(e,t){i.updateCacheSize(.1,t.viewState.projection),i.expireCache(t.viewState.projection,o7)}),this.postRender(f,e),j}findAltTiles_(e,t,n,s){const o=e.getTileRangeForTileCoordAndZ(t,n,this.tempTileRange_);if(!o)return!1;let i=!0;const a=this.tileRepresentationCache,r=this.getLayer().getRenderSource();for(let e=o.minX;e<=o.maxX;++e)for(let t=o.minY;t<=o.maxY;++t){const c=kl(r,[n,e,t]);let l=!1;if(a.containsKey(c)){const e=a.get(c);e.ready&&!j2(s,e.tile)&&(y2(s,e,n),l=!0)}l||(i=!1)}return i}clearCache(){const e=this.tileRepresentationCache;e.forEach(e=>e.dispose()),e.clear()}removeHelper(){this.helper&&this.clearCache(),super.removeHelper()}disposeInternal(){super.disposeInternal(),delete this.frameState}}const k={...A1,TILE_TEXTURE_ARRAY:"u_tileTextures",TEXTURE_PIXEL_WIDTH:"u_texturePixelWidth",TEXTURE_PIXEL_HEIGHT:"u_texturePixelHeight",TEXTURE_RESOLUTION:"u_textureResolution",TEXTURE_ORIGIN_X:"u_textureOriginX",TEXTURE_ORIGIN_Y:"u_textureOriginY"},Ti={TEXTURE_COORD:"a_textureCoord"},J5=[{name:Ti.TEXTURE_COORD,size:2,type:he.FLOAT}];class k2 extends C1{constructor(e,t){super(e,t),this.program_,this.vertexShader_=t.vertexShader,this.fragmentShader_=t.fragmentShader,this.indices_=new on(As,go),this.indices_.fromArray([0,1,3,1,2,3]),this.paletteTextures_=t.paletteTextures||[]}reset(e){if(super.reset(e),this.helper){const e=this.helper.getGL();for(const t of this.paletteTextures_)t.delete(e)}this.vertexShader_=e.vertexShader,this.fragmentShader_=e.fragmentShader,this.paletteTextures_=e.paletteTextures||[],this.helper&&(this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_))}afterHelperCreated(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.helper.flushBufferData(this.indices_)}removeHelper(){if(this.helper){const e=this.helper.getGL();for(const t of this.paletteTextures_)t.delete(e)}super.removeHelper()}createTileRepresentation(e){return new m2(e)}beforeTilesRender(e,t){super.beforeTilesRender(e,t),this.helper.useProgram(this.program_,e)}renderTile(e,t,n,s,o,i,a,r,c,l,d){const p=this.helper.getGL();this.helper.bindBuffer(e.coords),this.helper.bindBuffer(this.indices_),this.helper.enableAttributes(J5);let u=0;for(;u<e.textures.length;){const t=`${k.TILE_TEXTURE_ARRAY}[${u}]`;this.helper.bindTexture(e.textures[u],u,t),++u}for(let e=0;e<this.paletteTextures_.length;++e){const t=this.paletteTextures_[e],n=t.getTexture(p);this.helper.bindTexture(n,u,t.name),++u}const m=n.viewState,g=i[0]+2*l,v=i[1]+2*l,f=e.tile.tileCoord,b=f[1],j=f[2];this.helper.setUniformMatrixValue(k.TILE_TRANSFORM,ln(this.tempMat4,t)),this.helper.setUniformFloatValue(k.TRANSITION_ALPHA,d),this.helper.setUniformFloatValue(k.DEPTH,c);let h=s;l>0&&(h=r,ce(h,s,h)),this.helper.setUniformFloatVec4(k.RENDER_EXTENT,h),this.helper.setUniformFloatValue(k.RESOLUTION,m.resolution),this.helper.setUniformFloatValue(k.ZOOM,m.zoom),this.helper.setUniformFloatValue(k.TEXTURE_PIXEL_WIDTH,g),this.helper.setUniformFloatValue(k.TEXTURE_PIXEL_HEIGHT,v),this.helper.setUniformFloatValue(k.TEXTURE_RESOLUTION,o),this.helper.setUniformFloatValue(k.TEXTURE_ORIGIN_X,a[0]+b*i[0]*o-l*o),this.helper.setUniformFloatValue(k.TEXTURE_ORIGIN_Y,a[1]-j*i[1]*o+l*o),this.helper.drawElements(0,this.indices_.getSize())}getData(e){if(!this.helper.getGL())return null;const a=this.frameState;if(!a)return null;const r=this.getLayer(),n=R(a.pixelToCoordinateTransform,e.slice()),i=a.viewState,c=r.getExtent();if(c&&!qe(Pe(c,i.projection),n))return null;const l=r.getSources(oe([n]),i.resolution);let s,o,t;for(s=l.length-1;s>=0;--s)if(o=l[s],"ready"===o.getState()){if(t=o.getTileGridForProjection(i.projection),o.getWrapX())break;const e=t.getExtent();if(!e||qe(e,n))break}if(s<0)return null;const d=this.tileRepresentationCache;for(let e=t.getZForResolution(i.resolution);e>=t.getMinZoom();--e){const s=t.getTileCoordForCoordAndZ(n,e),c=kl(o,s);if(!d.containsKey(c))continue;const a=d.get(c),r=a.tile;if((r instanceof Es||r instanceof Nr)&&r.getState()===J)return null;if(!a.loaded)continue;const l=t.getOrigin(e),u=X(t.getTileSize(e)),h=t.getResolution(e),m=(n[0]-l[0])/h-s[1]*u[0],f=(l[1]-n[1])/h-s[2]*u[1];return a.getPixelData(m,f)}return null}disposeInternal(){const e=this.helper;if(e){const t=e.getGL();for(const e of this.paletteTextures_)e.delete(t);this.paletteTextures_.length=0,t.deleteProgram(this.program_),delete this.program_,e.deleteBuffer(this.indices_)}super.disposeInternal(),delete this.indices_}}function ts(e){const t=e.toString();return t.includes(".")?t:t+".0"}function ai(e){if(e.length<2||e.length>4)throw new Error("`formatArray` can only output `vec2`, `vec3` or `vec4` arrays.");return`vec${e.length}(${e.map(ts).join(", ")})`}function gi(e){const t=mt(e),n=t.length>3?t[3]:1;return ai([t[0]/255*n,t[1]/255*n,t[2]/255*n,n])}function F2(e){return ai(X(e))}const y1={};let Z5=0;function ji(e){return e in y1||(y1[e]=Z5++),y1[e]}function Zt(e){return ts(ji(e))}function tl(e){return"u_var_"+e}function G5(){return{inFragmentShader:!1,variables:{},properties:{},functions:{},bandCount:0,style:{}}}const b1="getBandValue",v1="u_paletteTextures";function I2(e,t,n,s){const o=V(e,n,t);if(Ho(o.type,Zn))throw new Error("No matching type was found");if(!vt(t,o.type)){const e=fe(t),n=fe(o.type);throw new Error(`Expected expression to be of type ${e}, got ${n}`)}return g1(o,t,s)}function H(e){return(t,n,s)=>{const o=n.args.length,i=new Array(o);for(let e=0;e<o;++e)i[e]=g1(n.args[e],s,t);return e(i,t)}}const K5={[s.Get]:(e,t)=>{const n=t.args[0].value;return n in e.properties||(e.properties[n]={name:n,type:t.type}),(e.inFragmentShader?"v_prop_":"a_prop_")+n},[s.GeometryType]:(e)=>{const s="geometryType";return s in e.properties||(e.properties[s]={name:s,type:pe,evaluator:e=>Jr(e.getGeometry())}),(e.inFragmentShader?"v_prop_":"a_prop_")+s},[s.Var]:(e,t)=>{const n=t.args[0].value;return n in e.variables||(e.variables[n]={name:n,type:t.type}),tl(n)},[s.Resolution]:()=>"u_resolution",[s.Zoom]:()=>"u_zoom",[s.Time]:()=>"u_time",[s.Any]:H(e=>`(${e.join(" || ")})`),[s.All]:H(e=>`(${e.join(" && ")})`),[s.Not]:H(([e])=>`(!${e})`),[s.Equal]:H(([e,t])=>`(${e} == ${t})`),[s.NotEqual]:H(([e,t])=>`(${e} != ${t})`),[s.GreaterThan]:H(([e,t])=>`(${e} > ${t})`),[s.GreaterThanOrEqualTo]:H(([e,t])=>`(${e} >= ${t})`),[s.LessThan]:H(([e,t])=>`(${e} < ${t})`),[s.LessThanOrEqualTo]:H(([e,t])=>`(${e} <= ${t})`),[s.Multiply]:H(e=>`(${e.join(" * ")})`),[s.Divide]:H(([e,t])=>`(${e} / ${t})`),[s.Add]:H(e=>`(${e.join(" + ")})`),[s.Subtract]:H(([e,t])=>`(${e} - ${t})`),[s.Clamp]:H(([e,t,n])=>`clamp(${e}, ${t}, ${n})`),[s.Mod]:H(([e,t])=>`mod(${e}, ${t})`),[s.Pow]:H(([e,t])=>`pow(${e}, ${t})`),[s.Abs]:H(([e])=>`abs(${e})`),[s.Floor]:H(([e])=>`floor(${e})`),[s.Ceil]:H(([e])=>`ceil(${e})`),[s.Round]:H(([e])=>`floor(${e} + 0.5)`),[s.Sin]:H(([e])=>`sin(${e})`),[s.Cos]:H(([e])=>`cos(${e})`),[s.Atan]:H(([e,t])=>void 0!==t?`atan(${e}, ${t})`:`atan(${e})`),[s.Sqrt]:H(([e])=>`sqrt(${e})`),[s.Match]:H(e=>{const n=e[0],s=e[e.length-1];let t=null;for(let o=e.length-3;o>=1;o-=2)t=`(${n} == ${e[o]} ? ${e[o+1]} : ${t||s})`;return t}),[s.Between]:H(([e,t,n])=>`(${e} >= ${t} && ${e} <= ${n})`),[s.Interpolate]:H(([e,t,...n])=>{let s="";for(let o=0;o<n.length-2;o+=2){const i=n[o],c=s||n[o+1],a=n[o+2],l=n[o+3];let r;r=e===ts(1)?`(${t} - ${i}) / (${a} - ${i})`:`(pow(${e}, (${t} - ${i})) - 1.0) / (pow(${e}, (${a} - ${i})) - 1.0)`,s=`mix(${c}, ${l}, clamp(${r}, 0.0, 1.0))`}return s}),[s.Case]:H(e=>{const n=e[e.length-1];let t=null;for(let s=e.length-3;s>=0;s-=2)t=`(${e[s]} ? ${e[s+1]} : ${t||n})`;return t}),[s.In]:H(([e,...t],n)=>{const s=function(e,t){return`operator_${e}_${Object.keys(t.functions).length}`}("in",n),o=[];for(let e=0;e<t.length;e+=1)o.push(`  if (inputValue == ${t[e]}) { return true; }`);return n.functions[s]=`bool ${s}(float inputValue) {
${o.join(`
`)}
  return false;
}`,`${s}(${e})`}),[s.Array]:H(e=>`vec${e.length}(${e.join(", ")})`),[s.Color]:H(e=>{if(1===e.length)return`vec4(vec3(${e[0]} / 255.0), 1.0)`;if(2===e.length)return`(${e[1]} * vec4(vec3(${e[0]} / 255.0), 1.0))`;const t=e.slice(0,3).map(e=>`${e} / 255.0`);return 3===e.length?`vec4(${t.join(", ")}, 1.0)`:`(${e[3]} * vec4(${t.join(", ")}, 1.0))`}),[s.Band]:H(([e,t,n],s)=>{if(!(b1 in s.functions)){let e="";const t=s.bandCount||1;for(let n=0;n<t;n++){const o=Math.floor(n/4);let s=n%4;n===t-1&&1===s&&(s=3),e+=`  if (band == ${n+1}.0) {
    return texture2D(${`${k.TILE_TEXTURE_ARRAY}[${o}]`}, v_textureCoord + vec2(dx, dy))[${s}];
  }
`}s.functions[b1]=`float getBandValue(float band, float xOffset, float yOffset) {
  float dx = xOffset / ${k.TEXTURE_PIXEL_WIDTH};
  float dy = yOffset / ${k.TEXTURE_PIXEL_HEIGHT};
${e}
}`}return`${b1}(${e}, ${t??"0.0"}, ${n??"0.0"})`}),[s.Palette]:(e,t)=>{const[a,...s]=t.args,o=s.length,n=new Uint8Array(4*o);for(let e=0;e<s.length;e++){const t=mt(s[e].value),o=4*e;n[o]=t[0],n[o+1]=t[1],n[o+2]=t[2],n[o+3]=255*t[3]}e.paletteTextures||(e.paletteTextures=[]);const i=`${v1}[${e.paletteTextures.length}]`,r=new k0(i,n);return e.paletteTextures.push(r),`texture2D(${i}, vec2((${g1(a,l,e)} + 0.5) / ${o}.0, 0.5))`}};function g1(e,t,n){if(e instanceof Uu){const s=K5[e.operator];if(void 0===s)throw new Error(`No compiler defined for this operator: ${JSON.stringify(e.operator)}`);return s(n,e,t)}if((e.type&l)>0)return ts(e.value);if((e.type&Q)>0)return e.value.toString();if((e.type&pe)>0)return Zt(e.value.toString());if((e.type&B)>0)return gi(e.value);if((e.type&be)>0)return ai(e.value);if((e.type&ct)>0)return F2(e.value);throw new Error(`Unexpected expression ${e.value} (expected type ${fe(t)})`)}function U5(){return{"fill-color":"rgba(255,255,255,0.4)","stroke-color":"#3399CC","stroke-width":1.25,"circle-radius":5,"circle-fill-color":"rgba(255,255,255,0.4)","circle-stroke-width":1.25,"circle-stroke-color":"#3399CC"}}const Ns=`#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif
uniform mat4 u_projectionMatrix;
uniform mat4 u_screenToWorldMatrix;
uniform vec2 u_viewportSizePx;
uniform float u_pixelRatio;
uniform float u_globalAlpha;
uniform float u_time;
uniform float u_zoom;
uniform float u_resolution;
uniform float u_rotation;
uniform vec4 u_renderExtent;
uniform vec2 u_patternOrigin;
uniform float u_depth;
uniform mediump int u_hitDetection;

const float PI = 3.141592653589793238;
const float TWO_PI = 2.0 * PI;

// this used to produce an alpha-premultiplied color from a texture
vec4 samplePremultiplied(sampler2D sampler, vec2 texCoord) {
  vec4 color = texture2D(sampler, texCoord);
  return vec4(color.rgb * color.a, color.a);
}
`,Bo={"fill-color":"rgba(255,255,255,0.4)","stroke-color":"#3399CC","stroke-width":1.25,"circle-radius":5,"circle-fill-color":"rgba(255,255,255,0.4)","circle-stroke-width":1.25,"circle-stroke-color":"#3399CC"};class Yc{constructor(){this.uniforms_=[],this.attributes_=[],this.varyings_=[],this.hasSymbol_=!1,this.symbolSizeExpression_=`vec2(${ts(Bo["circle-radius"])} + ${ts(.5*Bo["circle-stroke-width"])})`,this.symbolRotationExpression_="0.0",this.symbolOffsetExpression_="vec2(0.0)",this.symbolColorExpression_=gi(Bo["circle-fill-color"]),this.texCoordExpression_="vec4(0.0, 0.0, 1.0, 1.0)",this.discardExpression_="false",this.symbolRotateWithView_=!1,this.hasStroke_=!1,this.strokeWidthExpression_=ts(Bo["stroke-width"]),this.strokeColorExpression_=gi(Bo["stroke-color"]),this.strokeOffsetExpression_="0.",this.strokeCapExpression_=Zt("round"),this.strokeJoinExpression_=Zt("round"),this.strokeMiterLimitExpression_="10.",this.strokeDistanceFieldExpression_="-1000.",this.hasFill_=!1,this.fillColorExpression_=gi(Bo["fill-color"]),this.vertexShaderFunctions_=[],this.fragmentShaderFunctions_=[]}addUniform(e){return this.uniforms_.push(e),this}addAttribute(e){return this.attributes_.push(e),this}addVarying(e,t,n){return this.varyings_.push({name:e,type:t,expression:n}),this}setSymbolSizeExpression(e){return this.hasSymbol_=!0,this.symbolSizeExpression_=e,this}getSymbolSizeExpression(){return this.symbolSizeExpression_}setSymbolRotationExpression(e){return this.symbolRotationExpression_=e,this}setSymbolOffsetExpression(e){return this.symbolOffsetExpression_=e,this}getSymbolOffsetExpression(){return this.symbolOffsetExpression_}setSymbolColorExpression(e){return this.hasSymbol_=!0,this.symbolColorExpression_=e,this}getSymbolColorExpression(){return this.symbolColorExpression_}setTextureCoordinateExpression(e){return this.texCoordExpression_=e,this}setFragmentDiscardExpression(e){return this.discardExpression_=e,this}getFragmentDiscardExpression(){return this.discardExpression_}setSymbolRotateWithView(e){return this.symbolRotateWithView_=e,this}setStrokeWidthExpression(e){return this.hasStroke_=!0,this.strokeWidthExpression_=e,this}setStrokeColorExpression(e){return this.hasStroke_=!0,this.strokeColorExpression_=e,this}getStrokeColorExpression(){return this.strokeColorExpression_}setStrokeOffsetExpression(e){return this.strokeOffsetExpression_=e,this}setStrokeCapExpression(e){return this.strokeCapExpression_=e,this}setStrokeJoinExpression(e){return this.strokeJoinExpression_=e,this}setStrokeMiterLimitExpression(e){return this.strokeMiterLimitExpression_=e,this}setStrokeDistanceFieldExpression(e){return this.strokeDistanceFieldExpression_=e,this}setFillColorExpression(e){return this.hasFill_=!0,this.fillColorExpression_=e,this}getFillColorExpression(){return this.fillColorExpression_}addVertexShaderFunction(e){this.vertexShaderFunctions_.includes(e)||this.vertexShaderFunctions_.push(e)}addFragmentShaderFunction(e){this.fragmentShaderFunctions_.includes(e)||this.fragmentShaderFunctions_.push(e)}getSymbolVertexShader(){return this.hasSymbol_?`${Ns}
${this.uniforms_.map(function(e){return"uniform "+e+";"}).join(`
`)}
attribute vec2 a_position;
attribute float a_index;
attribute vec4 a_prop_hitColor;
${this.attributes_.map(function(e){return"attribute "+e+";"}).join(`
`)}
varying vec2 v_texCoord;
varying vec2 v_quadCoord;
varying vec4 v_prop_hitColor;
varying vec2 v_centerPx;
varying float v_angle;
varying vec2 v_quadSizePx;
${this.varyings_.map(function(e){return"varying "+e.type+" "+e.name+";"}).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
vec2 pxToScreen(vec2 coordPx) {
  vec2 scaled = coordPx / u_viewportSizePx / 0.5;
  return scaled;
}

vec2 screenToPx(vec2 coordScreen) {
  return (coordScreen * 0.5 + 0.5) * u_viewportSizePx;
}

void main(void) {
  v_quadSizePx = ${this.symbolSizeExpression_};
  vec2 halfSizePx = v_quadSizePx * 0.5;
  vec2 centerOffsetPx = ${this.symbolOffsetExpression_};
  vec2 offsetPx = centerOffsetPx;
  if (a_index == 0.0) {
    offsetPx -= halfSizePx;
  } else if (a_index == 1.0) {
    offsetPx += halfSizePx * vec2(1., -1.);
  } else if (a_index == 2.0) {
    offsetPx += halfSizePx;
  } else {
    offsetPx += halfSizePx * vec2(-1., 1.);
  }
  float angle = ${this.symbolRotationExpression_};
  ${this.symbolRotateWithView_?"angle += u_rotation;":""}
  float c = cos(-angle);
  float s = sin(-angle);
  offsetPx = vec2(c * offsetPx.x - s * offsetPx.y, s * offsetPx.x + c * offsetPx.y);
  vec4 center = u_projectionMatrix * vec4(a_position, 0.0, 1.0);
  gl_Position = center + vec4(pxToScreen(offsetPx), u_depth, 0.);
  vec4 texCoord = ${this.texCoordExpression_};
  float u = a_index == 0.0 || a_index == 3.0 ? texCoord.s : texCoord.p;
  float v = a_index == 2.0 || a_index == 3.0 ? texCoord.t : texCoord.q;
  v_texCoord = vec2(u, v);
  v_prop_hitColor = a_prop_hitColor;
  v_angle = angle;
  c = cos(-v_angle);
  s = sin(-v_angle);
  centerOffsetPx = vec2(c * centerOffsetPx.x - s * centerOffsetPx.y, s * centerOffsetPx.x + c * centerOffsetPx.y); 
  v_centerPx = screenToPx(center.xy) + centerOffsetPx;
${this.varyings_.map(function(e){return"  "+e.name+" = "+e.expression+";"}).join(`
`)}
}`:null}getSymbolFragmentShader(){return this.hasSymbol_?`${Ns}
${this.uniforms_.map(function(e){return"uniform "+e+";"}).join(`
`)}
varying vec2 v_texCoord;
varying vec4 v_prop_hitColor;
varying vec2 v_centerPx;
varying float v_angle;
varying vec2 v_quadSizePx;
${this.varyings_.map(function(e){return"varying "+e.type+" "+e.name+";"}).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}

void main(void) {
  if (${this.discardExpression_}) { discard; }
  vec2 coordsPx = gl_FragCoord.xy / u_pixelRatio - v_centerPx; // relative to center
  float c = cos(v_angle);
  float s = sin(v_angle);
  coordsPx = vec2(c * coordsPx.x - s * coordsPx.y, s * coordsPx.x + c * coordsPx.y);
  gl_FragColor = ${this.symbolColorExpression_};
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.05) { discard; };
    gl_FragColor = v_prop_hitColor;
  }
}`:null}getStrokeVertexShader(){return this.hasStroke_?`${Ns}
${this.uniforms_.map(function(e){return"uniform "+e+";"}).join(`
`)}
attribute vec2 a_position;
attribute float a_index;
attribute vec2 a_segmentStart;
attribute vec2 a_segmentEnd;
attribute float a_parameters;
attribute float a_distance;
attribute vec2 a_joinAngles;
attribute vec4 a_prop_hitColor;
${this.attributes_.map(function(e){return"attribute "+e+";"}).join(`
`)}
varying vec2 v_segmentStart;
varying vec2 v_segmentEnd;
varying float v_angleStart;
varying float v_angleEnd;
varying float v_width;
varying vec4 v_prop_hitColor;
varying float v_distanceOffsetPx;
${this.varyings_.map(function(e){return"varying "+e.type+" "+e.name+";"}).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
vec2 worldToPx(vec2 worldPos) {
  vec4 screenPos = u_projectionMatrix * vec4(worldPos, 0.0, 1.0);
  return (0.5 * screenPos.xy + 0.5) * u_viewportSizePx;
}

vec4 pxToScreen(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return vec4(screenPos, u_depth, 1.0);
}

bool isCap(float joinAngle) {
  return joinAngle < -0.1;
}

vec2 getJoinOffsetDirection(vec2 normalPx, float joinAngle) {
  float halfAngle = joinAngle / 2.0;
  float c = cos(halfAngle);
  float s = sin(halfAngle);
  vec2 angleBisectorNormal = vec2(s * normalPx.x + c * normalPx.y, -c * normalPx.x + s * normalPx.y);
  float length = 1.0 / s;
  return angleBisectorNormal * length;
}

vec2 getOffsetPoint(vec2 point, vec2 normal, float joinAngle, float offsetPx) {
  // if on a cap or the join angle is too high, offset the line along the segment normal
  if (cos(joinAngle) > 0.998 || isCap(joinAngle)) {
    return point - normal * offsetPx;
  }
  // offset is applied along the inverted normal (positive offset goes "right" relative to line direction)
  return point - getJoinOffsetDirection(normal, joinAngle) * offsetPx;
}

void main(void) {
  v_angleStart = a_joinAngles.x;
  v_angleEnd = a_joinAngles.y;
  float vertexNumber = floor(abs(a_parameters) / 10000. + 0.5);
  // we're reading the fractional part while keeping the sign (so -4.12 gives -0.12, 3.45 gives 0.45)
  float angleTangentSum = fract(abs(a_parameters) / 10000.) * 10000. * sign(a_parameters);

  float lineWidth = ${this.strokeWidthExpression_};
  float lineOffsetPx = ${this.strokeOffsetExpression_};

  // compute segment start/end in px with offset
  vec2 segmentStartPx = worldToPx(a_segmentStart);
  vec2 segmentEndPx = worldToPx(a_segmentEnd);
  vec2 tangentPx = normalize(segmentEndPx - segmentStartPx);
  vec2 normalPx = vec2(-tangentPx.y, tangentPx.x);
  segmentStartPx = getOffsetPoint(segmentStartPx, normalPx, v_angleStart, lineOffsetPx),
  segmentEndPx = getOffsetPoint(segmentEndPx, normalPx, v_angleEnd, lineOffsetPx);
  
  // compute current vertex position
  float normalDir = vertexNumber < 0.5 || (vertexNumber > 1.5 && vertexNumber < 2.5) ? 1.0 : -1.0;
  float tangentDir = vertexNumber < 1.5 ? 1.0 : -1.0;
  float angle = vertexNumber < 1.5 ? v_angleStart : v_angleEnd;
  vec2 joinDirection;
  vec2 positionPx = vertexNumber < 1.5 ? segmentStartPx : segmentEndPx;
  // if angle is too high, do not make a proper join
  if (cos(angle) > 0.985 || isCap(angle)) {
    joinDirection = normalPx * normalDir - tangentPx * tangentDir;
  } else {
    joinDirection = getJoinOffsetDirection(normalPx * normalDir, angle);
  }
  positionPx = positionPx + joinDirection * (lineWidth * 0.5 + 1.); // adding 1 pixel for antialiasing
  gl_Position = pxToScreen(positionPx);

  v_segmentStart = segmentStartPx;
  v_segmentEnd = segmentEndPx;
  v_width = lineWidth;
  v_prop_hitColor = a_prop_hitColor;
  v_distanceOffsetPx = a_distance / u_resolution - (lineOffsetPx * angleTangentSum);
${this.varyings_.map(function(e){return"  "+e.name+" = "+e.expression+";"}).join(`
`)}
}`:null}getStrokeFragmentShader(){return this.hasStroke_?`${Ns}
${this.uniforms_.map(function(e){return"uniform "+e+";"}).join(`
`)}
varying vec2 v_segmentStart;
varying vec2 v_segmentEnd;
varying float v_angleStart;
varying float v_angleEnd;
varying float v_width;
varying vec4 v_prop_hitColor;
varying float v_distanceOffsetPx;
${this.varyings_.map(function(e){return"varying "+e.type+" "+e.name+";"}).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}

vec2 pxToWorld(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return (u_screenToWorldMatrix * vec4(screenPos, 0.0, 1.0)).xy;
}

bool isCap(float joinAngle) {
  return joinAngle < -0.1;
}

float segmentDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  vec2 tangent = normalize(end - start);
  vec2 normal = vec2(-tangent.y, tangent.x);
  vec2 startToPoint = point - start;
  return abs(dot(startToPoint, normal)) - width * 0.5;
}

float buttCapDistanceField(vec2 point, vec2 start, vec2 end) {
  vec2 startToPoint = point - start;
  vec2 tangent = normalize(end - start);
  return dot(startToPoint, -tangent);
}

float squareCapDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  return buttCapDistanceField(point, start, end) - width * 0.5;
}

float roundCapDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  float onSegment = max(0., 1000. * dot(point - start, end - start)); // this is very high when inside the segment
  return length(point - start) - width * 0.5 - onSegment;
}

float roundJoinDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  return roundCapDistanceField(point, start, end, width);
}

float bevelJoinField(vec2 point, vec2 start, vec2 end, float width, float joinAngle) {
  vec2 startToPoint = point - start;
  vec2 tangent = normalize(end - start);
  float c = cos(joinAngle * 0.5);
  float s = sin(joinAngle * 0.5);
  float direction = -sign(sin(joinAngle));
  vec2 bisector = vec2(c * tangent.x - s * tangent.y, s * tangent.x + c * tangent.y);
  float radius = width * 0.5 * s;
  return dot(startToPoint, bisector * direction) - radius;
}

float miterJoinDistanceField(vec2 point, vec2 start, vec2 end, float width, float joinAngle) {
  if (cos(joinAngle) > 0.985) { // avoid risking a division by zero
    return bevelJoinField(point, start, end, width, joinAngle);
  }
  float miterLength = 1. / sin(joinAngle * 0.5);
  float miterLimit = ${this.strokeMiterLimitExpression_};
  if (miterLength > miterLimit) {
    return bevelJoinField(point, start, end, width, joinAngle);
  }
  return -1000.;
}

float capDistanceField(vec2 point, vec2 start, vec2 end, float width, float capType) {
   if (capType == ${Zt("butt")}) {
    return buttCapDistanceField(point, start, end);
  } else if (capType == ${Zt("square")}) {
    return squareCapDistanceField(point, start, end, width);
  }
  return roundCapDistanceField(point, start, end, width);
}

float joinDistanceField(vec2 point, vec2 start, vec2 end, float width, float joinAngle, float joinType) {
  if (joinType == ${Zt("bevel")}) {
    return bevelJoinField(point, start, end, width, joinAngle);
  } else if (joinType == ${Zt("miter")}) {
    return miterJoinDistanceField(point, start, end, width, joinAngle);
  }
  return roundJoinDistanceField(point, start, end, width);
}

float computeSegmentPointDistance(vec2 point, vec2 start, vec2 end, float width, float joinAngle, float capType, float joinType) {
  if (isCap(joinAngle)) {
    return capDistanceField(point, start, end, width, capType);
  }
  return joinDistanceField(point, start, end, width, joinAngle, joinType);
}

void main(void) {
  vec2 currentPoint = gl_FragCoord.xy / u_pixelRatio;
  #ifdef GL_FRAGMENT_PRECISION_HIGH
  vec2 worldPos = pxToWorld(currentPoint);
  if (
    abs(u_renderExtent[0] - u_renderExtent[2]) > 0.0 && (
      worldPos[0] < u_renderExtent[0] ||
      worldPos[1] < u_renderExtent[1] ||
      worldPos[0] > u_renderExtent[2] ||
      worldPos[1] > u_renderExtent[3]
    )
  ) {
    discard;
  }
  #endif
  if (${this.discardExpression_}) { discard; }

  float segmentLength = length(v_segmentEnd - v_segmentStart);
  vec2 segmentTangent = (v_segmentEnd - v_segmentStart) / segmentLength;
  vec2 segmentNormal = vec2(-segmentTangent.y, segmentTangent.x);
  vec2 startToPoint = currentPoint - v_segmentStart;
  float currentLengthPx = max(0., min(dot(segmentTangent, startToPoint), segmentLength)) + v_distanceOffsetPx; 
  float currentRadiusPx = abs(dot(segmentNormal, startToPoint));
  float currentRadiusRatio = dot(segmentNormal, startToPoint) * 2. / v_width;
  vec4 color = ${this.strokeColorExpression_} * u_globalAlpha;
  float capType = ${this.strokeCapExpression_};
  float joinType = ${this.strokeJoinExpression_};
  float segmentStartDistance = computeSegmentPointDistance(currentPoint, v_segmentStart, v_segmentEnd, v_width, v_angleStart, capType, joinType);
  float segmentEndDistance = computeSegmentPointDistance(currentPoint, v_segmentEnd, v_segmentStart, v_width, v_angleEnd, capType, joinType);
  float distance = max(
    segmentDistanceField(currentPoint, v_segmentStart, v_segmentEnd, v_width),
    max(segmentStartDistance, segmentEndDistance)
  );
  distance = max(distance, ${this.strokeDistanceFieldExpression_});
  gl_FragColor = color * smoothstep(0.5, -0.5, distance);
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.1) { discard; };
    gl_FragColor = v_prop_hitColor;
  }
}`:null}getFillVertexShader(){return this.hasFill_?`${Ns}
${this.uniforms_.map(function(e){return"uniform "+e+";"}).join(`
`)}
attribute vec2 a_position;
attribute vec4 a_prop_hitColor;
${this.attributes_.map(function(e){return"attribute "+e+";"}).join(`
`)}
varying vec4 v_prop_hitColor;
${this.varyings_.map(function(e){return"varying "+e.type+" "+e.name+";"}).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
void main(void) {
  gl_Position = u_projectionMatrix * vec4(a_position, u_depth, 1.0);
  v_prop_hitColor = a_prop_hitColor;
${this.varyings_.map(function(e){return"  "+e.name+" = "+e.expression+";"}).join(`
`)}
}`:null}getFillFragmentShader(){return this.hasFill_?`${Ns}
${this.uniforms_.map(function(e){return"uniform "+e+";"}).join(`
`)}
varying vec4 v_prop_hitColor;
${this.varyings_.map(function(e){return"varying "+e.type+" "+e.name+";"}).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}
vec2 pxToWorld(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return (u_screenToWorldMatrix * vec4(screenPos, 0.0, 1.0)).xy;
}

vec2 worldToPx(vec2 worldPos) {
  vec4 screenPos = u_projectionMatrix * vec4(worldPos, 0.0, 1.0);
  return (0.5 * screenPos.xy + 0.5) * u_viewportSizePx;
}

void main(void) {
  vec2 pxPos = gl_FragCoord.xy / u_pixelRatio;
  vec2 pxOrigin = worldToPx(u_patternOrigin);
  #ifdef GL_FRAGMENT_PRECISION_HIGH
  vec2 worldPos = pxToWorld(pxPos);
  if (
    abs(u_renderExtent[0] - u_renderExtent[2]) > 0.0 && (
      worldPos[0] < u_renderExtent[0] ||
      worldPos[1] < u_renderExtent[1] ||
      worldPos[0] > u_renderExtent[2] ||
      worldPos[1] > u_renderExtent[3]
    )
  ) {
    discard;
  }
  #endif
  if (${this.discardExpression_}) { discard; }
  gl_FragColor = ${this.fillColorExpression_} * u_globalAlpha;
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.1) { discard; };
    gl_FragColor = v_prop_hitColor;
  }
}`:null}}class u1{constructor(){this.globalCounter_=0,this.refToFeature_=new Map,this.uidToRef_=new Map,this.freeGlobalRef_=[],this.polygonBatch={entries:{},geometriesCount:0,verticesCount:0,ringsCount:0},this.pointBatch={entries:{},geometriesCount:0},this.lineStringBatch={entries:{},geometriesCount:0,verticesCount:0}}addFeatures(e,t){for(let n=0;n<e.length;n++)this.addFeature(e[n],t)}addFeature(e,t){let n=e.getGeometry();n&&(t&&(n=n.clone(),n.applyTransform(t)),this.addGeometry_(n,e))}clearFeatureEntryInPointBatch_(e){const t=this.pointBatch.entries[c(e)];if(t)return this.pointBatch.geometriesCount-=t.flatCoordss.length,delete this.pointBatch.entries[c(e)],t}clearFeatureEntryInLineStringBatch_(e){const t=this.lineStringBatch.entries[c(e)];if(t)return this.lineStringBatch.verticesCount-=t.verticesCount,this.lineStringBatch.geometriesCount-=t.flatCoordss.length,delete this.lineStringBatch.entries[c(e)],t}clearFeatureEntryInPolygonBatch_(e){const t=this.polygonBatch.entries[c(e)];if(t)return this.polygonBatch.verticesCount-=t.verticesCount,this.polygonBatch.ringsCount-=t.ringsCount,this.polygonBatch.geometriesCount-=t.flatCoordss.length,delete this.polygonBatch.entries[c(e)],t}addGeometry_(e,t){const n=e.getType();switch(n){case"GeometryCollection":{const n=e.getGeometriesArray();for(const e of n)this.addGeometry_(e,t);break}case"MultiPolygon":{const s=e;this.addCoordinates_(n,s.getFlatCoordinates(),s.getEndss(),t,c(t),s.getStride());break}case"MultiLineString":{const s=e;this.addCoordinates_(n,s.getFlatCoordinates(),s.getEnds(),t,c(t),s.getStride());break}case"MultiPoint":{const s=e;this.addCoordinates_(n,s.getFlatCoordinates(),null,t,c(t),s.getStride());break}case"Polygon":{const s=e;this.addCoordinates_(n,s.getFlatCoordinates(),s.getEnds(),t,c(t),s.getStride());break}case"Point":{const s=e;this.addCoordinates_(n,s.getFlatCoordinates(),null,t,c(t),s.getStride());break}case"LineString":case"LinearRing":{const s=e;this.addCoordinates_(n,s.getFlatCoordinates(),null,t,c(t),s.getStride());break}}}addCoordinates_(e,t,n,s,o,i){let a;switch(e){case"MultiPolygon":{const e=n;for(let a=0,l=e.length;a<l;a++){let n=e[a];const r=a>0?e[a-1]:null,c=r?r[r.length-1]:0,d=n[n.length-1];n=c>0?n.map(e=>e-c):n,this.addCoordinates_("Polygon",t.slice(c,d),n,s,o,i)}break}case"MultiLineString":{const e=n;for(let n=0,a=e.length;n<a;n++){const r=n>0?e[n-1]:0;this.addCoordinates_("LineString",t.slice(r,e[n]),null,s,o,i)}break}case"MultiPoint":for(let e=0,n=t.length;e<n;e+=i)this.addCoordinates_("Point",t.slice(e,e+2),null,s,o,null);break;case"Polygon":{const e=n;if(s instanceof Ce){const n=Pi(t,e);if(n.length>1)return void this.addCoordinates_("MultiPolygon",t,n,s,o,i)}this.polygonBatch.entries[o]||(this.polygonBatch.entries[o]=this.addRefToEntry_(o,{feature:s,flatCoordss:[],verticesCount:0,ringsCount:0,ringsVerticesCounts:[]})),a=t.length/i;const r=n.length,c=n.map((e,t,n)=>t>0?(e-n[t-1])/i:e/i);this.polygonBatch.verticesCount+=a,this.polygonBatch.ringsCount+=r,this.polygonBatch.geometriesCount++,this.polygonBatch.entries[o].flatCoordss.push(G2(t,i)),this.polygonBatch.entries[o].ringsVerticesCounts.push(c),this.polygonBatch.entries[o].verticesCount+=a,this.polygonBatch.entries[o].ringsCount+=r;for(let n=0,a=e.length;n<a;n++){const r=n>0?e[n-1]:0;this.addCoordinates_("LinearRing",t.slice(r,e[n]),null,s,o,i)}break}case"Point":this.pointBatch.entries[o]||(this.pointBatch.entries[o]=this.addRefToEntry_(o,{feature:s,flatCoordss:[]})),this.pointBatch.geometriesCount++,this.pointBatch.entries[o].flatCoordss.push(t);break;case"LineString":case"LinearRing":this.lineStringBatch.entries[o]||(this.lineStringBatch.entries[o]=this.addRefToEntry_(o,{feature:s,flatCoordss:[],verticesCount:0})),a=t.length/i,this.lineStringBatch.verticesCount+=a,this.lineStringBatch.geometriesCount++,this.lineStringBatch.entries[o].flatCoordss.push(G2(t,i)),this.lineStringBatch.entries[o].verticesCount+=a}}addRefToEntry_(e,t){const s=this.uidToRef_.get(e),n=s||this.freeGlobalRef_.pop()||++this.globalCounter_;return t.ref=n,s||(this.refToFeature_.set(n,t.feature),this.uidToRef_.set(e,n)),t}returnRef_(e,t){if(!e)throw new Error("This feature has no ref: "+t);this.refToFeature_.delete(e),this.uidToRef_.delete(t),this.freeGlobalRef_.push(e)}changeFeature(e){this.removeFeature(e);const t=e.getGeometry();t&&this.addGeometry_(t,e)}removeFeature(e){let t;t=this.clearFeatureEntryInPointBatch_(e)||t,t=this.clearFeatureEntryInPolygonBatch_(e)||t,t=this.clearFeatureEntryInLineStringBatch_(e)||t,t&&this.returnRef_(t.ref,c(t.feature))}clear(){this.polygonBatch.entries={},this.polygonBatch.geometriesCount=0,this.polygonBatch.verticesCount=0,this.polygonBatch.ringsCount=0,this.lineStringBatch.entries={},this.lineStringBatch.geometriesCount=0,this.lineStringBatch.verticesCount=0,this.pointBatch.entries={},this.pointBatch.geometriesCount=0,this.globalCounter_=0,this.freeGlobalRef_=[],this.refToFeature_.clear(),this.uidToRef_.clear()}getFeatureFromRef(e){return this.refToFeature_.get(e)}}function G2(e,t){return 2===t?e:e.filter((e,n)=>n%t<2)}class X2 extends d4{constructor(e,t){super(e),this.batch_=new u1,this.styleRenderers_=t,this.buffers=[],this.maskVertices=new on(xs,go),this.setTile(e.tile)}generateMaskBuffer_(){const e=this.tile.getSourceTiles()[0].extent;this.maskVertices.fromArray([e[0],e[1],e[2],e[1],e[2],e[3],e[0],e[3]]),this.helper_.flushBufferData(this.maskVertices)}uploadTile(){this.generateMaskBuffer_(),this.batch_.clear();const e=this.tile.getSourceTiles(),t=e.reduce((e,t)=>e.concat(t.getFeatures()),[]);this.batch_.addFeatures(t);const n=Ko([1,0,0,1,0,0],-e[0].extent[0],-e[0].extent[1]),s=this.styleRenderers_.map((e,t)=>e.generateBuffers(this.batch_,n).then(e=>{this.buffers[t]=e}));Promise.all(s).then(()=>{this.setReady()})}}function O(e,t,n){const s=$r();return s.style=e.style,I2(t,n,s,e)}function d1(e){const t=mt(e);return[256*t[0]+t[1],256*t[2]+Math.round(255*t[3])]}function J2(e){return e===B||e===ct?2:e===be?4:1}function l1(e){const t=J2(e);return t>1?`vec${t}`:"float"}function Si(e){return(JSON.stringify(e).split("").reduce((e,t)=>(e<<5)-e+t.charCodeAt(0),0)>>>0).toString()}function r1(e,t,n,s){if(`${s}radius`in e&&"icon-"!==s){let o=O(n,e[`${s}radius`],l);`${s}radius2`in e&&(o=`max(${o}, ${O(n,e[`${s}radius2`],l)})`),`${s}stroke-width`in e&&(o=`(${o} + ${O(n,e[`${s}stroke-width`],l)} * 0.5)`),t.setSymbolSizeExpression(`vec2(${o} * 2. + 0.5)`)}if(`${s}scale`in e){const o=O(n,e[`${s}scale`],ct);t.setSymbolSizeExpression(`${t.getSymbolSizeExpression()} * ${o}`)}`${s}displacement`in e&&t.setSymbolOffsetExpression(O(n,e[`${s}displacement`],be)),`${s}rotation`in e&&t.setSymbolRotationExpression(O(n,e[`${s}rotation`],l)),`${s}rotate-with-view`in e&&t.setSymbolRotateWithView(!!e[`${s}rotate-with-view`])}function s3(e,t,n,s,o){let i="vec4(0.)";null!==t&&(i=t),null!==n&&null!==s&&(i=`mix(${n}, ${i}, ${`smoothstep(-${s}+0.63,-${s}-0.58,${e})`})`);let a=`${i} * ${`(1.0-smoothstep(-0.63,0.58,${e}))`}`;return null!==o&&(a=`${a} * ${o}`),a}function a1(e,t,n,s,o){const i=new Image;let a;return i.crossOrigin=void 0===e[`${s}cross-origin`]?"anonymous":e[`${s}cross-origin`],i.src=e[`${s}src`],i.complete&&i.width&&i.height?a=ai([i.width,i.height]):(n[`u_texture${o}_size`]=()=>i.complete?[i.width,i.height]:[0,0],t.addUniform(`vec2 u_texture${o}_size`),a=`u_texture${o}_size`),n[`u_texture${o}`]=i,t.addUniform(`sampler2D u_texture${o}`),a}function i1(e,t,n,s,o){let i=O(n,e[`${t}offset`],be);if(`${t}offset-origin`in e)switch(e[`${t}offset-origin`]){case"top-right":i=`vec2(${s}.x, 0.) + ${o} * vec2(-1., 0.) + ${i} * vec2(-1., 1.)`;break;case"bottom-left":i=`vec2(0., ${s}.y) + ${o} * vec2(0., -1.) + ${i} * vec2(1., -1.)`;break;case"bottom-right":i=`${s} - ${o} - ${i}`}return i}function xc(e){const t={inFragmentShader:!1,properties:{},variables:{},functions:{},style:e},s={inFragmentShader:!0,variables:t.variables,properties:{},functions:{},style:e},n=new Yc,o={};if("icon-src"in e?function(e,t,n,s,o){let i="vec4(1.0)";"icon-color"in e&&(i=O(o,e["icon-color"],B)),"icon-opacity"in e&&(i=`${i} * ${O(o,e["icon-opacity"],l)}`);const a=Si(e["icon-src"]),r=a1(e,t,n,"icon-",a);if(t.setSymbolColorExpression(`${i} * samplePremultiplied(u_texture${a}, v_texCoord)`).setSymbolSizeExpression(r),"icon-width"in e&&"icon-height"in e&&t.setSymbolSizeExpression(`vec2(${O(s,e["icon-width"],l)}, ${O(s,e["icon-height"],l)})`),"icon-offset"in e&&"icon-size"in e){const n=O(s,e["icon-size"],be),o=t.getSymbolSizeExpression();t.setSymbolSizeExpression(n);const i=i1(e,"icon-",s,"v_quadSizePx",n);t.setTextureCoordinateExpression(`(vec4((${i}).xyxy) + vec4(0., 0., ${n})) / (${o}).xyxy`)}if(r1(e,t,s,"icon-"),"icon-anchor"in e){const o=O(s,e["icon-anchor"],be);let n,i="1.0";"icon-scale"in e&&(i=O(s,e["icon-scale"],ct)),n="pixels"===e["icon-anchor-x-units"]&&"pixels"===e["icon-anchor-y-units"]?`${o} * ${i}`:"pixels"===e["icon-anchor-x-units"]?`${o} * vec2(vec2(${i}).x, v_quadSizePx.y)`:"pixels"===e["icon-anchor-y-units"]?`${o} * vec2(v_quadSizePx.x, vec2(${i}).x)`:`${o} * v_quadSizePx`;let a=`v_quadSizePx * vec2(0.5, -0.5) + ${n} * vec2(-1., 1.)`;if("icon-anchor-origin"in e)switch(e["icon-anchor-origin"]){case"top-right":a=`v_quadSizePx * -0.5 + ${n}`;break;case"bottom-left":a=`v_quadSizePx * 0.5 - ${n}`;break;case"bottom-right":a=`v_quadSizePx * vec2(-0.5, 0.5) + ${n} * vec2(1., -1.)`}t.setSymbolOffsetExpression(`${t.getSymbolOffsetExpression()} + ${a}`)}}(e,n,o,t,s):"shape-points"in e?function(e,t,n,s,o){o.functions.round=`float round(float v) {
  return sign(v) * floor(abs(v) + 0.5);
}`,o.functions.starDistanceField=`float starDistanceField(vec2 point, float numPoints, float radius, float radius2, float angle) {
  float startAngle = -PI * 0.5 + angle; // tip starts upwards and rotates clockwise with angle
  float c = cos(startAngle);
  float s = sin(startAngle);
  vec2 pointRotated = vec2(c * point.x - s * point.y, s * point.x + c * point.y);
  float alpha = TWO_PI / numPoints; // the angle of one sector
  float beta = atan(pointRotated.y, pointRotated.x);
  float gamma = round(beta / alpha) * alpha; // angle in sector
  c = cos(-gamma);
  s = sin(-gamma);
  vec2 inSector = vec2(c * pointRotated.x - s * pointRotated.y, abs(s * pointRotated.x + c * pointRotated.y));
  vec2 tipToPoint = inSector + vec2(-radius, 0.);
  vec2 edgeNormal = vec2(radius2 * sin(alpha * 0.5), -radius2 * cos(alpha * 0.5) + radius);
  return dot(normalize(edgeNormal), tipToPoint);
}`,o.functions.regularDistanceField=`float regularDistanceField(vec2 point, float numPoints, float radius, float angle) {
  float startAngle = -PI * 0.5 + angle; // tip starts upwards and rotates clockwise with angle
  float c = cos(startAngle);
  float s = sin(startAngle);
  vec2 pointRotated = vec2(c * point.x - s * point.y, s * point.x + c * point.y);
  float alpha = TWO_PI / numPoints; // the angle of one sector
  float radiusIn = radius * cos(PI / numPoints);
  float beta = atan(pointRotated.y, pointRotated.x);
  float gamma = round((beta - alpha * 0.5) / alpha) * alpha + alpha * 0.5; // angle in sector from mid
  c = cos(-gamma);
  s = sin(-gamma);
  vec2 inSector = vec2(c * pointRotated.x - s * pointRotated.y, abs(s * pointRotated.x + c * pointRotated.y));
  return inSector.x - radiusIn;
}`,r1(e,t,s,"shape-");let u=null;"shape-opacity"in e&&(u=O(o,e["shape-opacity"],l));let r="coordsPx";"shape-scale"in e&&(r=`coordsPx / ${O(o,e["shape-scale"],ct)}`);let h=null;"shape-fill-color"in e&&(h=O(o,e["shape-fill-color"],B));let m=null;"shape-stroke-color"in e&&(m=O(o,e["shape-stroke-color"],B));let i=null;"shape-stroke-width"in e&&(i=O(o,e["shape-stroke-width"],l));const f=O(o,e["shape-points"],l);let c,d="0.";"shape-angle"in e&&(d=O(o,e["shape-angle"],l));let a=O(o,e["shape-radius"],l);if(null!==i&&(a=`${a} + ${i} * 0.5`),"shape-radius2"in e){let t=O(o,e["shape-radius2"],l);null!==i&&(t=`${t} + ${i} * 0.5`),c=`starDistanceField(${r}, ${f}, ${a}, ${t}, ${d})`}else c=`regularDistanceField(${r}, ${f}, ${a}, ${d})`;const p=s3(c,h,m,i,u);t.setSymbolColorExpression(p)}(e,n,0,t,s):"circle-radius"in e&&function(e,t,n,s,o){o.functions.circleDistanceField=`float circleDistanceField(vec2 point, float radius) {
  return length(point) - radius;
}`,r1(e,t,s,"circle-");let r=null;"circle-opacity"in e&&(r=O(o,e["circle-opacity"],l));let c="coordsPx";"circle-scale"in e&&(c=`coordsPx / ${O(o,e["circle-scale"],ct)}`);let d=null;"circle-fill-color"in e&&(d=O(o,e["circle-fill-color"],B));let u=null;"circle-stroke-color"in e&&(u=O(o,e["circle-stroke-color"],B));let i=O(o,e["circle-radius"],l),a=null;"circle-stroke-width"in e&&(a=O(o,e["circle-stroke-width"],l),i=`(${i} + ${a} * 0.5)`);const h=s3(`circleDistanceField(${c}, ${i})`,d,u,a,r);t.setSymbolColorExpression(h)}(e,n,0,t,s),function(e,t,n,s,o){if("stroke-color"in e&&t.setStrokeColorExpression(O(o,e["stroke-color"],B)),"stroke-pattern-src"in e){const a=Si(e["stroke-pattern-src"]),s=a1(e,t,n,"stroke-pattern-",a);let i=s,r="vec2(0.)";"stroke-pattern-offset"in e&&"stroke-pattern-size"in e&&(i=O(o,e["stroke-pattern-size"],be),r=i1(e,"stroke-pattern-",o,s,i));let c="0.";"stroke-pattern-spacing"in e&&(c=O(o,e["stroke-pattern-spacing"],l)),o.functions.sampleStrokePattern=`vec4 sampleStrokePattern(sampler2D texture, vec2 textureSize, vec2 textureOffset, vec2 sampleSize, float spacingPx, float currentLengthPx, float currentRadiusRatio, float lineWidth) {
  float currentLengthScaled = currentLengthPx * sampleSize.y / lineWidth;
  float spacingScaled = spacingPx * sampleSize.y / lineWidth;
  float uCoordPx = mod(currentLengthScaled, (sampleSize.x + spacingScaled));
  // make sure that we're not sampling too close to the borders to avoid interpolation with outside pixels
  uCoordPx = clamp(uCoordPx, 0.5, sampleSize.x - 0.5);
  float vCoordPx = (-currentRadiusRatio * 0.5 + 0.5) * sampleSize.y;
  vec2 texCoord = (vec2(uCoordPx, vCoordPx) + textureOffset) / textureSize;
  return samplePremultiplied(texture, texCoord);
}`;const u=`u_texture${a}`;let d="1.";"stroke-color"in e&&(d=t.getStrokeColorExpression()),t.setStrokeColorExpression(`${d} * sampleStrokePattern(${u}, ${s}, ${r}, ${i}, ${c}, currentLengthPx, currentRadiusRatio, v_width)`)}if("stroke-width"in e&&t.setStrokeWidthExpression(O(s,e["stroke-width"],l)),"stroke-offset"in e&&t.setStrokeOffsetExpression(O(s,e["stroke-offset"],l)),"stroke-line-cap"in e&&t.setStrokeCapExpression(O(s,e["stroke-line-cap"],pe)),"stroke-line-join"in e&&t.setStrokeJoinExpression(O(s,e["stroke-line-join"],pe)),"stroke-miter-limit"in e&&t.setStrokeMiterLimitExpression(O(s,e["stroke-miter-limit"],l)),"stroke-line-dash"in e){o.functions.getSingleDashDistance=`float getSingleDashDistance(float distance, float radius, float dashOffset, float dashLength, float dashLengthTotal, float capType) {
  float localDistance = mod(distance, dashLengthTotal);
  float distanceSegment = abs(localDistance - dashOffset - dashLength * 0.5) - dashLength * 0.5;
  distanceSegment = min(distanceSegment, dashLengthTotal - localDistance);
  if (capType == ${Zt("square")}) {
    distanceSegment -= v_width * 0.5;
  } else if (capType == ${Zt("round")}) {
    distanceSegment = min(distanceSegment, sqrt(distanceSegment * distanceSegment + radius * radius) - v_width * 0.5);
  }
  return distanceSegment;
}`;let n=e["stroke-line-dash"].map(e=>O(o,e,l));n.length%2==1&&(n=[...n,...n]);let c="0.";"stroke-line-dash-offset"in e&&(c=O(s,e["stroke-line-dash-offset"],l));const a=`dashDistanceField_${Si(e["stroke-line-dash"])}`,d=n.map((e,t)=>`float dashLength${t} = ${e};`),u=n.map((e,t)=>`dashLength${t}`).join(" + ");let i="0.",r=`getSingleDashDistance(distance, radius, ${i}, dashLength0, totalDashLength, capType)`;for(let e=2;e<n.length;e+=2)i=`${i} + dashLength${e-2} + dashLength${e-1}`,r=`min(${r}, getSingleDashDistance(distance, radius, ${i}, dashLength${e}, totalDashLength, capType))`;o.functions[a]=`float ${a}(float distance, float radius, float capType) {
  ${d.join(`
  `)}
  float totalDashLength = ${u};
  return ${r};
}`,t.setStrokeDistanceFieldExpression(`${a}(currentLengthPx + ${c}, currentRadiusPx, capType)`)}}(e,n,o,t,s),function(e,t,n,s,o){if("fill-color"in e&&t.setFillColorExpression(O(o,e["fill-color"],B)),"fill-pattern-src"in e){const a=Si(e["fill-pattern-src"]),s=a1(e,t,n,"fill-pattern-",a);let i=s,r="vec2(0.)";"fill-pattern-offset"in e&&"fill-pattern-size"in e&&(i=O(o,e["fill-pattern-size"],be),r=i1(e,"fill-pattern-",o,s,i)),o.functions.sampleFillPattern=`vec4 sampleFillPattern(sampler2D texture, vec2 textureSize, vec2 textureOffset, vec2 sampleSize, vec2 pxOrigin, vec2 pxPosition) {
  float scaleRatio = pow(2., mod(u_zoom + 0.5, 1.) - 0.5);
  vec2 pxRelativePos = pxPosition - pxOrigin;
  // rotate the relative position from origin by the current view rotation
  pxRelativePos = vec2(pxRelativePos.x * cos(u_rotation) - pxRelativePos.y * sin(u_rotation), pxRelativePos.x * sin(u_rotation) + pxRelativePos.y * cos(u_rotation));
  // sample position is computed according to the sample offset & size
  vec2 samplePos = mod(pxRelativePos / scaleRatio, sampleSize);
  // also make sure that we're not sampling too close to the borders to avoid interpolation with outside pixels
  samplePos = clamp(samplePos, vec2(0.5), sampleSize - vec2(0.5));
  samplePos.y = sampleSize.y - samplePos.y; // invert y axis so that images appear upright
  return samplePremultiplied(texture, (samplePos + textureOffset) / textureSize);
}`;const l=`u_texture${a}`;let c="1.";"fill-color"in e&&(c=t.getFillColorExpression()),t.setFillColorExpression(`${c} * sampleFillPattern(${l}, ${s}, ${r}, ${i}, pxOrigin, pxPos)`)}}(e,n,o,0,s),e.filter){const t=O(s,e.filter,Q);n.setFragmentDiscardExpression(`!${t}`)}Object.keys(s.variables).forEach(function(t){const i=s.variables[t],a=tl(i.name);let r;n.addUniform(`${l1(i.type)} ${a}`),r=i.type===pe?()=>ji(e.variables[i.name]):i.type===B?()=>d1([...mt(e.variables[i.name]||"#eee")]):i.type===Q?()=>e.variables[i.name]?1:0:()=>e.variables[i.name],o[a]=r}),Object.keys(s.properties).forEach(function(e){const o=s.properties[e];t.properties[e]||(t.properties[e]=o);let a=l1(o.type),i=`a_prop_${o.name}`;o.type===B&&(a="vec4",i=`unpackColor(${i})`,n.addVertexShaderFunction(`vec4 unpackColor(vec2 packedColor) {
  return fract(packedColor[1] / 256.0) * vec4(
    fract(floor(packedColor[0] / 256.0) / 256.0),
    fract(packedColor[0] / 256.0),
    fract(floor(packedColor[1] / 256.0) / 256.0),
    1.0
  );
}`)),n.addVarying(`v_prop_${o.name}`,a,i)}),Object.keys(t.properties).forEach(function(e){const s=t.properties[e];n.addAttribute(`${l1(s.type)} a_prop_${s.name}`)});const i=Object.keys(t.properties).map(function(e){const n=t.properties[e];let s;return s=n.evaluator?n.evaluator:n.type===pe?e=>ji(e.get(n.name)):n.type===B?e=>d1([...mt(e.get(n.name)||"#eee")]):n.type===Q?e=>e.get(n.name)?1:0:e=>e.get(n.name),{name:n.name,size:J2(n.type),callback:s}});for(const e in t.functions)n.addVertexShaderFunction(t.functions[e]);for(const e in s.functions)n.addFragmentShaderFunction(s.functions[e]);return{builder:n,attributes:i.reduce((e,t)=>({...e,[t.name]:{callback:t.callback,size:t.size}}),{}),uniforms:o}}const L5="GENERATE_POLYGON_BUFFERS",s1="GENERATE_POINT_BUFFERS",D5="GENERATE_LINE_STRING_BUFFERS";function d3(){const e='const e="GENERATE_POLYGON_BUFFERS",t="GENERATE_POINT_BUFFERS",n="GENERATE_LINE_STRING_BUFFERS";function r(e,t){const n=t[0],r=t[1];return t[0]=e[0]*n+e[2]*r+e[4],t[1]=e[1]*n+e[3]*r+e[5],t}function x(e,t){const n=(r=t)[0]*r[3]-r[1]*r[2];var r;!function(e,t){if(!e)throw new Error(t)}(0!==n,"Transformation matrix cannot be inverted");const x=t[0],i=t[1],u=t[2],o=t[3],f=t[4],s=t[5];return e[0]=o/n,e[1]=-i/n,e[2]=-u/n,e[3]=x/n,e[4]=(u*s-o*f)/n,e[5]=-(x*s-i*f)/n,e}function i(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}new Array(6);var u={exports:{}};function o(e,t,n){n=n||2;var r,x,i,u,o,s,l,v=t&&t.length,h=v?t[0]*n:e.length,c=f(e,0,h,n,!0),g=[];if(!c||c.next===c.prev)return g;if(v&&(c=function(e,t,n,r){var x,i,u,o=[];for(x=0,i=t.length;x<i;x++)(u=f(e,t[x]*r,x<i-1?t[x+1]*r:e.length,r,!1))===u.next&&(u.steiner=!0),o.push(d(u));for(o.sort(p),x=0;x<o.length;x++)n=y(o[x],n);return n}(e,t,c,n)),e.length>80*n){r=i=e[0],x=u=e[1];for(var b=n;b<h;b+=n)(o=e[b])<r&&(r=o),(s=e[b+1])<x&&(x=s),o>i&&(i=o),s>u&&(u=s);l=0!==(l=Math.max(i-r,u-x))?32767/l:0}return a(c,g,n,r,x,l,0),g}function f(e,t,n,r,x){var i,u;if(x===O(e,t,n,r)>0)for(i=t;i<n;i+=r)u=P(i,e[i],e[i+1],u);else for(i=n-r;i>=t;i-=r)u=P(i,e[i],e[i+1],u);return u&&m(u,u.next)&&(B(u),u=u.next),u}function s(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!m(r,r.next)&&0!==w(r.prev,r,r.next))r=r.next;else{if(B(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function a(e,t,n,r,x,i,u){if(e){!u&&i&&function(e,t,n,r){var x=e;do{0===x.z&&(x.z=b(x.x,x.y,t,n,r)),x.prevZ=x.prev,x.nextZ=x.next,x=x.next}while(x!==e);x.prevZ.nextZ=null,x.prevZ=null,function(e){var t,n,r,x,i,u,o,f,s=1;do{for(n=e,e=null,i=null,u=0;n;){for(u++,r=n,o=0,t=0;t<s&&(o++,r=r.nextZ);t++);for(f=s;o>0||f>0&&r;)0!==o&&(0===f||!r||n.z<=r.z)?(x=n,n=n.nextZ,o--):(x=r,r=r.nextZ,f--),i?i.nextZ=x:e=x,x.prevZ=i,i=x;n=r}i.nextZ=null,s*=2}while(u>1)}(x)}(e,r,x,i);for(var o,f,p=e;e.prev!==e.next;)if(o=e.prev,f=e.next,i?v(e,r,x,i):l(e))t.push(o.i/n|0),t.push(e.i/n|0),t.push(f.i/n|0),B(e),e=f.next,p=f.next;else if((e=f)===p){u?1===u?a(e=h(s(e),t,n),t,n,r,x,i,2):2===u&&c(e,t,n,r,x,i):a(s(e),t,n,r,x,i,1);break}}}function l(e){var t=e.prev,n=e,r=e.next;if(w(t,n,r)>=0)return!1;for(var x=t.x,i=n.x,u=r.x,o=t.y,f=n.y,s=r.y,a=x<i?x<u?x:u:i<u?i:u,l=o<f?o<s?o:s:f<s?f:s,v=x>i?x>u?x:u:i>u?i:u,h=o>f?o>s?o:s:f>s?f:s,c=r.next;c!==t;){if(c.x>=a&&c.x<=v&&c.y>=l&&c.y<=h&&M(x,o,i,f,u,s,c.x,c.y)&&w(c.prev,c,c.next)>=0)return!1;c=c.next}return!0}function v(e,t,n,r){var x=e.prev,i=e,u=e.next;if(w(x,i,u)>=0)return!1;for(var o=x.x,f=i.x,s=u.x,a=x.y,l=i.y,v=u.y,h=o<f?o<s?o:s:f<s?f:s,c=a<l?a<v?a:v:l<v?l:v,p=o>f?o>s?o:s:f>s?f:s,y=a>l?a>v?a:v:l>v?l:v,g=b(h,c,t,n,r),d=b(p,y,t,n,r),Z=e.prevZ,m=e.nextZ;Z&&Z.z>=g&&m&&m.z<=d;){if(Z.x>=h&&Z.x<=p&&Z.y>=c&&Z.y<=y&&Z!==x&&Z!==u&&M(o,a,f,l,s,v,Z.x,Z.y)&&w(Z.prev,Z,Z.next)>=0)return!1;if(Z=Z.prevZ,m.x>=h&&m.x<=p&&m.y>=c&&m.y<=y&&m!==x&&m!==u&&M(o,a,f,l,s,v,m.x,m.y)&&w(m.prev,m,m.next)>=0)return!1;m=m.nextZ}for(;Z&&Z.z>=g;){if(Z.x>=h&&Z.x<=p&&Z.y>=c&&Z.y<=y&&Z!==x&&Z!==u&&M(o,a,f,l,s,v,Z.x,Z.y)&&w(Z.prev,Z,Z.next)>=0)return!1;Z=Z.prevZ}for(;m&&m.z<=d;){if(m.x>=h&&m.x<=p&&m.y>=c&&m.y<=y&&m!==x&&m!==u&&M(o,a,f,l,s,v,m.x,m.y)&&w(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function h(e,t,n){var r=e;do{var x=r.prev,i=r.next.next;!m(x,i)&&A(x,r,r.next,i)&&z(x,i)&&z(i,x)&&(t.push(x.i/n|0),t.push(r.i/n|0),t.push(i.i/n|0),B(r),B(r.next),r=e=i),r=r.next}while(r!==e);return s(r)}function c(e,t,n,r,x,i){var u=e;do{for(var o=u.next.next;o!==u.prev;){if(u.i!==o.i&&Z(u,o)){var f=F(u,o);return u=s(u,u.next),f=s(f,f.next),a(u,t,n,r,x,i,0),void a(f,t,n,r,x,i,0)}o=o.next}u=u.next}while(u!==e)}function p(e,t){return e.x-t.x}function y(e,t){var n=function(e,t){var n,r=t,x=e.x,i=e.y,u=-1/0;do{if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){var o=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(o<=x&&o>u&&(u=o,n=r.x<r.next.x?r:r.next,o===x))return n}r=r.next}while(r!==t);if(!n)return null;var f,s=n,a=n.x,l=n.y,v=1/0;r=n;do{x>=r.x&&r.x>=a&&x!==r.x&&M(i<l?x:u,i,a,l,i<l?u:x,i,r.x,r.y)&&(f=Math.abs(i-r.y)/(x-r.x),z(r,e)&&(f<v||f===v&&(r.x>n.x||r.x===n.x&&g(n,r)))&&(n=r,v=f)),r=r.next}while(r!==s);return n}(e,t);if(!n)return t;var r=F(n,e);return s(r,r.next),s(n,n.next)}function g(e,t){return w(e.prev,e,t.prev)<0&&w(t.next,e,e.next)<0}function b(e,t,n,r,x){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*x|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*x|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function d(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function M(e,t,n,r,x,i,u,o){return(x-u)*(t-o)>=(e-u)*(i-o)&&(e-u)*(r-o)>=(n-u)*(t-o)&&(n-u)*(i-o)>=(x-u)*(r-o)}function Z(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&A(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(z(e,t)&&z(t,e)&&function(e,t){var n=e,r=!1,x=(e.x+t.x)/2,i=(e.y+t.y)/2;do{n.y>i!=n.next.y>i&&n.next.y!==n.y&&x<(n.next.x-n.x)*(i-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(w(e.prev,e,t.prev)||w(e,t.prev,t))||m(e,t)&&w(e.prev,e,e.next)>0&&w(t.prev,t,t.next)>0)}function w(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function m(e,t){return e.x===t.x&&e.y===t.y}function A(e,t,n,r){var x=I(w(e,t,n)),i=I(w(e,t,r)),u=I(w(n,r,e)),o=I(w(n,r,t));return x!==i&&u!==o||(!(0!==x||!E(e,n,t))||(!(0!==i||!E(e,r,t))||(!(0!==u||!E(n,e,r))||!(0!==o||!E(n,t,r)))))}function E(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function I(e){return e>0?1:e<0?-1:0}function z(e,t){return w(e.prev,e,e.next)<0?w(e,t,e.next)>=0&&w(e,e.prev,t)>=0:w(e,t,e.prev)<0||w(e,e.next,t)<0}function F(e,t){var n=new _(e.i,e.x,e.y),r=new _(t.i,t.x,t.y),x=e.next,i=t.prev;return e.next=t,t.prev=e,n.next=x,x.prev=n,r.next=n,n.prev=r,i.next=r,r.prev=i,r}function P(e,t,n,r){var x=new _(e,t,n);return r?(x.next=r.next,x.prev=r,r.next.prev=x,r.next=x):(x.prev=x,x.next=x),x}function B(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function _(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function O(e,t,n,r){for(var x=0,i=t,u=n-r;i<n;i+=r)x+=(e[u]-e[i])*(e[i+1]+e[u+1]),u=i;return x}u.exports=o,u.exports.default=o,o.deviation=function(e,t,n,r){var x=t&&t.length,i=x?t[0]*n:e.length,u=Math.abs(O(e,0,i,n));if(x)for(var o=0,f=t.length;o<f;o++){var s=t[o]*n,a=o<f-1?t[o+1]*n:e.length;u-=Math.abs(O(e,s,a,n))}var l=0;for(o=0;o<r.length;o+=3){var v=r[o]*n,h=r[o+1]*n,c=r[o+2]*n;l+=Math.abs((e[v]-e[c])*(e[h+1]-e[v+1])-(e[v]-e[h])*(e[c+1]-e[v+1]))}return 0===u&&0===l?0:Math.abs((l-u)/u)},o.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,x=0;x<e.length;x++){for(var i=0;i<e[x].length;i++)for(var u=0;u<t;u++)n.vertices.push(e[x][i][u]);x>0&&(r+=e[x-1].length,n.holes.push(r))}return n};var N=i(u.exports);const R=[],S={vertexPosition:0,indexPosition:0};function T(e,t,n,r,x){e[t+0]=n,e[t+1]=r,e[t+2]=x}function U(e,t,n,r,x,i){const u=3+x,o=e[t+0],f=e[t+1],s=R;s.length=x;for(let n=0;n<s.length;n++)s[n]=e[t+2+n];let a=i?i.vertexPosition:0,l=i?i.indexPosition:0;const v=a/u;return T(n,a,o,f,0),s.length&&n.set(s,a+3),a+=u,T(n,a,o,f,1),s.length&&n.set(s,a+3),a+=u,T(n,a,o,f,2),s.length&&n.set(s,a+3),a+=u,T(n,a,o,f,3),s.length&&n.set(s,a+3),a+=u,r[l++]=v,r[l++]=v+1,r[l++]=v+3,r[l++]=v+1,r[l++]=v+2,r[l++]=v+3,S.vertexPosition=a,S.indexPosition=l,S}function k(e,t,n,x,i,u,o,f,s,a,l){const v=8+f.length,h=u.length/v,c=[e[t+0],e[t+1]],p=[e[n],e[n+1]],y=r(s,[...c]),g=r(s,[...p]);function b(e,t,n){const r=Math.sqrt((t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])),x=[(t[0]-e[0])/r,(t[1]-e[1])/r],i=[-x[1],x[0]],u=Math.sqrt((n[0]-e[0])*(n[0]-e[0])+(n[1]-e[1])*(n[1]-e[1])),o=[(n[0]-e[0])/u,(n[1]-e[1])/u],f=0===r||0===u?0:Math.acos((s=o[0]*x[0]+o[1]*x[1],a=-1,l=1,Math.min(Math.max(s,a),l)));var s,a,l;return o[0]*i[0]+o[1]*i[1]>0?f:2*Math.PI-f}let d=-1,M=-1,Z=l;const w=null!==i;if(null!==x){d=b(y,g,r(s,[...[e[x],e[x+1]]])),Math.cos(d)<=.985&&(Z+=Math.tan((d-Math.PI)/2))}if(w){M=b(g,y,r(s,[...[e[i],e[i+1]]])),Math.cos(M)<=.985&&(Z+=Math.tan((Math.PI-M)/2))}function m(e,t){return 0===t?1e4*e:Math.sign(t)*(1e4*e+Math.abs(t))}return u.push(c[0],c[1],p[0],p[1],d,M,a,m(0,l)),u.push(...f),u.push(c[0],c[1],p[0],p[1],d,M,a,m(1,l)),u.push(...f),u.push(c[0],c[1],p[0],p[1],d,M,a,m(2,l)),u.push(...f),u.push(c[0],c[1],p[0],p[1],d,M,a,m(3,l)),u.push(...f),o.push(h,h+1,h+2,h+1,h+3,h+2),{length:a+Math.sqrt((g[0]-y[0])*(g[0]-y[0])+(g[1]-y[1])*(g[1]-y[1])),angle:Z}}function G(e,t,n,r,x){const i=2+x;let u=t;const o=e.slice(u,u+x);u+=x;const f=e[u++];let s=0;const a=new Array(f-1);for(let t=0;t<f;t++)s+=e[u++],t<f-1&&(a[t]=s);const l=e.slice(u,u+2*s),v=N(l,a,2);for(let e=0;e<v.length;e++)r.push(v[e]+n.length/i);for(let e=0;e<l.length;e+=2)n.push(l[e],l[e+1],...o);return u+2*s}const j=self;j.onmessage=r=>{const i=r.data;switch(i.type){case t:{const e=3,t=2,n=i.customAttributesSize,r=t+n,x=new Float32Array(i.renderInstructions),u=x.length/r,o=4*u*(n+e),f=new Uint32Array(6*u),s=new Float32Array(o);let a;for(let e=0;e<x.length;e+=r)a=U(x,e,s,f,n,a);const l=Object.assign({vertexBuffer:s.buffer,indexBuffer:f.buffer,renderInstructions:x.buffer},i);j.postMessage(l,[s.buffer,f.buffer,x.buffer]);break}case n:{const e=[],t=[],n=i.customAttributesSize,r=2,u=new Float32Array(i.renderInstructions);let o=0;const f=[1,0,0,1,0,0];let s,a;for(x(f,i.renderInstructionsTransform);o<u.length;){a=Array.from(u.slice(o,o+n)),o+=n,s=u[o++];const x=o,i=o+(s-1)*r,l=u[x]===u[i]&&u[x+1]===u[i+1];let v=0,h=0;for(let n=0;n<s-1;n++){let c=null;n>0?c=o+(n-1)*r:l&&(c=i-r);let p=null;n<s-2?p=o+(n+2)*r:l&&(p=x+r);const y=k(u,o+n*r,o+(n+1)*r,c,p,e,t,a,f,v,h);v=y.length,h=y.angle}o+=s*r}const l=Uint32Array.from(t),v=Float32Array.from(e),h=Object.assign({vertexBuffer:v.buffer,indexBuffer:l.buffer,renderInstructions:u.buffer},i);j.postMessage(h,[v.buffer,l.buffer,u.buffer]);break}case e:{const e=[],t=[],n=i.customAttributesSize,r=new Float32Array(i.renderInstructions);let x=0;for(;x<r.length;)x=G(r,x,e,t,n);const u=Uint32Array.from(t),o=Float32Array.from(e),f=Object.assign({vertexBuffer:o.buffer,indexBuffer:u.buffer,renderInstructions:r.buffer},i);j.postMessage(f,[o.buffer,u.buffer,r.buffer]);break}}};';return new Worker("undefined"==typeof Blob?"data:application/javascript;base64,"+Buffer.from(e,"binary").toString("base64"):URL.createObjectURL(new Blob([e],{type:"application/javascript"})))}function u3(e,t){const i=e.viewState.projection,n=t.getSource().getWrapX()&&i.canWrapX(),s=i.getExtent(),a=e.extent,o=n?b(s):null,r=n?Math.ceil((a[2]-s[2])/o)+1:1;return[n?Math.floor((a[0]-s[0])/o):0,r,o]}class t1 extends ii{constructor(e,t){const s=t.uniforms||{},o=[1,0,0,1,0,0];s[$t.PROJECTION_MATRIX]=o,super(e,{uniforms:s,postProcesses:t.postProcesses}),this.sourceRevision_=-1,this.verticesBuffer_=new on(xs,wa),this.indicesBuffer_=new on(As,wa),this.vertexShader_=t.vertexShader,this.fragmentShader_=t.fragmentShader,this.program_,this.hitDetectionEnabled_=t.hitDetectionEnabled??!0;const i=t.attributes?t.attributes.map(function(e){return{name:"a_prop_"+e.name,size:1,type:he.FLOAT}}):[];this.attributes=[{name:"a_position",size:2,type:he.FLOAT},{name:"a_index",size:1,type:he.FLOAT}],this.hitDetectionEnabled_&&(this.attributes.push({name:"a_prop_hitColor",size:4,type:he.FLOAT}),this.attributes.push({name:"a_featureUid",size:1,type:he.FLOAT})),this.attributes.push(...i),this.customAttributes=t.attributes?t.attributes:[],this.previousExtent_=[1/0,1/0,-1/0,-1/0],this.currentTransform_=o,this.renderTransform_=[1,0,0,1,0,0],this.invertRenderTransform_=[1,0,0,1,0,0],this.renderInstructions_=new Float32Array(0),this.hitRenderTarget_,this.lastSentId=0,this.worker_=d3(),this.worker_.addEventListener("message",e=>{const t=e.data;if(t.type===s1){const n=t.projectionTransform;this.verticesBuffer_.fromArrayBuffer(t.vertexBuffer),this.helper.flushBufferData(this.verticesBuffer_),this.indicesBuffer_.fromArrayBuffer(t.indexBuffer),this.helper.flushBufferData(this.indicesBuffer_),this.renderTransform_=n,Kt(this.invertRenderTransform_,this.renderTransform_),this.renderInstructions_=new Float32Array(e.data.renderInstructions),t.id===this.lastSentId&&(this.ready=!0),this.getLayer().changed()}}),this.featureCache_={},this.featureCount_=0;const n=this.getLayer().getSource();this.sourceListenKeys_=[m(n,$n,this.handleSourceFeatureAdded_,this),m(n,$u,this.handleSourceFeatureChanged_,this),m(n,Ms,this.handleSourceFeatureDelete_,this),m(n,Wu,this.handleSourceFeatureClear_,this)],n.forEachFeature(e=>{this.featureCache_[c(e)]={feature:e,properties:e.getProperties(),geometry:e.getGeometry()},this.featureCount_++})}afterHelperCreated(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.hitDetectionEnabled_&&(this.hitRenderTarget_=new Fc(this.helper))}handleSourceFeatureAdded_(e){const t=e.feature;this.featureCache_[c(t)]={feature:t,properties:t.getProperties(),geometry:t.getGeometry()},this.featureCount_++}handleSourceFeatureChanged_(e){const t=e.feature;this.featureCache_[c(t)]={feature:t,properties:t.getProperties(),geometry:t.getGeometry()}}handleSourceFeatureDelete_(e){const t=e.feature;delete this.featureCache_[c(t)],this.featureCount_--}handleSourceFeatureClear_(){this.featureCache_={},this.featureCount_=0}renderFrame(e){const t=this.helper.getGL();this.preRender(t,e);const[n,s,o]=u3(e,this.getLayer());return this.renderWorlds(e,!1,n,s,o),this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent),this.hitDetectionEnabled_&&(this.renderWorlds(e,!0,n,s,o),this.hitRenderTarget_.clearCachedData()),this.postRender(t,e),this.helper.getCanvas()}prepareFrameInternal(e){const t=this.getLayer(),n=t.getSource(),s=e.viewState,i=!e.viewHints[Ae]&&!e.viewHints[ze],a=!Ue(this.previousExtent_,e.extent),o=this.sourceRevision_<n.getRevision();if(o&&(this.sourceRevision_=n.getRevision()),i&&(a||o)){const i=s.projection,o=s.resolution,a=t instanceof Un?t.getRenderBuffer():0,r=Fe(e.extent,a*o);n.loadFeatures(r,o,i),this.rebuildBuffers_(e),this.previousExtent_=e.extent.slice()}return this.helper.useProgram(this.program_,e),this.helper.prepareDraw(e),this.helper.bindBuffer(this.verticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.attributes),!0}rebuildBuffers_(e){const i=[1,0,0,1,0,0];this.helper.makeProjectionTransform(e,i);const l=le(),a=(this.hitDetectionEnabled_?7:2)+this.customAttributes.length,r=a*this.featureCount_;let o,s;this.renderInstructions_&&this.renderInstructions_.length===r||(this.renderInstructions_=new Float32Array(r));const n=[],d=[];let t=-1;for(const a in this.featureCache_)if(o=this.featureCache_[a],s=o.geometry,s&&"Point"===s.getType()){if(l){const t=I(s.getFlatCoordinates(),e.viewState.projection);n[0]=t[0],n[1]=t[1]}else n[0]=s.getFlatCoordinates()[0],n[1]=s.getFlatCoordinates()[1];if(R(i,n),this.renderInstructions_[++t]=n[0],this.renderInstructions_[++t]=n[1],this.hitDetectionEnabled_){const e=D1(t+5,d);this.renderInstructions_[++t]=e[0],this.renderInstructions_[++t]=e[1],this.renderInstructions_[++t]=e[2],this.renderInstructions_[++t]=e[3],this.renderInstructions_[++t]=Number(a)}for(let e=0;e<this.customAttributes.length;e++){const n=this.customAttributes[e].callback(o.feature,o.properties);this.renderInstructions_[++t]=n}}const c={id:++this.lastSentId,type:s1,renderInstructions:this.renderInstructions_.buffer,customAttributesSize:a-2};c.projectionTransform=i,this.ready=!1,this.worker_.postMessage(c,[this.renderInstructions_.buffer]),this.renderInstructions_=null}forEachFeatureAtCoordinate(e,t,n,s){if(x(this.hitDetectionEnabled_,"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has been disabled using the `disableHitDetection: true` option."),!this.renderInstructions_||!this.hitDetectionEnabled_)return;const a=R(t.coordinateToPixelTransform,e.slice()),i=this.hitRenderTarget_.readPixel(a[0]/2,a[1]/2),c=z1([i[0]/255,i[1]/255,i[2]/255,i[3]/255]),l=this.renderInstructions_[c],d=Math.floor(l).toString(),r=this.getLayer().getSource().getFeatureByUid(d);return r?s(r,this.getLayer(),null):void 0}renderWorlds(e,t,n,s,o){let i=n;this.helper.useProgram(this.program_,e),t&&(this.hitRenderTarget_.setSize([Math.floor(e.size[0]/2),Math.floor(e.size[1]/2)]),this.helper.prepareDrawToRenderTarget(e,this.hitRenderTarget_,!0)),this.helper.bindBuffer(this.verticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.attributes);do{this.helper.makeProjectionTransform(e,this.currentTransform_),Ko(this.currentTransform_,i*o,0),dn(this.currentTransform_,this.invertRenderTransform_),this.helper.applyUniforms(e),this.helper.applyHitDetectionUniform(t);const n=this.indicesBuffer_.getSize();this.helper.drawElements(0,n)}while(++i<s)}disposeInternal(){this.worker_.terminate(),this.layer_=null,this.sourceListenKeys_.forEach(function(e){T(e)}),this.sourceListenKeys_=null,super.disposeInternal()}renderDeclutter(){}}function e1(e,t,n,s){let o=0;for(const r in t){const i=t[r],a=i.callback.call(n,n.feature);e[s+o++]=a[0]??a,i.size&&1!==i.size&&(e[s+o++]=a[1],i.size<3||(e[s+o++]=a[2],i.size<4||(e[s+o++]=a[3])))}return o}function zi(e){return Object.keys(e).reduce((t,n)=>t+(e[n].size||1),0)}function p3(e,t,n,s){const a=(2+zi(n))*e.geometriesCount;t&&t.length===a||(t=new Float32Array(a));const o=[];let i=0;for(const r in e.entries){const a=e.entries[r];for(let e=0,r=a.flatCoordss.length;e<r;e++)o[0]=a.flatCoordss[e][0],o[1]=a.flatCoordss[e][1],R(s,o),t[i++]=o[0],t[i++]=o[1],i+=e1(t,n,a,i)}return t}function g3(e,t,n,s){const a=2*e.verticesCount+(1+zi(n))*e.geometriesCount;t&&t.length===a||(t=new Float32Array(a));const o=[];let i=0;for(const r in e.entries){const a=e.entries[r];for(let e=0,r=a.flatCoordss.length;e<r;e++){o.length=a.flatCoordss[e].length,bt(a.flatCoordss[e],0,o.length,2,s,o),i+=e1(t,n,a,i),t[i++]=o.length/2;for(let e=0,n=o.length;e<n;e+=2)t[i++]=o[e],t[i++]=o[e+1]}}return t}function v3(e,t,n,s){const a=2*e.verticesCount+(1+zi(n))*e.geometriesCount+e.ringsCount;t&&t.length===a||(t=new Float32Array(a));const o=[];let i=0;for(const r in e.entries){const a=e.entries[r];for(let e=0,r=a.flatCoordss.length;e<r;e++){o.length=a.flatCoordss[e].length,bt(a.flatCoordss[e],0,o.length,2,s,o),i+=e1(t,n,a,i),t[i++]=a.ringsVerticesCounts[e].length;for(let n=0,s=a.ringsVerticesCounts[e].length;n<s;n++)t[i++]=a.ringsVerticesCounts[e][n];for(let e=0,n=o.length;e<n;e+=2)t[i++]=o[e],t[i++]=o[e+1]}}return t}const z5=[],Ju=d3();let F5=0;const _3="a_position",M5="a_index",S5="a_segmentStart",Wg="a_segmentEnd",k5="a_parameters",E5="a_joinAngles",C5="a_distance";class Zu{constructor(e,t,n){this.helper_=t,this.hitDetectionEnabled_=n;let s=e;if(!("builder"in e)){const t=xc(e);s={builder:t.builder,attributes:t.attributes,uniforms:t.uniforms}}this.hasFill_=!!s.builder.getFillVertexShader(),this.hasFill_&&(this.fillVertexShader_=s.builder.getFillVertexShader(),this.fillFragmentShader_=s.builder.getFillFragmentShader(),this.fillProgram_=this.helper_.getProgram(this.fillFragmentShader_,this.fillVertexShader_)),this.hasStroke_=!!s.builder.getStrokeVertexShader(),this.hasStroke_&&(this.strokeVertexShader_=s.builder.getStrokeVertexShader(),this.strokeFragmentShader_=s.builder.getStrokeFragmentShader(),this.strokeProgram_=this.helper_.getProgram(this.strokeFragmentShader_,this.strokeVertexShader_)),this.hasSymbol_=!!s.builder.getSymbolVertexShader(),this.hasSymbol_&&(this.symbolVertexShader_=s.builder.getSymbolVertexShader(),this.symbolFragmentShader_=s.builder.getSymbolFragmentShader(),this.symbolProgram_=this.helper_.getProgram(this.symbolFragmentShader_,this.symbolVertexShader_));const i=this.hitDetectionEnabled_?{hitColor:{callback(){return D1(this.ref,z5)},size:4}}:{};this.customAttributes_=Object.assign({},i,s.attributes),this.uniforms_=s.uniforms;const o=Object.entries(this.customAttributes_).map(([e,t])=>({name:`a_prop_${e}`,size:t.size||1,type:he.FLOAT}));this.polygonAttributesDesc_=[{name:_3,size:2,type:he.FLOAT},...o],this.lineStringAttributesDesc_=[{name:S5,size:2,type:he.FLOAT},{name:Wg,size:2,type:he.FLOAT},{name:E5,size:2,type:he.FLOAT},{name:C5,size:1,type:he.FLOAT},{name:k5,size:1,type:he.FLOAT},...o],this.pointAttributesDesc_=[{name:_3,size:2,type:he.FLOAT},{name:M5,size:1,type:he.FLOAT},...o],s.uniforms&&this.helper_.addUniforms(s.uniforms)}async generateBuffers(e,t){const n=this.generateRenderInstructions_(e,t),[s,o,i]=await Promise.all([this.generateBuffersForType_(n.polygonInstructions,"Polygon",t),this.generateBuffersForType_(n.lineStringInstructions,"LineString",t),this.generateBuffersForType_(n.pointInstructions,"Point",t)]);return{polygonBuffers:s,lineStringBuffers:o,pointBuffers:i,invertVerticesTransform:Kt([1,0,0,1,0,0],t)}}generateRenderInstructions_(e,t){return{polygonInstructions:this.hasFill_?v3(e.polygonBatch,new Float32Array(0),this.customAttributes_,t):null,lineStringInstructions:this.hasStroke_?g3(e.lineStringBatch,new Float32Array(0),this.customAttributes_,t):null,pointInstructions:this.hasSymbol_?p3(e.pointBatch,new Float32Array(0),this.customAttributes_,t):null}}generateBuffersForType_(e,t,n){if(null===e)return null;const o=F5++;let s;switch(t){case"Polygon":s=L5;break;case"LineString":s=D5;break;case"Point":s=s1}const i={id:o,type:s,renderInstructions:e.buffer,renderInstructionsTransform:n,customAttributesSize:zi(this.customAttributes_)};return Ju.postMessage(i,[e.buffer]),e=null,new Promise(e=>{const t=n=>{const s=n.data;if(s.id!==o)return;if(Ju.removeEventListener("message",t),!this.helper_.getGL())return;const i=new on(xs,wa).fromArrayBuffer(s.vertexBuffer),a=new on(As,wa).fromArrayBuffer(s.indexBuffer);this.helper_.flushBufferData(i),this.helper_.flushBufferData(a),e([a,i])};Ju.addEventListener("message",t)})}render(e,t,n){this.hasFill_&&this.renderInternal_(e.polygonBuffers[0],e.polygonBuffers[1],this.fillProgram_,this.polygonAttributesDesc_,t,n),this.hasStroke_&&this.renderInternal_(e.lineStringBuffers[0],e.lineStringBuffers[1],this.strokeProgram_,this.lineStringAttributesDesc_,t,n),this.hasSymbol_&&this.renderInternal_(e.pointBuffers[0],e.pointBuffers[1],this.symbolProgram_,this.pointAttributesDesc_,t,n)}renderInternal_(e,t,n,s,o,i){const a=e.getSize();0!==a&&(this.helper_.useProgram(n,o),this.helper_.bindBuffer(t),this.helper_.bindBuffer(e),this.helper_.enableAttributes(s),i(),this.helper_.drawElements(0,a))}}const _s={...$t,RENDER_EXTENT:"u_renderExtent",PATTERN_ORIGIN:"u_patternOrigin",GLOBAL_ALPHA:"u_globalAlpha"},de={...A1,TILE_MASK_TEXTURE:"u_depthMask",TILE_ZOOM_LEVEL:"u_tileZoomLevel"},F3={POSITION:"a_position"},_c=0,z3=1,D3=2,N3=3,kt=4,Qu=5,gs=6,Gu=7,I3=8,Yu=9,Ri=10,cs=11,W3=12,Gi=[I3],fn=[W3],Rn=[z3],Vu=[N3];class vo extends Fd{constructor(e,t,n,s){super(),this.tolerance=e,this.maxExtent=t,this.pixelRatio=s,this.maxLineWidth=0,this.resolution=n,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(e){const t=this.pixelRatio;return 1==t?e:e.map(function(e){return e*t})}appendFlatPointCoordinates(e,t){const i=this.getBufferedMaxExtent(),n=this.tmpCoordinate_,s=this.coordinates;let o=s.length;for(let a=0,r=e.length;a<r;a+=t)n[0]=e[a],n[1]=e[a+1],qe(i,n)&&(s[o++]=n[0],s[o++]=n[1]);return o}appendFlatLineCoordinates(e,t,n,s,o,i){const a=this.coordinates;let r=a.length;const p=this.getBufferedMaxExtent();i&&(t+=s);let h=e[t],m=e[t+1];const c=this.tmpCoordinate_;let l,f,u,d=!0;for(l=t+s;l<n;l+=s)c[0]=e[l],c[1]=e[l+1],u=Qr(p,c),u!==f?(d&&(a[r++]=h,a[r++]=m,d=!1),a[r++]=c[0],a[r++]=c[1]):u===je.INTERSECTING?(a[r++]=c[0],a[r++]=c[1],d=!1):d=!0,h=c[0],m=c[1],f=u;return(o&&d||l===t+s)&&(a[r++]=h,a[r++]=m),r}drawCustomCoordinates_(e,t,n,s,o){for(let i=0,r=n.length;i<r;++i){const a=n[i],c=this.appendFlatLineCoordinates(e,t,a,s,!1,!1);o.push(c),t=a}return t}drawCustom(e,t,n,s,o){this.beginGeometry(e,t,o);const h=e.getType(),c=e.getStride(),a=this.coordinates.length;let i,r,l,d,u;switch(h){case"MultiPolygon":i=e.getOrientedFlatCoordinates(),d=[];const t=e.getEndss();u=0;for(let e=0,s=t.length;e<s;++e){const n=[];u=this.drawCustomCoordinates_(i,u,t[e],c,n),d.push(n)}this.instructions.push([kt,a,d,e,n,Pr,o]),this.hitDetectionInstructions.push([kt,a,d,e,s||n,Pr,o]);break;case"Polygon":case"MultiLineString":l=[],i="Polygon"==h?e.getOrientedFlatCoordinates():e.getFlatCoordinates(),u=this.drawCustomCoordinates_(i,0,e.getEnds(),c,l),this.instructions.push([kt,a,l,e,n,eo,o]),this.hitDetectionInstructions.push([kt,a,l,e,s||n,eo,o]);break;case"LineString":case"Circle":i=e.getFlatCoordinates(),r=this.appendFlatLineCoordinates(i,0,i.length,c,!1,!1),this.instructions.push([kt,a,r,e,n,Pt,o]),this.hitDetectionInstructions.push([kt,a,r,e,s||n,Pt,o]);break;case"MultiPoint":i=e.getFlatCoordinates(),r=this.appendFlatPointCoordinates(i,c),r>a&&(this.instructions.push([kt,a,r,e,n,Pt,o]),this.hitDetectionInstructions.push([kt,a,r,e,s||n,Pt,o]));break;case"Point":i=e.getFlatCoordinates(),this.coordinates.push(i[0],i[1]),r=this.coordinates.length,this.instructions.push([kt,a,r,e,n,void 0,o]),this.hitDetectionInstructions.push([kt,a,r,e,s||n,void 0,o])}this.endGeometry(t)}beginGeometry(e,t,n){this.beginGeometryInstruction1_=[_c,t,0,e,n],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[_c,t,0,e,n],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const t=this.hitDetectionInstructions;let e;t.reverse();const i=t.length;let n,s,o=-1;for(e=0;e<i;++e)n=t[e],s=n[0],s==Gu?o=e:s==_c&&(n[2]=e,g0(this.hitDetectionInstructions,o,e),o=-1)}setFillStrokeStyle(e,t){const n=this.state;if(e){const t=e.getColor();n.fillPatternScale=t&&"object"==typeof t&&"src"in t?this.pixelRatio:1,n.fillStyle=Mt(t||He)}else n.fillStyle=void 0;if(t){const r=t.getColor();n.strokeStyle=Mt(r||Ao);const e=t.getLineCap();n.lineCap=void 0!==e?e:ds;const s=t.getLineDash();n.lineDash=s?s.slice():Bt;const c=t.getLineDashOffset();n.lineDashOffset=c||0;const o=t.getLineJoin();n.lineJoin=void 0!==o?o:ms;const i=t.getWidth();n.lineWidth=void 0!==i?i:1;const a=t.getMiterLimit();n.miterLimit=void 0!==a?a:ko,n.lineWidth>this.maxLineWidth&&(this.maxLineWidth=n.lineWidth,this.bufferedMaxExtent_=null)}else n.strokeStyle=void 0,n.lineCap=void 0,n.lineDash=null,n.lineDashOffset=void 0,n.lineJoin=void 0,n.lineWidth=void 0,n.miterLimit=void 0}createFill(e){const t=e.fillStyle,n=[Ri,t];return"string"!=typeof t&&n.push(e.fillPatternScale),n}applyStroke(e){this.instructions.push(this.createStroke(e))}createStroke(e){return[cs,e.strokeStyle,e.lineWidth*this.pixelRatio,e.lineCap,e.lineJoin,e.miterLimit,this.applyPixelRatio(e.lineDash),e.lineDashOffset*this.pixelRatio]}updateFillStyle(e,t){const n=e.fillStyle;"string"==typeof n&&e.currentFillStyle==n||(void 0!==n&&this.instructions.push(t.call(this,e)),e.currentFillStyle=n)}updateStrokeStyle(e,t){const n=e.strokeStyle,o=e.lineCap,s=e.lineDash,i=e.lineDashOffset,a=e.lineJoin,r=e.lineWidth,c=e.miterLimit;(e.currentStrokeStyle!=n||e.currentLineCap!=o||s!=e.currentLineDash&&!Ct(e.currentLineDash,s)||e.currentLineDashOffset!=i||e.currentLineJoin!=a||e.currentLineWidth!=r||e.currentMiterLimit!=c)&&(void 0!==n&&t.call(this,e),e.currentStrokeStyle=n,e.currentLineCap=o,e.currentLineDash=s,e.currentLineDashOffset=i,e.currentLineJoin=a,e.currentLineWidth=r,e.currentMiterLimit=c)}endGeometry(e){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const t=[Gu,e];this.instructions.push(t),this.hitDetectionInstructions.push(t)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=_d(this.maxExtent),this.maxLineWidth>0)){const e=this.resolution*(this.maxLineWidth+1)/2;Fe(this.bufferedMaxExtent_,e,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}}class X3 extends vo{constructor(e,t,n,s){super(e,t,n,s),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(e,t,n){if(!this.image_||this.maxExtent&&!qe(this.maxExtent,e.getFlatCoordinates()))return;this.beginGeometry(e,t,n);const i=e.getFlatCoordinates(),a=e.getStride(),s=this.coordinates.length,o=this.appendFlatPointCoordinates(i,a);this.instructions.push([gs,s,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([gs,s,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(t)}drawMultiPoint(e,t,n){if(!this.image_)return;this.beginGeometry(e,t,n);const s=e.getFlatCoordinates(),o=[];for(let t=0,n=s.length;t<n;t+=e.getStride())this.maxExtent&&!qe(this.maxExtent,s.slice(t,t+2))||o.push(s[t],s[t+1]);const i=this.coordinates.length,a=this.appendFlatPointCoordinates(o,2);this.instructions.push([gs,i,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([gs,i,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(t)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(e,t){const n=e.getAnchor(),s=e.getSize(),o=e.getOrigin();this.imagePixelRatio_=e.getPixelRatio(this.pixelRatio),this.anchorX_=n[0],this.anchorY_=n[1],this.hitDetectionImage_=e.getHitDetectionImage(),this.image_=e.getImage(this.pixelRatio),this.height_=s[1],this.opacity_=e.getOpacity(),this.originX_=o[0],this.originY_=o[1],this.rotateWithView_=e.getRotateWithView(),this.rotation_=e.getRotation(),this.scale_=e.getScaleArray(),this.width_=s[0],this.declutterMode_=e.getDeclutterMode(),this.declutterImageWithText_=t}}class Q3 extends vo{constructor(e,t,n,s){super(e,t,n,s)}drawFlatCoordinates_(e,t,n,s){const i=this.coordinates.length,a=this.appendFlatLineCoordinates(e,t,n,s,!1,!1),o=[Yu,i,a];return this.instructions.push(o),this.hitDetectionInstructions.push(o),n}drawLineString(e,t,n){const s=this.state,i=s.strokeStyle,a=s.lineWidth;if(void 0===i||void 0===a)return;this.updateStrokeStyle(s,this.applyStroke),this.beginGeometry(e,t,n),this.hitDetectionInstructions.push([cs,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,Bt,0],Rn);const o=e.getFlatCoordinates(),r=e.getStride();this.drawFlatCoordinates_(o,0,o.length,r),this.hitDetectionInstructions.push(fn),this.endGeometry(t)}drawMultiLineString(e,t,n){const s=this.state,a=s.strokeStyle,r=s.lineWidth;if(void 0===a||void 0===r)return;this.updateStrokeStyle(s,this.applyStroke),this.beginGeometry(e,t,n),this.hitDetectionInstructions.push([cs,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,Bt,0],Rn);const o=e.getEnds(),c=e.getFlatCoordinates(),l=e.getStride();let i=0;for(let e=0,t=o.length;e<t;++e)i=this.drawFlatCoordinates_(c,i,o[e],l);this.hitDetectionInstructions.push(fn),this.endGeometry(t)}finish(){const e=this.state;return null!=e.lastStroke&&e.lastStroke!=this.coordinates.length&&this.instructions.push(fn),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(e){null!=e.lastStroke&&e.lastStroke!=this.coordinates.length&&(this.instructions.push(fn),e.lastStroke=this.coordinates.length),e.lastStroke=0,super.applyStroke(e),this.instructions.push(Rn)}}class Iu extends vo{constructor(e,t,n,s){super(e,t,n,s)}drawFlatCoordinatess_(e,t,n,s){const i=this.state,a=void 0!==i.fillStyle,o=void 0!==i.strokeStyle,r=n.length;this.instructions.push(Rn),this.hitDetectionInstructions.push(Rn);for(let i=0;i<r;++i){const a=n[i],l=this.coordinates.length,d=this.appendFlatLineCoordinates(e,t,a,s,!0,!o),c=[Yu,l,d];this.instructions.push(c),this.hitDetectionInstructions.push(c),o&&(this.instructions.push(Vu),this.hitDetectionInstructions.push(Vu)),t=a}return a&&(this.instructions.push(Gi),this.hitDetectionInstructions.push(Gi)),o&&(this.instructions.push(fn),this.hitDetectionInstructions.push(fn)),t}drawCircle(e,t,n){const s=this.state,a=s.fillStyle,r=s.strokeStyle;if(void 0===a&&void 0===r)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t,n),void 0!==s.fillStyle&&this.hitDetectionInstructions.push([Ri,He]),void 0!==s.strokeStyle&&this.hitDetectionInstructions.push([cs,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,Bt,0]);const o=e.getFlatCoordinates(),c=e.getStride(),l=this.coordinates.length;this.appendFlatLineCoordinates(o,0,o.length,c,!1,!1);const i=[D3,l];this.instructions.push(Rn,i),this.hitDetectionInstructions.push(Rn,i),void 0!==s.fillStyle&&(this.instructions.push(Gi),this.hitDetectionInstructions.push(Gi)),void 0!==s.strokeStyle&&(this.instructions.push(fn),this.hitDetectionInstructions.push(fn)),this.endGeometry(t)}drawPolygon(e,t,n){const s=this.state,o=s.fillStyle,i=s.strokeStyle;if(void 0===o&&void 0===i)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t,n),void 0!==s.fillStyle&&this.hitDetectionInstructions.push([Ri,He]),void 0!==s.strokeStyle&&this.hitDetectionInstructions.push([cs,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,Bt,0]);const a=e.getEnds(),r=e.getOrientedFlatCoordinates(),c=e.getStride();this.drawFlatCoordinatess_(r,0,a,c),this.endGeometry(t)}drawMultiPolygon(e,t,n){const s=this.state,a=s.fillStyle,r=s.strokeStyle;if(void 0===a&&void 0===r)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t,n),void 0!==s.fillStyle&&this.hitDetectionInstructions.push([Ri,He]),void 0!==s.strokeStyle&&this.hitDetectionInstructions.push([cs,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,Bt,0]);const o=e.getEndss(),c=e.getOrientedFlatCoordinates(),l=e.getStride();let i=0;for(let e=0,t=o.length;e<t;++e)i=this.drawFlatCoordinatess_(c,i,o[e],l);this.endGeometry(t)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const e=this.tolerance;if(0!==e){const t=this.coordinates;for(let n=0,s=t.length;n<s;++n)t[n]=qn(t[n],e)}return super.finish()}setFillStrokeStyles_(){const e=this.state;void 0!==e.fillStyle&&this.updateFillStyle(e,this.createFill),void 0!==e.strokeStyle&&this.updateStrokeStyle(e,this.applyStroke)}}function j5(e,t,n,s,o){const c=[];let r=n,i=0,a=t.slice(n,2);for(;i<e&&r+o<s;){const[l,d]=a.slice(-2),u=t[r+o],h=t[r+o+1],n=Math.sqrt((u-l)*(u-l)+(h-d)*(h-d));if(i+=n,i>=e){const t=(e-i+n)/n,s=$e(l,u,t),m=$e(d,h,t);a.push(s,m),c.push(a),a=[s,m],i==e&&(r+=o),i=0}else if(i<e)a.push(t[r+o],t[r+o+1]),r+=o;else{const e=n-i,t=$e(l,u,e/n),s=$e(d,h,e/n);a.push(t,s),c.push(a),a=[t,s],i=0,r+=o}}return i>0&&c.push(a),c}function eh(e,t,n,s,o){let v,i,m,l,u,p,d,g,r,c,b=n,j=n,h=0,a=0,f=n;for(i=n;i<s;i+=o){const y=t[i],_=t[i+1];void 0!==u&&(r=y-u,c=_-p,l=Math.sqrt(r*r+c*c),void 0!==d&&(a+=m,v=Math.acos((d*r+g*c)/(m*l)),v>e&&(a>h&&(h=a,b=f,j=i),a=0,f=i-o)),m=l,d=r,g=c),u=y,p=_}return a+=l,a>h?[f,i]:[b,j]}const Xi={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};class nh extends vo{constructor(e,t,n,s){super(e,t,n,s),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[He]={fillStyle:He},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterMode_=void 0,this.declutterImageWithText_=void 0}finish(){const e=super.finish();return e.textStates=this.textStates,e.fillStates=this.fillStates,e.strokeStates=this.strokeStates,e}drawText(e,t,n){const l=this.textFillState_,d=this.textStrokeState_,s=this.textState_;if(""===this.text_||!s||!l&&!d)return;const c=this.coordinates;let r=c.length;const i=e.getType();let o=null,a=e.getStride();if("line"!==s.placement||"LineString"!=i&&"MultiLineString"!=i&&"Polygon"!=i&&"MultiPolygon"!=i){let l=s.overflow?null:[];switch(i){case"Point":case"MultiPoint":o=e.getFlatCoordinates();break;case"LineString":o=e.getFlatMidpoint();break;case"Circle":o=e.getCenter();break;case"MultiLineString":o=e.getFlatMidpoints(),a=2;break;case"Polygon":o=e.getFlatInteriorPoint(),s.overflow||l.push(o[2]/this.resolution),a=3;break;case"MultiPolygon":const t=e.getFlatInteriorPoints();o=[];for(let e=0,n=t.length;e<n;e+=3)s.overflow||l.push(t[e+2]/this.resolution),o.push(t[e],t[e+1]);if(0===o.length)return;a=2}const u=this.appendFlatPointCoordinates(o,a);if(u===r)return;if(l&&(u-r)/2!=o.length/a){let e=r/2;l=l.filter((t,n)=>{const s=c[2*(e+n)]===o[n*a]&&c[2*(e+n)+1]===o[n*a+1];return s||--e,s})}this.saveTextStates_(),(s.backgroundFill||s.backgroundStroke)&&(this.setFillStrokeStyle(s.backgroundFill,s.backgroundStroke),s.backgroundFill&&this.updateFillStyle(this.state,this.createFill),s.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(e,t,n);let d=s.padding;if(d!=Yn&&(s.scale[0]<0||s.scale[1]<0)){let e=s.padding[0],t=s.padding[1],n=s.padding[2],o=s.padding[3];s.scale[0]<0&&(t=-t,o=-o),s.scale[1]<0&&(e=-e,n=-n),d=[e,t,n,o]}const h=this.pixelRatio;this.instructions.push([gs,r,u,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterMode_,this.declutterImageWithText_,d==Yn?Yn:d.map(function(e){return e*h}),!!s.backgroundFill,!!s.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,l]);const m=1/h,f=this.state.fillStyle;s.backgroundFill&&(this.state.fillStyle=He,this.hitDetectionInstructions.push(this.createFill(this.state))),this.hitDetectionInstructions.push([gs,r,u,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[m,m],NaN,this.declutterMode_,this.declutterImageWithText_,d,!!s.backgroundFill,!!s.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?He:this.fillKey_,this.textOffsetX_,this.textOffsetY_,l]),s.backgroundFill&&(this.state.fillStyle=f,this.hitDetectionInstructions.push(this.createFill(this.state))),this.endGeometry(t)}else{if(!U(this.maxExtent,e.getExtent()))return;let l;if(o=e.getFlatCoordinates(),"LineString"==i)l=[o.length];else if("MultiLineString"==i)l=e.getEnds();else if("Polygon"==i)l=e.getEnds().slice(0,1);else if("MultiPolygon"==i){const t=e.getEndss();l=[];for(let e=0,n=t.length;e<n;++e)l.push(t[e][0])}this.beginGeometry(e,t,n);const d=s.repeat,h=d?void 0:s.textAlign;let u=0;for(let e=0,n=l.length;e<n;++e){let t;t=d?j5(d*this.resolution,o,u,l[e],a):[o.slice(u,l[e])];for(let o=0,f=t.length;o<f;++o){const n=t[o];let i=0,d=n.length;if(h==null){const e=eh(s.maxAngle,n,0,n.length,2);i=e[0],d=e[1]}for(let e=i;e<d;e+=a)c.push(n[e],n[e+1]);const m=c.length;u=l[e],this.drawChars_(r,m),r=m}}this.endGeometry(t)}}saveTextStates_(){const e=this.textStrokeState_,t=this.textState_,n=this.textFillState_,s=this.strokeKey_;e&&(s in this.strokeStates||(this.strokeStates[s]={strokeStyle:e.strokeStyle,lineCap:e.lineCap,lineDashOffset:e.lineDashOffset,lineWidth:e.lineWidth,lineJoin:e.lineJoin,miterLimit:e.miterLimit,lineDash:e.lineDash}));const o=this.textKey_;o in this.textStates||(this.textStates[o]={font:t.font,textAlign:t.textAlign||So,justify:t.justify,textBaseline:t.textBaseline||Fa,scale:t.scale});const i=this.fillKey_;n&&(i in this.fillStates||(this.fillStates[i]={fillStyle:n.fillStyle}))}drawChars_(e,t){const i=this.textStrokeState_,n=this.textState_,a=this.strokeKey_,r=this.textKey_,o=this.fillKey_;this.saveTextStates_();const s=this.pixelRatio,c=Xi[n.textBaseline],l=this.textOffsetY_*s,d=this.text_,u=i?i.lineWidth*Math.abs(n.scale[0])/2:0;this.instructions.push([Qu,e,t,c,n.overflow,o,n.maxAngle,s,l,a,u*s,d,r,1,this.declutterMode_]),this.hitDetectionInstructions.push([Qu,e,t,c,n.overflow,o&&He,n.maxAngle,s,l,a,u*s,d,r,1/s,this.declutterMode_])}setTextStyle(e,t){let s,o,n;if(e){const i=e.getFill();i?(o=this.textFillState_,o||(o={},this.textFillState_=o),o.fillStyle=Mt(i.getColor()||He)):(o=null,this.textFillState_=o);const t=e.getStroke();if(t){n=this.textStrokeState_,n||(n={},this.textStrokeState_=n);const e=t.getLineDash(),s=t.getLineDashOffset(),o=t.getWidth(),i=t.getMiterLimit();n.lineCap=t.getLineCap()||ds,n.lineDash=e?e.slice():Bt,n.lineDashOffset=void 0===s?0:s,n.lineJoin=t.getLineJoin()||ms,n.lineWidth=void 0===o?1:o,n.miterLimit=void 0===i?ko:i,n.strokeStyle=Mt(t.getColor()||Ao)}else n=null,this.textStrokeState_=n;s=this.textState_;const a=e.getFont()||R1;h2(a);const r=e.getScaleArray();s.overflow=e.getOverflow(),s.font=a,s.maxAngle=e.getMaxAngle(),s.placement=e.getPlacement(),s.textAlign=e.getTextAlign(),s.repeat=e.getRepeat(),s.justify=e.getJustify(),s.textBaseline=e.getTextBaseline()||Fa,s.backgroundFill=e.getBackgroundFill(),s.backgroundStroke=e.getBackgroundStroke(),s.padding=e.getPadding()||Yn,s.scale=void 0===r?[1,1]:r;const l=e.getOffsetX(),d=e.getOffsetY(),u=e.getRotateWithView(),h=e.getRotation();this.text_=e.getText()||"",this.textOffsetX_=void 0===l?0:l,this.textOffsetY_=void 0===d?0:d,this.textRotateWithView_=void 0!==u&&u,this.textRotation_=void 0===h?0:h,this.strokeKey_=n?("string"==typeof n.strokeStyle?n.strokeStyle:c(n.strokeStyle))+n.lineCap+n.lineDashOffset+"|"+n.lineWidth+n.lineJoin+n.miterLimit+"["+n.lineDash.join()+"]":"",this.textKey_=s.font+s.scale+(s.textAlign||"?")+(s.repeat||"?")+(s.justify||"?")+(s.textBaseline||"?"),this.fillKey_=o&&o.fillStyle?"string"==typeof o.fillStyle?o.fillStyle:"|"+c(o.fillStyle):""}else this.text_="";this.declutterMode_=e.getDeclutterMode(),this.declutterImageWithText_=t}}const v5={Circle:Iu,Default:vo,Image:X3,LineString:Q3,Polygon:Iu,Text:nh};class Hu{constructor(e,t,n,s){this.tolerance_=e,this.maxExtent_=t,this.pixelRatio_=s,this.resolution_=n,this.buildersByZIndex_={}}finish(){const e={};for(const t in this.buildersByZIndex_){e[t]=e[t]||{};const n=this.buildersByZIndex_[t];for(const s in n){const o=n[s].finish();e[t][s]=o}}return e}getBuilder(e,t){const o=void 0!==e?e.toString():"0";let n=this.buildersByZIndex_[o];void 0===n&&(n={},this.buildersByZIndex_[o]=n);let s=n[t];return void 0===s&&(s=new(0,v5[t])(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),n[t]=s),s}}function ih(e,t,n,s,o,i,a,r,c,l,d,u){let m=e[t],f=e[t+1],g=0,v=0,h=0,p=0;function O(){g=m,v=f,m=e[t+=s],f=e[t+1],p+=h,h=Math.sqrt((m-g)*(m-g)+(f-v)*(f-v))}do O();while(t<n-s&&p+h<i)let b=0===h?0:(i-p)/h;const E=$e(g,m,b),S=$e(v,f,b),k=t-s,M=p,x=i+r*c(l,o,d);for(;t<n-s&&p+h<x;)O();b=0===h?0:(x-p)/h;const C=$e(g,m,b),A=$e(v,f,b);let _;if(u){const e=[E,S,C,A];or(e,0,4,2,u,e,e),_=e[0]>e[2]}else _=E>C;const j=Math.PI,w=[],F=k+s===t;let y;if(h=0,p=M,m=e[t=k],f=e[t+1],F){O(),y=Math.atan2(f-v,m-g),_&&(y+=y>0?-j:j);const e=(C+E)/2,t=(A+S)/2;return w[0]=[e,t,(x-i)/2,y,o],w}for(let e=0,u=(o=o.replace(/\n/g," ")).length;e<u;){O();let x=Math.atan2(f-v,m-g);if(_&&(x+=x>0?-j:j),void 0!==y){let e=x-y;if(e+=e>j?-2*j:e<-j?2*j:0,Math.abs(e)>a)return null}y=x;const E=e;let C=0;for(;e<u;++e){const a=r*c(l,o[_?u-e-1:e],d);if(t+s<n&&p+h<i+C+a/2)break;C+=a}if(e===E)continue;const k=_?o.substring(u-E,u-e):o.substring(E,e);b=0===h?0:(i+C/2-p)/h;const A=$e(g,m,b),S=$e(v,f,b);w.push([A,S,C/2,x,k]),i+=C}return w}const fo=[1/0,1/0,-1/0,-1/0],An=[],yn=[],Jt=[],wn=[];function uh(e){return e[3].declutterBox}const hh=new RegExp("["+String.fromCharCode(1425)+"-"+String.fromCharCode(2303)+String.fromCharCode(64285)+"-"+String.fromCharCode(65023)+String.fromCharCode(65136)+"-"+String.fromCharCode(65276)+String.fromCharCode(67584)+"-"+String.fromCharCode(69631)+String.fromCharCode(124928)+"-"+String.fromCharCode(126975)+"]");function Nu(e,t){return"start"===t?t=hh.test(e)?"right":"left":"end"===t&&(t=hh.test(e)?"left":"right"),Xi[t]}function h5(e,t,n){return n>0&&e.push(`
`,""),e.push(t,""),e}class ph{constructor(e,t,n,s,o){this.overlaps=n,this.pixelRatio=t,this.resolution=e,this.alignAndScaleFill_,this.instructions=s.instructions,this.coordinates=s.coordinates,this.coordinateCache_={},this.renderedTransform_=[1,0,0,1,0,0],this.hitDetectionInstructions=s.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=s.fillStates||{},this.strokeStates=s.strokeStates||{},this.textStates=s.textStates||{},this.widths_={},this.labels_={},this.zIndexContext_=o?new $a:null}getZIndexContext(){return this.zIndexContext_}createLabel(e,t,n,s){const v=e+t+n+s;if(this.labels_[v])return this.labels_[v];const i=s?this.strokeStates[s]:null,T=n?this.fillStates[n]:null,a=this.textStates[t],x=this.pixelRatio,d=[a.scale[0]*x,a.scale[1]*x],k=Array.isArray(e),h=a.justify?Xi[a.justify]:Nu(Array.isArray(e)?e[0]:e,a.textAlign||So),r=s&&i.lineWidth?i.lineWidth:0,u=k?e:e.split(`
`).reduce(h5,[]),{width:M,height:F,widths:g,heights:S,lineWidths:A}=S2(a,u),j=M+r,o=[],_=(j+2)*d[0],y=(F+r)*d[1],w={width:_<0?Math.floor(_):Math.ceil(_),height:y<0?Math.floor(y):Math.ceil(y),contextInstructions:o};1==d[0]&&1==d[1]||o.push("scale",d),s&&(o.push("strokeStyle",i.strokeStyle),o.push("lineWidth",r),o.push("lineCap",i.lineCap),o.push("lineJoin",i.lineJoin),o.push("miterLimit",i.miterLimit),o.push("setLineDash",[i.lineDash]),o.push("lineDashOffset",i.lineDashOffset)),n&&o.push("fillStyle",T.fillStyle),o.push("textBaseline","middle"),o.push("textAlign","center");const b=.5-h;let m=h*j+b*r;const f=[],p=[];let O,l=0,C=0,c=0,E=0;for(let e=0,d=u.length;e<d;e+=2){const o=u[e];if(`
`===o){C+=l,l=0,m=h*j+b*r,++E;continue}const t=u[e+1]||a.font;t!==O&&(s&&f.push("font",t),n&&p.push("font",t),O=t),l=Math.max(l,S[c]);const i=[o,m+b*g[c]+h*(g[c]-A[E]),.5*(r+l)+C];m+=g[c],s&&f.push("strokeText",i),n&&p.push("fillText",i),++c}return Array.prototype.push.apply(o,f),Array.prototype.push.apply(o,p),this.labels_[v]=w,w}replayTextBackground_(e,t,n,s,o,i,a){e.beginPath(),e.moveTo.apply(e,t),e.lineTo.apply(e,n),e.lineTo.apply(e,s),e.lineTo.apply(e,o),e.lineTo.apply(e,t),i&&(this.alignAndScaleFill_=i[2],this.fill_(e)),a&&(this.setStrokeStyle_(e,a),e.stroke())}calculateImageOrLabelDimensions_(e,t,n,s,o,i,a,r,c,l,d,u,h,m,f,p){let j=n-(a*=u[0]),y=s-(r*=u[1]);const O=o+c>e?e-c:o,x=i+l>t?t-l:i,_=m[3]+O*u[0]+m[1],w=m[0]+x*u[1]+m[2],g=j-m[3],v=y-m[0];let b;return(f||0!==d)&&(An[0]=g,wn[0]=g,An[1]=v,yn[1]=v,yn[0]=g+_,Jt[0]=yn[0],Jt[1]=v+w,wn[1]=Jt[1]),0!==d?(b=Le([1,0,0,1,0,0],n,s,1,1,d,-n,-s),R(b,An),R(b,yn),R(b,Jt),R(b,wn),Ge(Math.min(An[0],yn[0],Jt[0],wn[0]),Math.min(An[1],yn[1],Jt[1],wn[1]),Math.max(An[0],yn[0],Jt[0],wn[0]),Math.max(An[1],yn[1],Jt[1],wn[1]),fo)):Ge(Math.min(g,g+_),Math.min(v,v+w),Math.max(g,g+_),Math.max(v,v+w),fo),h&&(j=Math.round(j),y=Math.round(y)),{drawImageX:j,drawImageY:y,drawImageW:O,drawImageH:x,originX:c,originY:l,declutterBox:{minX:fo[0],minY:fo[1],maxX:fo[2],maxY:fo[3],value:p},canvasTransform:b,scale:u}}replayImageOrLabel_(e,t,n,s,o,i,a){const l=!!i||!!a,r=s.declutterBox,c=a?a[2]*s.scale[0]/2:0;return r.minX-c<=t[0]&&r.maxX+c>=0&&r.minY-c<=t[1]&&r.maxY+c>=0&&(l&&this.replayTextBackground_(e,An,yn,Jt,wn,i,a),T2(e,s.canvasTransform,o,n,s.originX,s.originY,s.drawImageW,s.drawImageH,s.drawImageX,s.drawImageY,s.scale)),!0}fill_(e){const t=this.alignAndScaleFill_;if(t){const n=R(this.renderedTransform_,[0,0]),s=512*this.pixelRatio;e.save(),e.translate(n[0]%s,n[1]%s),1!==t&&e.scale(t,t),e.rotate(this.viewRotation_)}e.fill(),t&&e.restore()}setStrokeStyle_(e,t){e.strokeStyle=t[1],e.lineWidth=t[2],e.lineCap=t[3],e.lineJoin=t[4],e.miterLimit=t[5],e.lineDashOffset=t[7],e.setLineDash(t[6])}drawLabelWithPointPlacement_(e,t,n,s){const o=this.textStates[t],i=this.createLabel(e,t,s,n),a=this.strokeStates[n],r=this.pixelRatio,c=Nu(Array.isArray(e)?e[0]:e,o.textAlign||So),l=Xi[o.textBaseline||Fa],d=a&&a.lineWidth?a.lineWidth:0;return{label:i,anchorX:c*(i.width/r-2*o.scale[0])+2*(.5-c)*d,anchorY:l*i.height/r+2*(.5-l)*d}}execute_(e,t,n,s,o,i,a,r){const E=this.zIndexContext_;let d;this.pixelCoordinates_&&Ct(n,this.renderedTransform_)?d=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),d=bt(this.coordinates,0,this.coordinates.length,2,n,this.pixelCoordinates_),Ui(this.renderedTransform_,n));let l=0;const P=s.length;let p,g,v,u,k,A,N,D,h,_,b,O,x,c=0,j=0,m=0,R=null,L=null;const M=this.coordinateCache_,F=this.viewRotation_,T=Math.round(1e12*Math.atan2(-n[1],n[0]))/1e12,z={context:e,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:F},C=this.instructions!=s||this.overlaps?0:200;let f,w,y,S;for(;l<P;){const n=s[l];switch(n[0]){case _c:f=n[1],S=n[3],f.getGeometry()?void 0===a||U(a,S.getExtent())?++l:l=n[2]+1:l=n[2],E&&(E.zIndex=n[4]);break;case z3:j>C&&(this.fill_(e),j=0),m>C&&(e.stroke(),m=0),j||m||(e.beginPath(),k=NaN,A=NaN),++l;break;case D3:c=n[1];const q=d[c],Y=d[c+1],ae=d[c+2]-q,de=d[c+3]-Y,ie=Math.sqrt(ae*ae+de*de);e.moveTo(q+ie,Y),e.arc(q,Y,ie,0,2*Math.PI,!0),++l;break;case N3:e.closePath(),++l;break;case kt:c=n[1],p=n[2];const ye=n[3],me=n[4],te=n[5];z.geometry=ye,z.feature=f,l in M||(M[l]=[]);const s=M[l];te?te(d,c,p,2,s):(s[0]=d[c],s[1]=d[c+1],s.length=2),E&&(E.zIndex=n[6]),me(s,z),++l;break;case gs:c=n[1],p=n[2],h=n[3],g=n[4],v=n[5];let ee=n[6];const je=n[7],ge=n[8],fe=n[9],le=n[10];let Z=n[11];const _e=n[12];let W=n[13];u=n[14]||"declutter";const B=n[15];if(!h&&n.length>=20){_=n[19],b=n[20],O=n[21],x=n[22];const e=this.drawLabelWithPointPlacement_(_,b,O,x);h=e.label,n[3]=h;const t=n[23];g=(e.anchorX-t)*this.pixelRatio,n[4]=g;const s=n[24];v=(e.anchorY-s)*this.pixelRatio,n[5]=v,ee=h.height,n[6]=ee,W=h.width,n[13]=W}let K,J,$,V;n.length>25&&(K=n[25]),n.length>17?(J=n[16],$=n[17],V=n[18]):(J=Yn,$=!1,V=!1),le&&T?Z+=F:le||T||(Z-=F);let be=0;for(;c<p;c+=2){if(K&&K[be++]<W/this.pixelRatio)continue;const n=this.calculateImageOrLabelDimensions_(h.width,h.height,d[c],d[c+1],W,ee,g,v,ge,fe,Z,_e,o,J,$||V,f),s=[e,t,h,n,je,$?R:null,V?L:null];if(r){let e,t,a,o,i;if(B){const n=p-c;if(!B[n]){B[n]={args:s,declutterMode:u};continue}const o=B[n];e=o.args,t=o.declutterMode,delete B[n],a=uh(e)}if(!e||"declutter"===t&&r.collides(a)||(o=!0),"declutter"===u&&r.collides(n.declutterBox)||(i=!0),"declutter"===t&&"declutter"===u){const e=o&&i;o=e,i=e}o&&("none"!==t&&r.insert(a),this.replayImageOrLabel_.apply(this,e)),i&&("none"!==u&&r.insert(n.declutterBox),this.replayImageOrLabel_.apply(this,s))}else this.replayImageOrLabel_.apply(this,s)}++l;break;case Qu:const re=n[1],ce=n[2],Q=n[3],ve=n[4];x=n[5];const pe=n[6],ne=n[7],he=n[8];O=n[9];const X=n[10];_=n[11],b=n[12];const ue=[n[13],n[13]];u=n[14]||"declutter";const G=this.textStates[b],I=G.font,H=[G.scale[0]*ne,G.scale[1]*ne];let P;I in this.widths_?P=this.widths_[I]:(P={},this.widths_[I]=P);const oe=rc(d,re,ce,2),se=Math.abs(H[0])*O1(I,_,P);if(ve||se<=oe){const n=ih(d,re,ce,2,_,(oe-se)*Nu(_,this.textStates[b].textAlign),pe,Math.abs(H[0]),O1,I,P,T?0:this.viewRotation_);t:if(n){const a=[];let i,c,l,s,o;if(O)for(i=0,c=n.length;i<c;++i){o=n[i],l=o[4],s=this.createLabel(l,b,"",O),g=o[2]+(H[0]<0?-X:X),v=Q*s.height+2*(.5-Q)*X*H[1]/H[0]-he;const d=this.calculateImageOrLabelDimensions_(s.width,s.height,o[0],o[1],s.width,s.height,g,v,0,0,o[3],ue,!1,Yn,!1,f);if(r&&"declutter"===u&&r.collides(d.declutterBox))break t;a.push([e,t,s,d,1,null,null])}if(x)for(i=0,c=n.length;i<c;++i){o=n[i],l=o[4],s=this.createLabel(l,b,x,""),g=o[2],v=Q*s.height-he;const d=this.calculateImageOrLabelDimensions_(s.width,s.height,o[0],o[1],s.width,s.height,g,v,0,0,o[3],ue,!1,Yn,!1,f);if(r&&"declutter"===u&&r.collides(d.declutterBox))break t;a.push([e,t,s,d,1,null,null])}r&&"none"!==u&&r.load(a.map(uh));for(let e=0,t=a.length;e<t;++e)this.replayImageOrLabel_.apply(this,a[e])}}++l;break;case Gu:if(void 0!==i){f=n[1];const e=i(f,S,u);if(e)return e}++l;break;case I3:C?j++:this.fill_(e),++l;break;case Yu:for(c=n[1],p=n[2],w=d[c],y=d[c+1],e.moveTo(w,y),k=w+.5|0,A=y+.5|0,c+=2;c<p;c+=2)w=d[c],y=d[c+1],N=w+.5|0,D=y+.5|0,c!=p-2&&N===k&&D===A||(e.lineTo(w,y),k=N,A=D);++l;break;case Ri:R=n,this.alignAndScaleFill_=n[2],j&&(this.fill_(e),j=0,m&&(e.stroke(),m=0)),e.fillStyle=n[1],++l;break;case cs:L=n,m&&(e.stroke(),m=0),this.setStrokeStyle_(e,n),++l;break;case W3:C?m++:e.stroke(),++l;break;default:++l}}j&&this.fill_(e),m&&e.stroke()}execute(e,t,n,s,o,i){this.viewRotation_=s,this.execute_(e,t,n,this.instructions,o,void 0,void 0,i)}executeHitDetection(e,t,n,s,o){return this.viewRotation_=n,this.execute_(e,[e.canvas.width,e.canvas.height],t,this.hitDetectionInstructions,!0,s,o)}}const Ks=["Polygon","Circle","LineString","Image","Text","Default"],oa=["Image","Text"],bh=Ks.filter(e=>!oa.includes(e));class Tu{constructor(e,t,n,s,o,i,a){this.maxExtent_=e,this.overlaps_=s,this.pixelRatio_=n,this.resolution_=t,this.renderBuffer_=i,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=[1,0,0,1,0,0],this.renderedContext_=null,this.deferredZIndexContexts_={},this.createExecutors_(o,a)}clip(e,t){const n=this.getClipCoords(t);e.beginPath(),e.moveTo(n[0],n[1]),e.lineTo(n[2],n[3]),e.lineTo(n[4],n[5]),e.lineTo(n[6],n[7]),e.clip()}createExecutors_(e,t){for(const s in e){let n=this.executorsByZIndex_[s];void 0===n&&(n={},this.executorsByZIndex_[s]=n);const o=e[s];for(const e in o){const s=o[e];n[e]=new ph(this.resolution_,this.pixelRatio_,this.overlaps_,s,t)}}}hasExecutors(e){for(const t in this.executorsByZIndex_){const n=this.executorsByZIndex_[t];for(let t=0,s=e.length;t<s;++t)if(e[t]in n)return!0}return!1}forEachFeatureAtCoordinate(e,t,n,s,o,i){const a=2*(s=Math.round(s))+1,b=Le(this.hitDetectionTransform_,s+.5,s+.5,1/t,-1/t,-n,-e[0],-e[1]),g=!this.hitDetectionContext_;g&&(this.hitDetectionContext_=K(a,a,void 0,{willReadFrequently:!0}));const r=this.hitDetectionContext_;let c;r.canvas.width!==a||r.canvas.height!==a?(r.canvas.width=a,r.canvas.height=a):g||r.clearRect(0,0,a,a),void 0!==this.renderBuffer_&&(c=[1/0,1/0,-1/0,-1/0],vs(c,e),Fe(c,t*(this.renderBuffer_+s),c));const h=_h(s);let l;function j(e,t,n){const c=r.getImageData(0,0,a,a).data;for(let d=0,u=h.length;d<u;d++)if(c[h[d]]>0){if(!i||"none"===n||"Image"!==l&&"Text"!==l||i.includes(e)){const n=(h[d]-3)/4,i=s-n%a,r=s-(n/a|0),c=o(e,t,i*i+r*r);if(c)return c}r.clearRect(0,0,a,a);break}}const m=Object.keys(this.executorsByZIndex_).map(Number);let d,u,v,f,p;for(m.sort(_t),d=m.length-1;d>=0;--d){const e=m[d].toString();for(v=this.executorsByZIndex_[e],u=Ks.length-1;u>=0;--u)if(l=Ks[u],f=v[l],void 0!==f&&(p=f.executeHitDetection(r,b,n,j,c),p))return p}}getClipCoords(e){const t=this.maxExtent_;if(!t)return null;const s=t[0],o=t[1],i=t[2],a=t[3],n=[s,o,s,a,i,a,i,o];return bt(n,0,8,2,e,n),n}isEmpty(){return it(this.executorsByZIndex_)}execute(e,t,n,s,o,i,a){const r=Object.keys(this.executorsByZIndex_).map(Number);r.sort(_t),i=i||Ks;const m=Ks.length;let c,d,l,u,h;for(a&&r.reverse(),c=0,d=r.length;c<d;++c){const f=r[c].toString();for(h=this.executorsByZIndex_[f],l=0,u=i.length;l<u;++l){const d=i[l],p=h[d];if(void 0!==p){const i=null===a?void 0:p.getZIndexContext(),u=i?i.getContext():e,h=this.maxExtent_&&"Image"!==d&&"Text"!==d;if(h&&(u.save(),this.clip(u,n)),i&&"Text"!==d&&"Image"!==d?i.pushFunction(e=>p.execute(e,t,n,s,o,a)):p.execute(u,t,n,s,o,a),h&&u.restore(),i){i.offset();const e=r[c]*m+l;this.deferredZIndexContexts_[e]||(this.deferredZIndexContexts_[e]=[]),this.deferredZIndexContexts_[e].push(i)}}}}this.renderedContext_=e}getDeferredZIndexContexts(){return this.deferredZIndexContexts_}getRenderedContext(){return this.renderedContext_}renderDeferred(){const e=this.deferredZIndexContexts_,t=Object.keys(e).map(Number).sort(_t);for(let n=0,s=t.length;n<s;++n)e[t[n]].forEach(e=>{e.draw(this.renderedContext_),e.clear()}),e[t[n]].length=0}}const Fu={};function _h(e){if(void 0!==Fu[e])return Fu[e];const n=2*e+1,o=e*e,t=new Array(o+1);for(let s=0;s<=e;++s)for(let i=0;i<=e;++i){const r=s*s+i*i;if(r>o)break;let a=t[r];a||(a=[],t[r]=a),a.push(4*((e+s)*n+(e+i))+3),s>0&&a.push(4*((e-s)*n+(e+i))+3),i>0&&(a.push(4*((e+s)*n+(e-i))+3),s>0&&a.push(4*((e-s)*n+(e-i))+3))}const s=[];for(let e=0,n=t.length;e<n;++e)t[e]&&s.push(...t[e]);return Fu[e]=s,s}const Ve=.5;function Au(e,t,n,s,o,i,a,r,c){const p=c?Tt(o,c):o,l=K(e[0]*Ve,e[1]*Ve);l.imageSmoothingEnabled=!1;const h=l.canvas,u=new al(l,Ve,o,null,a,r,c?De(le(),c):null),m=n.length,g=Math.floor(16777215/m),d={};for(let t=1;t<=m;++t){const o=n[t-1],r=o.getStyleFunction()||s;if(!r)continue;let e=r(o,i);if(!e)continue;Array.isArray(e)||(e=[e]);const a=(t*g).toString(16).padStart(7,"#00000");for(let r=0,f=e.length;r<f;++r){const c=e[r],i=c.getGeometryFunction()(o);if(!i||!U(p,i.getExtent()))continue;const s=c.clone(),u=s.getFill();u&&u.setColor(a);const l=s.getStroke();l&&(l.setColor(a),l.setLineDash(null)),s.setText(void 0);const n=c.getImage();if(n){const e=n.getImageSize();if(!e)continue;const t=K(e[0],e[1],void 0,{alpha:!1}),o=t.canvas;t.fillStyle=a,t.fillRect(0,0,o.width,o.height),s.setImage(new Vo({img:o,anchor:n.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:n.getOrigin(),opacity:1,size:n.getSize(),scale:n.getScale(),rotation:n.getRotation(),rotateWithView:n.getRotateWithView()}))}const h=s.getZIndex()||0;let t=d[h];t||(t={},d[h]=t,t.Polygon=[],t.Circle=[],t.LineString=[],t.Point=[]);const m=i.getType();if("GeometryCollection"===m){const e=i.getGeometriesArrayRecursive();for(let n=0,i=e.length;n<i;++n){const o=e[n];t[o.getType().replace("Multi","")].push(o,s)}}else t[m.replace("Multi","")].push(i,s)}}const f=Object.keys(d).map(Number).sort(_t);for(let e=0,s=f.length;e<s;++e){const n=d[f[e]];for(const s in n){const e=n[s];for(let n=0,s=e.length;n<s;n+=2){u.setStyle(e[n+1]);for(let s=0,o=t.length;s<o;++s)u.setTransform(t[s]),u.drawGeometry(e[n])}}}return l.getImageData(0,0,h.width,h.height)}function ku(e,t,n){const s=[];if(n){const r=Math.floor(Math.round(e[0])*Ve),c=Math.floor(Math.round(e[1])*Ve),o=4*(y(r,0,n.width-1)+y(c,0,n.height-1)*n.width),l=n.data[o],d=n.data[o+1],i=n.data[o+2]+256*(d+256*l),a=Math.floor(16777215/t.length);i&&i%a==0&&s.push(t[i/a-1])}return s}class Eu extends Wa{constructor(e){super(e),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.clipped_=!1,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=[1/0,1/0,-1/0,-1/0],this.wrappedRenderedExtent_=[1/0,1/0,-1/0,-1/0],this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedPixelRatio_=1,this.renderedRenderOrder_=null,this.renderedFrameDeclutter_,this.replayGroup_=null,this.replayGroupChanged=!0,this.clipping=!0,this.targetContext_=null,this.opacity_=1}renderWorlds(e,t,n){const o=t.extent,s=t.viewState,_=s.center,r=s.resolution,u=s.projection,y=s.rotation,l=u.getExtent(),g=this.getLayer().getSource(),h=this.getLayer().getDeclutter(),i=t.pixelRatio,m=t.viewHints,p=!m[Ae]&&!m[ze],d=this.context,v=Math.round(b(o)/r*i),j=Math.round(W(o)/r*i),c=g.getWrapX()&&u.canWrapX(),a=c?b(l):null,w=c?Math.ceil((o[2]-l[2])/a)+1:1;let f=c?Math.floor((o[0]-l[0])/a):0;do{let s=this.getRenderTransform(_,r,0,i,v,j,f*a);t.declutter&&(s=s.slice(0)),e.execute(d,[d.canvas.width,d.canvas.height],s,y,p,void 0===n?Ks:n?oa:bh,n?h&&t.declutter[h]:void 0)}while(++f<w)}setDrawContext_(){1!==this.opacity_&&(this.targetContext_=this.context,this.context=K(this.context.canvas.width,this.context.canvas.height,o4))}resetDrawContext_(){if(1!==this.opacity_){const e=this.targetContext_.globalAlpha;this.targetContext_.globalAlpha=this.opacity_,this.targetContext_.drawImage(this.context.canvas,0,0),this.targetContext_.globalAlpha=e,zn(this.context),o4.push(this.context.canvas),this.context=this.targetContext_,this.targetContext_=null}}renderDeclutter(e){this.replayGroup_&&this.getLayer().getDeclutter()&&this.renderWorlds(this.replayGroup_,e,!0)}renderDeferredInternal(){this.replayGroup_&&(this.replayGroup_.renderDeferred(),this.clipped_&&this.context.restore(),this.resetDrawContext_())}renderFrame(e,t){const o=e.layerStatesArray[e.layerIndex];this.opacity_=o.opacity;const i=e.viewState;this.prepareContainer(e,t);const s=this.context,a=this.replayGroup_;let n=a&&!a.isEmpty();if(!n&&!this.getLayer().hasListener(hl)&&!this.getLayer().hasListener(ui))return null;this.setDrawContext_(),this.preRender(s,e);const r=i.projection;if(this.clipped_=!1,n&&o.extent&&this.clipping){const t=Pe(o.extent,r);n=U(t,e.extent),this.clipped_=n&&!xe(t,e.extent),this.clipped_&&this.clipUnrotated(s,e,t)}return n&&this.renderWorlds(a,e,!this.getLayer().getDeclutter()&&void 0),!e.declutter&&this.clipped_&&s.restore(),this.postRender(s,e),this.renderedRotation_!==i.rotation&&(this.renderedRotation_=i.rotation,this.hitDetectionImageData_=null),e.declutter||this.resetDrawContext_(),this.container}getFeatures(e){return new Promise(t=>{if(this.frameState&&!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const c=this.frameState.size.slice(),l=this.renderedCenter_,e=this.renderedResolution_,s=this.renderedRotation_,a=this.renderedProjection_,t=this.wrappedRenderedExtent_,d=this.getLayer(),o=[],r=c[0]*Ve,i=c[1]*Ve;o.push(this.getRenderTransform(l,e,s,Ve,r,i,0).slice());const u=d.getSource(),n=a.getExtent();if(u.getWrapX()&&a.canWrapX()&&!xe(n,t)){let a=t[0];const d=b(n);let u,c=0;for(;a<n[0];)--c,u=d*c,o.push(this.getRenderTransform(l,e,s,Ve,r,i,u).slice()),a+=d;for(c=0,a=t[2];a>n[2];)++c,u=d*c,o.push(this.getRenderTransform(l,e,s,Ve,r,i,u).slice()),a-=d}const h=le();this.hitDetectionImageData_=Au(c,o,this.renderedFeatures_,d.getStyleFunction(),t,e,s,vi(e,this.renderedPixelRatio_),h?a:null)}t(ku(e,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(e,t,n,s,o){if(!this.replayGroup_)return;const d=t.viewState.resolution,u=t.viewState.rotation,a=this.getLayer(),i={},h=function(e,t,n){const l=c(e),r=i[l];if(r){if(!0!==r&&n<r.distanceSq){if(0===n)return i[l]=!0,o.splice(o.lastIndexOf(r),1),s(e,a,t);r.geometry=t,r.distanceSq=n}}else{if(0===n)return i[l]=!0,s(e,a,t);o.push(i[l]={feature:e,layer:a,geometry:t,distanceSq:n,callback:s})}};let l;const m=[this.replayGroup_],r=this.getLayer().getDeclutter();return m.some(s=>l=s.forEachFeatureAtCoordinate(e,d,u,n,h,r&&t.declutter[r]?t.declutter[r].all().map(e=>e.value):null)),l}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&this.replayGroup_&&e.changed()}handleStyleImageChange_(){this.renderIfReadyAndVisible()}prepareFrame(e){const i=this.getLayer(),r=i.getSource();if(!r)return!1;const A=e.viewHints[Ae],_=e.viewHints[ze],O=i.getUpdateWhileAnimating(),x=i.getUpdateWhileInteracting();if(this.ready&&!O&&A||!x&&_)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const w=e.extent,f=e.viewState,n=f.projection,s=f.resolution,l=e.pixelRatio,v=i.getRevision(),C=i.getRenderBuffer();let c=i.getRenderOrder();void 0===c&&(c=lf);const u=f.center.slice(),t=Fe(w,C*s),h=t.slice(),a=[t.slice()],o=n.getExtent();if(r.getWrapX()&&n.canWrapX()&&!xe(o,e.extent)){const s=b(o),i=Math.max(b(t)/2,s);t[0]=o[0]-i,t[2]=o[2]+i,va(u,n);const e=Lr(a[0],n);e[0]<o[0]&&e[2]<o[2]?a.push([e[0]+s,e[1],e[2]+s,e[3]]):e[0]>o[0]&&e[2]>o[2]&&a.push([e[0]-s,e[1],e[2]-s,e[3]])}if(this.ready&&this.renderedResolution_==s&&this.renderedRevision_==v&&this.renderedRenderOrder_==c&&this.renderedFrameDeclutter_===!!e.declutter&&xe(this.wrappedRenderedExtent_,t))return Ct(this.renderedExtent_,h)||(this.hitDetectionImageData_=null,this.renderedExtent_=h),this.renderedCenter_=u,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const g=new Hu(Rd(s,l),t,s,l),p=le();let j;if(p){for(let e=0,t=a.length;e<t;++e){const o=Tt(a[e],n);r.loadFeatures(o,fu(s,n),p)}j=De(p,n)}else for(let e=0,t=a.length;e<t;++e)r.loadFeatures(a[e],s,n);const y=vi(s,l);let m=!0;const E=(e,t)=>{let n;const o=e.getStyleFunction()||i.getStyleFunction();if(o&&(n=o(e,s)),n){const s=this.renderFeature(e,y,n,g,j,this.getLayer().getDeclutter(),t);m=m&&!s}},k=Tt(t,n),d=r.getFeaturesInExtent(k);c&&d.sort(c);for(let e=0,t=d.length;e<t;++e)E(d[e],e);this.renderedFeatures_=d,this.ready=m;const S=g.finish(),M=new Tu(t,s,l,r.getOverlaps(),S,i.getRenderBuffer(),!!e.declutter);return this.renderedResolution_=s,this.renderedRevision_=v,this.renderedRenderOrder_=c,this.renderedFrameDeclutter_=!!e.declutter,this.renderedExtent_=h,this.wrappedRenderedExtent_=t,this.renderedCenter_=u,this.renderedProjection_=n,this.renderedPixelRatio_=l,this.replayGroup_=M,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(e,t,n,s,o,i,a){if(!n)return!1;let r=!1;if(Array.isArray(n))for(let c=0,l=n.length;c<l;++c)r=bi(s,e,n[c],t,this.boundHandleStyleImageChange_,o,i,a)||r;else r=bi(s,e,n,t,this.boundHandleStyleImageChange_,o,i,a);return r}}class Eh extends r4{constructor(e){super(e),this.vectorRenderer_=new Eu(e),this.layerImageRatio_=e.getImageRatio(),this.coordinateToVectorPixelTransform_=[1,0,0,1,0,0],this.renderedPixelToCoordinateTransform_=null}disposeInternal(){this.vectorRenderer_.dispose(),super.disposeInternal()}getFeatures(e){if(!this.vectorRenderer_)return Promise.resolve([]);const t=R(this.coordinateToVectorPixelTransform_,R(this.renderedPixelToCoordinateTransform_,e.slice()));return this.vectorRenderer_.getFeatures(t)}handleFontsChanged(){this.vectorRenderer_.handleFontsChanged()}prepareFrame(e){const i=e.pixelRatio,s=e.viewState,o=s.resolution,a=e.viewHints,t=this.vectorRenderer_;let n=e.extent;1!==this.layerImageRatio_&&(n=n.slice(0),Rr(n,this.layerImageRatio_));const r=b(n)/o,c=W(n)/o;if(!a[Ae]&&!a[ze]&&!Ft(n)){t.useContainer(null,null);const m=t.context,f=e.layerStatesArray[e.layerIndex],p=Object.assign({},f,{opacity:1}),l=Object.assign({},e,{extent:n,size:[r,c],viewState:Object.assign({},e.viewState,{rotation:0}),layerStatesArray:[p],layerIndex:0,declutter:null}),d=this.getLayer().getDeclutter();d&&(l.declutter={[d]:new m4(9)});let h=!0;const a=new ol(n,o,i,m.canvas,function(e){t.prepareFrame(l)&&t.replayGroupChanged&&(t.clipping=!1,t.renderFrame(l,null)&&(t.renderDeclutter(l),t.renderDeferred(l),h=!1),e())});a.addEventListener(A,()=>{if(a.getState()!==u.LOADED)return;this.image_=h?null:a;const t=a.getPixelRatio(),e=xi(a.getResolution())*i/t;this.renderedResolution=e,this.coordinateToVectorPixelTransform_=Le(this.coordinateToVectorPixelTransform_,r/2,c/2,1/e,-1/e,0,-s.center[0],-s.center[1])}),a.load()}return this.image_&&(this.renderedPixelToCoordinateTransform_=e.pixelToCoordinateTransform.slice()),!!this.image_}preRender(){}postRender(){}renderDeclutter(){}forEachFeatureAtCoordinate(e,t,n,s,o){return this.vectorRenderer_?this.vectorRenderer_.forEachFeatureAtCoordinate(e,t,n,s,o):super.forEachFeatureAtCoordinate(e,t,n,s,o)}}const u5={image:["Polygon","Circle","LineString","Image","Text"],hybrid:["Polygon","LineString"],vector:[]},Ah={hybrid:["Image","Text","Default"],vector:["Polygon","Circle","LineString","Image","Text","Default"]};class Sh extends h4{constructor(e){super(e),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.renderedLayerRevision_,this.renderedPixelToCoordinateTransform_=null,this.renderedRotation_,this.renderedOpacity_=1,this.tmpTransform_=[1,0,0,1,0,0],this.tileClipContexts_=null}prepareTile(e,t,n){let s;const o=e.getState();return o!==L&&o!==Z||(this.updateExecutorGroup_(e,t,n),this.tileImageNeedsRender_(e)&&(s=!0)),s}getTile(e,t,n,s){const i=s.pixelRatio,a=s.viewState,u=a.resolution,r=a.projection,c=this.getLayer(),o=c.getSource().getTile(e,t,n,i,r),l=s.viewHints,d=!l[Ae]&&!l[ze];return!d&&o.wantedResolution||(o.wantedResolution=u),this.prepareTile(o,i,r)&&(d||Date.now()-s.time<8)&&"vector"!==c.getRenderMode()&&this.renderTileImage_(o,s),super.getTile(e,t,n,s)}isDrawableTile(e){const t=this.getLayer();return super.isDrawableTile(e)&&("vector"===t.getRenderMode()?c(t)in e.executorGroups:e.hasContext(t))}getTileImage(e){return e.getImage(this.getLayer())}prepareFrame(e){const t=this.getLayer().getRevision();return this.renderedLayerRevision_!==t&&(this.renderedLayerRevision_=t,this.renderedTiles.length=0),super.prepareFrame(e)}updateExecutorGroup_(e,t,n){const o=this.getLayer(),u=o.getRevision(),a=o.getRenderOrder()||null,i=e.wantedResolution,s=e.getReplayState(o);if(!s.dirty&&s.renderedResolution===i&&s.renderedRevision==u&&s.renderedRenderOrder==a)return;const r=o.getSource(),h=!!o.getDeclutter(),m=r.getTileGrid(),f=r.getTileGridForProjection(n).getTileCoordExtent(e.wrappedTileCoord),l=r.getSourceTiles(t,n,e),d=c(o);delete e.hitDetectionImageData[d],e.executorGroups[d]=[],s.dirty=!1;for(let p=0,O=l.length;p<O;++p){const u=l[p];if(u.getState()!=L)continue;const y=u.tileCoord,b=m.getTileCoordExtent(y),n=ce(f,b),j=Fe(n,o.getRenderBuffer()*i,this.tmpExtent),g=Ue(b,n)?null:j,v=new Hu(0,n,i,t),_=vi(i,t),w=function(e,t){let n;const a=e.getStyleFunction()||o.getStyleFunction();if(a&&(n=a(e,i)),n){const o=this.renderFeature(e,_,n,v,h,t);s.dirty=s.dirty||o}},c=u.getFeatures();a&&a!==s.renderedRenderOrder&&c.sort(a);for(let e=0,n=c.length;e<n;++e){const t=c[e];g&&!U(g,t.getGeometry().getExtent())||w.call(this,t,e)}const x=v.finish(),C="vector"!==o.getRenderMode()&&h&&1===l.length?null:n,E=new Tu(C,i,t,r.getOverlaps(),x,o.getRenderBuffer(),!0);e.executorGroups[d].push(E)}s.renderedRevision=u,s.renderedRenderOrder=a,s.renderedResolution=i}forEachFeatureAtCoordinate(e,t,n,s,o){const d=t.viewState.resolution,h=t.viewState.rotation;n=n??0;const i=this.getLayer(),m=i.getSource().getTileGridForProjection(t.viewState.projection),l=oe([e]);Fe(l,d*n,l);const a={},f=function(e,t,n){let r=e.getId();void 0===r&&(r=c(e));const l=a[r];if(l){if(!0!==l&&n<l.distanceSq){if(0===n)return a[r]=!0,o.splice(o.lastIndexOf(l),1),s(e,i,t);l.geometry=t,l.distanceSq=n}}else{if(0===n)return a[r]=!0,s(e,i,t);o.push(a[r]={feature:e,layer:i,geometry:t,distanceSq:n,callback:s})}},u=this.renderedTiles;let r;for(let s=0,p=u.length;!r&&s<p;++s){const o=u[s];if(!U(m.getTileCoordExtent(o.wrappedTileCoord),l))continue;const g=c(i),v=[o.executorGroups[g]],a=i.getDeclutter();v.some(s=>{const o=a?t.declutter[a].all().map(e=>e.value):null;for(let t=0,i=s.length;t<i;++t){const a=s[t];if(r=a.forEachFeatureAtCoordinate(e,d,h,n,f,o),r)return!0}})}return r}getFeatures(e){return new Promise((t)=>{const r=this.getLayer(),h=c(r),u=r.getSource(),a=this.renderedProjection,p=a.getExtent(),i=this.renderedResolution,o=u.getTileGridForProjection(a),l=R(this.renderedPixelToCoordinateTransform_,e.slice()),g=o.getTileCoordForCoordAndResolution(l,i);let s;for(let e=0,t=this.renderedTiles.length;e<t;++e)if(g.toString()===this.renderedTiles[e].tileCoord.toString()){if(s=this.renderedTiles[e],s.getState()===L){const e=o.getTileCoordExtent(s.tileCoord);u.getWrapX()&&a.canWrapX()&&!xe(p,e)&&va(l,a);break}s=void 0}if(!s||s.loadingSourceTiles>0)return void t([]);const m=ht(o.getTileCoordExtent(s.wrappedTileCoord)),v=[(l[0]-m[0])/i,(m[1]-l[1])/i],f=s.getSourceTiles().reduce(function(e,t){return e.concat(t.getFeatures())},[]);let d=s.hitDetectionImageData[h];if(!d){const e=X(o.getTileSize(o.getZForResolution(i,u.zDirection))),t=this.renderedRotation_;d=Au(e,[this.getRenderTransform(o.getTileCoordCenter(s.wrappedTileCoord),i,0,Ve,e[0]*Ve,e[1]*Ve,0)],f,r.getStyleFunction(),o.getTileCoordExtent(s.wrappedTileCoord),s.getReplayState(r).renderedResolution,t),s.hitDetectionImageData[h]=d}t(ku(v,f,d))})}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&void 0!==this.renderedLayerRevision_&&e.changed()}handleStyleImageChange_(){this.renderIfReadyAndVisible()}renderDeclutter(e,t){const n=this.context,i=n.globalAlpha;n.globalAlpha=t.opacity;const s=e.viewHints,a=!s[Ae]&&!s[ze],o=this.renderedTiles;for(let t=0,r=o.length;t<r;++t){const s=o[t],n=s.executorGroups[c(this.getLayer())],i=this.getLayer().getDeclutter();if(n)for(let t=n.length-1;t>=0;--t)n[t].execute(this.context,[this.context.canvas.width,this.context.canvas.height],this.getTileRenderTransform(s,e),e.viewState.rotation,a,oa,i?e.declutter[i]:void 0)}n.globalAlpha=i}renderDeferredInternal(){const t=this.renderedTiles.reduce((e,t,n)=>(t.executorGroups[c(this.getLayer())].forEach(t=>e.push({executorGroup:t,index:n})),e),[]),s=t.map(({executorGroup:e})=>e.getDeferredZIndexContexts()),n={};for(let e=0,s=t.length;e<s;++e){const o=t[e].executorGroup.getDeferredZIndexContexts();for(const e in o)n[e]=!0}Object.keys(n).sort(_t).map(Number).forEach(e=>{s.forEach((n,s)=>{n[e]&&(n[e].forEach(e=>{const{executorGroup:i,index:a}=t[s],n=i.getRenderedContext(),r=n.globalAlpha;n.globalAlpha=this.renderedOpacity_;const o=this.tileClipContexts_[a];o&&o.draw(n),e.draw(n),o&&n.restore(),n.globalAlpha=r,e.clear()}),n[e].length=0)})})}getTileRenderTransform(e,t){const n=t.pixelRatio,s=t.viewState,a=s.center,r=s.resolution,c=s.rotation,o=t.size,l=Math.round(o[0]*n),d=Math.round(o[1]*n),i=this.getLayer().getSource().getTileGridForProjection(t.viewState.projection),u=e.tileCoord,h=i.getTileCoordExtent(e.wrappedTileCoord),m=i.getTileCoordExtent(u,this.tmpExtent)[0]-h[0];return dn(qs(this.inversePixelTransform.slice(),1/n,1/n),this.getRenderTransform(a,r,c,n,l,d,m))}postRender(e,t){const r=t.viewHints,b=!r[Ae]&&!r[ze];this.renderedPixelToCoordinateTransform_=t.pixelToCoordinateTransform.slice(),this.renderedRotation_=t.viewState.rotation,this.renderedOpacity_=t.layerStatesArray[t.layerIndex].opacity;const n=this.getLayer(),a=n.getRenderMode(),p=e.globalAlpha;e.globalAlpha=this.renderedOpacity_;const l=n.getDeclutter(),d=l?Ah[a].filter(e=>!oa.includes(e)):Ah[a],i=t.viewState,v=i.rotation,h=n.getSource(),g=h.getTileGridForProjection(i.projection).getZForResolution(i.resolution,h.zDirection),f=this.renderedTiles,s=[],m=[],u=[];let o=!0;for(let r=f.length-1;r>=0;--r){const h=f[r];o=o&&!h.getReplayState(n).dirty;const p=h.executorGroups[c(n)].filter(e=>e.hasExecutors(d));if(0===p.length)continue;const w=this.getTileRenderTransform(h,t),j=h.tileCoord[0];let y=!1;const i=p[0].getClipCoords(w);let _,a=e;if(i){_=new $a,a=_.getContext();for(let e=0,t=s.length;e<t;++e)if(g!==j&&j<m[e]){const t=s[e];U([i[0],i[3],i[4],i[7]],[t[0],t[3],t[4],t[7]])&&(y||(a.save(),y=!0),a.beginPath(),a.moveTo(i[0],i[1]),a.lineTo(i[2],i[3]),a.lineTo(i[4],i[5]),a.lineTo(i[6],i[7]),a.moveTo(t[6],t[7]),a.lineTo(t[4],t[5]),a.lineTo(t[2],t[3]),a.lineTo(t[0],t[1]),a.clip())}s.push(i),m.push(j)}for(let n=0,s=p.length;n<s;++n)p[n].execute(e,[e.canvas.width,e.canvas.height],w,v,b,d,t.declutter?.[l]);y&&(a===e?a.restore():u[r]=_)}e.globalAlpha=p,this.ready=o,this.tileClipContexts_=u,t.declutter||this.renderDeferredInternal(t),super.postRender(e,t)}renderFeature(e,t,n,s,o,i){if(!n)return!1;let a=!1;if(Array.isArray(n))for(let r=0,c=n.length;r<c;++r)a=bi(s,e,n[r],t,this.boundHandleStyleImageChange_,void 0,o,i)||a;else a=bi(s,e,n,t,this.boundHandleStyleImageChange_,void 0,o,i);return a}tileImageNeedsRender_(e){const t=this.getLayer();if("vector"===t.getRenderMode())return!1;const n=e.getReplayState(t),s=t.getRevision(),o=e.wantedResolution;return n.renderedTileResolution!==o||n.renderedTileRevision!==s}renderTileImage_(e,t){const s=this.getLayer(),b=e.getReplayState(s),_=s.getRevision(),f=e.executorGroups[c(s)];b.renderedTileRevision=_;const m=e.wrappedTileCoord,h=m[0],u=s.getSource();let o=t.pixelRatio;const d=t.viewState.projection,l=u.getTileGridForProjection(d),j=l.getResolution(e.tileCoord[0]),r=t.pixelRatio/e.wantedResolution*j,y=l.getResolution(h),n=e.getContext(s);o=Math.round(Math.max(o,r/o));const p=u.getTilePixelSize(h,o,d);n.canvas.width=p[0],n.canvas.height=p[1];const i=o/r;if(1!==i){const e=hc(this.tmpTransform_);qs(e,i,i),n.setTransform.apply(n,e)}const g=l.getTileCoordExtent(m,this.tmpExtent),v=r/y,a=hc(this.tmpTransform_);qs(a,v,-v),Ko(a,-g[0],-g[3]);for(let e=0,t=f.length;e<t;++e)f[e].execute(n,[n.canvas.width*i,n.canvas.height*i],a,0,!0,u5[s.getRenderMode()],null);b.renderedTileResolution=e.wantedResolution}}let Sr=null;function Fh(e){Sr=e;const n=Object.keys(e.defs),o=n.length;let t,s;for(t=0;t<o;++t){const s=n[t];if(!d(s)){const t=e.defs(s);let n=t.units;n||"longlat"!==t.projName||(n="degrees"),cu(new ns({code:s,axisOrientation:t.axis,metersPerUnit:t.to_meter,units:n}))}}for(t=0;t<o;++t){const i=n[t],a=d(i);for(s=0;s<o;++s){const t=n[s],r=d(t);if(!Qd(i,t))if(e.defs[i]===e.defs[t])qa([a,r]);else{const n=e(i,t);Lm(a,r,gu(a,r,n.forward),gu(r,a,n.inverse))}}}}let Cu=async function(e){const t=await fetch(`https://epsg.io/${e}.proj4`);if(!t.ok)throw new Error(`Unexpected response from epsg.io: ${t.status}`);return t.text()};class Us extends Un{constructor(e){super(e)}createRenderer(){return new Eu(this)}}function Ou(e,t,n){const v=[];let m=e(0),d=e(1),o=t(m),s=t(d);const f=[d,m],p=[s,o],c=[1,0],g={};let l,a,u,r,h,i,b=1e5;for(;--b>0&&c.length>0;)u=c.pop(),m=f.pop(),o=p.pop(),i=u.toString(),i in g||(v.push(o[0],o[1]),g[i]=!0),r=c.pop(),d=f.pop(),s=p.pop(),h=(u+r)/2,l=e(h),a=t(l),Zd(a[0],a[1],o[0],o[1],s[0],s[1])<n?(v.push(s[0],s[1]),i=r.toString(),g[i]=!0):(c.push(r,h,h,u),p.push(s,a,a,o),f.push(d,l,l,m));return v}function Nh(e,t,n,s,o){return Ou(function(s){return[e,t+(n-t)*s]},pt(d("EPSG:4326"),s),o)}function Lh(e,t,n,s,o){return Ou(function(s){return[t+(n-t)*s,e]},pt(d("EPSG:4326"),s),o)}const l5=new Ze({color:"rgba(0,0,0,0.2)"}),c5=[90,45,30,20,10,5,2,1,.5,20/60,10/60,5/60,2/60,1/60,30/3600,20/3600,10/3600,5/3600,2/3600,1/3600],Cr="blur",yu="gradient",Or="radius",r5=["#00f","#0ff","#0f0","#ff0","#f00"];function $h(e,t){const r=`
    attribute vec2 ${Ti.TEXTURE_COORD};
    uniform mat4 ${k.TILE_TRANSFORM};
    uniform float ${k.TEXTURE_PIXEL_WIDTH};
    uniform float ${k.TEXTURE_PIXEL_HEIGHT};
    uniform float ${k.TEXTURE_RESOLUTION};
    uniform float ${k.TEXTURE_ORIGIN_X};
    uniform float ${k.TEXTURE_ORIGIN_Y};
    uniform float ${k.DEPTH};

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;

    void main() {
      v_textureCoord = ${Ti.TEXTURE_COORD};
      v_mapCoord = vec2(
        ${k.TEXTURE_ORIGIN_X} + ${k.TEXTURE_RESOLUTION} * ${k.TEXTURE_PIXEL_WIDTH} * v_textureCoord[0],
        ${k.TEXTURE_ORIGIN_Y} - ${k.TEXTURE_RESOLUTION} * ${k.TEXTURE_PIXEL_HEIGHT} * v_textureCoord[1]
      );
      gl_Position = ${k.TILE_TRANSFORM} * vec4(${Ti.TEXTURE_COORD}, ${k.DEPTH}, 1.0);
    }
  `,n={inFragmentShader:!1,variables:{},properties:{},functions:{},bandCount:0,style:{},inFragmentShader:!0,bandCount:t,style:e},s=[];if(void 0!==e.color){const t=O(n,e.color,B);s.push(`color = ${t};`)}if(void 0!==e.contrast){const t=O(n,e.contrast,l);s.push(`color.rgb = clamp((${t} + 1.0) * color.rgb - (${t} / 2.0), vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(void 0!==e.exposure){const t=O(n,e.exposure,l);s.push(`color.rgb = clamp((${t} + 1.0) * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(void 0!==e.saturation){const t=O(n,e.saturation,l);s.push(`
      float saturation = ${t} + 1.0;
      float sr = (1.0 - saturation) * 0.2126;
      float sg = (1.0 - saturation) * 0.7152;
      float sb = (1.0 - saturation) * 0.0722;
      mat3 saturationMatrix = mat3(
        sr + saturation, sr, sr,
        sg, sg + saturation, sg,
        sb, sb, sb + saturation
      );
      color.rgb = clamp(saturationMatrix * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));
    `)}if(void 0!==e.gamma){const t=O(n,e.gamma,l);s.push(`color.rgb = pow(color.rgb, vec3(1.0 / ${t}));`)}if(void 0!==e.brightness){const t=O(n,e.brightness,l);s.push(`color.rgb = clamp(color.rgb + ${t}, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}const o={},a=Object.keys(n.variables).length;if(a>1&&!e.variables)throw new Error(`Missing variables in style (expected ${n.variables})`);for(let s=0;s<a;++s){const t=n.variables[Object.keys(n.variables)[s]];if(!(t.name in e.variables))throw new Error(`Missing '${t.name}' in style variables`);o[tl(t.name)]=function(){let n=e.variables[t.name];return"string"==typeof n&&(n=ji(n)),void 0!==n?n:-9999999}}const i=Object.keys(o).map(function(e){return`uniform float ${e};`}),c=Math.ceil(t/4);i.push(`uniform sampler2D ${k.TILE_TEXTURE_ARRAY}[${c}];`),n.paletteTextures&&i.push(`uniform sampler2D ${v1}[${n.paletteTextures.length}];`);const d=Object.keys(n.functions).map(function(e){return n.functions[e]});return{vertexShader:r,fragmentShader:`
    #ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    #else
    precision mediump float;
    #endif

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;
    uniform vec4 ${k.RENDER_EXTENT};
    uniform float ${k.TRANSITION_ALPHA};
    uniform float ${k.TEXTURE_PIXEL_WIDTH};
    uniform float ${k.TEXTURE_PIXEL_HEIGHT};
    uniform float ${k.RESOLUTION};
    uniform float ${k.ZOOM};

    ${i.join(`
`)}

    ${d.join(`
`)}

    void main() {
      if (
        v_mapCoord[0] < ${k.RENDER_EXTENT}[0] ||
        v_mapCoord[1] < ${k.RENDER_EXTENT}[1] ||
        v_mapCoord[0] > ${k.RENDER_EXTENT}[2] ||
        v_mapCoord[1] > ${k.RENDER_EXTENT}[3]
      ) {
        discard;
      }

      vec4 color = texture2D(${k.TILE_TEXTURE_ARRAY}[0],  v_textureCoord);

      ${s.join(`
`)}

      gl_FragColor = color;
      gl_FragColor.rgb *= gl_FragColor.a;
      gl_FragColor *= ${k.TRANSITION_ALPHA};
    }`,uniforms:o,paletteTextures:n.paletteTextures}}class Wh extends u4{constructor(e){const t=(e=e?Object.assign({},e):{}).style||{};delete e.style;const n=e.cacheSize;delete e.cacheSize,super(e),this.sources_=e.sources,this.renderedSource_=null,this.renderedResolution_=NaN,this.style_=t,this.cacheSize_=n,this.styleVariables_=this.style_.variables||{},this.addChangeListener(Cl,this.handleSourceUpdate_)}getSources(e,t){const n=this.getSource();return this.sources_?"function"==typeof this.sources_?this.sources_(e,t):this.sources_:n?[n]:[]}getRenderSource(){return this.renderedSource_||this.getSource()}getSourceState(){const e=this.getRenderSource();return e?e.getState():"undefined"}handleSourceUpdate_(){this.hasRenderer()&&this.getRenderer().clearCache(),this.getSource()&&this.setStyle(this.style_)}getSourceBandCount_(){const e=Number.MAX_SAFE_INTEGER,t=this.getSources([-e,-e,e,e],e);return t&&t.length&&"bandCount"in t[0]?t[0].bandCount:4}createRenderer(){const e=$h(this.style_,this.getSourceBandCount_());return new k2(this,{vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,cacheSize:this.cacheSize_,paletteTextures:e.paletteTextures})}renderSources(e,t){const n=this.getRenderer();let s;for(let o=0,i=t.length;o<i;++o)this.renderedSource_=t[o],n.prepareFrame(e)&&(s=n.renderFrame(e));return s}render(e){this.rendered=!0;const s=e.viewState,n=this.getSources(e.extent,s.resolution);let o=!0;for(let t=0,i=n.length;t<i;++t){const e=n[t],s=e.getState();if("loading"==s){const t=()=>{"ready"==e.getState()&&(e.removeEventListener("change",t),this.changed())};e.addEventListener("change",t)}o=o&&"ready"==s}const i=this.renderSources(e,n);if(this.getRenderer().renderComplete&&o)return this.renderedResolution_=s.resolution,i;if(this.renderedResolution_>.5*s.resolution){const t=this.getSources(e.extent,this.renderedResolution_).filter(e=>!n.includes(e));if(t.length>0)return this.renderSources(e,t)}return i}setStyle(e){this.styleVariables_=e.variables||{},this.style_=e;const t=$h(this.style_,this.getSourceBandCount_());this.getRenderer().reset({vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:t.uniforms,paletteTextures:t.paletteTextures}),this.changed()}updateStyleVariables(e){Object.assign(this.styleVariables_,e),this.changed()}}Wh.prototype.dispose;const a5="addfeatures";class Kh extends ue{constructor(e,t,n,s){super(e),this.features=n,this.file=t,this.projection=s}}const qh="drawstart",n5="drawend",t5="drawabort";class pa extends ue{constructor(e,t){super(e),this.feature=t}}function fr(e,t){return wt(e[0],e[1],t[0],t[1])}function ho(e,t){const n=e.length;return t<0?e[t+n]:t>=n?e[t-n]:e[t]}function lr(e,t,n){let s,o;t<n?(s=t,o=n):(s=n,o=t);const i=Math.ceil(s),a=Math.floor(o);if(i>a)return fr(Js(e,s),Js(e,o));let r=0;s<i&&(r+=fr(Js(e,s),ho(e,i))),a<o&&(r+=fr(ho(e,a),Js(e,o)));for(let t=i;t<a-1;++t)r+=fr(ho(e,t),ho(e,t+1));return r}function em(e,t,n){if(t instanceof ee)rr(e,t.getCoordinates(),!1,n);else if(t instanceof ke){const s=t.getCoordinates();for(let t=0,o=s.length;t<o;++t)rr(e,s[t],!1,n)}else if(t instanceof ie){const s=t.getCoordinates();for(let t=0,o=s.length;t<o;++t)rr(e,s[t],!0,n)}else if(t instanceof Re){const s=t.getCoordinates();for(let t=0,i=s.length;t<i;++t){const o=s[t];for(let t=0,s=o.length;t<s;++t)rr(e,o[t],!0,n)}}else if(t instanceof ge){const s=t.getGeometries();for(let t=0;t<s.length;++t)em(e,s[t],n)}}const bu={index:-1,endIndex:NaN};function rr(e,t,n,s){const o=e[0],i=e[1];for(let e=0,r=t.length-1;e<r;++e){const a=om(o,i,t[e],t[e+1]);if(0===a.squaredDistance){const o=e+a.along;return void s.push({coordinates:t,ring:n,startIndex:o,endIndex:o})}}}const vu={along:0,squaredDistance:0};function om(e,t,n,s){const r=n[0],c=n[1],o=s[0]-r,i=s[1]-c;let a=0,l=r,d=c;return 0===o&&0===i||(a=y(((e-r)*o+(t-c)*i)/(o*o+i*i),0,1),l+=o*a,d+=i*a),vu.along=a,vu.squaredDistance=kn(wt(e,t,l,d),10),vu}function Js(e,t){const s=e.length;let n=Math.floor(t);const i=t-n;n>=s?n-=s:n<0&&(n+=s);let o=n+1;o>=s&&(o-=s);const a=e[n],r=a[0],c=a[1],l=e[o];return[r+(l[0]-r)*i,c+(l[1]-c)*i]}function e5(){const e=Ro();return function(t){return e[t.getGeometry().getType()]}}const Jg="extentchanged";class cm extends ue{constructor(e){super(Jg),this.extent=e}}function Zg(){const e=Ro();return function(){return e.Polygon}}function Qg(){const e=Ro();return function(){return e.Point}}function um(e){return function(t){return oe([e,t])}}function hm(e,t){return e[0]==t[0]?function(n){return oe([e,[n[0],t[1]]])}:e[1]==t[1]?function(n){return oe([e,[t[0],n[1]]])}:null}function ka(e){return parseFloat(e)}function Sa(e){return function(e){return kn(e,5)}(e).toString()}function Qa(e,t){return!isNaN(e)&&e!==ka(Sa(t))}const gm=[0,0,0,0],bo=[],Xg="modifystart",jm="modifyend";class Ka extends ue{constructor(e,t,n){super(e),this.features=t,this.mapBrowserEvent=n}}function Gg(e,t){return e.index-t.index}function wm(e,t,n){const s=t.geometry;if("Circle"===s.getType()){let o=s;if(1===t.index){const t=le();t&&(o=o.clone().transform(t,n));const i=nt(o.getCenter(),I(e,n)),s=Math.sqrt(i)-o.getRadius();return s*s}}const o=I(e,n);return bo[0]=I(t.segment[0],n),bo[1]=I(t.segment[1],n),vr(o,bo)}function Om(e,t,n){const s=t.geometry;if("Circle"===s.getType()&&1===t.index){let t=s;const o=le();return o&&(t=t.clone().transform(o,n)),un(t.getClosestPoint(I(e,n)),n)}const o=I(e,n);return bo[0]=I(t.segment[0],n),bo[1]=I(t.segment[1],n),un(ha(o,bo),n)}function Yg(){const e=Ro();return function(){return e.Point}}const qg="select";class Em extends ue{constructor(e,t,n,s){super(e),this.selected=t,this.deselected=n,this.mapBrowserEvent=s}}const Va={};class Am extends Rt{constructor(e){let t;if(super(),this.on,this.once,this.un,e=e||{},this.boundAddFeature_=this.addFeature_.bind(this),this.boundRemoveFeature_=this.removeFeature_.bind(this),this.condition_=e.condition?e.condition:Hl,this.addCondition_=e.addCondition?e.addCondition:xl,this.removeCondition_=e.removeCondition?e.removeCondition:xl,this.toggleCondition_=e.toggleCondition?e.toggleCondition:sa,this.multi_=!!e.multi&&e.multi,this.filter_=e.filter?e.filter:Je,this.hitTolerance_=e.hitTolerance?e.hitTolerance:0,this.style_=void 0!==e.style?e.style:function(){const e=Ro();return z(e.Polygon,e.LineString),z(e.GeometryCollection,e.LineString),function(t){return t.getGeometry()?e[t.getGeometry().getType()]:null}}(),this.features_=e.features||new me,e.layers)if("function"==typeof e.layers)t=e.layers;else{const n=e.layers;t=function(e){return n.includes(e)}}else t=Je;this.layerFilter_=t,this.featureLayerAssociation_={}}addFeatureLayerAssociation_(e,t){this.featureLayerAssociation_[c(e)]=t}getFeatures(){return this.features_}getHitTolerance(){return this.hitTolerance_}getLayer(e){return this.featureLayerAssociation_[c(e)]}setHitTolerance(e){this.hitTolerance_=e}setMap(e){this.getMap()&&this.style_&&this.features_.forEach(this.restorePreviousStyle_.bind(this)),super.setMap(e),e?(this.features_.addEventListener(dt,this.boundAddFeature_),this.features_.addEventListener(ut,this.boundRemoveFeature_),this.style_&&this.features_.forEach(this.applySelectedStyle_.bind(this))):(this.features_.removeEventListener(dt,this.boundAddFeature_),this.features_.removeEventListener(ut,this.boundRemoveFeature_))}addFeature_(e){const t=e.element;if(this.style_&&this.applySelectedStyle_(t),!this.getLayer(t)){const e=this.getMap().getAllLayers().find(function(e){if(e instanceof Us&&e.getSource()&&e.getSource().hasFeature(t))return e});e&&this.addFeatureLayerAssociation_(t,e)}}removeFeature_(e){this.style_&&this.restorePreviousStyle_(e.element)}getStyle(){return this.style_}applySelectedStyle_(e){const t=c(e);t in Va||(Va[t]=e.getStyle()),e.setStyle(this.style_)}restorePreviousStyle_(e){const t=this.getMap().getInteractions().getArray();for(let s=t.length-1;s>=0;--s){const n=t[s];if(n!==this&&n instanceof Am&&n.getStyle()&&-1!==n.getFeatures().getArray().lastIndexOf(e))return void e.setStyle(n.getStyle())}const n=c(e);e.setStyle(Va[n]),delete Va[n]}removeFeatureLayerAssociation_(e){delete this.featureLayerAssociation_[c(e)]}handleEvent(e){if(!this.condition_(e))return!0;const i=this.addCondition_(e),a=this.removeCondition_(e),o=this.toggleCondition_(e),c=!i&&!a&&!o,r=e.map,n=this.getFeatures(),s=[],t=[];if(c){Kn(this.featureLayerAssociation_),r.forEachFeatureAtPixel(e.pixel,(e,n)=>{if(e instanceof N&&this.filter_(e,n))return this.addFeatureLayerAssociation_(e,n),t.push(e),!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let e=n.getLength()-1;e>=0;--e){const o=n.item(e),i=t.indexOf(o);i>-1?t.splice(i,1):(n.remove(o),s.push(o))}0!==t.length&&n.extend(t)}else{r.forEachFeatureAtPixel(e.pixel,(e,r)=>{if(e instanceof N&&this.filter_(e,r))return!i&&!o||n.getArray().includes(e)?(a||o)&&n.getArray().includes(e)&&(s.push(e),this.removeFeatureLayerAssociation_(e)):(this.addFeatureLayerAssociation_(e,r),t.push(e)),!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let e=s.length-1;e>=0;--e)n.remove(s[e]);n.extend(t)}return(t.length>0||s.length>0)&&this.dispatchEvent(new Em(qg,t,s,e)),!0}}const rp="snap";class Mm extends ue{constructor(e,t){super(e),this.vertex=t.vertex,this.vertexPixel=t.vertexPixel,this.feature=t.feature,this.segment=t.segment}}function Fm(e){return e.feature?e.feature:e.element?e.element:null}const hu=[],A5="translatestart",$g="translating",Vg="translateend";class Ba extends ue{constructor(e,t,n,s,o){super(e),this.features=t,this.coordinate=n,this.startCoordinate=s,this.mapBrowserEvent=o}}function uu(e,t,n,s,o,i){void 0!==o?i=void 0!==i?i:0:(o=[],i=0);let a=t;for(;a<n;){const t=e[a++];o[i++]=e[a++],o[i++]=t;for(let t=2;t<s;++t)o[i++]=e[a++]}return o.length=i,o}class xo{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.featureClass=N,this.supportedMediaTypes=null}getReadOptions(e,t){if(t){let n=t.dataProjection?d(t.dataProjection):this.readProjection(e);t.extent&&n&&"tile-pixels"===n.getUnits()&&(n=d(n),n.setWorldExtent(t.extent)),t={dataProjection:n,featureProjection:t.featureProjection}}return this.adaptOptions(t)}adaptOptions(e){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection,featureClass:this.featureClass},e)}getType(){return g()}readFeature(){return g()}readFeatures(){return g()}readGeometry(){return g()}readProjection(){return g()}writeFeature(){return g()}writeFeatures(){return g()}writeGeometry(){return g()}}function q(e,t,n){const o=n?d(n.featureProjection):null,i=n?d(n.dataProjection):null;let s=e;if(o&&i&&!Oe(o,i)){t&&(s=e.clone());const n=t?o:i,a=t?i:o;"tile-pixels"===n.getUnits()?s.transform(n,a):s.applyTransform(pt(n,a))}if(t&&n&&void 0!==n.decimals){const t=Math.pow(10,n.decimals),o=function(e){for(let n=0,s=e.length;n<s;++n)e[n]=Math.round(e[n]*t)/t;return e};s===e&&(s=e.clone()),s.applyTransform(o)}return s}function Ga(e,t){const n=t?d(t.featureProjection):null,s=t?d(t.dataProjection):null;return n&&s&&!Oe(n,s)?Ha(e,s,n):e}const Bg={Point:Y,LineString:ee,Polygon:ie,MultiPoint:tt,MultiLineString:ke,MultiPolygon:Re};function lu(e,t){const n=e.geometry;if(!n)return[];if(Array.isArray(n))return n.map(t=>lu({...e,geometry:t})).flat();const s="MultiPolygon"===n.type?"Polygon":n.type;if("GeometryCollection"===s||"Circle"===s)throw new Error("Unsupported geometry type: "+s);const o=n.layout.length;return q(new Ce(s,"Polygon"===s?function(e,t,n){return Array.isArray(t[0])?(qu(e,0,t,n)||fc(e=e.slice(),0,t,n),e):(ac(e,0,t,n)||Wi(e=e.slice(),0,t,n),e)}(n.flatCoordinates,n.ends,o):n.flatCoordinates,n.ends?.flat(),o,e.properties||{},e.id).enableSimplifyTransformed(),!1,t)}function Xa(e,t){if(!e)return null;if(Array.isArray(e)){const n=e.map(e=>Xa(e,t));return new ge(n)}return q(new(0,Bg[e.type])(e.flatCoordinates,e.layout,e.ends),!1,t)}class Ja extends xo{constructor(){super()}getType(){return"json"}readFeature(e,t){return this.readFeatureFromObject(tr(e),this.getReadOptions(e,t))}readFeatures(e,t){return this.readFeaturesFromObject(tr(e),this.getReadOptions(e,t))}readFeatureFromObject(){return g()}readFeaturesFromObject(){return g()}readGeometry(e,t){return this.readGeometryFromObject(tr(e),this.getReadOptions(e,t))}readGeometryFromObject(){return g()}readProjection(e){return this.readProjectionFromObject(tr(e))}readProjectionFromObject(){return g()}writeFeature(e,t){return JSON.stringify(this.writeFeatureObject(e,t))}writeFeatureObject(){return g()}writeFeatures(e,t){return JSON.stringify(this.writeFeaturesObject(e,t))}writeFeaturesObject(){return g()}writeGeometry(e,t){return JSON.stringify(this.writeGeometryObject(e,t))}writeGeometryObject(){return g()}}function tr(e){if("string"==typeof e){const t=JSON.parse(e);return t||null}return null!==e?e:null}const Ig={Point:function(e){let t;return t=void 0!==e.m&&void 0!==e.z?new Y([e.x,e.y,e.z,e.m],"XYZM"):void 0!==e.z?new Y([e.x,e.y,e.z],"XYZ"):void 0!==e.m?new Y([e.x,e.y,e.m],"XYM"):new Y([e.x,e.y]),t},LineString:function(e){const t=Fo(e);return new ee(e.paths[0],t)},Polygon:function(e){const t=Fo(e);return new ie(e.rings,t)},MultiPoint:function(e){const t=Fo(e);return new tt(e.points,t)},MultiLineString:function(e){const t=Fo(e);return new ke(e.paths,t)},MultiPolygon:function(e){const t=Fo(e);return new Re(e.rings,t)}},Hg={Point:function(e){const n=e.getCoordinates();let s;const o=e.getLayout();if("XYZ"===o)s={x:n[0],y:n[1],z:n[2]};else if("XYM"===o)s={x:n[0],y:n[1],m:n[2]};else if("XYZM"===o)s={x:n[0],y:n[1],z:n[2],m:n[3]};else{if("XY"!==o)throw new Error("Invalid geometry layout");s={x:n[0],y:n[1]}}return s},LineString:function(e){const n=Ea(e);return{hasZ:n.hasZ,hasM:n.hasM,paths:[e.getCoordinates()]}},Polygon:function(e){const n=Ea(e);return{hasZ:n.hasZ,hasM:n.hasM,rings:e.getCoordinates(!1)}},MultiPoint:function(e){const n=Ea(e);return{hasZ:n.hasZ,hasM:n.hasM,points:e.getCoordinates()}},MultiLineString:function(e){const n=Ea(e);return{hasZ:n.hasZ,hasM:n.hasM,paths:e.getCoordinates()}},MultiPolygon:function(e){const s=Ea(e),n=e.getCoordinates(!1),o=[];for(let e=0;e<n.length;e++)for(let t=n[e].length-1;t>=0;t--)o.push(n[e][t]);return{hasZ:s.hasZ,hasM:s.hasM,rings:o}}};function Ym(e,t){if(!e)return null;let n;if("number"==typeof e.x&&"number"==typeof e.y)n="Point";else if(e.points)n="MultiPoint";else if(e.paths)n=1===e.paths.length?"LineString":"MultiLineString";else if(e.rings){const s=e,o=Fo(s),t=function(e,t){const o=[],s=[],i=[];let n,a;for(n=0,a=e.length;n<a;++n)o.length=0,io(o,0,e[n],t.length),Ki(o,0,o.length,t.length)?s.push([e[n]]):i.push(e[n]);for(;i.length;){const e=i.shift();let t=!1;for(n=s.length-1;n>=0;n--){const o=s[n][0];if(xe(new Tn(o).getExtent(),new Tn(e).getExtent())){s[n].push(e),t=!0;break}}t||s.push([e.reverse()])}return s}(s.rings,o);1===t.length?(n="Polygon",e=Object.assign({},e,{rings:t[0]})):(n="MultiPolygon",e=Object.assign({},e,{rings:t}))}return q((0,Ig[n])(e),!1,t)}function Fo(e){let t="XY";return!0===e.hasZ&&!0===e.hasM?t="XYZM":!0===e.hasZ?t="XYZ":!0===e.hasM&&(t="XYM"),t}function Ea(e){const t=e.getLayout();return{hasZ:"XYZ"===t||"XYZM"===t,hasM:"XYM"===t||"XYZM"===t}}function Qm(e,t){return(0,Hg[e.getType()])(q(e,!0,t),t)}class bs extends xo{constructor(){super(),this.xmlSerializer_=c0()}getType(){return"xml"}readFeature(e,t){if(!e)return null;if("string"==typeof e){const n=et(e);return this.readFeatureFromDocument(n,t)}return Xe(e)?this.readFeatureFromDocument(e,t):this.readFeatureFromNode(e,t)}readFeatureFromDocument(e,t){const n=this.readFeaturesFromDocument(e,t);return n.length>0?n[0]:null}readFeatureFromNode(){return null}readFeatures(e,t){if(!e)return[];if("string"==typeof e){const n=et(e);return this.readFeaturesFromDocument(n,t)}return Xe(e)?this.readFeaturesFromDocument(e,t):this.readFeaturesFromNode(e,t)}readFeaturesFromDocument(e,t){const n=[];for(let s=e.firstChild;s;s=s.nextSibling)s.nodeType==Node.ELEMENT_NODE&&z(n,this.readFeaturesFromNode(s,t));return n}readFeaturesFromNode(){return g()}readGeometry(e,t){if(!e)return null;if("string"==typeof e){const n=et(e);return this.readGeometryFromDocument(n,t)}return Xe(e)?this.readGeometryFromDocument(e,t):this.readGeometryFromNode(e,t)}readGeometryFromDocument(){return null}readGeometryFromNode(){return null}readProjection(e){if(!e)return null;if("string"==typeof e){const t=et(e);return this.readProjectionFromDocument(t)}return Xe(e)?this.readProjectionFromDocument(e):this.readProjectionFromNode(e)}readProjectionFromDocument(){return this.dataProjection}readProjectionFromNode(){return this.dataProjection}writeFeature(e,t){const n=this.writeFeatureNode(e,t);return this.xmlSerializer_.serializeToString(n)}writeFeatureNode(){return null}writeFeatures(e,t){const n=this.writeFeaturesNode(e,t);return this.xmlSerializer_.serializeToString(n)}writeFeaturesNode(){return null}writeGeometry(e,t){const n=this.writeGeometryNode(e,t);return this.xmlSerializer_.serializeToString(n)}writeGeometryNode(){return null}}const qt="http://www.opengis.net/gml",Rg=/^\s*$/;class f extends bs{constructor(e){super(),e=e||{},this.featureType=e.featureType,this.featureNS=e.featureNS,this.srsName=e.srsName,this.schemaLocation="",this.FEATURE_COLLECTION_PARSERS={},this.FEATURE_COLLECTION_PARSERS[this.namespace]={featureMember:h(this.readFeaturesInternal),featureMembers:v(this.readFeaturesInternal)},this.supportedMediaTypes=["application/gml+xml"]}readFeaturesInternal(e,t){const n=e.localName;let s=null;if("FeatureCollection"==n)s=i([],this.FEATURE_COLLECTION_PARSERS,e,t,this);else if("featureMembers"==n||"featureMember"==n||"member"==n){const r=t[0];let a=r.featureType,o=r.featureNS;const u="p",l="p0";if(!a&&e.childNodes){a=[],o={};for(let t=0,s=e.childNodes.length;t<s;++t){const n=e.childNodes[t];if(1===n.nodeType){const e=n.nodeName.split(":").pop();if(!a.includes(e)){let t="",s=0;const i=n.namespaceURI;for(const e in o){if(o[e]===i){t=e;break}++s}t||(t=u+s,o[t]=i),a.push(t+":"+e)}}}"featureMember"!=n&&(r.featureType=a,r.featureNS=o)}if("string"==typeof o){const e=o;o={},o[l]=e}const d={},c=Array.isArray(a)?a:[a];for(const e in o){const t={};for(let s=0,o=c.length;s<o;++s)(c[s].includes(":")?c[s].split(":")[0]:l)===e&&(t[c[s].split(":").pop()]="featureMembers"==n?h(this.readFeatureElement,this):v(this.readFeatureElement,this));d[o[e]]=t}s=i("featureMember"==n||"member"==n?void 0:[],d,e,t)}return null===s&&(s=[]),s}readGeometryOrExtent(e,t){const n=t[0];return n.srsName=e.firstElementChild.getAttribute("srsName"),n.srsDimension=e.firstElementChild.getAttribute("srsDimension"),i(null,this.GEOMETRY_PARSERS,e,t,this)}readExtentElement(e,t){const s=t[0],n=this.readGeometryOrExtent(e,t);return n?Ga(n,s):void 0}readGeometryElement(e,t){const s=t[0],n=this.readGeometryOrExtent(e,t);return n?q(n,!1,s):void 0}readFeatureElementInternal(e,t,n){let o;const s={};for(let i=e.firstElementChild;i;i=i.nextElementSibling){let a;const r=i.localName;0===i.childNodes.length||1===i.childNodes.length&&(3===i.firstChild.nodeType||4===i.firstChild.nodeType)?(a=Me(i,!1),Rg.test(a)&&(a=void 0)):(n&&(a="boundedBy"===r?this.readExtentElement(i,t):this.readGeometryElement(i,t)),a?"boundedBy"!==r&&(o=r):a=this.readFeatureElementInternal(i,t,!1));const c=i.attributes.length;if(c>0&&!(a instanceof ur)){a={_content_:a};for(let e=0;e<c;e++)a[i.attributes[e].name]=i.attributes[e].value}s[r]?(s[r]instanceof Array||(s[r]=[s[r]]),s[r].push(a)):s[r]=a}if(!n)return s;const i=new N(s);o&&i.setGeometryName(o);const a=e.getAttribute("fid")||$4(e,this.namespace,"id");return a&&i.setId(a),i}readFeatureElement(e,t){return this.readFeatureElementInternal(e,t,!0)}readPoint(e,t){const n=this.readFlatCoordinatesFromNode(e,t);if(n)return new Y(n,"XYZ")}readMultiPoint(e,t){const n=i([],this.MULTIPOINT_PARSERS,e,t,this);if(n)return new tt(n)}readMultiLineString(e,t){const n=i([],this.MULTILINESTRING_PARSERS,e,t,this);if(n)return new ke(n)}readMultiPolygon(e,t){const n=i([],this.MULTIPOLYGON_PARSERS,e,t,this);if(n)return new Re(n)}pointMemberParser(e,t){Te(this.POINTMEMBER_PARSERS,e,t,this)}lineStringMemberParser(e,t){Te(this.LINESTRINGMEMBER_PARSERS,e,t,this)}polygonMemberParser(e,t){Te(this.POLYGONMEMBER_PARSERS,e,t,this)}readLineString(e,t){const n=this.readFlatCoordinatesFromNode(e,t);if(n)return new ee(n,"XYZ")}readFlatLinearRing(e,t){const n=i(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,e,t,this);if(n)return n}readLinearRing(e,t){const n=this.readFlatCoordinatesFromNode(e,t);if(n)return new Tn(n,"XYZ")}readPolygon(e,t){const n=i([null],this.FLAT_LINEAR_RINGS_PARSERS,e,t,this);if(n&&n[0]){const e=n[0],s=[e.length];let t,o;for(t=1,o=n.length;t<o;++t)z(e,n[t]),s.push(e.length);return new ie(e,"XYZ",s)}}readFlatCoordinatesFromNode(e,t){return i(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,e,t,this)}readGeometryFromNode(e,t){const n=this.readGeometryElement(e,[this.getReadOptions(e,t||{})]);return n||null}readFeaturesFromNode(e,t){const n={featureType:this.featureType,featureNS:this.featureNS};return n&&Object.assign(n,this.getReadOptions(e,t)),this.readFeaturesInternal(e,[n])||[]}readProjectionFromNode(e){return d(this.srsName?this.srsName:e.firstElementChild.getAttribute("srsName"))}}function vn(e){return Sn(Me(e,!1))}function Sn(e){const t=/^\s*(true|1)|(false|0)\s*$/.exec(e);if(t)return void 0!==t[1]||!1}function ua(e){const n=Me(e,!1),t=Date.parse(n);return isNaN(t)?void 0:t/1e3}function F(e){return Gt(Me(e,!1))}function Gt(e){const t=/^\s*([+-]?\d*\.?\d+(?:e[+-]?\d+)?)\s*$/i.exec(e);if(t)return parseFloat(t[1])}function ae(e){return Qt(Me(e,!1))}function Qt(e){const t=/^\s*(\d+)\s*$/.exec(e);if(t)return parseInt(t[1],10)}function a(e){return Me(e,!1).trim()}function Zs(e,t){j(e,t?"1":"0")}function u8(e,t){e.appendChild(os().createCDATASection(t))}function h8(e,t){const n=new Date(1e3*t),s=n.getUTCFullYear()+"-"+On(n.getUTCMonth()+1,2)+"-"+On(n.getUTCDate(),2)+"T"+On(n.getUTCHours(),2)+":"+On(n.getUTCMinutes(),2)+":"+On(n.getUTCSeconds(),2)+"Z";e.appendChild(os().createTextNode(s))}function Be(e,t){const n=t.toPrecision();e.appendChild(os().createTextNode(n))}function ra(e,t){const n=t.toString();e.appendChild(os().createTextNode(n))}function j(e,t){e.appendChild(os().createTextNode(t))}f.prototype.namespace=qt,f.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{}},f.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{}},f.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{}},f.prototype.MULTIPOINT_PARSERS={"http://www.opengis.net/gml":{pointMember:h(f.prototype.pointMemberParser),pointMembers:h(f.prototype.pointMemberParser)}},f.prototype.MULTILINESTRING_PARSERS={"http://www.opengis.net/gml":{lineStringMember:h(f.prototype.lineStringMemberParser),lineStringMembers:h(f.prototype.lineStringMemberParser)}},f.prototype.MULTIPOLYGON_PARSERS={"http://www.opengis.net/gml":{polygonMember:h(f.prototype.polygonMemberParser),polygonMembers:h(f.prototype.polygonMemberParser)}},f.prototype.POINTMEMBER_PARSERS={"http://www.opengis.net/gml":{Point:h(f.prototype.readFlatCoordinatesFromNode)}},f.prototype.LINESTRINGMEMBER_PARSERS={"http://www.opengis.net/gml":{LineString:h(f.prototype.readLineString)}},f.prototype.POLYGONMEMBER_PARSERS={"http://www.opengis.net/gml":{Polygon:h(f.prototype.readPolygon)}},f.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:v(f.prototype.readFlatLinearRing)}};const Ng=qt+" http://schemas.opengis.net/gml/2.1.2/feature.xsd",Dg={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"};class S extends f{constructor(e){super(e=e||{}),this.FEATURE_COLLECTION_PARSERS[qt].featureMember=h(this.readFeaturesInternal),this.schemaLocation=e.schemaLocation?e.schemaLocation:Ng}readFlatCoordinates(e,t){const a=Me(e,!1).replace(/^\s*|\s*$/g,""),s=t[0].srsName;let o="enu";if(s){const e=d(s);e&&(o=e.getAxisOrientation())}const i=a.trim().split(/\s+/),n=[];for(let t=0,c=i.length;t<c;t++){const e=i[t].split(/,+/),s=parseFloat(e[0]),a=parseFloat(e[1]),r=3===e.length?parseFloat(e[2]):0;"en"===o.substr(0,2)?n.push(s,a,r):n.push(a,s,r)}return n}readBox(e,t){const n=i([null],this.BOX_PARSERS_,e,t,this);return Ge(n[1][0],n[1][1],n[1][3],n[1][4])}innerBoundaryIsParser(e,t){const n=i(void 0,this.RING_PARSERS,e,t,this);n&&t[t.length-1].push(n)}outerBoundaryIsParser(e,t){const n=i(void 0,this.RING_PARSERS,e,t,this);n&&(t[t.length-1][0]=n)}GEOMETRY_NODE_FACTORY_(e,t,n){const s=t[t.length-1],o=s.multiSurface,i=s.surface,a=s.multiCurve;return Array.isArray(e)?n="Envelope":"MultiPolygon"===(n=e.getType())&&!0===o?n="MultiSurface":"Polygon"===n&&!0===i?n="Surface":"MultiLineString"===n&&!0===a&&(n="MultiCurve"),w("http://www.opengis.net/gml",n)}writeFeatureElement(e,t,s){const a=t.getId();a&&e.setAttribute("fid",a);const o=s[s.length-1],i=o.featureNS,d=t.getGeometryName();o.serializers||(o.serializers={},o.serializers[i]={});const r=[],c=[];if(t.hasProperties()){const e=t.getProperties();for(const t in e){const s=e[t];null!==s&&(r.push(t),c.push(s),t==d||"function"==typeof s.getSimplifiedGeometry?t in o.serializers[i]||(o.serializers[i][t]=n(this.writeGeometryElement,this)):t in o.serializers[i]||(o.serializers[i][t]=n(j)))}}const l=Object.assign({},o);l.node=e,_(l,o.serializers,se(void 0,i),c,s,r)}writeCurveOrLineString(e,t,n){const s=n[n.length-1].srsName;if("LineStringSegment"!==e.nodeName&&s&&e.setAttribute("srsName",s),"LineString"===e.nodeName||"LineStringSegment"===e.nodeName){const s=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(s),this.writeCoordinates_(s,t,n)}else if("Curve"===e.nodeName){const s=w(e.namespaceURI,"segments");e.appendChild(s),this.writeCurveSegments_(s,t,n)}}writeLineStringOrCurveMember(e,t,n){const s=this.GEOMETRY_NODE_FACTORY_(t,n);s&&(e.appendChild(s),this.writeCurveOrLineString(s,t,n))}writeMultiCurveOrLineString(e,t,n){const s=n[n.length-1],i=s.hasZ,o=s.srsName,a=s.curve;o&&e.setAttribute("srsName",o);const r=t.getLineStrings();_({node:e,hasZ:i,srsName:o,curve:a},this.LINESTRINGORCURVEMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,r,n,void 0,this)}writeGeometryElement(e,t,n){const s=n[n.length-1],o=Object.assign({},s);let i;o.node=e,i=Array.isArray(t)?Ga(t,s):q(t,!0,s),_(o,this.GEOMETRY_SERIALIZERS,this.GEOMETRY_NODE_FACTORY_,[i],n,void 0,this)}createCoordinatesNode_(e){const t=w(e,"coordinates");return t.setAttribute("decimal","."),t.setAttribute("cs",","),t.setAttribute("ts"," "),t}writeCoordinates_(e,t,n){const s=n[n.length-1],r=s.hasZ,c=s.srsName,o=t.getCoordinates(),i=o.length,a=new Array(i);for(let e=0;e<i;++e){const t=o[e];a[e]=this.getCoords_(t,c,r)}j(e,a.join(" "))}writeCurveSegments_(e,t,n){const s=w(e.namespaceURI,"LineStringSegment");e.appendChild(s),this.writeCurveOrLineString(s,t,n)}writeSurfaceOrPolygon(e,t,n){const o=n[n.length-1],i=o.hasZ,s=o.srsName;if("PolygonPatch"!==e.nodeName&&s&&e.setAttribute("srsName",s),"Polygon"===e.nodeName||"PolygonPatch"===e.nodeName){const o=t.getLinearRings();_({node:e,hasZ:i,srsName:s},this.RING_SERIALIZERS,this.RING_NODE_FACTORY_,o,n,void 0,this)}else if("Surface"===e.nodeName){const s=w(e.namespaceURI,"patches");e.appendChild(s),this.writeSurfacePatches_(s,t,n)}}RING_NODE_FACTORY_(e,t){const s=t[t.length-1],i=s.node,o=s.exteriorWritten;return void 0===o&&(s.exteriorWritten=!0),w(i.namespaceURI,void 0!==o?"innerBoundaryIs":"outerBoundaryIs")}writeSurfacePatches_(e,t,n){const s=w(e.namespaceURI,"PolygonPatch");e.appendChild(s),this.writeSurfaceOrPolygon(s,t,n)}writeRing(e,t,n){const s=w(e.namespaceURI,"LinearRing");e.appendChild(s),this.writeLinearRing(s,t,n)}getCoords_(e,t,n){let s="enu";t&&(s=d(t).getAxisOrientation());let o="en"===s.substr(0,2)?e[0]+","+e[1]:e[1]+","+e[0];return n&&(o+=","+(e[2]||0)),o}writePoint(e,t,n){const o=n[n.length-1],a=o.hasZ,s=o.srsName;s&&e.setAttribute("srsName",s);const i=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(i);const r=t.getCoordinates();j(i,this.getCoords_(r,s,a))}writeMultiPoint(e,t,n){const o=n[n.length-1],i=o.hasZ,s=o.srsName;s&&e.setAttribute("srsName",s);const a=t.getPoints();_({node:e,hasZ:i,srsName:s},this.POINTMEMBER_SERIALIZERS,se("pointMember"),a,n,void 0,this)}writePointMember(e,t,n){const s=w(e.namespaceURI,"Point");e.appendChild(s),this.writePoint(s,t,n)}writeLinearRing(e,t,n){const s=n[n.length-1].srsName;s&&e.setAttribute("srsName",s);const o=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(o),this.writeCoordinates_(o,t,n)}writeMultiSurfaceOrPolygon(e,t,n){const s=n[n.length-1],i=s.hasZ,o=s.srsName,a=s.surface;o&&e.setAttribute("srsName",o);const r=t.getPolygons();_({node:e,hasZ:i,srsName:o,surface:a},this.SURFACEORPOLYGONMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,r,n,void 0,this)}writeSurfaceOrPolygonMember(e,t,n){const s=this.GEOMETRY_NODE_FACTORY_(t,n);s&&(e.appendChild(s),this.writeSurfaceOrPolygon(s,t,n))}writeEnvelope(e,t,n){const s=n[n.length-1].srsName;s&&e.setAttribute("srsName",s);const o=[t[0]+" "+t[1],t[2]+" "+t[3]];_({node:e},this.ENVELOPE_SERIALIZERS,ye,o,n,["lowerCorner","upperCorner"],this)}MULTIGEOMETRY_MEMBER_NODE_FACTORY_(e,t){const s=t[t.length-1].node;return w("http://www.opengis.net/gml",Dg[s.nodeName])}}S.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{coordinates:v(S.prototype.readFlatCoordinates)}},S.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{innerBoundaryIs:S.prototype.innerBoundaryIsParser,outerBoundaryIs:S.prototype.outerBoundaryIsParser}},S.prototype.BOX_PARSERS_={"http://www.opengis.net/gml":{coordinates:h(S.prototype.readFlatCoordinates)}},S.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:v(f.prototype.readPoint),MultiPoint:v(f.prototype.readMultiPoint),LineString:v(f.prototype.readLineString),MultiLineString:v(f.prototype.readMultiLineString),LinearRing:v(f.prototype.readLinearRing),Polygon:v(f.prototype.readPolygon),MultiPolygon:v(f.prototype.readMultiPolygon),Box:v(S.prototype.readBox)}},S.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml":{Curve:n(S.prototype.writeCurveOrLineString),MultiCurve:n(S.prototype.writeMultiCurveOrLineString),Point:n(S.prototype.writePoint),MultiPoint:n(S.prototype.writeMultiPoint),LineString:n(S.prototype.writeCurveOrLineString),MultiLineString:n(S.prototype.writeMultiCurveOrLineString),LinearRing:n(S.prototype.writeLinearRing),Polygon:n(S.prototype.writeSurfaceOrPolygon),MultiPolygon:n(S.prototype.writeMultiSurfaceOrPolygon),Surface:n(S.prototype.writeSurfaceOrPolygon),MultiSurface:n(S.prototype.writeMultiSurfaceOrPolygon),Envelope:n(S.prototype.writeEnvelope)}},S.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{lineStringMember:n(S.prototype.writeLineStringOrCurveMember),curveMember:n(S.prototype.writeLineStringOrCurveMember)}},S.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml":{outerBoundaryIs:n(S.prototype.writeRing),innerBoundaryIs:n(S.prototype.writeRing)}},S.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{pointMember:n(S.prototype.writePointMember)}},S.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{surfaceMember:n(S.prototype.writeSurfaceOrPolygonMember),polygonMember:n(S.prototype.writeSurfaceOrPolygonMember)}},S.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml":{lowerCorner:n(j),upperCorner:n(j)}};const zg=qt+" http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",Tg={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"};class r extends f{constructor(e){super(e=e||{}),this.surface_=void 0!==e.surface&&e.surface,this.curve_=void 0!==e.curve&&e.curve,this.multiCurve_=void 0===e.multiCurve||e.multiCurve,this.multiSurface_=void 0===e.multiSurface||e.multiSurface,this.schemaLocation=e.schemaLocation?e.schemaLocation:zg,this.hasZ=void 0!==e.hasZ&&e.hasZ}readMultiCurve(e,t){const n=i([],this.MULTICURVE_PARSERS,e,t,this);if(n)return new ke(n)}readFlatCurveRing(e,t){const n=i([],this.MULTICURVE_PARSERS,e,t,this),s=[];for(let e=0,t=n.length;e<t;++e)z(s,n[e].getFlatCoordinates());return s}readMultiSurface(e,t){const n=i([],this.MULTISURFACE_PARSERS,e,t,this);if(n)return new Re(n)}curveMemberParser(e,t){Te(this.CURVEMEMBER_PARSERS,e,t,this)}surfaceMemberParser(e,t){Te(this.SURFACEMEMBER_PARSERS,e,t,this)}readPatch(e,t){return i([null],this.PATCHES_PARSERS,e,t,this)}readSegment(e,t){return i([],this.SEGMENTS_PARSERS,e,t,this)}readPolygonPatch(e,t){return i([null],this.FLAT_LINEAR_RINGS_PARSERS,e,t,this)}readLineStringSegment(e,t){return i([null],this.GEOMETRY_FLAT_COORDINATES_PARSERS,e,t,this)}interiorParser(e,t){const n=i(void 0,this.RING_PARSERS,e,t,this);n&&t[t.length-1].push(n)}exteriorParser(e,t){const n=i(void 0,this.RING_PARSERS,e,t,this);n&&(t[t.length-1][0]=n)}readSurface(e,t){const n=i([null],this.SURFACE_PARSERS,e,t,this);if(n&&n[0]){const e=n[0],s=[e.length];let t,o;for(t=1,o=n.length;t<o;++t)z(e,n[t]),s.push(e.length);return new ie(e,"XYZ",s)}}readCurve(e,t){const n=i([null],this.CURVE_PARSERS,e,t,this);if(n)return new ee(n,"XYZ")}readEnvelope(e,t){const n=i([null],this.ENVELOPE_PARSERS,e,t,this);return Ge(n[1][0],n[1][1],n[2][0],n[2][1])}readFlatPos(e,t){let s=Me(e,!1);const c=/^\s*([+-]?\d*\.?\d+(?:[eE][+-]?\d+)?)\s*/,n=[];let o;for(;o=c.exec(s);)n.push(parseFloat(o[1])),s=s.substr(o[0].length);if(""!==s)return;const i=t[0].srsName;let a="enu";if(i&&(a=d(i).getAxisOrientation()),"neu"===a){let e,t;for(e=0,t=n.length;e<t;e+=3){const s=n[e],o=n[e+1];n[e]=o,n[e+1]=s}}const r=n.length;return 2==r&&n.push(0),0!==r?n:void 0}readFlatPosList(e,t){const m=Me(e,!1).replace(/^\s*|\s*$/g,""),c=t[0],l=c.srsName,u=c.srsDimension;let h="enu";l&&(h=d(l).getAxisOrientation());const s=m.split(/\s+/);let o,i,a,n=2;e.getAttribute("srsDimension")?n=Qt(e.getAttribute("srsDimension")):e.getAttribute("dimension")?n=Qt(e.getAttribute("dimension")):e.parentNode.getAttribute("srsDimension")?n=Qt(e.parentNode.getAttribute("srsDimension")):u&&(n=Qt(u));const r=[];for(let e=0,t=s.length;e<t;e+=n)o=parseFloat(s[e]),i=parseFloat(s[e+1]),a=3===n?parseFloat(s[e+2]):0,"en"===h.substr(0,2)?r.push(o,i,a):r.push(i,o,a);return r}writePos_(e,t,n){const i=n[n.length-1],a=i.hasZ,l=a?"3":"2";e.setAttribute("srsDimension",l);const r=i.srsName;let c="enu";r&&(c=d(r).getAxisOrientation());const s=t.getCoordinates();let o;(o="en"===c.substr(0,2)?s[0]+" "+s[1]:s[1]+" "+s[0],a)&&(o+=" "+(s[2]||0)),j(e,o)}getCoords_(e,t,n){let s="enu";t&&(s=d(t).getAxisOrientation());let o="en"===s.substr(0,2)?e[0]+" "+e[1]:e[1]+" "+e[0];return n&&(o+=" "+(e[2]||0)),o}writePosList_(e,t,n){const s=n[n.length-1],o=s.hasZ,l=o?"3":"2";e.setAttribute("srsDimension",l);const d=s.srsName,i=t.getCoordinates(),a=i.length,r=new Array(a);let c;for(let e=0;e<a;++e)c=i[e],r[e]=this.getCoords_(c,d,o);j(e,r.join(" "))}writePoint(e,t,n){const s=n[n.length-1].srsName;s&&e.setAttribute("srsName",s);const o=w(e.namespaceURI,"pos");e.appendChild(o),this.writePos_(o,t,n)}writeEnvelope(e,t,n){const s=n[n.length-1].srsName;s&&e.setAttribute("srsName",s);const o=[t[0]+" "+t[1],t[2]+" "+t[3]];_({node:e},this.ENVELOPE_SERIALIZERS,ye,o,n,["lowerCorner","upperCorner"],this)}writeLinearRing(e,t,n){const s=n[n.length-1].srsName;s&&e.setAttribute("srsName",s);const o=w(e.namespaceURI,"posList");e.appendChild(o),this.writePosList_(o,t,n)}RING_NODE_FACTORY_(e,t){const s=t[t.length-1],i=s.node,o=s.exteriorWritten;return void 0===o&&(s.exteriorWritten=!0),w(i.namespaceURI,void 0!==o?"interior":"exterior")}writeSurfaceOrPolygon(e,t,n){const o=n[n.length-1],i=o.hasZ,s=o.srsName;if("PolygonPatch"!==e.nodeName&&s&&e.setAttribute("srsName",s),"Polygon"===e.nodeName||"PolygonPatch"===e.nodeName){const o=t.getLinearRings();_({node:e,hasZ:i,srsName:s},this.RING_SERIALIZERS,this.RING_NODE_FACTORY_,o,n,void 0,this)}else if("Surface"===e.nodeName){const s=w(e.namespaceURI,"patches");e.appendChild(s),this.writeSurfacePatches_(s,t,n)}}writeCurveOrLineString(e,t,n){const s=n[n.length-1].srsName;if("LineStringSegment"!==e.nodeName&&s&&e.setAttribute("srsName",s),"LineString"===e.nodeName||"LineStringSegment"===e.nodeName){const s=w(e.namespaceURI,"posList");e.appendChild(s),this.writePosList_(s,t,n)}else if("Curve"===e.nodeName){const s=w(e.namespaceURI,"segments");e.appendChild(s),this.writeCurveSegments_(s,t,n)}}writeMultiSurfaceOrPolygon(e,t,n){const s=n[n.length-1],i=s.hasZ,o=s.srsName,a=s.surface;o&&e.setAttribute("srsName",o);const r=t.getPolygons();_({node:e,hasZ:i,srsName:o,surface:a},this.SURFACEORPOLYGONMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,r,n,void 0,this)}writeMultiPoint(e,t,n){const o=n[n.length-1],s=o.srsName,i=o.hasZ;s&&e.setAttribute("srsName",s);const a=t.getPoints();_({node:e,hasZ:i,srsName:s},this.POINTMEMBER_SERIALIZERS,se("pointMember"),a,n,void 0,this)}writeMultiCurveOrLineString(e,t,n){const s=n[n.length-1],i=s.hasZ,o=s.srsName,a=s.curve;o&&e.setAttribute("srsName",o);const r=t.getLineStrings();_({node:e,hasZ:i,srsName:o,curve:a},this.LINESTRINGORCURVEMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,r,n,void 0,this)}writeRing(e,t,n){const s=w(e.namespaceURI,"LinearRing");e.appendChild(s),this.writeLinearRing(s,t,n)}writeSurfaceOrPolygonMember(e,t,n){const s=this.GEOMETRY_NODE_FACTORY_(t,n);s&&(e.appendChild(s),this.writeSurfaceOrPolygon(s,t,n))}writePointMember(e,t,n){const s=w(e.namespaceURI,"Point");e.appendChild(s),this.writePoint(s,t,n)}writeLineStringOrCurveMember(e,t,n){const s=this.GEOMETRY_NODE_FACTORY_(t,n);s&&(e.appendChild(s),this.writeCurveOrLineString(s,t,n))}writeSurfacePatches_(e,t,n){const s=w(e.namespaceURI,"PolygonPatch");e.appendChild(s),this.writeSurfaceOrPolygon(s,t,n)}writeCurveSegments_(e,t,n){const s=w(e.namespaceURI,"LineStringSegment");e.appendChild(s),this.writeCurveOrLineString(s,t,n)}writeGeometryElement(e,t,n){const s=n[n.length-1],o=Object.assign({},s);let i;o.node=e,i=Array.isArray(t)?Ga(t,s):q(t,!0,s),_(o,this.GEOMETRY_SERIALIZERS,this.GEOMETRY_NODE_FACTORY_,[i],n,void 0,this)}writeFeatureElement(e,t,s){const a=t.getId();a&&e.setAttribute("fid",a);const o=s[s.length-1],i=o.featureNS,d=t.getGeometryName();o.serializers||(o.serializers={},o.serializers[i]={});const r=[],c=[];if(t.hasProperties()){const e=t.getProperties();for(const t in e){const s=e[t];null!==s&&(r.push(t),c.push(s),t==d||"function"==typeof s.getSimplifiedGeometry?t in o.serializers[i]||(o.serializers[i][t]=n(this.writeGeometryElement,this)):t in o.serializers[i]||(o.serializers[i][t]=n(j)))}}const l=Object.assign({},o);l.node=e,_(l,o.serializers,se(void 0,i),c,s,r)}writeFeatureMembers_(e,t,s){const o=s[s.length-1],r=o.featureType,i=o.featureNS,a={};a[i]={},a[i][r]=n(this.writeFeatureElement,this);const c=Object.assign({},o);c.node=e,_(c,a,se(r,i),t,s)}MULTIGEOMETRY_MEMBER_NODE_FACTORY_(e,t){const s=t[t.length-1].node;return w(this.namespace,Tg[s.nodeName])}GEOMETRY_NODE_FACTORY_(e,t,n){const s=t[t.length-1],o=s.multiSurface,i=s.surface,a=s.curve,r=s.multiCurve;return Array.isArray(e)?n="Envelope":"MultiPolygon"===(n=e.getType())&&!0===o?n="MultiSurface":"Polygon"===n&&!0===i?n="Surface":"LineString"===n&&!0===a?n="Curve":"MultiLineString"===n&&!0===r&&(n="MultiCurve"),w(this.namespace,n)}writeGeometryNode(e,t){t=this.adaptOptions(t);const n=w(this.namespace,"geom"),s={node:n,hasZ:this.hasZ,srsName:this.srsName,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_};return t&&Object.assign(s,t),this.writeGeometryElement(n,e,[s]),n}writeFeaturesNode(e,t){t=this.adaptOptions(t);const n=w(this.namespace,"featureMembers");n.setAttributeNS(Dn,"xsi:schemaLocation",this.schemaLocation);const s={srsName:this.srsName,hasZ:this.hasZ,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_,featureNS:this.featureNS,featureType:this.featureType};return t&&Object.assign(s,t),this.writeFeatureMembers_(n,e,[s]),n}}r.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{pos:v(r.prototype.readFlatPos),posList:v(r.prototype.readFlatPosList),coordinates:v(S.prototype.readFlatCoordinates)}},r.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{interior:r.prototype.interiorParser,exterior:r.prototype.exteriorParser}},r.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:v(f.prototype.readPoint),MultiPoint:v(f.prototype.readMultiPoint),LineString:v(f.prototype.readLineString),MultiLineString:v(f.prototype.readMultiLineString),LinearRing:v(f.prototype.readLinearRing),Polygon:v(f.prototype.readPolygon),MultiPolygon:v(f.prototype.readMultiPolygon),Surface:v(r.prototype.readSurface),MultiSurface:v(r.prototype.readMultiSurface),Curve:v(r.prototype.readCurve),MultiCurve:v(r.prototype.readMultiCurve),Envelope:v(r.prototype.readEnvelope)}},r.prototype.MULTICURVE_PARSERS={"http://www.opengis.net/gml":{curveMember:h(r.prototype.curveMemberParser),curveMembers:h(r.prototype.curveMemberParser)}},r.prototype.MULTISURFACE_PARSERS={"http://www.opengis.net/gml":{surfaceMember:h(r.prototype.surfaceMemberParser),surfaceMembers:h(r.prototype.surfaceMemberParser)}},r.prototype.CURVEMEMBER_PARSERS={"http://www.opengis.net/gml":{LineString:h(f.prototype.readLineString),Curve:h(r.prototype.readCurve)}},r.prototype.SURFACEMEMBER_PARSERS={"http://www.opengis.net/gml":{Polygon:h(f.prototype.readPolygon),Surface:h(r.prototype.readSurface)}},r.prototype.SURFACE_PARSERS={"http://www.opengis.net/gml":{patches:v(r.prototype.readPatch)}},r.prototype.CURVE_PARSERS={"http://www.opengis.net/gml":{segments:v(r.prototype.readSegment)}},r.prototype.ENVELOPE_PARSERS={"http://www.opengis.net/gml":{lowerCorner:h(r.prototype.readFlatPosList),upperCorner:h(r.prototype.readFlatPosList)}},r.prototype.PATCHES_PARSERS={"http://www.opengis.net/gml":{PolygonPatch:v(r.prototype.readPolygonPatch)}},r.prototype.SEGMENTS_PARSERS={"http://www.opengis.net/gml":{LineStringSegment:fa(r.prototype.readLineStringSegment)}},f.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:v(f.prototype.readFlatLinearRing),Ring:v(r.prototype.readFlatCurveRing)}},r.prototype.writeFeatures,r.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml":{exterior:n(r.prototype.writeRing),interior:n(r.prototype.writeRing)}},r.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml":{lowerCorner:n(j),upperCorner:n(j)}},r.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{surfaceMember:n(r.prototype.writeSurfaceOrPolygonMember),polygonMember:n(r.prototype.writeSurfaceOrPolygonMember)}},r.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{pointMember:n(r.prototype.writePointMember)}},r.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{lineStringMember:n(r.prototype.writeLineStringOrCurveMember),curveMember:n(r.prototype.writeLineStringOrCurveMember)}},r.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml":{Curve:n(r.prototype.writeCurveOrLineString),MultiCurve:n(r.prototype.writeMultiCurveOrLineString),Point:n(r.prototype.writePoint),MultiPoint:n(r.prototype.writeMultiPoint),LineString:n(r.prototype.writeCurveOrLineString),MultiLineString:n(r.prototype.writeMultiCurveOrLineString),LinearRing:n(r.prototype.writeLinearRing),Polygon:n(r.prototype.writeSurfaceOrPolygon),MultiPolygon:n(r.prototype.writeMultiSurfaceOrPolygon),Surface:n(r.prototype.writeSurfaceOrPolygon),MultiSurface:n(r.prototype.writeMultiSurfaceOrPolygon),Envelope:n(r.prototype.writeEnvelope)}};const qd=r;qd.prototype.writeFeatures,qd.prototype.writeFeaturesNode;class D extends r{constructor(e){super(e=e||{}),this.schemaLocation=e.schemaLocation?e.schemaLocation:this.namespace+" http://schemas.opengis.net/gml/3.2.1/gml.xsd"}writeGeometryElement(e,t,n){const s=n[n.length-1];n[n.length-1]=Object.assign({multiCurve:!0,multiSurface:!0},s),super.writeGeometryElement(e,t,n)}}D.prototype.namespace="http://www.opengis.net/gml/3.2",D.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml/3.2":{pos:v(r.prototype.readFlatPos),posList:v(r.prototype.readFlatPosList),coordinates:v(S.prototype.readFlatCoordinates)}},D.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml/3.2":{interior:r.prototype.interiorParser,exterior:r.prototype.exteriorParser}},D.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml/3.2":{Point:v(f.prototype.readPoint),MultiPoint:v(f.prototype.readMultiPoint),LineString:v(f.prototype.readLineString),MultiLineString:v(f.prototype.readMultiLineString),LinearRing:v(f.prototype.readLinearRing),Polygon:v(f.prototype.readPolygon),MultiPolygon:v(f.prototype.readMultiPolygon),Surface:v(D.prototype.readSurface),MultiSurface:v(r.prototype.readMultiSurface),Curve:v(D.prototype.readCurve),MultiCurve:v(r.prototype.readMultiCurve),Envelope:v(D.prototype.readEnvelope)}},D.prototype.MULTICURVE_PARSERS={"http://www.opengis.net/gml/3.2":{curveMember:h(r.prototype.curveMemberParser),curveMembers:h(r.prototype.curveMemberParser)}},D.prototype.MULTISURFACE_PARSERS={"http://www.opengis.net/gml/3.2":{surfaceMember:h(r.prototype.surfaceMemberParser),surfaceMembers:h(r.prototype.surfaceMemberParser)}},D.prototype.CURVEMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{LineString:h(f.prototype.readLineString),Curve:h(r.prototype.readCurve)}},D.prototype.SURFACEMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Polygon:h(f.prototype.readPolygon),Surface:h(r.prototype.readSurface)}},D.prototype.SURFACE_PARSERS={"http://www.opengis.net/gml/3.2":{patches:v(r.prototype.readPatch)}},D.prototype.CURVE_PARSERS={"http://www.opengis.net/gml/3.2":{segments:v(r.prototype.readSegment)}},D.prototype.ENVELOPE_PARSERS={"http://www.opengis.net/gml/3.2":{lowerCorner:h(r.prototype.readFlatPosList),upperCorner:h(r.prototype.readFlatPosList)}},D.prototype.PATCHES_PARSERS={"http://www.opengis.net/gml/3.2":{PolygonPatch:v(r.prototype.readPolygonPatch)}},D.prototype.SEGMENTS_PARSERS={"http://www.opengis.net/gml/3.2":{LineStringSegment:fa(r.prototype.readLineStringSegment)}},D.prototype.MULTIPOINT_PARSERS={"http://www.opengis.net/gml/3.2":{pointMember:h(f.prototype.pointMemberParser),pointMembers:h(f.prototype.pointMemberParser)}},D.prototype.MULTILINESTRING_PARSERS={"http://www.opengis.net/gml/3.2":{lineStringMember:h(f.prototype.lineStringMemberParser),lineStringMembers:h(f.prototype.lineStringMemberParser)}},D.prototype.MULTIPOLYGON_PARSERS={"http://www.opengis.net/gml/3.2":{polygonMember:h(f.prototype.polygonMemberParser),polygonMembers:h(f.prototype.polygonMemberParser)}},D.prototype.POINTMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Point:h(f.prototype.readFlatCoordinatesFromNode)}},D.prototype.LINESTRINGMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{LineString:h(f.prototype.readLineString)}},D.prototype.POLYGONMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Polygon:h(f.prototype.readPolygon)}},D.prototype.RING_PARSERS={"http://www.opengis.net/gml/3.2":{LinearRing:v(f.prototype.readFlatLinearRing),Ring:v(D.prototype.readFlatCurveRing)}},D.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml/3.2":{exterior:n(r.prototype.writeRing),interior:n(r.prototype.writeRing)}},D.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml/3.2":{lowerCorner:n(j),upperCorner:n(j)}},D.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{surfaceMember:n(r.prototype.writeSurfaceOrPolygonMember),polygonMember:n(r.prototype.writeSurfaceOrPolygonMember)}},D.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{pointMember:n(r.prototype.writePointMember)}},D.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{lineStringMember:n(r.prototype.writeLineStringOrCurveMember),curveMember:n(r.prototype.writeLineStringOrCurveMember)}},D.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml/3.2":{Curve:n(r.prototype.writeCurveOrLineString),MultiCurve:n(r.prototype.writeMultiCurveOrLineString),Point:n(D.prototype.writePoint),MultiPoint:n(r.prototype.writeMultiPoint),LineString:n(r.prototype.writeCurveOrLineString),MultiLineString:n(r.prototype.writeMultiCurveOrLineString),LinearRing:n(r.prototype.writeLinearRing),Polygon:n(r.prototype.writeSurfaceOrPolygon),MultiPolygon:n(r.prototype.writeMultiSurfaceOrPolygon),Surface:n(r.prototype.writeSurfaceOrPolygon),MultiSurface:n(r.prototype.writeMultiSurfaceOrPolygon),Envelope:n(r.prototype.writeEnvelope)}};const te=[null,"http://www.topografix.com/GPX/1/0","http://www.topografix.com/GPX/1/1"],Fg={rte:tf,trk:nf,wpt:sf},Mg=o(te,{rte:h(tf),trk:h(nf),wpt:h(sf)}),Sg=o(te,{text:t(a,"linkText"),type:t(a,"linkType")}),Ag=o(te,{name:t(a),email:function(e,t){const o=t[t.length-1],n=e.getAttribute("id"),s=e.getAttribute("domain");null!==n&&null!==s&&(o.email=`${n}@${s}`)},link:aa}),Eg=o(te,{name:t(a),desc:t(a),author:t(function(e,t){const n=i({},Ag,e,t);if(n)return n}),copyright:t(function(e,t){const n=i({},xg,e,t);if(n){const t=e.getAttribute("author");return null!==t&&(n.author=t),n}}),link:aa,time:t(ua),keywords:t(a),bounds:function(e,t){const a=t[t.length-1],n=e.getAttribute("minlat"),s=e.getAttribute("minlon"),o=e.getAttribute("maxlat"),i=e.getAttribute("maxlon");null!==s&&null!==n&&null!==i&&null!==o&&(a.bounds=[[parseFloat(s),parseFloat(n)],[parseFloat(i),parseFloat(o)]])},extensions:Mr}),xg=o(te,{year:t(ae),license:t(a)}),wg=o(te,{rte:n(function(e,t,n){const r=n[0],s=t.getProperties(),o={node:e};o.properties=s;const i=t.getGeometry();if("LineString"==i.getType()){const e=q(i,!0,r);o.geometryLayout=e.getLayout(),s.rtept=e.getCoordinates()}const c=n[n.length-1].node,a=eg[c.namespaceURI],l=Ie(s,a);_(o,Zp,ye,l,n,a)}),trk:n(function(e,t,n){const r=n[0],s=t.getProperties(),o={node:e};o.properties=s;const i=t.getGeometry();if("MultiLineString"==i.getType()){const e=q(i,!0,r);s.trkseg=e.getLineStrings()}const c=n[n.length-1].node,a=Gp[c.namespaceURI],l=Ie(s,a);_(o,Yp,ye,l,n,a)}),wpt:n(function(e,t,n){const i=n[0],s=n[n.length-1];s.properties=t.getProperties();const o=t.getGeometry();if("Point"==o.getType()){const t=q(o,!0,i);s.geometryLayout=t.getLayout(),Hd(e,t.getCoordinates(),n)}})}),_g=o(te,{name:t(a),cmt:t(a),desc:t(a),src:t(a),link:aa,number:t(ae),extensions:Mr,type:t(a),rtept:function(e,t){const n=i({},yg,e,t);if(n){const s=t[t.length-1];Ud(s.flatCoordinates,s.layoutOptions,e,n)}}}),yg=o(te,{ele:t(F),time:t(ua)}),jg=o(te,{name:t(a),cmt:t(a),desc:t(a),src:t(a),link:aa,number:t(ae),type:t(a),extensions:Mr,trkseg:function(e,t){const n=t[t.length-1];Te(bg,e,t);const s=n.flatCoordinates;n.ends.push(s.length)}}),bg=o(te,{trkpt:function(e,t){const n=i({},vg,e,t);if(n){const s=t[t.length-1];Ud(s.flatCoordinates,s.layoutOptions,e,n)}}}),vg=o(te,{ele:t(F),time:t(ua)}),gg=o(te,{ele:t(F),time:t(ua),magvar:t(F),geoidheight:t(F),name:t(a),cmt:t(a),desc:t(a),src:t(a),link:aa,sym:t(a),type:t(a),fix:t(a),sat:t(ae),hdop:t(F),vdop:t(F),pdop:t(F),ageofdgpsdata:t(F),dgpsid:t(ae),extensions:Mr}),pg=["text","type"],fg=o(te,{text:n(j),type:n(j)}),eg=o(te,["name","cmt","desc","src","link","number","type","rtept"]),Zp=o(te,{name:n(j),cmt:n(j),desc:n(j),src:n(j),link:n(Id),number:n(ra),type:n(j),rtept:b4(n(Hd))}),Qp=o(te,["ele","time"]),Gp=o(te,["name","cmt","desc","src","link","number","type","trkseg"]),Yp=o(te,{name:n(j),cmt:n(j),desc:n(j),src:n(j),link:n(Id),number:n(ra),type:n(j),trkseg:b4(n(function(e,t,n){const s={node:e};s.geometryLayout=t.getLayout(),s.properties={},_(s,Hp,Wp,t.getCoordinates(),n)}))}),Wp=se("trkpt"),Hp=o(te,{trkpt:n(Hd)}),Pp=o(te,["ele","time","magvar","geoidheight","name","cmt","desc","src","link","sym","type","fix","sat","hdop","vdop","pdop","ageofdgpsdata","dgpsid"]),Rp=o(te,{ele:n(Be),time:n(h8),magvar:n(Be),geoidheight:n(Be),name:n(j),cmt:n(j),desc:n(j),src:n(j),link:n(Id),sym:n(j),type:n(j),fix:n(j),sat:n(ra),hdop:n(Be),vdop:n(Be),pdop:n(Be),ageofdgpsdata:n(Be),dgpsid:n(ra)}),Lp={Point:"wpt",LineString:"rte",MultiLineString:"trk"};function Ep(e,t){const s=e.getGeometry();if(s){const e=Lp[s.getType()];if(e)return w(t[t.length-1].node.namespaceURI,e)}}function Ud(e,t,n,s){return e.push(parseFloat(n.getAttribute("lon")),parseFloat(n.getAttribute("lat"))),"ele"in s?(e.push(s.ele),delete s.ele,t.hasZ=!0):e.push(0),"time"in s?(e.push(s.time),delete s.time,t.hasM=!0):e.push(0),e}function $d(e,t,n){let o="XY",s=2;if(e.hasZ&&e.hasM?(o="XYZM",s=4):e.hasZ?(o="XYZ",s=3):e.hasM&&(o="XYM",s=3),4!==s){for(let n=0,o=t.length/4;n<o;n++)t[n*s]=t[4*n],t[n*s+1]=t[4*n+1],e.hasZ&&(t[n*s+2]=t[4*n+2]),e.hasM&&(t[n*s+2]=t[4*n+3]);if(t.length=t.length/4*s,n)for(let e=0,t=n.length;e<t;e++)n[e]=n[e]/4*s}return o}function aa(e,t){const s=t[t.length-1],n=e.getAttribute("href");null!==n&&(s.link=n),Te(Sg,e,t)}function Mr(e,t){t[t.length-1].extensionsNode_=e}function tf(e,t){const r=t[0],n=i({flatCoordinates:[],layoutOptions:{}},_g,e,t);if(!n)return;const s=n.flatCoordinates;delete n.flatCoordinates;const c=n.layoutOptions;delete n.layoutOptions;const l=$d(c,s),o=new ee(s,l);q(o,!1,r);const a=new N(o);return a.setProperties(n,!0),a}function nf(e,t){const c=t[0],n=i({flatCoordinates:[],ends:[],layoutOptions:{}},jg,e,t);if(!n)return;const s=n.flatCoordinates;delete n.flatCoordinates;const o=n.ends;delete n.ends;const l=n.layoutOptions;delete n.layoutOptions;const d=$d(l,s,o),a=new ke(s,d,o);q(a,!1,c);const r=new N(a);return r.setProperties(n,!0),r}function sf(e,t){const c=t[0],n=i({},gg,e,t);if(!n)return;const s={},o=Ud([],s,e,n),l=$d(s,o),a=new Y(o,l);q(a,!1,c);const r=new N(a);return r.setProperties(n,!0),r}function Id(e,t,n){e.setAttribute("href",t);const s=n[n.length-1].properties,o=[s.linkText,s.linkType];_({node:e},fg,ye,o,n,pg)}function Hd(e,t,n){const o=n[n.length-1],i=o.node.namespaceURI,s=o.properties;switch(e.setAttributeNS(null,"lat",String(t[1])),e.setAttributeNS(null,"lon",String(t[0])),o.geometryLayout){case"XYZM":0!==t[3]&&(s.time=t[3]);case"XYZ":0!==t[2]&&(s.ele=t[2]);break;case"XYM":0!==t[2]&&(s.time=t[2])}const a="rtept"==e.nodeName?Qp[i]:Pp[i],r=Ie(s,a);_({node:e,properties:s},Rp,ye,r,n,a)}function Ld(e){if(!e)return null;let n;switch(e.type){case"Point":n=function(e){const t=e.coordinates;return{type:"Point",flatCoordinates:t,layout:Fn(t.length)}}(e);break;case"LineString":n=function(e){const t=e.coordinates,n=t.flat();return{type:"LineString",flatCoordinates:n,ends:[n.length],layout:Fn(t[0]?.length||2)}}(e);break;case"Polygon":n=function(e){const t=e.coordinates,n=[],s=t[0]?.[0]?.length,o=oo(n,0,t,s);return{type:"Polygon",flatCoordinates:n,ends:o,layout:Fn(s)}}(e);break;case"MultiPoint":n=function(e){const t=e.coordinates;return{type:"MultiPoint",flatCoordinates:t.flat(),layout:Fn(t[0]?.length||2)}}(e);break;case"MultiLineString":n=function(e){const t=e.coordinates,n=t[0]?.[0]?.length||2,s=[],o=oo(s,0,t,n);return{type:"MultiLineString",flatCoordinates:s,ends:o,layout:Fn(n)}}(e);break;case"MultiPolygon":n=function(e){const t=e.coordinates,n=[],s=t[0]?.[0]?.[0].length||2,o=xu(n,0,t,s);return{type:"MultiPolygon",flatCoordinates:n,ends:o,layout:Fn(s)}}(e);break;case"GeometryCollection":n=function(e){const n=e.geometries.map(function(e){return Ld(e)});return n}(e);break;default:throw new Error("Unsupported GeoJSON type: "+e.type)}return n}function Nd(e,t){const s=(e=q(e,!0,t)).getType();let n;switch(s){case"Point":n=function(e){return{type:"Point",coordinates:e.getCoordinates()}}(e);break;case"LineString":n=function(e){return{type:"LineString",coordinates:e.getCoordinates()}}(e);break;case"Polygon":n=function(e,t){let n;return t&&(n=t.rightHanded),{type:"Polygon",coordinates:e.getCoordinates(n)}}(e,t);break;case"MultiPoint":n=function(e){return{type:"MultiPoint",coordinates:e.getCoordinates()}}(e);break;case"MultiLineString":n=function(e){return{type:"MultiLineString",coordinates:e.getCoordinates()}}(e);break;case"MultiPolygon":n=function(e,t){let n;return t&&(n=t.rightHanded),{type:"MultiPolygon",coordinates:e.getCoordinates(n)}}(e,t);break;case"GeometryCollection":n=function(e,t){t=Object.assign({},t),delete t.featureProjection;const n=e.getGeometriesArray().map(function(e){return Nd(e,t)});return{type:"GeometryCollection",geometries:n}}(e,t);break;case"Circle":n={type:"GeometryCollection",geometries:[]};break;default:throw new Error("Unsupported geometry type: "+s)}return n}class Tr extends xo{constructor(){super()}getType(){return"text"}readFeature(e,t){return this.readFeatureFromText(zr(e),this.adaptOptions(t))}readFeatureFromText(){return g()}readFeatures(e,t){return this.readFeaturesFromText(zr(e),this.adaptOptions(t))}readFeaturesFromText(){return g()}readGeometry(e,t){return this.readGeometryFromText(zr(e),this.adaptOptions(t))}readGeometryFromText(){return g()}readProjection(e){return this.readProjectionFromText(zr(e))}readProjectionFromText(){return this.dataProjection}writeFeature(e,t){return this.writeFeatureText(e,this.adaptOptions(t))}writeFeatureText(){return g()}writeFeatures(e,t){return this.writeFeaturesText(e,this.adaptOptions(t))}writeFeaturesText(){return g()}writeGeometry(e,t){return this.writeGeometryText(e,this.adaptOptions(t))}writeGeometryText(){return g()}}function zr(e){return"string"==typeof e?e:""}const Cp=/^B(\d{2})(\d{2})(\d{2})(\d{2})(\d{5})([NS])(\d{3})(\d{5})([EW])([AV])(\d{5})(\d{5})/,xp=/^H.([A-Z]{3}).*?:(.*)/,Op=/^HFDTE(\d{2})(\d{2})(\d{2})/,wp=/^HFDTEDATE:(\d{2})(\d{2})(\d{2}),(\d{2})/,_p=/\r\n|\r|\n/,sn=["http://www.google.com/kml/ext/2.2"],p=[null,"http://earth.google.com/kml/2.0","http://earth.google.com/kml/2.1","http://earth.google.com/kml/2.2","http://www.opengis.net/kml/2.2"],jf={fraction:"fraction",pixels:"pixels",insetPixels:"pixels"},fp=o(p,{ExtendedData:n6,Region:t6,MultiGeometry:t(m6,"geometry"),LineString:t(u6,"geometry"),LinearRing:t(h6,"geometry"),Point:t(c6,"geometry"),Polygon:t(r6,"geometry"),Style:t(vd),StyleMap:function(e,t){const n=Qf.call(this,e,t);if(!n)return;const s=t[t.length-1];if(Array.isArray(n))s.Style=n;else{if("string"!=typeof n)throw new Error("`styleMapValue` has an unknown type");s.styleUrl=n}},address:t(a),description:t(a),name:t(a),open:t(vn),phoneNumber:t(a),styleUrl:t(Yf),visibility:t(vn)},o(sn,{MultiTrack:t(function(e,t){const n=i([],y6,e,t);if(!n)return;return new ke(n)},"geometry"),Track:t(a6,"geometry")})),hp=o(p,{ExtendedData:n6,Region:t6,Link:function(e,t){Te(lp,e,t)},address:t(a),description:t(a),name:t(a),open:t(vn),phoneNumber:t(a),visibility:t(vn)}),lp=o(p,{href:t(qf)}),p6=o(p,{Altitude:t(F),Longitude:t(F),Latitude:t(F),Tilt:t(F),AltitudeMode:t(a),Heading:t(F),Roll:t(F)}),xf=o(p,{LatLonAltBox:function(e,t){const n=i({},k6,e,t);if(!n)return;const s=t[t.length-1],o=[parseFloat(n.west),parseFloat(n.south),parseFloat(n.east),parseFloat(n.north)];s.extent=o,s.altitudeMode=n.altitudeMode,s.minAltitude=parseFloat(n.minAltitude),s.maxAltitude=parseFloat(n.maxAltitude)},Lod:function(e,t){const n=i({},A6,e,t);if(!n)return;const s=t[t.length-1];s.minLodPixels=parseFloat(n.minLodPixels),s.maxLodPixels=parseFloat(n.maxLodPixels),s.minFadeExtent=parseFloat(n.minFadeExtent),s.maxFadeExtent=parseFloat(n.maxFadeExtent)}}),op=o(p,["Document","Placemark"]),tp=o(p,{Document:n(function(e,t,n){const s={node:e};_(s,z6,D6,t,n,void 0,this)}),Placemark:n(Cf)});let ro,zd,ni,na,ta,Wr,ea=null,Ad,Kr=null,Ed,Yr=null,Bn=null,wd=null,Xr,ec=null;function tc(e){return 32/Math.min(e[0],e[1])}function Z6(e){return e}function Wf(e,t,n){return Array.isArray(e)?e:"string"==typeof e?Wf(n[e],t,n):t}function nc(e){const n=Me(e,!1),t=/^\s*#?\s*([0-9A-Fa-f]{8})\s*$/.exec(n);if(t){const e=t[1];return[parseInt(e.substr(6,2),16),parseInt(e.substr(4,2),16),parseInt(e.substr(2,2),16),parseInt(e.substr(0,2),16)/255]}}function jd(e){let t=Me(e,!1);const s=[];t=t.replace(/\s*,\s*/g,",");const o=/^\s*([+-]?\d*\.?\d+(?:e[+-]?\d+)?),([+-]?\d*\.?\d+(?:e[+-]?\d+)?)(?:\s+|,|$)(?:([+-]?\d*\.?\d+(?:e[+-]?\d+)?)(?:\s+|$))?\s*/i;let n;for(;n=o.exec(t);){const e=parseFloat(n[1]),i=parseFloat(n[2]),a=n[3]?parseFloat(n[3]):0;s.push(e,i,a),t=t.substr(n[0].length)}if(""===t)return s}function qf(e){const n=Me(e,!1).trim();let t=e.baseURI;return t&&"about:blank"!=t||(t=window.location.href),t?new URL(n,t).href:n}function Yf(e){const n=Me(e,!1).trim().replace(/^(?!.*#)/,"#");let t=e.baseURI;return t&&"about:blank"!=t||(t=window.location.href),t?new URL(n,t).href:n}function Gf(e){return F(e)}const K6=o(p,{Pair:function(e,t){const n=i({},C6,e,t,this);if(!n)return;const s=n.key;if(s&&"normal"==s){const e=n.styleUrl;e&&(t[t.length-1]=e);const s=n.Style;s&&(t[t.length-1]=s)}}});function Qf(e,t){return i(void 0,K6,e,t,this)}const R6=o(p,{Icon:t(function(e,t){const n=i({},v6,e,t);return n||null}),color:t(nc),heading:t(F),hotSpot:t(function(e){const n=e.getAttribute("xunits"),t=e.getAttribute("yunits");let s;return s="insetPixels"!==n?"insetPixels"!==t?"bottom-left":"top-left":"insetPixels"!==t?"bottom-right":"top-right",{x:parseFloat(e.getAttribute("x")),xunits:jf[n],y:parseFloat(e.getAttribute("y")),yunits:jf[t],origin:s}}),scale:t(Gf)}),L6=o(p,{color:t(nc),scale:t(Gf)}),F6=o(p,{color:t(nc),width:t(F)}),x6=o(p,{color:t(nc),fill:t(vn),outline:t(vn)}),O6=o(p,{coordinates:v(jd)});function s6(e,t){return i(null,O6,e,t)}const y6=o(sn,{Track:h(a6)}),j6=o(p,{when:function(e,t){const s=t[t.length-1].whens,o=Me(e,!1),n=Date.parse(o);s.push(isNaN(n)?0:n)}},o(sn,{coord:function(e,t){const s=t[t.length-1].coordinates,o=Me(e,!1),n=/^\s*([+-]?\d+(?:\.\d*)?(?:e[+-]?\d*)?)\s+([+-]?\d+(?:\.\d*)?(?:e[+-]?\d*)?)\s+([+-]?\d+(?:\.\d*)?(?:e[+-]?\d*)?)\s*$/i.exec(o);if(n){const e=parseFloat(n[1]),t=parseFloat(n[2]),o=parseFloat(n[3]);s.push([e,t,o])}else s.push([])}}));function a6(e,t){const s=i({coordinates:[],whens:[]},j6,e,t);if(!s)return;const o=[],n=s.coordinates,a=s.whens;for(let e=0,t=Math.min(n.length,a.length);e<t;++e)3==n[e].length&&o.push(n[e][0],n[e][1],n[e][2],a[e]);return new ee(o,"XYZM")}const v6=o(p,{href:t(qf)},o(sn,{x:t(F),y:t(F),w:t(F),h:t(F)})),Ug=o(p,{coordinates:v(jd)});function bd(e,t){return i(null,Ug,e,t)}const oc=o(p,{extrude:t(vn),tessellate:t(vn),altitudeMode:t(a)});function u6(e,t){const s=i({},oc,e,t),n=bd(e,t);if(n){const e=new ee(n,"XYZ");return e.setProperties(s,!0),e}}function h6(e,t){const s=i({},oc,e,t),n=bd(e,t);if(n){const e=new ie(n,"XYZ",[n.length]);return e.setProperties(s,!0),e}}const kg=o(p,{LineString:h(u6),LinearRing:h(h6),MultiGeometry:h(m6),Point:h(c6),Polygon:h(r6)});function m6(e,t){const n=i([],kg,e,t);if(!n)return null;if(0===n.length)return new ge(n);let s,r=!0;const o=n[0].getType();let a;for(let e=1,t=n.length;e<t;++e)if(a=n[e],a.getType()!=o){r=!1;break}if(r){let t,e;if("Point"==o){const o=n[0];t=o.getLayout(),e=o.getFlatCoordinates();for(let t=1,s=n.length;t<s;++t)a=n[t],z(e,a.getFlatCoordinates());s=new tt(e,t),gd(s,n)}else if("LineString"==o)s=new ke(n),gd(s,n);else if("Polygon"==o)s=new Re(n),gd(s,n);else{if("GeometryCollection"!=o)throw new Error("Unknown geometry type found");s=new ge(n)}}else s=new ge(n);return s}function c6(e,t){const s=i({},oc,e,t),n=bd(e,t);if(n){const e=new Y(n,"XYZ");return e.setProperties(s,!0),e}}const g6=o(p,{innerBoundaryIs:function(e,t){const n=i([],S6,e,t);n.length>0&&t[t.length-1].push(...n)},outerBoundaryIs:function(e,t){const n=i(void 0,M6,e,t);n&&(t[t.length-1][0]=n)}});function r6(e,t){const s=i({},oc,e,t),n=i([null],g6,e,t);if(n&&n[0]){const e=n[0],t=[e.length];for(let s=1,o=n.length;s<o;++s)z(e,n[s]),t.push(e.length);const o=new ie(e,"XYZ",t);return o.setProperties(s,!0),o}}const b6=o(p,{IconStyle:function(e,t){const s=i({},R6,e,t);if(!s)return;const b=t[t.length-1],o="Icon"in s?s.Icon:{},f=!("Icon"in s)||Object.keys(o).length>0;let n;const h=o.href;let c,l,r;h?n=h:f&&(n=Wr);let m="bottom-left";const a=s.hotSpot;let p;a?(c=[a.x,a.y],l=a.xunits,r=a.yunits,m=a.origin):/^https?:\/\/maps\.(?:google|gstatic)\.com\//.test(n)&&(n.includes("pushpin")?(c=zd,l=ni,r=na):n.includes("arrow-reverse")?(c=[54,42],l=ni,r=na):n.includes("paddle")&&(c=[32,1],l=ni,r=na));const g=o.x,v=o.y;let d;void 0!==g&&void 0!==v&&(p=[g,v]);const j=o.w,y=o.h;let _;void 0!==j&&void 0!==y&&(d=[j,y]);const w=s.heading;void 0!==w&&(_=we(w));const O=s.scale,x=s.color;if(f){n==Wr&&(d=ta);const e=new Vo({anchor:c,anchorOrigin:m,anchorXUnits:l,anchorYUnits:r,crossOrigin:this.crossOrigin_,offset:p,offsetOrigin:"bottom-left",rotation:_,scale:O,size:d,src:this.iconUrlFunction_(n),color:x}),s=e.getScaleArray()[0],t=e.getSize();if(null===t){{const t=e.getImageState();if(t===u.IDLE||t===u.LOADING){const n=function(){const t=e.getImageState();if(t!==u.IDLE&&t!==u.LOADING){const t=e.getSize();if(t&&2==t.length){const n=tc(t);e.setScale(s*n)}e.unlistenImageChange(n)}};e.listenImageChange(n),t===u.IDLE&&e.load()}}}else if(2==t.length){const n=tc(t);e.setScale(s*n)}b.imageStyle=e}else b.imageStyle=Ad},LabelStyle:function(e,t){const n=i({},L6,e,t);if(!n)return;const s=t[t.length-1],o=new Is({fill:new ot({color:"color"in n?n.color:ro}),scale:n.scale});s.textStyle=o},LineStyle:function(e,t){const n=i({},F6,e,t);if(!n)return;const s=t[t.length-1],o=new Ze({color:"color"in n?n.color:ro,width:"width"in n?n.width:1});s.strokeStyle=o},PolyStyle:function(e,t){const n=i({},x6,e,t);if(!n)return;const s=t[t.length-1],r=new ot({color:"color"in n?n.color:ro});s.fillStyle=r;const o=n.fill;void 0!==o&&(s.fill=o);const a=n.outline;void 0!==a&&(s.outline=a)}});function vd(e,t){const n=i({},b6,e,t,this);if(!n)return null;let s="fillStyle"in n?n.fillStyle:ea;const a=n.fill;let o;void 0===a||a||(s=null),"imageStyle"in n?n.imageStyle!=Ad&&(o=n.imageStyle):o=Kr;const r="textStyle"in n?n.textStyle:Bn,c="strokeStyle"in n?n.strokeStyle:Yr,l=n.outline;return void 0===l||l?[new ve({fill:s,image:o,stroke:c,text:r,zIndex:void 0})]:[new ve({geometry:function(e){const t=e.getGeometry(),n=t.getType();if("GeometryCollection"===n)return new ge(t.getGeometriesArrayRecursive().filter(function(e){const t=e.getType();return"Polygon"!==t&&"MultiPolygon"!==t}));if("Polygon"!==n&&"MultiPolygon"!==n)return t},fill:s,image:o,stroke:c,text:r,zIndex:void 0}),new ve({geometry:function(e){const t=e.getGeometry(),n=t.getType();if("GeometryCollection"===n)return new ge(t.getGeometriesArrayRecursive().filter(function(e){const t=e.getType();return"Polygon"===t||"MultiPolygon"===t}));if("Polygon"===n||"MultiPolygon"===n)return t},fill:s,stroke:null,zIndex:void 0})]}function gd(e,t){const c=t.length,i=new Array(t.length),a=new Array(t.length),r=new Array(t.length);let n,s,o;n=!1,s=!1,o=!1;for(let e=0;e<c;++e){const l=t[e];i[e]=l.get("extrude"),a[e]=l.get("tessellate"),r[e]=l.get("altitudeMode"),n=n||void 0!==i[e],s=s||void 0!==a[e],o=o||r[e]}n&&e.set("extrude",i),s&&e.set("tessellate",a),o&&e.set("altitudeMode",r)}const _6=o(p,{displayName:t(a),value:t(a)}),w6=o(p,{Data:function(e,t){const s=e.getAttribute("name");Te(_6,e,t);const n=t[t.length-1];s&&n.displayName?n[s]={value:n.value,displayName:n.displayName,toString:function(){return n.value}}:null!==s?n[s]=n.value:null!==n.displayName&&(n[n.displayName]=n.value),delete n.value},SchemaData:function(e,t){Te(E6,e,t)}});function n6(e,t){Te(w6,e,t)}function t6(e,t){Te(xf,e,t)}const C6=o(p,{Style:t(vd),key:t(a),styleUrl:t(Yf)}),E6=o(p,{SimpleData:function(e,t){const n=e.getAttribute("name");if(null!==n){const s=a(e);t[t.length-1][n]=s}}}),k6=o(p,{altitudeMode:t(a),minAltitude:t(F),maxAltitude:t(F),north:t(F),south:t(F),east:t(F),west:t(F)}),A6=o(p,{minLodPixels:t(F),maxLodPixels:t(F),minFadeExtent:t(F),maxFadeExtent:t(F)}),S6=o(p,{LinearRing:h(s6)}),M6=o(p,{LinearRing:v(s6)});function ic(e,t){const n=mt(t),s=[255*(4==n.length?n[3]:1),n[2],n[1],n[0]];for(let e=0;e<4;++e){const t=Math.floor(s[e]).toString(16);s[e]=1==t.length?"0"+t:t}j(e,s.join(""))}const mc=o(p,{Data:n(function(e,t,n){e.setAttribute("name",t.name);const o={node:e},s=t.value;"object"==typeof s?(null!==s&&s.displayName&&_(o,mc,ye,[s.displayName],n,["displayName"]),null!==s&&s.value&&_(o,mc,ye,[s.value],n,["value"])):_(o,mc,ye,[s],n,["value"])}),value:n(function(e,t){j(e,t)}),displayName:n(function(e,t){u8(e,t)})}),z6=o(p,{Placemark:n(Cf)}),D6=function(e,t){return w(t[t.length-1].node.namespaceURI,"Placemark")},N6=se("Data"),Jf=o(p,["href"],o(sn,["x","y","w","h"])),Zf=o(p,{href:n(j)},o(sn,{x:n(Be),y:n(Be),w:n(Be),h:n(Be)})),P6=function(e,t,n){return w(sn[0],"gx:"+n)},H6=o(p,["scale","heading","Icon","color","hotSpot"]),I6=o(p,{Icon:n(function(e,t,n){const i={node:e},a=n[n.length-1].node;let s=Jf[a.namespaceURI],o=Ie(t,s);_(i,Zf,ye,o,n,s),s=Jf[sn[0]],o=Ie(t,s),_(i,Zf,P6,o,n,s)}),color:n(ic),heading:n(Be),hotSpot:n(function(e,t){e.setAttribute("x",String(t.x)),e.setAttribute("y",String(t.y)),e.setAttribute("xunits",t.xunits),e.setAttribute("yunits",t.yunits)}),scale:n(yf)}),B6=o(p,["color","scale"]),V6=o(p,{color:n(ic),scale:n(yf)}),$6=o(p,["color","width"]),W6=o(p,{color:n(ic),width:n(Be)}),U6={Point:"Point",LineString:"LineString",LinearRing:"LinearRing",Polygon:"Polygon",MultiPoint:"MultiGeometry",MultiLineString:"MultiGeometry",MultiPolygon:"MultiGeometry",GeometryCollection:"MultiGeometry"},Xf=function(e,t){if(e)return w(t[t.length-1].node.namespaceURI,U6[e.getType()])},q6=se("Point"),Y6=se("LineString"),G6=se("LinearRing"),X6=se("Polygon"),Q6=o(p,{LineString:n(ti),Point:n(ti),Polygon:n(_f),GeometryCollection:n($f)});function $f(e,t,n){const a={node:e},i=t.getType();let o,s=[];if("GeometryCollection"===i)t.getGeometriesArrayRecursive().forEach(function(e){const t=e.getType();if("MultiPoint"===t)s=s.concat(e.getPoints());else if("MultiLineString"===t)s=s.concat(e.getLineStrings());else if("MultiPolygon"===t)s=s.concat(e.getPolygons());else{if("Point"!==t&&"LineString"!==t&&"Polygon"!==t)throw new Error("Unknown geometry type");s.push(e)}}),o=Xf;else if("MultiPoint"===i)s=t.getPoints(),o=q6;else if("MultiLineString"===i)s=t.getLineStrings(),o=Y6;else{if("MultiPolygon"!==i)throw new Error("Unknown geometry type");s=t.getPolygons(),o=X6}_(a,Q6,o,s,n)}const J6=o(p,{LinearRing:n(ti)});function Af(e,t,n){_({node:e},J6,G6,[t],n)}const pd=o(p,{ExtendedData:n(function(e,t,n){const o={node:e},s=t.names,i=t.values,a=s.length;for(let e=0;e<a;e++)_(o,mc,N6,[{name:s[e],value:i[e]}],n)}),MultiGeometry:n($f),LineString:n(ti),LinearRing:n(ti),Point:n(ti),Polygon:n(_f),Style:n(function(e,t,n){const i={node:e},s={};if(t.pointStyles.length){const n=t.pointStyles[0].getText();n&&(s.LabelStyle=n);const e=t.pointStyles[0].getImage();e&&"function"==typeof e.getSrc&&(s.IconStyle=e)}if(t.lineStyles.length){const e=t.lineStyles[0].getStroke();e&&(s.LineStyle=e)}if(t.polyStyles.length){const e=t.polyStyles[0].getStroke();e&&!s.LineStyle&&(s.LineStyle=e),s.PolyStyle=t.polyStyles[0]}const a=n[n.length-1].node,o=pp[a.namespaceURI],r=Ie(s,o);_(i,gp,ye,r,n,o)}),address:n(j),description:n(j),name:n(j),open:n(Zs),phoneNumber:n(j),styleUrl:n(j),visibility:n(Zs)}),np=o(p,["name","open","visibility","address","phoneNumber","description","styleUrl","Style"]),sp=se("ExtendedData");function Cf(e,t,n){const i={node:e};t.getId()&&e.setAttribute("id",t.getId());const s=t.getProperties(),r={address:1,description:1,name:1,open:1,phoneNumber:1,styleUrl:1,visibility:1};r[t.getGeometryName()]=1;const a=Object.keys(s||{}).sort().filter(function(e){return!r[e]}),c=t.getStyleFunction();if(c){const e=c(t,0);if(e){const n=Array.isArray(e)?e:[e];let o=n;if(t.getGeometry()&&(o=n.filter(function(e){const n=e.getGeometryFunction()(t);if(n){const e=n.getType();return"GeometryCollection"===e?n.getGeometriesArrayRecursive().filter(function(e){const t=e.getType();return"Point"===t||"MultiPoint"===t}).length:"Point"===e||"MultiPoint"===e}})),this.writeStyles_){let e=n,i=n;t.getGeometry()&&(e=n.filter(function(e){const n=e.getGeometryFunction()(t);if(n){const e=n.getType();return"GeometryCollection"===e?n.getGeometriesArrayRecursive().filter(function(e){const t=e.getType();return"LineString"===t||"MultiLineString"===t}).length:"LineString"===e||"MultiLineString"===e}}),i=n.filter(function(e){const n=e.getGeometryFunction()(t);if(n){const e=n.getType();return"GeometryCollection"===e?n.getGeometriesArrayRecursive().filter(function(e){const t=e.getType();return"Polygon"===t||"MultiPolygon"===t}).length:"Polygon"===e||"MultiPolygon"===e}})),s.Style={pointStyles:o,lineStyles:e,polyStyles:i}}if(o.length&&void 0===s.name){const e=o[0].getText();e&&(s.name=e.getText())}}}const d=n[n.length-1].node,l=np[d.namespaceURI],u=Ie(s,l);if(_(i,pd,ye,u,n,l),a.length>0){const e=Ie(s,a);_(i,pd,sp,[{names:a,values:e}],n)}const h=n[0];let o=t.getGeometry();o&&(o=q(o,!0,h)),_(i,pd,Xf,[o],n)}const ip=o(p,["extrude","tessellate","altitudeMode","coordinates"]),ap=o(p,{extrude:n(Zs),tessellate:n(Zs),altitudeMode:n(j),coordinates:n(function(e,t,n){const a=n[n.length-1],o=a.layout,r=a.stride;let i;if("XY"==o||"XYM"==o)i=2;else{if("XYZ"!=o&&"XYZM"!=o)throw new Error("Invalid geometry layout");i=3}const c=t.length;let s="";if(c>0){s+=t[0];for(let e=1;e<i;++e)s+=","+t[e];for(let e=r;e<c;e+=r){s+=" "+t[e];for(let n=1;n<i;++n)s+=","+t[e+n]}}j(e,s)})});function ti(e,t,n){const a=t.getFlatCoordinates(),s={node:e};s.layout=t.getLayout(),s.stride=t.getStride();const o=t.getProperties();o.coordinates=a;const r=n[n.length-1].node,i=ip[r.namespaceURI],c=Ie(o,i);_(s,ap,ye,c,n,i)}const cp=o(p,["color","fill","outline"]),wf=o(p,{outerBoundaryIs:n(Af),innerBoundaryIs:n(Af)}),dp=se("innerBoundaryIs"),up=se("outerBoundaryIs");function _f(e,t,n){const s=t.getLinearRings(),i=s.shift(),o={node:e};_(o,wf,dp,s,n),_(o,wf,up,[i],n)}const mp=o(p,{color:n(ic),fill:n(Zs),outline:n(Zs)});function yf(e,t){Be(e,Math.round(1e6*t)/1e6)}const pp=o(p,["IconStyle","LabelStyle","LineStyle","PolyStyle"]),gp=o(p,{IconStyle:n(function(e,t,n){const h={node:e},o={},m=t.getSrc(),s=t.getSize(),c=t.getImageSize(),i={href:m};if(s){i.w=s[0],i.h=s[1];const e=t.getAnchor(),n=t.getOrigin();if(n&&c&&0!==n[0]&&n[1]!==s[1]&&(i.x=n[0],i.y=c[1]-(n[1]+s[1])),e&&(e[0]!==s[0]/2||e[1]!==s[1]/2)){const t={x:e[0],xunits:"pixels",y:s[1]-e[1],yunits:"pixels"};o.hotSpot=t}}o.Icon=i;let r=t.getScaleArray()[0],a=s;(null===a&&(a=ta),2==a.length)&&(r/=tc(a)),1!==r&&(o.scale=r);const l=t.getRotation();0!==l&&(o.heading=l);const d=t.getColor();d&&(o.color=d);const f=n[n.length-1].node,u=H6[f.namespaceURI],p=Ie(o,u);_(h,I6,ye,p,n,u)}),LabelStyle:n(function(e,t,n){const r={node:e},s={},i=t.getFill();i&&(s.color=i.getColor());const o=t.getScale();o&&1!==o&&(s.scale=o);const c=n[n.length-1].node,a=B6[c.namespaceURI],l=Ie(s,a);_(r,V6,ye,l,n,a)}),LineStyle:n(function(e,t,n){const o={node:e},i={color:t.getColor(),width:Number(t.getWidth())||1},a=n[n.length-1].node,s=$6[a.namespaceURI],r=Ie(i,s);_(o,W6,ye,r,n,s)}),PolyStyle:n(function(e,t,n){const i={node:e},s=t.getFill(),a=t.getStroke(),r={color:s?s.getColor():void 0,fill:!!s&&void 0,outline:!!a&&void 0},c=n[n.length-1].node,o=cp[c.namespaceURI],l=Ie(r,o);_(i,mp,ye,l,n,o)})});var vp={read:function(e,t,n,s,o){var i,r,u=8*o-s-1,h=(1<<u)-1,m=h>>1,a=-7,c=n?o-1:0,d=n?-1:1,l=e[t+c];for(c+=d,i=l&(1<<-a)-1,l>>=-a,a+=u;a>0;i=256*i+e[t+c],c+=d,a-=8);for(r=i&(1<<-a)-1,i>>=-a,a+=s;a>0;r=256*r+e[t+c],c+=d,a-=8);if(0===i)i=1-m;else{if(i===h)return r?NaN:1/0*(l?-1:1);r+=Math.pow(2,s),i-=m}return(l?-1:1)*r*Math.pow(2,i-s)},write:function(e,t,n,s,o,i){var a,r,c,u=8*i-o-1,h=(1<<u)-1,l=h>>1,f=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,d=s?0:i-1,m=s?1:-1,p=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(r=isNaN(t)?1:0,a=h):(a=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-a))<1&&(a--,c*=2),(t+=a+l>=1?f/c:f*Math.pow(2,1-l))*c>=2&&(a++,c/=2),a+l>=h?(r=0,a=h):a+l>=1?(r=(t*c-1)*Math.pow(2,o),a+=l):(r=t*Math.pow(2,l-1)*Math.pow(2,o),a=0));o>=8;e[n+d]=255&r,d+=m,r/=256,o-=8);for(a=a<<o|r,u+=o;u>0;e[n+d]=255&a,d+=m,a/=256,u-=8);e[n+d-m]|=128*p}},bp=$,gc=vp;function $(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}$.Varint=0,$.Fixed64=1,$.Bytes=2,$.Fixed32=5;var md=4294967296,pf=1/md,ff="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function nn(e){return e.type===$.Bytes?e.readVarint()+e.pos:e.pos+1}function Go(e,t,n){return n?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function X8(e,t,n){var s,o=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(o);for(s=n.pos-1;s>=e;s--)n.buf[s+o]=n.buf[s]}function kp(e,t){for(var n=0;n<e.length;n++)t.writeVarint(e[n])}function Ap(e,t){for(var n=0;n<e.length;n++)t.writeSVarint(e[n])}function Sp(e,t){for(var n=0;n<e.length;n++)t.writeFloat(e[n])}function Mp(e,t){for(var n=0;n<e.length;n++)t.writeDouble(e[n])}function Fp(e,t){for(var n=0;n<e.length;n++)t.writeBoolean(e[n])}function Tp(e,t){for(var n=0;n<e.length;n++)t.writeFixed32(e[n])}function zp(e,t){for(var n=0;n<e.length;n++)t.writeSFixed32(e[n])}function Dp(e,t){for(var n=0;n<e.length;n++)t.writeFixed64(e[n])}function Np(e,t){for(var n=0;n<e.length;n++)t.writeSFixed64(e[n])}function Tc(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function Io(e,t,n){e[n]=t,e[n+1]=t>>>8,e[n+2]=t>>>16,e[n+3]=t>>>24}function q8(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}$.prototype={destroy:function(){this.buf=null},readFields:function(e,t,n){for(n=n||this.length;this.pos<n;){var s=this.readVarint(),o=s>>3,i=this.pos;this.type=7&s,e(o,t,this),this.pos===i&&this.skip(s)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=Tc(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=q8(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=Tc(this.buf,this.pos)+Tc(this.buf,this.pos+4)*md;return this.pos+=8,e},readSFixed64:function(){var e=Tc(this.buf,this.pos)+q8(this.buf,this.pos+4)*md;return this.pos+=8,e},readFloat:function(){var e=gc.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=gc.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,n,s=this.buf;return t=127&(n=s[this.pos++]),n<128?t:(t|=(127&(n=s[this.pos++]))<<7,n<128?t:(t|=(127&(n=s[this.pos++]))<<14,n<128?t:(t|=(127&(n=s[this.pos++]))<<21,n<128?t:function(e,t,n){var s,o,i=n.buf;if(s=i[n.pos++],o=(112&s)>>4,s<128)return Go(e,o,t);if(s=i[n.pos++],o|=(127&s)<<3,s<128)return Go(e,o,t);if(s=i[n.pos++],o|=(127&s)<<10,s<128)return Go(e,o,t);if(s=i[n.pos++],o|=(127&s)<<17,s<128)return Go(e,o,t);if(s=i[n.pos++],o|=(127&s)<<24,s<128)return Go(e,o,t);if(s=i[n.pos++],o|=(1&s)<<31,s<128)return Go(e,o,t);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(n=s[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&ff?function(e,t,n){return ff.decode(e.subarray(t,n))}(this.buf,t,e):function(e,t,n){for(l="",o=t;o<n;){var o,i,c,l,d,a=e[o],s=null,r=a>239?4:a>223?3:a>191?2:1;if(o+r>n)break;1===r?a<128&&(s=a):2===r?128==(192&(i=e[o+1]))&&(s=(31&a)<<6|63&i)<=127&&(s=null):3===r?(i=e[o+1],c=e[o+2],128==(192&i)&&128==(192&c)&&((s=(15&a)<<12|(63&i)<<6|63&c)<=2047||s>=55296&&s<=57343)&&(s=null)):4===r&&(i=e[o+1],c=e[o+2],d=e[o+3],128==(192&i)&&128==(192&c)&&128==(192&d)&&((s=(15&a)<<18|(63&i)<<12|(63&c)<<6|63&d)<=65535||s>=1114112)&&(s=null)),null===s?(s=65533,r=1):s>65535&&(s-=65536,l+=String.fromCharCode(s>>>10&1023|55296),s=56320|1023&s),l+=String.fromCharCode(s),o+=r}return l}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==$.Bytes)return e.push(this.readVarint(t));var n=nn(this);for(e=e||[];this.pos<n;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==$.Bytes)return e.push(this.readSVarint());var t=nn(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==$.Bytes)return e.push(this.readBoolean());var t=nn(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==$.Bytes)return e.push(this.readFloat());var t=nn(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==$.Bytes)return e.push(this.readDouble());var t=nn(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==$.Bytes)return e.push(this.readFixed32());var t=nn(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==$.Bytes)return e.push(this.readSFixed32());var t=nn(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==$.Bytes)return e.push(this.readFixed64());var t=nn(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==$.Bytes)return e.push(this.readSFixed64());var t=nn(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===$.Varint)for(;this.buf[this.pos++]>127;);else if(t===$.Bytes)this.pos=this.readVarint()+this.pos;else if(t===$.Fixed32)this.pos+=4;else{if(t!==$.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var n,t=this.length||16;t<this.pos+e;)t*=2;t!==this.length&&(n=new Uint8Array(t),n.set(this.buf),this.buf=n,this.length=t)},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),Io(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),Io(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),Io(this.buf,-1&e,this.pos),Io(this.buf,Math.floor(e*pf),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),Io(this.buf,-1&e,this.pos),Io(this.buf,Math.floor(e*pf),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(e,t){var n,s;if(e>=0?(n=e%4294967296|0,s=e/4294967296|0):(s=~(-e/4294967296),4294967295^(n=~(-e%4294967296))?n=n+1|0:(n=0,s=s+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,n){n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos]=127&e}(n,0,t),function(e,t){var n=(7&e)<<4;if(t.buf[t.pos++]|=n|((e>>>=3)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;t.buf[t.pos++]=127&e}(s,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t,n=this.pos;this.pos=function(e,t,n){for(var s,o,i=0;i<t.length;i++){if((s=t.charCodeAt(i))>55295&&s<57344){if(!o){s>56319||i+1===t.length?(e[n++]=239,e[n++]=191,e[n++]=189):o=s;continue}if(s<56320){e[n++]=239,e[n++]=191,e[n++]=189,o=s;continue}s=o-55296<<10|s-56320|65536,o=null}else o&&(e[n++]=239,e[n++]=191,e[n++]=189,o=null);s<128?e[n++]=s:(s<2048?e[n++]=s>>6|192:(s<65536?e[n++]=s>>12|224:(e[n++]=s>>18|240,e[n++]=s>>12&63|128),e[n++]=s>>6&63|128),e[n++]=63&s|128)}return n}(this.buf,e,this.pos),t=this.pos-n,t>=128&&X8(n,t,this),this.pos=n-1,this.writeVarint(t),this.pos+=t},writeFloat:function(e){this.realloc(4),gc.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),gc.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t,n=e.length;this.writeVarint(n),this.realloc(n);for(t=0;t<n;t++)this.buf[this.pos++]=e[t]},writeRawMessage:function(e,t){this.pos++;var n,s=this.pos;e(t,this),n=this.pos-s,n>=128&&X8(s,n,this),this.pos=s-1,this.writeVarint(n),this.pos+=n},writeMessage:function(e,t,n){this.writeTag(e,$.Bytes),this.writeRawMessage(t,n)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,kp,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,Ap,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,Fp,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,Sp,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,Mp,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,Tp,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,zp,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,Dp,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,Np,t)},writeBytesField:function(e,t){this.writeTag(e,$.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,$.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,$.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,$.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,$.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,$.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,$.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,$.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,$.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,$.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}},K8=O4(bp);function Ip(e,t,n){if(3===e){const e={keys:[],values:[],features:[]},s=n.readVarint()+n.pos;n.readFields(Bp,e,s),e.length=e.features.length,e.length&&(t[e.name]=e)}}function Bp(e,t,n){if(15===e)t.version=n.readVarint();else if(1===e)t.name=n.readString();else if(5===e)t.extent=n.readVarint();else if(2===e)t.features.push(n.pos);else if(3===e)t.keys.push(n.readString());else if(4===e){let s=null;const o=n.readVarint()+n.pos;for(;n.pos<o;)s=1===(e=n.readVarint()>>3)?n.readString():2===e?n.readFloat():3===e?n.readDouble():4===e?n.readVarint64():5===e?n.readVarint():6===e?n.readSVarint():7===e?n.readBoolean():null;t.values.push(s)}}function Vp(e,t,n){if(1==e)t.id=n.readVarint();else if(2==e){const e=n.readVarint()+n.pos;for(;n.pos<e;){const s=t.layer.keys[n.readVarint()],o=t.layer.values[n.readVarint()];t.properties[s]=o}}else 3==e?t.type=n.readVarint():4==e&&(t.geometry=n.pos)}function $p(e,t,n){e.pos=t.features[n];const o=e.readVarint()+e.pos,s={layer:t,type:0,properties:{}};return e.readFields(Vp,s,o),s}const dd=[null],Up=o(dd,{nd:function(e,t){const n=t[t.length-1];n.ndrefs.push(e.getAttribute("ref")),e.hasAttribute("lon")&&e.hasAttribute("lat")&&(n.flatCoordinates.push(parseFloat(e.getAttribute("lon"))),n.flatCoordinates.push(parseFloat(e.getAttribute("lat"))))},tag:W8}),Kp=o(dd,{node:function(e,t){const r=t[0],s=t[t.length-1],n=e.getAttribute("id"),o=[parseFloat(e.getAttribute("lon")),parseFloat(e.getAttribute("lat"))];s.nodes[n]=o;const a=i({tags:{}},qp,e,t);if(!it(a.tags)){const t=new Y(o);q(t,!1,r);const e=new N(t);void 0!==n&&e.setId(n),e.setProperties(a.tags,!0),s.features.push(e)}},way:function(e,t){const n=i({id:e.getAttribute("id"),ndrefs:[],flatCoordinates:[],tags:{}},Up,e,t);t[t.length-1].ways.push(n)}}),qp=o(dd,{tag:W8});function W8(e,t){t[t.length-1].tags[e.getAttribute("k")]=e.getAttribute("v")}class Dc{read(e){if(!e)return null;if("string"==typeof e){const t=et(e);return this.readFromDocument(t)}return Xe(e)?this.readFromDocument(e):this.readFromNode(e)}readFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFromNode(t);return null}readFromNode(){g()}}const Xp="http://www.w3.org/1999/xlink";function Cs(e){return e.getAttributeNS(Xp,"href")}const Ke=[null,"http://www.opengis.net/ows/1.1"],Jp=o(Ke,{ServiceIdentification:t(function(e,t){return i({},hg,e,t)}),ServiceProvider:t(function(e,t){return i({},mg,e,t)}),OperationsMetadata:t(function(e,t){return i({},cg,e,t)})});class I8 extends Dc{constructor(){super()}readFromNode(e){const t=i({},Jp,e,[]);return t||null}}const tg=o(Ke,{DeliveryPoint:t(a),City:t(a),AdministrativeArea:t(a),PostalCode:t(a),Country:t(a),ElectronicMailAddress:t(a)}),ng=o(Ke,{Value:G(function(e){return a(e)})}),sg=o(Ke,{AllowedValues:t(function(e,t){return i({},ng,e,t)})}),og=o(Ke,{Phone:t(function(e,t){return i({},lg,e,t)}),Address:t(function(e,t){return i({},tg,e,t)})}),ig=o(Ke,{HTTP:t(function(e,t){return i({},ag,e,t)})}),ag=o(Ke,{Get:G(function(e,t){const n=Cs(e);if(!n)return;return i({href:n},dg,e,t)}),Post:void 0}),rg=o(Ke,{DCP:t(function(e,t){return i({},ig,e,t)})}),cg=o(Ke,{Operation:function(e,t){const s=e.getAttribute("name"),n=i({},rg,e,t);if(!n)return;t[t.length-1][s]=n}}),lg=o(Ke,{Voice:t(a),Facsimile:t(a)}),dg=o(Ke,{Constraint:G(function(e,t){const n=e.getAttribute("name");if(!n)return;return i({name:n},sg,e,t)})}),ug=o(Ke,{IndividualName:t(a),PositionName:t(a),ContactInfo:t(function(e,t){return i({},og,e,t)})}),hg=o(Ke,{Abstract:t(a),AccessConstraints:t(a),Fees:t(a),Title:t(a),ServiceTypeVersion:t(a),ServiceType:t(a)}),mg=o(Ke,{ProviderName:t(a),ProviderSite:t(Cs),ServiceContact:t(function(e,t){return i({},ug,e,t)})});function H8(e,t,n){let s;n=n||1e5;const o=new Array(t);for(s=0;s<t;++s)o[s]=0;for(let n=0,i=e.length;n<i;)for(s=0;s<t;++s,++n){const i=e[n],a=i-o[s];o[s]=i,e[n]=a}return R8(e,n)}function P8(e,t,n){let s;n=n||1e5;const i=new Array(t);for(s=0;s<t;++s)i[s]=0;const o=L8(e,n);for(let e=0,n=o.length;e<n;)for(s=0;s<t;++s,++e)i[s]+=o[e],o[e]=i[s];return o}function R8(e,t){t=t||1e5;for(let n=0,s=e.length;n<s;++n)e[n]=Math.round(e[n]*t);return N8(e)}function L8(e,t){t=t||1e5;const n=D8(e);for(let e=0,s=n.length;e<s;++e)n[e]/=t;return n}function N8(e){for(let t=0,s=e.length;t<s;++t){const n=e[t];e[t]=n<0?~(n<<1):n<<1}return z8(e)}function D8(e){const t=T8(e);for(let e=0,s=t.length;e<s;++e){const n=t[e];t[e]=1&n?~(n>>1):n>>1}return t}function z8(e){let t="";for(let n=0,s=e.length;n<s;++n)t+=F8(e[n]);return t}function T8(e){const s=[];let t=0,n=0;for(let o=0,a=e.length;o<a;++o){const i=e.charCodeAt(o)-63;t|=(31&i)<<n,i<32?(s.push(t),t=0,n=0):n+=5}return s}function F8(e){let t,n="";for(;e>=32;)t=63+(32|31&e),n+=String.fromCharCode(t),e>>=5;return t=e+63,n+=String.fromCharCode(t),n}const Og={Point:function(e,t,n){const s=e.coordinates;return t&&n&&ad(s,t,n),new Y(s)},LineString:function(e,t){const n=Rc(e.arcs,t);return new ee(n)},Polygon:function(e,t){const n=[];for(let s=0,o=e.arcs.length;s<o;++s)n[s]=Rc(e.arcs[s],t);return new ie(n)},MultiPoint:function(e,t,n){const s=e.coordinates;if(t&&n)for(let e=0,o=s.length;e<o;++e)ad(s[e],t,n);return new tt(s)},MultiLineString:function(e,t){const n=[];for(let s=0,o=e.arcs.length;s<o;++s)n[s]=Rc(e.arcs[s],t);return new ke(n)},MultiPolygon:function(e,t){const n=[];for(let s=0,a=e.arcs.length;s<a;++s){const o=e.arcs[s],i=[];for(let e=0,n=o.length;e<n;++e)i[e]=Rc(o[e],t);n[s]=i}return new Re(n)}};function Rc(e,t){const n=[];let s;for(let o=0,i=e.length;o<i;++o)if(s=e[o],o>0&&n.pop(),s>=0){const e=t[s];for(let t=0,s=e.length;t<s;++t)n.push(e[t].slice(0))}else{const e=t[~s];for(let t=e.length-1;t>=0;--t)n.push(e[t].slice(0))}return n}function Cg(e,t,n,s,o,i,a){const r=e.geometries,c=[];for(let e=0,l=r.length;e<l;++e)c[e]=S8(r[e],t,n,s,o,i,a);return c}function S8(e,t,n,s,o,i,a){let c=null;const l=e.type;if(l){const o=Og[l];c="Point"===l||"MultiPoint"===l?o(e,n,s):o(e,t),c=q(c,!1,a)}const d=new N({geometry:c});void 0!==e.id&&d.setId(e.id);let r=e.properties;return o&&(r||(r={}),r[o]=i),r&&d.setProperties(r,!0),d}function Kg(e,t,n){let s=0,o=0;for(let a=0,r=e.length;a<r;++a){const i=e[a];s+=i[0],o+=i[1],i[0]=s,i[1]=o,ad(i,t,n)}}function ad(e,t,n){e[0]=e[0]*t[0]+n[0],e[1]=e[1]*t[1]+n[1]}class us{constructor(e){this.tagName_=e}getTagName(){return this.tagName_}}class Jl extends us{constructor(e,t){super(e),this.conditions=t,x(this.conditions.length>=2,"At least 2 conditions are required")}}class C8 extends Jl{constructor(){super("And",Array.prototype.slice.call(arguments))}}class y8 extends us{constructor(e,t,n){if(super("BBOX"),this.geometryName=e,this.extent=t,4!==t.length)throw new Error("Expected an extent with four values ([minX, minY, maxX, maxY])");this.srsName=n}}class Eo extends us{constructor(e,t,n,s){super(e),this.geometryName=t||"the_geom",this.geometry=n,this.srsName=s}}class v8 extends Eo{constructor(e,t,n){super("Contains",e,t,n)}}class g8 extends Eo{constructor(e,t,n,s,o){super("DWithin",e,t,o),this.distance=n,this.unit=s}}class p8 extends Eo{constructor(e,t,n){super("Disjoint",e,t,n)}}class Co extends us{constructor(e,t){super(e),this.propertyName=t}}class Jm extends Co{constructor(e,t,n){super("During",e),this.begin=t,this.end=n}}class ls extends Co{constructor(e,t,n,s){super(e,t),this.expression=n,this.matchCase=s}}class Km extends ls{constructor(e,t,n){super("PropertyIsEqualTo",e,t,n)}}class Bm extends ls{constructor(e,t){super("PropertyIsGreaterThan",e,t)}}class Nm extends ls{constructor(e,t){super("PropertyIsGreaterThanOrEqualTo",e,t)}}class Dm extends Eo{constructor(e,t,n){super("Intersects",e,t,n)}}class zm extends Co{constructor(e,t,n){super("PropertyIsBetween",e),this.lowerBoundary=t,this.upperBoundary=n}}class Sm extends Co{constructor(e,t,n,s,o,i){super("PropertyIsLike",e),this.pattern=t,this.wildCard=void 0!==n?n:"*",this.singleChar=void 0!==s?s:".",this.escapeChar=void 0!==o?o:"!",this.matchCase=i}}class km extends Co{constructor(e){super("PropertyIsNull",e)}}class Cm extends ls{constructor(e,t){super("PropertyIsLessThan",e,t)}}class xm extends ls{constructor(e,t){super("PropertyIsLessThanOrEqualTo",e,t)}}class _m extends us{constructor(e){super("Not"),this.condition=e}}class bm extends ls{constructor(e,t,n){super("PropertyIsNotEqualTo",e,t,n)}}class dm extends Jl{constructor(){super("Or",Array.prototype.slice.call(arguments))}}class lm extends us{constructor(e){super("ResourceId"),this.rid=e}}class rm extends Eo{constructor(e,t,n){super("Within",e,t,n)}}function am(){const t=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(C8,t))}function Gh(e,t,n){return new y8(e,t,n)}const Yh={"http://www.opengis.net/gml":{boundedBy:t(f.prototype.readExtentElement,"bounds")},"http://www.opengis.net/wfs/2.0":{member:h(f.prototype.readFeaturesInternal)}},s5={"http://www.opengis.net/wfs":{totalInserted:t(ae),totalUpdated:t(ae),totalDeleted:t(ae)},"http://www.opengis.net/wfs/2.0":{totalInserted:t(ae),totalUpdated:t(ae),totalDeleted:t(ae)}},o5={"http://www.opengis.net/wfs":{TransactionSummary:t(ah,"transactionSummary"),InsertResults:t(J3,"insertIds")},"http://www.opengis.net/wfs/2.0":{TransactionSummary:t(ah,"transactionSummary"),InsertResults:t(J3,"insertIds")}},i5={"http://www.opengis.net/wfs":{PropertyName:n(j)},"http://www.opengis.net/wfs/2.0":{PropertyName:n(j)}},Uh={"http://www.opengis.net/wfs":{Insert:n(Y3),Update:n(P3),Delete:n(B3),Property:n(k3),Native:n(E3)},"http://www.opengis.net/wfs/2.0":{Insert:n(Y3),Update:n(P3),Delete:n(B3),Property:n(k3),Native:n(E3)}},Vh="feature",Zl="http://www.w3.org/2000/xmlns/",Ql={"2.0.0":"http://www.opengis.net/ogc/1.1","1.1.0":"http://www.opengis.net/ogc","1.0.0":"http://www.opengis.net/ogc"},Xl={"2.0.0":"http://www.opengis.net/wfs/2.0","1.1.0":"http://www.opengis.net/wfs","1.0.0":"http://www.opengis.net/wfs"},Gl={"2.0.0":"http://www.opengis.net/fes/2.0","1.1.0":"http://www.opengis.net/fes","1.0.0":"http://www.opengis.net/fes"},fh={"2.0.0":"http://www.opengis.net/wfs/2.0 http://schemas.opengis.net/wfs/2.0/wfs.xsd","1.1.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd","1.0.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.0.0/wfs.xsd"},Yl={"2.0.0":D,"1.1.0":r,"1.0.0":S};function Vc(e,t,n,s){_(s,Uh,se(e),t,n)}function ah(e,t){return i({},s5,e,t)}const g5={"http://www.opengis.net/ogc":{FeatureId:h(function(e){return e.getAttribute("fid")})},"http://www.opengis.net/ogc/1.1":{FeatureId:h(function(e){return e.getAttribute("fid")})}};function sh(e,t){Te(g5,e,t)}const b5={"http://www.opengis.net/wfs":{Feature:sh},"http://www.opengis.net/wfs/2.0":{Feature:sh}};function J3(e,t){return i([],b5,e,t)}function Y3(e,t,n){const o=n[n.length-1],a=o.featureType,c=o.featureNS,i=o.gmlVersion,s=w(c,a);e.appendChild(s),2===i?S.prototype.writeFeatureElement(s,t,n):3===i?r.prototype.writeFeatureElement(s,t,n):D.prototype.writeFeatureElement(s,t,n)}function q3(e,t,n){const a=n[n.length-1].version,s=Ql[a],o=w(s,"Filter"),i=w(s,"FeatureId");o.appendChild(i),i.setAttribute("fid",t),e.appendChild(o)}function ql(e,t){const n=(e=e||Vh)+":";return t.startsWith(n)?t:n+t}function B3(e,t,n){const s=n[n.length-1];x(void 0!==t.getId(),"Features must have an id set");const a=s.featureType,o=s.featurePrefix,r=s.featureNS,c=ql(o,a);e.setAttribute("typeName",c),e.setAttributeNS(Zl,"xmlns:"+o,r);const i=t.getId();void 0!==i&&q3(e,i,n)}function P3(e,t,n){const s=n[n.length-1];x(void 0!==t.getId(),"Features must have an id set");const a=s.version,r=s.featureType,o=s.featurePrefix,c=s.featureNS,l=ql(o,r),d=t.getGeometryName();e.setAttribute("typeName",l),e.setAttributeNS(Zl,"xmlns:"+o,c);const i=t.getId();if(void 0!==i){const o=t.getKeys(),r=[];for(let e=0,s=o.length;e<s;e++){const n=t.get(o[e]);if(void 0!==n){let t=o[e];n&&"function"==typeof n.getSimplifiedGeometry&&(t=d),r.push({name:t,value:n})}}_({version:a,gmlVersion:s.gmlVersion,node:e,hasZ:s.hasZ,srsName:s.srsName},Uh,se("Property"),r,n),q3(e,i,n)}}function k3(e,t,n){const s=n[n.length-1],o=s.version,i=Xl[o],a=w(i,"2.0.0"===o?"ValueReference":"Name"),c=s.gmlVersion;if(e.appendChild(a),j(a,t.name),void 0!==t.value&&null!==t.value){const s=w(i,"Value");e.appendChild(s),t.value&&"function"==typeof t.value.getSimplifiedGeometry?2===c?S.prototype.writeGeometryElement(s,t.value,n):3===c?r.prototype.writeGeometryElement(s,t.value,n):D.prototype.writeGeometryElement(s,t.value,n):j(s,t.value)}}function E3(e,t){t.vendorId&&e.setAttribute("vendorId",t.vendorId),void 0!==t.safeToIgnore&&e.setAttribute("safeToIgnore",String(t.safeToIgnore)),void 0!==t.value&&j(e,t.value)}const $c={"http://www.opengis.net/wfs":{Query:n(x3)},"http://www.opengis.net/wfs/2.0":{Query:n(x3)},"http://www.opengis.net/ogc":{During:n(b3),And:n(Xc),Or:n(Xc),Not:n(c3),BBOX:n(w3),Contains:n(Ln),Intersects:n(Ln),Within:n(Ln),DWithin:n(j3),PropertyIsEqualTo:n(rt),PropertyIsNotEqualTo:n(rt),PropertyIsLessThan:n(rt),PropertyIsLessThanOrEqualTo:n(rt),PropertyIsGreaterThan:n(rt),PropertyIsGreaterThanOrEqualTo:n(rt),PropertyIsNull:n(a3),PropertyIsBetween:n(i3),PropertyIsLike:n(o3)},"http://www.opengis.net/fes/2.0":{During:n(b3),And:n(Xc),Or:n(Xc),Not:n(c3),BBOX:n(w3),Contains:n(Ln),Disjoint:n(Ln),Intersects:n(Ln),ResourceId:n(function(e,t){e.setAttribute("rid",t.rid)}),Within:n(Ln),DWithin:n(j3),PropertyIsEqualTo:n(rt),PropertyIsNotEqualTo:n(rt),PropertyIsLessThan:n(rt),PropertyIsLessThanOrEqualTo:n(rt),PropertyIsGreaterThan:n(rt),PropertyIsGreaterThanOrEqualTo:n(rt),PropertyIsNull:n(a3),PropertyIsBetween:n(i3),PropertyIsLike:n(o3)}};function x3(e,t,n){const s=n[n.length-1],i=s.version,o=s.featurePrefix,a=s.featureNS,h=s.propertyNames,r=s.srsName;let c,l;c=o?ql(o,t):t,l="2.0.0"===i?"typeNames":"typeName",e.setAttribute(l,c),r&&e.setAttribute("srsName",r),a&&e.setAttributeNS(Zl,"xmlns:"+o,a);const d=Object.assign({},s);d.node=e,_(d,i5,se("PropertyName"),h,n);const u=s.filter;if(u){const t=w(pi(i),"Filter");e.appendChild(t),O3(t,u,n)}}function O3(e,t,n){const o=n[n.length-1],s={node:e};Object.assign(s,{context:o}),_(s,$c,se(t.getTagName()),[t],n)}function w3(e,t,n){const s=n[n.length-1],o=s.context.version;s.srsName=t.srsName;const i=Yl[o];ao(o,e,t.geometryName),i.prototype.writeGeometryElement(e,t.extent,n)}function Ln(e,t,n){const s=n[n.length-1],o=s.context.version;s.srsName=t.srsName;const i=Yl[o];ao(o,e,t.geometryName),i.prototype.writeGeometryElement(e,t.geometry,n)}function j3(e,t,n){const o=n[n.length-1].context.version;Ln(e,t,n);const s=w(pi(o),"Distance");j(s,t.distance.toString()),"2.0.0"===o?s.setAttribute("uom",t.unit):s.setAttribute("units",t.unit),e.appendChild(s)}function b3(e,t,n){const a=n[n.length-1].context.version;Jc(Gl[a],"ValueReference",e,t.propertyName);const s=w(qt,"TimePeriod");e.appendChild(s);const o=w(qt,"begin");s.appendChild(o),Z2(o,t.begin);const i=w(qt,"end");s.appendChild(i),Z2(i,t.end)}function Xc(e,t,n){const i=n[n.length-1].context,s={node:e};Object.assign(s,{context:i});const o=t.conditions;for(let e=0,i=o.length;e<i;++e){const t=o[e];_(s,$c,se(t.getTagName()),[t],n)}}function c3(e,t,n){const i=n[n.length-1].context,s={node:e};Object.assign(s,{context:i});const o=t.condition;_(s,$c,se(o.getTagName()),[o],n)}function rt(e,t,n){const s=n[n.length-1].context.version;void 0!==t.matchCase&&e.setAttribute("matchCase",t.matchCase.toString()),ao(s,e,t.propertyName),el(s,e,""+t.expression)}function a3(e,t,n){ao(n[n.length-1].context.version,e,t.propertyName)}function i3(e,t,n){const s=n[n.length-1].context.version,o=pi(s);ao(s,e,t.propertyName);const i=w(o,"LowerBoundary");e.appendChild(i),el(s,i,""+t.lowerBoundary);const a=w(o,"UpperBoundary");e.appendChild(a),el(s,a,""+t.upperBoundary)}function o3(e,t,n){const s=n[n.length-1].context.version;e.setAttribute("wildCard",t.wildCard),e.setAttribute("singleChar",t.singleChar),e.setAttribute("escapeChar",t.escapeChar),void 0!==t.matchCase&&e.setAttribute("matchCase",t.matchCase.toString()),ao(s,e,t.propertyName),el(s,e,""+t.pattern)}function Jc(e,t,n,s){const o=w(e,t);j(o,s),n.appendChild(o)}function el(e,t,n){Jc(pi(e),"Literal",t,n)}function ao(e,t,n){"2.0.0"===e?Jc(Gl[e],"ValueReference",t,n):Jc(Ql[e],"PropertyName",t,n)}function Z2(e,t){const n=w(qt,"TimeInstant");e.appendChild(n);const s=w(qt,"timePosition");n.appendChild(s),j(s,t)}function U2(e,t,n){const o=n[n.length-1],s=Object.assign({},o);s.node=e,_(s,$c,se("Query"),t,n)}function pi(e){let t;return t="2.0.0"===e?Gl[e]:Ql[e],t}const cl=1,pl=2,bl=3,Wl=4,$l=5,Vl=6,Bl=7,E2=15,x2=16,O2=17;class w2{constructor(e){this.view_=e,this.pos_=0,this.initialized_=!1,this.isLittleEndian_=!1,this.hasZ_=!1,this.hasM_=!1,this.srid_=null,this.layout_="XY"}readUint8(){return this.view_.getUint8(this.pos_++)}readUint32(e){return this.view_.getUint32((this.pos_+=4)-4,void 0!==e?e:this.isLittleEndian_)}readDouble(e){return this.view_.getFloat64((this.pos_+=8)-8,void 0!==e?e:this.isLittleEndian_)}readPoint(){const e=[];return e.push(this.readDouble()),e.push(this.readDouble()),this.hasZ_&&e.push(this.readDouble()),this.hasM_&&e.push(this.readDouble()),e}readLineString(){const t=this.readUint32(),e=[];for(let n=0;n<t;n++)e.push(this.readPoint());return e}readPolygon(){const t=this.readUint32(),e=[];for(let n=0;n<t;n++)e.push(this.readLineString());return e}readWkbHeader(e){const n=this.readUint8()>0,t=this.readUint32(n),s=Math.floor((268435455&t)/1e3),a=Boolean(2147483648&t)||1===s||3===s,r=Boolean(1073741824&t)||2===s||3===s,l=Boolean(536870912&t),o=(268435455&t)%1e3,c=["XY",a?"Z":"",r?"M":""].join(""),i=l?this.readUint32(n):null;if(void 0!==e&&e!==o)throw new Error("Unexpected WKB geometry type "+o);if(this.initialized_){{if(this.isLittleEndian_!==n)throw new Error("Inconsistent endian");if(this.layout_!==c)throw new Error("Inconsistent geometry layout");if(i&&this.srid_!==i)throw new Error("Inconsistent coordinate system (SRID)")}}else this.isLittleEndian_=n,this.hasZ_=a,this.hasM_=r,this.layout_=c,this.srid_=i,this.initialized_=!0;return o}readWkbPayload(e){switch(e){case cl:return this.readPoint();case pl:return this.readLineString();case bl:case O2:return this.readPolygon();case Wl:return this.readMultiPoint();case $l:return this.readMultiLineString();case Vl:case E2:case x2:return this.readMultiPolygon();case Bl:return this.readGeometryCollection();default:throw new Error("Unsupported WKB geometry type "+e+" is found")}}readWkbBlock(e){return this.readWkbPayload(this.readWkbHeader(e))}readWkbCollection(e,t){const s=this.readUint32(),n=[];for(let o=0;o<s;o++){const i=e.call(this,t);i&&n.push(i)}return n}readMultiPoint(){return this.readWkbCollection(this.readWkbBlock,cl)}readMultiLineString(){return this.readWkbCollection(this.readWkbBlock,pl)}readMultiPolygon(){return this.readWkbCollection(this.readWkbBlock,bl)}readGeometryCollection(){return this.readWkbCollection(this.readGeometry)}readGeometry(){const t=this.readWkbHeader(),e=this.readWkbPayload(t);switch(t){case cl:return new Y(e,this.layout_);case pl:return new ee(e,this.layout_);case bl:case O2:return new ie(e,this.layout_);case Wl:return new tt(e,this.layout_);case $l:return new ke(e,this.layout_);case Vl:case E2:case x2:return new Re(e,this.layout_);case Bl:return new ge(e);default:return null}}getSrid(){return this.srid_}}class s7{constructor(e){e=e||{},this.layout_=e.layout,this.isLittleEndian_=!1!==e.littleEndian,this.isEWKB_=!1!==e.ewkb,this.writeQueue_=[],this.nodata_=Object.assign({X:0,Y:0,Z:0,M:0},e.nodata)}writeUint8(e){this.writeQueue_.push([1,e])}writeUint32(e){this.writeQueue_.push([4,e])}writeDouble(e){this.writeQueue_.push([8,e])}writePoint(e,t){const n=Object.assign.apply(null,t.split("").map((t,n)=>({[t]:e[n]})));for(const e of this.layout_)this.writeDouble(e in n?n[e]:this.nodata_[e])}writeLineString(e,t){this.writeUint32(e.length);for(let n=0;n<e.length;n++)this.writePoint(e[n],t)}writePolygon(e,t){this.writeUint32(e.length);for(let n=0;n<e.length;n++)this.writeLineString(e[n],t)}writeWkbHeader(e,t){e%=1e3,this.layout_.includes("Z")&&(e+=this.isEWKB_?2147483648:1e3),this.layout_.includes("M")&&(e+=this.isEWKB_?1073741824:2e3),this.isEWKB_&&Number.isInteger(t)&&(e|=536870912),this.writeUint8(this.isLittleEndian_?1:0),this.writeUint32(e),this.isEWKB_&&Number.isInteger(t)&&this.writeUint32(t)}writeMultiPoint(e,t){this.writeUint32(e.length);for(let n=0;n<e.length;n++)this.writeWkbHeader(1),this.writePoint(e[n],t)}writeMultiLineString(e,t){this.writeUint32(e.length);for(let n=0;n<e.length;n++)this.writeWkbHeader(2),this.writeLineString(e[n],t)}writeMultiPolygon(e,t){this.writeUint32(e.length);for(let n=0;n<e.length;n++)this.writeWkbHeader(3),this.writePolygon(e[n],t)}writeGeometryCollection(e){this.writeUint32(e.length);for(let t=0;t<e.length;t++)this.writeGeometry(e[t])}findMinimumLayout(e,t="XYZM"){if(e instanceof jt)return(n=e.getLayout())===(s=t)?n:"XYZM"===n?s:"XYZM"===s?n:"XY";var n,s;if(e instanceof ge){const n=e.getGeometriesArray();for(let e=0;e<n.length&&"XY"!==t;e++)t=this.findMinimumLayout(n[e],t)}return t}writeGeometry(e,t){const o={Point:cl,LineString:pl,Polygon:bl,MultiPoint:Wl,MultiLineString:$l,MultiPolygon:Vl,GeometryCollection:Bl},n=e.getType(),s=o[n];if(!s)throw new Error("GeometryType "+n+" is not supported");this.layout_||(this.layout_=this.findMinimumLayout(e)),this.writeWkbHeader(s,t),e instanceof jt?{Point:this.writePoint,LineString:this.writeLineString,Polygon:this.writePolygon,MultiPoint:this.writeMultiPoint,MultiLineString:this.writeMultiLineString,MultiPolygon:this.writeMultiPolygon}[n].call(this,e.getCoordinates(),e.getLayout()):e instanceof ge&&this.writeGeometryCollection(e.getGeometriesArray())}getBuffer(){const s=this.writeQueue_.reduce((e,t)=>e+t[0],0),n=new ArrayBuffer(s),t=new DataView(n);let e=0;return this.writeQueue_.forEach(n=>{switch(n[0]){case 1:t.setUint8(e,n[1]);break;case 4:t.setUint32(e,n[1],this.isLittleEndian_);break;case 8:t.setFloat64(e,n[1],this.isLittleEndian_)}e+=n[0]}),n}}function g2(e){return"string"==typeof e?function(e){const t=new Uint8Array(e.length/2);for(let n=0;n<e.length/2;n++)t[n]=parseInt(e.substr(2*n,2),16);return new DataView(t.buffer)}(e):ArrayBuffer.isView(e)?e instanceof DataView?e:new DataView(e.buffer,e.byteOffset,e.byteLength):e instanceof ArrayBuffer?new DataView(e):null}const i7={POINT:Y,LINESTRING:ee,POLYGON:ie,MULTIPOINT:tt,MULTILINESTRING:ke,MULTIPOLYGON:Re},c2="EMPTY",i2="Z",X0="M",l7=0,jl=1,bn=2,Cn=3,U0=4,po=5,p7=6,g7={Point:"POINT",LineString:"LINESTRING",Polygon:"POLYGON",MultiPoint:"MULTIPOINT",MultiLineString:"MULTILINESTRING",MultiPolygon:"MULTIPOLYGON",GeometryCollection:"GEOMETRYCOLLECTION",Circle:"CIRCLE"};class v7{constructor(e){this.wkt=e,this.index_=-1}isAlpha_(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}isNumeric_(e,t){return t=void 0!==t&&t,e>="0"&&e<="9"||"."==e&&!t}isWhiteSpace_(e){return" "==e||"	"==e||``==e||`
`==e}nextChar_(){return this.wkt.charAt(++this.index_)}nextToken(){const e=this.nextChar_(),s=this.index_;let t,n=e;if("("==e)t=bn;else if(","==e)t=po;else if(")"==e)t=Cn;else if(this.isNumeric_(e)||"-"==e)t=U0,n=this.readNumber_();else if(this.isAlpha_(e))t=jl,n=this.readText_();else{if(this.isWhiteSpace_(e))return this.nextToken();if(""!==e)throw new Error("Unexpected character: "+e);t=p7}return{position:s,value:n,type:t}}readNumber_(){let e;const s=this.index_;let n=!1,t=!1;do"."==e?n=!0:"e"!=e&&"E"!=e||(t=!0),e=this.nextChar_();while(this.isNumeric_(e,n)||!t&&("e"==e||"E"==e)||t&&("-"==e||"+"==e))return parseFloat(this.wkt.substring(s,this.index_--))}readText_(){let e;const t=this.index_;do e=this.nextChar_();while(this.isAlpha_(e))return this.wkt.substring(t,this.index_--).toUpperCase()}}class b7{constructor(e){this.lexer_=e,this.token_={position:0,type:l7},this.layout_="XY"}consume_(){this.token_=this.lexer_.nextToken()}isTokenType(e){return this.token_.type==e}match(e){const t=this.isTokenType(e);return t&&this.consume_(),t}parse(){return this.consume_(),this.parseGeometry_()}parseGeometryLayout_(){let e="XY";const t=this.token_;if(this.isTokenType(jl)){const n=t.value;n===i2?e="XYZ":n===X0?e="XYM":"ZM"===n&&(e="XYZM"),"XY"!==e&&this.consume_()}return e}parseGeometryCollectionText_(){if(this.match(bn)){const e=[];do e.push(this.parseGeometry_());while(this.match(po))if(this.match(Cn))return e}throw new Error(this.formatErrorMessage_())}parsePointText_(){if(this.match(bn)){const e=this.parsePoint_();if(this.match(Cn))return e}throw new Error(this.formatErrorMessage_())}parseLineStringText_(){if(this.match(bn)){const e=this.parsePointList_();if(this.match(Cn))return e}throw new Error(this.formatErrorMessage_())}parsePolygonText_(){if(this.match(bn)){const e=this.parseLineStringTextList_();if(this.match(Cn))return e}throw new Error(this.formatErrorMessage_())}parseMultiPointText_(){if(this.match(bn)){let e;if(e=this.token_.type==bn?this.parsePointTextList_():this.parsePointList_(),this.match(Cn))return e}throw new Error(this.formatErrorMessage_())}parseMultiLineStringText_(){if(this.match(bn)){const e=this.parseLineStringTextList_();if(this.match(Cn))return e}throw new Error(this.formatErrorMessage_())}parseMultiPolygonText_(){if(this.match(bn)){const e=this.parsePolygonTextList_();if(this.match(Cn))return e}throw new Error(this.formatErrorMessage_())}parsePoint_(){const e=[],t=this.layout_.length;for(let n=0;n<t;++n){const s=this.token_;if(!this.match(U0))break;e.push(s.value)}if(e.length==t)return e;throw new Error(this.formatErrorMessage_())}parsePointList_(){const e=[this.parsePoint_()];for(;this.match(po);)e.push(this.parsePoint_());return e}parsePointTextList_(){const e=[this.parsePointText_()];for(;this.match(po);)e.push(this.parsePointText_());return e}parseLineStringTextList_(){const e=[this.parseLineStringText_()];for(;this.match(po);)e.push(this.parseLineStringText_());return e}parsePolygonTextList_(){const e=[this.parsePolygonText_()];for(;this.match(po);)e.push(this.parsePolygonText_());return e}isEmptyGeometry_(){const e=this.isTokenType(jl)&&this.token_.value==c2;return e&&this.consume_(),e}formatErrorMessage_(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"}parseGeometry_(){const e=this.token_;if(this.match(jl)){const n=e.value;this.layout_=this.parseGeometryLayout_();const s=this.isEmptyGeometry_();if("GEOMETRYCOLLECTION"==n){if(s)return new ge([]);const e=this.parseGeometryCollectionText_();return new ge(e)}const o=i7[n];if(!o)throw new Error("Invalid geometry type: "+n);let t;if(s)t="POINT"==n?[NaN,NaN]:[];else switch(n){case"POINT":t=this.parsePointText_();break;case"LINESTRING":t=this.parseLineStringText_();break;case"POLYGON":t=this.parsePolygonText_();break;case"MULTIPOINT":t=this.parseMultiPointText_();break;case"MULTILINESTRING":t=this.parseMultiLineStringText_();break;case"MULTIPOLYGON":t=this.parseMultiPolygonText_()}return new o(t,this.layout_)}throw new Error(this.formatErrorMessage_())}}function $0(e){const t=e.getCoordinates();return 0===t.length?"":t.join(" ")}function Pl(e){const t=e.getCoordinates(),n=[];for(let e=0,s=t.length;e<s;++e)n.push(t[e].join(" "));return n.join(",")}function I0(e){const t=[],n=e.getLinearRings();for(let e=0,s=n.length;e<s;++e)t.push("("+Pl(n[e])+")");return t.join(",")}const w7={Point:$0,LineString:Pl,Polygon:I0,MultiPoint:function(e){const t=[],n=e.getPoints();for(let e=0,s=n.length;e<s;++e)t.push("("+$0(n[e])+")");return t.join(",")},MultiLineString:function(e){const t=[],n=e.getLineStrings();for(let e=0,s=n.length;e<s;++e)t.push("("+Pl(n[e])+")");return t.join(",")},MultiPolygon:function(e){const t=[],n=e.getPolygons();for(let e=0,s=n.length;e<s;++e)t.push("("+I0(n[e])+")");return t.join(",")},GeometryCollection:function(e){const t=[],n=e.getGeometries();for(let e=0,s=n.length;e<s;++e)t.push(H0(n[e]));return t.join(",")}};function H0(e){const n=e.getType(),s=(0,w7[n])(e);let t=g7[n];if("function"==typeof e.getFlatCoordinates){const n=function(e){const t=e.getLayout();let n="";return"XYZ"!==t&&"XYZM"!==t||(n+=i2),"XYM"!==t&&"XYZM"!==t||(n+=X0),n}(e);n.length>0&&(t+=" "+n)}return 0===s.length?t+" "+c2:t+"("+s+")"}const Se=[null,"http://www.opengis.net/wms"],C7=o(Se,{Service:t(function(e,t){return i({},k7,e,t)}),Capability:t(function(e,t){return i({},E7,e,t)})}),E7=o(Se,{Request:t(function(e,t){return i({},N7,e,t)}),Exception:t(function(e,t){return i([],F7,e,t)}),Layer:t(function(e,t){const n=i({},P0,e,t);return void 0===n.Layer?Object.assign(n,R0(e,t)):n})}),k7=o(Se,{Name:t(a),Title:t(a),Abstract:t(a),KeywordList:t(v0),OnlineResource:t(Cs),ContactInformation:t(function(e,t){return i({},A7,e,t)}),Fees:t(a),AccessConstraints:t(a),LayerLimit:t(ae),MaxWidth:t(ae),MaxHeight:t(ae)}),A7=o(Se,{ContactPersonPrimary:t(function(e,t){return i({},S7,e,t)}),ContactPosition:t(a),ContactAddress:t(function(e,t){return i({},M7,e,t)}),ContactVoiceTelephone:t(a),ContactFacsimileTelephone:t(a),ContactElectronicMailAddress:t(a)}),S7=o(Se,{ContactPerson:t(a),ContactOrganization:t(a)}),M7=o(Se,{AddressType:t(a),Address:t(a),City:t(a),StateOrProvince:t(a),PostCode:t(a),Country:t(a)}),F7=o(Se,{Format:h(a)}),P0=o(Se,{Name:t(a),Title:t(a),Abstract:t(a),KeywordList:t(v0),CRS:G(a),EX_GeographicBoundingBox:t(function(e,t){const n=i({},D7,e,t);if(!n)return;const s=n.westBoundLongitude,o=n.southBoundLatitude,a=n.eastBoundLongitude,r=n.northBoundLatitude;if(void 0===s||void 0===o||void 0===a||void 0===r)return;return[s,o,a,r]}),BoundingBox:G(function(e){const n=[Gt(e.getAttribute("minx")),Gt(e.getAttribute("miny")),Gt(e.getAttribute("maxx")),Gt(e.getAttribute("maxy"))],s=[Gt(e.getAttribute("resx")),Gt(e.getAttribute("resy"))];return{crs:e.getAttribute("CRS"),extent:n,res:s}}),Dimension:G(function(e){return{name:e.getAttribute("name"),units:e.getAttribute("units"),unitSymbol:e.getAttribute("unitSymbol"),default:e.getAttribute("default"),multipleValues:Sn(e.getAttribute("multipleValues")),nearestValue:Sn(e.getAttribute("nearestValue")),current:Sn(e.getAttribute("current")),values:a(e)}}),Attribution:t(function(e,t){return i({},z7,e,t)}),AuthorityURL:G(function(e,t){const n=pn(e,t);if(n)return n.name=e.getAttribute("name"),n}),Identifier:G(a),MetadataURL:G(function(e,t){const n=pn(e,t);if(n)return n.type=e.getAttribute("type"),n}),DataURL:G(pn),FeatureListURL:G(pn),Style:G(function(e,t){return i({},H7,e,t)}),MinScaleDenominator:t(F),MaxScaleDenominator:t(F),Layer:G(R0)}),z7=o(Se,{Title:t(a),OnlineResource:t(Cs),LogoURL:t(N0)}),D7=o(Se,{westBoundLongitude:t(F),eastBoundLongitude:t(F),southBoundLatitude:t(F),northBoundLatitude:t(F)}),N7=o(Se,{GetCapabilities:t(Ll),GetMap:t(Ll),GetFeatureInfo:t(Ll)}),L7=o(Se,{Format:G(a),DCPType:G(function(e,t){return i({},R7,e,t)})}),R7=o(Se,{HTTP:t(function(e,t){return i({},P7,e,t)})}),P7=o(Se,{Get:t(pn),Post:t(pn)}),H7=o(Se,{Name:t(a),Title:t(a),Abstract:t(a),LegendURL:G(N0),StyleSheetURL:t(pn),StyleURL:t(pn)}),I7=o(Se,{Format:t(a),OnlineResource:t(Cs)}),B7=o(Se,{Keyword:h(a)});function R0(e,t){const s=t[t.length-1],n=i({},P0,e,t);if(!n)return;let o=Sn(e.getAttribute("queryable"));void 0===o&&(o=s.queryable),n.queryable=void 0!==o&&o;let c=Qt(e.getAttribute("cascaded"));void 0===c&&(c=s.cascaded),n.cascaded=c;let a=Sn(e.getAttribute("opaque"));void 0===a&&(a=s.opaque),n.opaque=void 0!==a&&a;let r=Sn(e.getAttribute("noSubsets"));void 0===r&&(r=s.noSubsets),n.noSubsets=void 0!==r&&r;let l=Gt(e.getAttribute("fixedWidth"));l||(l=s.fixedWidth),n.fixedWidth=l;let d=Gt(e.getAttribute("fixedHeight"));return d||(d=s.fixedHeight),n.fixedHeight=d,["Style","CRS","AuthorityURL"].forEach(function(e){if(e in s){const t=n[e]||[];n[e]=t.concat(s[e])}}),["EX_GeographicBoundingBox","BoundingBox","Dimension","Attribution","MinScaleDenominator","MaxScaleDenominator"].forEach(function(e){if(!(e in n)){const t=s[e];n[e]=t}}),n}function pn(e,t){return i({},I7,e,t)}function Ll(e,t){return i({},L7,e,t)}function N0(e,t){const n=pn(e,t);if(n){const t=[Qt(e.getAttribute("width")),Qt(e.getAttribute("height"))];return n.size=t,n}}function v0(e,t){return i([],B7,e,t)}const Xt=[null,"http://www.opengis.net/wmts/1.0"],Wo=[null,"http://www.opengis.net/ows/1.1"],G7=o(Xt,{Contents:t(function(e,t){return i({},X7,e,t)})}),X7=o(Xt,{Layer:G(function(e,t){return i({},Q7,e,t)}),TileMatrixSet:G(function(e,t){return i({},ov,e,t)})}),Q7=o(Xt,{Style:G(function(e,t){const n=i({},Z7,e,t);if(!n)return;const s="true"===e.getAttribute("isDefault");return n.isDefault=s,n}),Format:G(a),TileMatrixSetLink:G(function(e,t){return i({},J7,e,t)}),Dimension:G(function(e,t){return i({},nv,e,t)}),ResourceURL:G(function(e){const s=e.getAttribute("format"),o=e.getAttribute("template"),i=e.getAttribute("resourceType"),n={};return s&&(n.format=s),o&&(n.template=o),i&&(n.resourceType=i),n})},o(Wo,{Title:t(a),Abstract:t(a),WGS84BoundingBox:t(a0),BoundingBox:G(function(e,t){const s=e.getAttribute("crs"),n=i([],l0,e,t);if(2!=n.length)return;return{extent:oe(n),crs:s}}),Identifier:t(a)})),Z7=o(Xt,{LegendURL:G(function(e){const n={};return n.format=e.getAttribute("format"),n.href=Cs(e),n})},o(Wo,{Title:t(a),Identifier:t(a)})),J7=o(Xt,{TileMatrixSet:t(a),TileMatrixSetLimits:t(function(e,t){return i([],ev,e,t)})}),ev=o(Xt,{TileMatrixLimits:h(function(e,t){return i({},tv,e,t)})}),tv=o(Xt,{TileMatrix:t(a),MinTileRow:t(ae),MaxTileRow:t(ae),MinTileCol:t(ae),MaxTileCol:t(ae)}),nv=o(Xt,{Default:t(a),Value:G(a)},o(Wo,{Identifier:t(a)})),l0=o(Wo,{LowerCorner:h(Nl),UpperCorner:h(Nl)}),ov=o(Xt,{WellKnownScaleSet:t(a),TileMatrix:G(function(e,t){return i({},iv,e,t)})},o(Wo,{SupportedCRS:t(a),Identifier:t(a),BoundingBox:t(a0)})),iv=o(Xt,{TopLeftCorner:t(Nl),ScaleDenominator:t(F),TileWidth:t(ae),TileHeight:t(ae),MatrixWidth:t(ae),MatrixHeight:t(ae)},o(Wo,{Identifier:t(a)}));function a0(e,t){const n=i([],l0,e,t);if(2==n.length)return oe(n)}function Nl(e){const n=a(e).split(/\s+/);if(!n||2!=n.length)return;const s=+n[0],o=+n[1];return isNaN(s)||isNaN(o)?void 0:[s,o]}const s0=["fullscreenchange","webkitfullscreenchange","MSFullscreenChange"],lv="enterfullscreen",dv="leavefullscreen";function n0(e){const t=e.body;return!!(t.webkitRequestFullscreen||t.requestFullscreen&&e.fullscreenEnabled)}function t0(e){return!!e.webkitIsFullScreen||!!e.fullscreenElement}function J4(e){e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()}const Dl="projection",Y4="coordinateFormat",q4=.75,zl=.1,Tl="units",jv=[1,2,5],oi=25.4/.28,H4=0,Ml=1;return e={},e.Collection=me,e.Collection.CollectionEvent=Ci,e.DataTile=Cc,e.DataTile.asArrayLike=Ac,e.DataTile.asImageLike=Mi,e.DataTile.toArray=mf,e.Disposable=Zo,e.Feature=N,e.Feature.createStyleFunction=bf,e.Geolocation=class extends Ye{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.position_=null,this.transform_=Ta,this.watchId_=void 0,this.addChangeListener(c1,this.handleProjectionChanged_),this.addChangeListener(m1,this.handleTrackingChanged_),void 0!==e.projection&&this.setProjection(e.projection),void 0!==e.trackingOptions&&this.setTrackingOptions(e.trackingOptions),this.setTracking(void 0!==e.tracking&&e.tracking)}disposeInternal(){this.setTracking(!1),super.disposeInternal()}handleProjectionChanged_(){const e=this.getProjection();e&&(this.transform_=De(d("EPSG:4326"),e),this.position_&&this.set(o1,this.transform_(this.position_)))}handleTrackingChanged_(){if("geolocation"in navigator){const e=this.getTracking();e&&void 0===this.watchId_?this.watchId_=navigator.geolocation.watchPosition(this.positionChange_.bind(this),this.positionError_.bind(this),this.getTrackingOptions()):e||void 0===this.watchId_||(navigator.geolocation.clearWatch(this.watchId_),this.watchId_=void 0)}}positionChange_(e){const t=e.coords;this.set(L3,t.accuracy),this.set(M3,null===t.altitude?void 0:t.altitude),this.set(S3,null===t.altitudeAccuracy?void 0:t.altitudeAccuracy),this.set(f3,null===t.heading?void 0:we(t.heading)),this.position_?(this.position_[0]=t.longitude,this.position_[1]=t.latitude):this.position_=[t.longitude,t.latitude];const s=this.transform_(this.position_);this.set(o1,s.slice()),this.set(Q2,null===t.speed?void 0:t.speed);const n=V3(this.position_,t.accuracy);n.applyTransform(this.transform_),this.set(T3,n),this.changed()}positionError_(e){this.dispatchEvent(new B2(e))}getAccuracy(){return this.get(L3)}getAccuracyGeometry(){return this.get(T3)||null}getAltitude(){return this.get(M3)}getAltitudeAccuracy(){return this.get(S3)}getHeading(){return this.get(f3)}getPosition(){return this.get(o1)}getProjection(){return this.get(c1)}getSpeed(){return this.get(Q2)}getTracking(){return this.get(m1)}getTrackingOptions(){return this.get(K2)}setProjection(e){this.set(c1,d(e))}setTracking(e){this.set(m1,e)}setTrackingOptions(e){this.set(K2,e)}},e.Geolocation.GeolocationError=B2,e.Image=wi,e.Image.decode=hn,e.Image.decodeFallback=j1,e.Image.listenImage=L2,e.Image.load=N2,e.ImageCanvas=ol,e.ImageTile=Qo,e.Kinetic=M2,e.Map=k8,e.MapBrowserEvent=It,e.MapBrowserEventHandler=c8,e.MapEvent=ys,e.Object=Ye,e.Object.ObjectEvent=Ul,e.Observable=co,e.Observable.unByKey=n3,e.Overlay=A8,e.Tile=fs,e.TileCache=di,e.TileQueue=Pd,e.TileQueue.getTilePriority=cf,e.TileRange=fi,e.TileRange.createOrUpdate=Xs,e.VectorRenderTile=Kf,e.VectorTile=Bf,e.View=xt,e.View.createCenterConstraint=y0,e.View.createResolutionConstraint=j0,e.View.createRotationConstraint=b0,e.View.isNoopAnimation=m0,e.array={},e.array.ascending=_t,e.array.binarySearch=B4,e.array.descending=u0,e.array.equals=Ct,e.array.extend=z,e.array.isSorted=L0,e.array.linearFindNearest=ci,e.array.remove=function(e,t){const n=e.indexOf(t),s=n>-1;return s&&e.splice(n,1),s},e.array.reverseSubArray=g0,e.array.stableSort=function(e,t){const o=e.length,s=Array(e.length);let n;for(n=0;n<o;n++)s[n]={index:n,value:e[n]};for(s.sort(function(e,n){return t(e.value,n.value)||e.index-n.index}),n=0;n<e.length;n++)e[n]=s[n].value},e.asserts={},e.asserts.assert=x,e.centerconstraint={},e.centerconstraint.createExtent=Y1,e.centerconstraint.none=K0,e.color={},e.color.asArray=mt,e.color.asString=I4,e.color.fromString=ar,e.color.isStringColor=U4,e.color.lchaToRgba=D4,e.color.normalize=M4,e.color.rgbaToLcha=Sl,e.color.toString=sr,e.color.withAlpha=J8,e.colorlike={},e.colorlike.asColorLike=Mt,e.console={},e.console.error=Mo,e.console.log=function(...e){nr>Aa.info||console.log(...e)},e.console.setLevel=function(e){nr=Aa[e]},e.console.warn=su,e.control={},e.control.Attribution=zf,e.control.Control=Lt,e.control.FullScreen=class extends Lt{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target}),this.on,this.once,this.un,this.keys_=void 0!==e.keys&&e.keys,this.source_=e.source,this.isInFullscreen_=!1,this.boundHandleMapTargetChange_=this.handleMapTargetChange_.bind(this),this.cssClassName_=void 0!==e.className?e.className:"ol-full-screen",this.documentListeners_=[],this.activeClassName_=void 0!==e.activeClassName?e.activeClassName.split(" "):[this.cssClassName_+"-true"],this.inactiveClassName_=void 0!==e.inactiveClassName?e.inactiveClassName.split(" "):[this.cssClassName_+"-false"];const t=void 0!==e.label?e.label:"⤢";this.labelNode_="string"==typeof t?document.createTextNode(t):t;const n=void 0!==e.labelActive?e.labelActive:"×";this.labelActiveNode_="string"==typeof n?document.createTextNode(n):n;const s=e.tipLabel?e.tipLabel:"Toggle full-screen";this.button_=document.createElement("button"),this.button_.title=s,this.button_.setAttribute("type","button"),this.button_.appendChild(this.labelNode_),this.button_.addEventListener(Ht,this.handleClick_.bind(this),!1),this.setClassName_(this.button_,this.isInFullscreen_),this.element.className=`${this.cssClassName_} ${At} ${En}`,this.element.appendChild(this.button_)}handleClick_(e){e.preventDefault(),this.handleFullScreen_()}handleFullScreen_(){const t=this.getMap();if(!t)return;const e=t.getOwnerDocument();if(n0(e))if(t0(e))!function(e){e.exitFullscreen?e.exitFullscreen():e.webkitExitFullscreen&&e.webkitExitFullscreen()}(e);else{let n;n=this.source_?"string"==typeof this.source_?e.getElementById(this.source_):this.source_:t.getTargetElement(),this.keys_?function(e){e.webkitRequestFullscreen?e.webkitRequestFullscreen():J4(e)}(n):J4(n)}}handleFullScreenChange_(){const e=this.getMap();if(!e)return;const t=this.isInFullscreen_;this.isInFullscreen_=t0(e.getOwnerDocument()),t!==this.isInFullscreen_&&(this.setClassName_(this.button_,this.isInFullscreen_),this.isInFullscreen_?(Bs(this.labelActiveNode_,this.labelNode_),this.dispatchEvent(lv)):(Bs(this.labelNode_,this.labelActiveNode_),this.dispatchEvent(dv)),e.updateSize())}setClassName_(e,t){t?(e.classList.remove(...this.inactiveClassName_),e.classList.add(...this.activeClassName_)):(e.classList.remove(...this.activeClassName_),e.classList.add(...this.inactiveClassName_))}setMap(e){const t=this.getMap();t&&t.removeChangeListener(Ls,this.boundHandleMapTargetChange_),super.setMap(e),this.handleMapTargetChange_(),e&&e.addChangeListener(Ls,this.boundHandleMapTargetChange_)}handleMapTargetChange_(){const e=this.documentListeners_;for(let t=0,n=e.length;t<n;++t)T(e[t]);e.length=0;const t=this.getMap();if(t){const n=t.getOwnerDocument();n0(n)?this.element.classList.remove(i4):this.element.classList.add(i4);for(let t=0,s=s0.length;t<s;++t)e.push(m(n,s0[t],this.handleFullScreenChange_,this));this.handleFullScreenChange_()}}},e.control.MousePosition=class extends Lt{constructor(e){e=e||{};const t=document.createElement("div");t.className=void 0!==e.className?e.className:"ol-mouse-position",super({element:t,render:e.render,target:e.target}),this.on,this.once,this.un,this.addChangeListener(Dl,this.handleProjectionChanged_),e.coordinateFormat&&this.setCoordinateFormat(e.coordinateFormat),e.projection&&this.setProjection(e.projection),this.renderOnMouseOut_=void 0!==e.placeholder,this.placeholder_=this.renderOnMouseOut_?e.placeholder:"&#160;",this.renderedHTML_=t.innerHTML,this.mapProjection_=null,this.transform_=null,this.wrapX_=!1!==e.wrapX}handleProjectionChanged_(){this.transform_=null}getCoordinateFormat(){return this.get(Y4)}getProjection(){return this.get(Dl)}handleMouseMove(e){const t=this.getMap();this.updateHTML_(t.getEventPixel(e))}handleMouseOut(){this.updateHTML_(null)}setMap(e){if(super.setMap(e),e){const t=e.getViewport();this.listenerKeys.push(m(t,Bc,this.handleMouseMove,this)),this.renderOnMouseOut_&&this.listenerKeys.push(m(t,Pg,this.handleMouseOut,this)),this.updateHTML_(null)}}setCoordinateFormat(e){this.set(Y4,e)}setProjection(e){this.set(Dl,d(e))}updateHTML_(e){let t=this.placeholder_;if(e&&this.mapProjection_){if(!this.transform_){const e=this.getProjection();this.transform_=e?De(this.mapProjection_,e):Ta}const n=this.getMap().getCoordinateFromPixelInternal(e);if(n){const e=le();e&&(this.transform_=De(this.mapProjection_,e)),this.transform_(n,n),this.wrapX_&&va(n,e||this.getProjection()||this.mapProjection_);const s=this.getCoordinateFormat();t=s?s(n):n.toString()}}this.renderedHTML_&&t===this.renderedHTML_||(this.element.innerHTML=t,this.renderedHTML_=t)}render(e){const t=e.frameState;t?this.mapProjection_!=t.viewState.projection&&(this.mapProjection_=t.viewState.projection,this.transform_=null):this.mapProjection_=null}},e.control.OverviewMap=class extends Lt{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target}),this.boundHandleRotationChanged_=this.handleRotationChanged_.bind(this),this.collapsed_=void 0===e.collapsed||e.collapsed,this.collapsible_=void 0===e.collapsible||e.collapsible,this.collapsible_||(this.collapsed_=!1),this.rotateWithView_=void 0!==e.rotateWithView&&e.rotateWithView,this.viewExtent_=void 0;const l=void 0!==e.className?e.className:"ol-overviewmap",u=void 0!==e.tipLabel?e.tipLabel:"Overview map",o=void 0!==e.collapseLabel?e.collapseLabel:"‹";"string"==typeof o?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=o):this.collapseLabel_=o;const s=void 0!==e.label?e.label:"›";"string"==typeof s?(this.label_=document.createElement("span"),this.label_.textContent=s):this.label_=s;const d=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_,t=document.createElement("button");t.setAttribute("type","button"),t.title=u,t.appendChild(d),t.addEventListener(Ht,this.handleClick_.bind(this),!1),this.ovmapDiv_=document.createElement("div"),this.ovmapDiv_.className="ol-overviewmap-map",this.view_=e.view;const n=new k8({view:e.view,controls:new me,interactions:new me});this.ovmap_=n,e.layers&&e.layers.forEach(function(e){n.addLayer(e)});const i=document.createElement("div");i.className="ol-overviewmap-box",i.style.boxSizing="border-box",this.boxOverlay_=new A8({position:[0,0],positioning:"center-center",element:i}),this.ovmap_.addOverlay(this.boxOverlay_);const h=l+" "+At+" "+En+(this.collapsed_&&this.collapsible_?" "+Ia:"")+(this.collapsible_?"":" ol-uncollapsible"),a=this.element;a.className=h,a.appendChild(this.ovmapDiv_),a.appendChild(t);const m=this,f=this.boxOverlay_,p=this.boxOverlay_.getElement(),r=function(e){const s={clientX:(t=e).clientX,clientY:t.clientY};var t;const o=n.getEventCoordinateInternal(s);f.setPosition(o)},c=function(e){const t=n.getEventCoordinateInternal(e);m.getMap().getView().setCenterInternal(t),window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",c)};p.addEventListener("mousedown",function(){window.addEventListener("mousemove",r),window.addEventListener("mouseup",c)})}setMap(e){const t=this.getMap();if(e!==t){if(t){const e=t.getView();e&&this.unbindView_(e),this.ovmap_.setTarget(null)}if(super.setMap(e),e){this.ovmap_.setTarget(this.ovmapDiv_),this.listenerKeys.push(m(e,Xn,this.handleMapPropertyChange_,this));const t=e.getView();t&&(this.bindView_(t),t.isDef()&&(this.ovmap_.updateSize(),this.resetExtent_())),this.ovmap_.isRendered()||this.updateBoxAfterOvmapIsRendered_()}}}handleMapPropertyChange_(e){if(e.key===lo){const t=e.oldValue;t&&this.unbindView_(t);const n=this.getMap().getView();this.bindView_(n)}else this.ovmap_.isRendered()||e.key!==Ls&&e.key!==Zc||this.ovmap_.updateSize()}bindView_(e){if(!this.view_){const t=new xt({projection:e.getProjection()});this.ovmap_.setView(t)}e.addChangeListener(Qe.ROTATION,this.boundHandleRotationChanged_),this.handleRotationChanged_()}unbindView_(e){e.removeChangeListener(Qe.ROTATION,this.boundHandleRotationChanged_)}handleRotationChanged_(){this.rotateWithView_&&this.ovmap_.getView().setRotation(this.getMap().getView().getRotation())}validateExtent_(){const n=this.getMap(),e=this.ovmap_;if(!n.isRendered()||!e.isRendered())return;const d=n.getSize(),t=n.getView().calculateExtentInternal(d);if(this.viewExtent_&&Ue(t,this.viewExtent_))return;this.viewExtent_=t;const s=e.getSize(),u=e.getView().calculateExtentInternal(s),o=e.getPixelFromCoordinateInternal(ht(t)),i=e.getPixelFromCoordinateInternal(Ws(t)),a=Math.abs(o[0]-i[0]),r=Math.abs(o[1]-i[1]),c=s[0],l=s[1];a<c*zl||r<l*zl||a>c*q4||r>l*q4?this.resetExtent_():xe(u,t)||this.recenter_()}resetExtent_(){const e=this.getMap(),n=this.ovmap_,s=e.getSize(),t=e.getView().calculateExtentInternal(s),o=n.getView(),i=Math.log(7.5)/Math.LN2;Rr(t,1/(Math.pow(2,i/2)*zl)),o.fitInternal(ps(t))}recenter_(){const e=this.getMap(),t=this.ovmap_,n=e.getView();t.getView().setCenterInternal(n.getCenterInternal())}updateBox_(){const n=this.getMap(),i=this.ovmap_;if(!n.isRendered()||!i.isRendered())return;const o=n.getSize(),t=n.getView(),r=i.getView(),c=this.rotateWithView_?0:-t.getRotation(),l=this.boxOverlay_,e=this.boxOverlay_.getElement(),d=t.getCenterInternal(),s=t.getResolution(),a=r.getResolution(),u=o[0]*s/a,h=o[1]*s/a;if(l.setPosition(d),e){e.style.width=u+"px",e.style.height=h+"px";const t="rotate("+c+"rad)";e.style.transform=t}}updateBoxAfterOvmapIsRendered_(){this.ovmapPostrenderKey_||(this.ovmapPostrenderKey_=Hs(this.ovmap_,Kc,function(){delete this.ovmapPostrenderKey_,this.updateBox_()},this))}handleClick_(e){e.preventDefault(),this.handleToggle_()}handleToggle_(){this.element.classList.toggle(Ia),this.collapsed_?Bs(this.collapseLabel_,this.label_):Bs(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_;const e=this.ovmap_;if(!this.collapsed_){if(e.isRendered())return this.viewExtent_=void 0,void e.render();e.updateSize(),this.resetExtent_(),this.updateBoxAfterOvmapIsRendered_()}}getCollapsible(){return this.collapsible_}setCollapsible(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),!e&&this.collapsed_&&this.handleToggle_())}setCollapsed(e){this.collapsible_&&this.collapsed_!==e&&this.handleToggle_()}getCollapsed(){return this.collapsed_}getRotateWithView(){return this.rotateWithView_}setRotateWithView(e){this.rotateWithView_!==e&&(this.rotateWithView_=e,0!==this.getMap().getView().getRotation()&&(this.rotateWithView_?this.handleRotationChanged_():this.ovmap_.getView().setRotation(0),this.viewExtent_=void 0,this.validateExtent_(),this.updateBox_()))}getOverviewMap(){return this.ovmap_}render(){this.validateExtent_(),this.updateBox_()}},e.control.Rotate=Lf,e.control.ScaleLine=class extends Lt{constructor(e){e=e||{};const t=document.createElement("div");t.style.pointerEvents="none",super({element:t,render:e.render,target:e.target}),this.on,this.once,this.un;const n=void 0!==e.className?e.className:e.bar?"ol-scale-bar":"ol-scale-line";this.innerElement_=document.createElement("div"),this.innerElement_.className=n+"-inner",this.element.className=n+" "+At,this.element.appendChild(this.innerElement_),this.viewState_=null,this.minWidth_=void 0!==e.minWidth?e.minWidth:64,this.maxWidth_=e.maxWidth,this.renderedVisible_=!1,this.renderedWidth_=void 0,this.renderedHTML_="",this.addChangeListener(Tl,this.handleUnitsChanged_),this.setUnits(e.units||"metric"),this.scaleBar_=e.bar||!1,this.scaleBarSteps_=e.steps||4,this.scaleBarText_=e.text||!1,this.dpi_=e.dpi||void 0}getUnits(){return this.get(Tl)}handleUnitsChanged_(){this.updateElement_()}setUnits(e){this.set(Tl,e)}setDpi(e){this.dpi_=e}updateElement_(){const r=this.viewState_;if(!r)return void(this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1));const p=r.center,v=r.projection,i=this.getUnits(),g="degrees"==i?"degrees":"m";let t=Na(v,r.resolution,p,g);const c=this.minWidth_*(this.dpi_||oi)/oi,f=void 0!==this.maxWidth_?this.maxWidth_*(this.dpi_||oi)/oi:void 0;let n=c*t,e="";if("degrees"==i){const s=rs.degrees;n*=s,n<s/60?(e="″",t*=3600):n<s?(e="′",t*=60):e="°"}else if("imperial"==i)n<.9144?(e="in",t/=.0254):n<1609.344?(e="ft",t/=.3048):(e="mi",t/=1609.344);else if("nautical"==i)t/=1852,e="NM";else if("metric"==i)n<1e-6?(e="nm",t*=1e9):n<.001?(e="μm",t*=1e6):n<1?(e="mm",t*=1e3):n<1e3?e="m":(e="km",t/=1e3);else{if("us"!=i)throw new Error("Invalid units");n<.9144?(e="in",t*=39.37):n<1609.344?(e="ft",t/=.30480061):(e="mi",t/=1609.3472)}let a,s,o,h,u,m,d=3*Math.floor(Math.log(c*t)/Math.log(10));for(;;){o=Math.floor(d/3);const e=Math.pow(10,o);if(a=jv[(d%3+3)%3]*e,s=Math.round(a/t),isNaN(s))return this.element.style.display="none",void(this.renderedVisible_=!1);if(void 0!==f&&s>=f){a=h,s=u,o=m;break}if(s>=c)break;h=a,u=s,m=o,++d}const l=this.scaleBar_?this.createScaleBar(s,a,e):a.toFixed(o<0?-o:0)+" "+e;this.renderedHTML_!=l&&(this.innerElement_.innerHTML=l,this.renderedHTML_=l),this.renderedWidth_!=s&&(this.innerElement_.style.width=s+"px",this.renderedWidth_=s),this.renderedVisible_||(this.element.style.display="",this.renderedVisible_=!0)}createScaleBar(e,t,n){const o=this.getScaleForResolution(),a=o<1?Math.round(1/o).toLocaleString()+" : 1":"1 : "+Math.round(o).toLocaleString(),s=this.scaleBarSteps_,r=e/s,i=[this.createMarker("absolute")];for(let o=0;o<s;++o){const a=o%2==0?"ol-scale-singlebar-odd":"ol-scale-singlebar-even";i.push(`<div><div class="ol-scale-singlebar ${a}" style="width: ${r}px;"></div>`+this.createMarker("relative")+(o%2==0||2===s?this.createStepText(o,e,!1,t,n):"")+"</div>")}return i.push(this.createStepText(s,e,!0,t,n)),(this.scaleBarText_?`<div class="ol-scale-text" style="width: ${e}px;">`+a+"</div>":"")+i.join("")}createMarker(e){return`<div class="ol-scale-step-marker" style="position: ${e}; top: ${"absolute"===e?3:-10}px;"></div>`}createStepText(e,t,n,s,o){const i=(0===e?0:Math.round(s/this.scaleBarSteps_*e*100)/100)+(0===e?"":" "+o);return`<div class="ol-scale-step-text" style="margin-left: ${0===e?-3:t/this.scaleBarSteps_*-1}px;text-align: ${0===e?"left":"center"};min-width: ${0===e?0:t/this.scaleBarSteps_*2}px;left: ${n?t+"px":"unset"};">`+i+"</div>"}getScaleForResolution(){return Na(this.viewState_.projection,this.viewState_.resolution,this.viewState_.center,"m")*(1e3/25.4)*(this.dpi_||oi)}render(e){const t=e.frameState;this.viewState_=t?t.viewState:null,this.updateElement_()}},e.control.Zoom=i6,e.control.ZoomSlider=class extends Lt{constructor(e){super({target:(e=e||{}).target,element:document.createElement("div"),render:e.render}),this.dragListenerKeys_=[],this.currentResolution_=void 0,this.direction_=H4,this.dragging_,this.heightLimit_=0,this.widthLimit_=0,this.startX_,this.startY_,this.thumbSize_=null,this.sliderInitialized_=!1,this.duration_=void 0!==e.duration?e.duration:200;const s=void 0!==e.className?e.className:"ol-zoomslider",n=document.createElement("button");n.setAttribute("type","button"),n.className=s+"-thumb "+At;const t=this.element;t.className=s+" "+At+" "+En,t.appendChild(n),t.addEventListener(ou,this.handleDraggerStart_.bind(this),!1),t.addEventListener(Bc,this.handleDraggerDrag_.bind(this),!1),t.addEventListener(Gm,this.handleDraggerEnd_.bind(this),!1),t.addEventListener(Ht,this.handleContainerClick_.bind(this),!1),n.addEventListener(Ht,R4,!1)}setMap(e){super.setMap(e),e&&e.render()}initSlider_(){const e=this.element;let t=e.offsetWidth,n=e.offsetHeight;if(0===t&&0===n)return this.sliderInitialized_=!1;const s=getComputedStyle(e);t-=parseFloat(s.paddingRight)+parseFloat(s.paddingLeft),n-=parseFloat(s.paddingTop)+parseFloat(s.paddingBottom);const i=e.firstElementChild,o=getComputedStyle(i),a=i.offsetWidth+parseFloat(o.marginRight)+parseFloat(o.marginLeft),r=i.offsetHeight+parseFloat(o.marginTop)+parseFloat(o.marginBottom);return this.thumbSize_=[a,r],t>n?(this.direction_=Ml,this.widthLimit_=t-a):(this.direction_=H4,this.heightLimit_=n-r),this.sliderInitialized_=!0}handleContainerClick_(e){const t=this.getMap().getView(),n=this.getRelativePosition_(e.offsetX-this.thumbSize_[0]/2,e.offsetY-this.thumbSize_[1]/2),s=this.getResolutionForPosition_(n),o=t.getConstrainedZoom(t.getZoomForResolution(s));t.animateInternal({zoom:o,duration:this.duration_,easing:Hn})}handleDraggerStart_(e){if(!this.dragging_&&e.target===this.element.firstElementChild){const t=this.element.firstElementChild;if(this.getMap().getView().beginInteraction(),this.startX_=e.clientX-parseFloat(t.style.left),this.startY_=e.clientY-parseFloat(t.style.top),this.dragging_=!0,0===this.dragListenerKeys_.length){const t=this.handleDraggerDrag_,n=this.handleDraggerEnd_,e=this.getMap().getOwnerDocument();this.dragListenerKeys_.push(m(e,Bc,t,this),m(e,Gm,n,this))}}}handleDraggerDrag_(e){if(this.dragging_){const t=e.clientX-this.startX_,n=e.clientY-this.startY_,s=this.getRelativePosition_(t,n);this.currentResolution_=this.getResolutionForPosition_(s),this.getMap().getView().setResolution(this.currentResolution_)}}handleDraggerEnd_(){this.dragging_&&(this.getMap().getView().endInteraction(),this.dragging_=!1,this.startX_=void 0,this.startY_=void 0,this.dragListenerKeys_.forEach(T),this.dragListenerKeys_.length=0)}setThumbPosition_(e){const t=this.getPositionForResolution_(e),n=this.element.firstElementChild;this.direction_==Ml?n.style.left=this.widthLimit_*t+"px":n.style.top=this.heightLimit_*t+"px"}getRelativePosition_(e,t){let n;return n=this.direction_===Ml?e/this.widthLimit_:t/this.heightLimit_,y(n,0,1)}getResolutionForPosition_(e){return this.getMap().getView().getResolutionForValueFunction()(1-e)}getPositionForResolution_(e){return y(1-this.getMap().getView().getValueForResolutionFunction()(e),0,1)}render(e){if(!e.frameState)return;if(!this.sliderInitialized_&&!this.initSlider_())return;const t=e.frameState.viewState.resolution;this.currentResolution_=t,this.setThumbPosition_(t)}},e.control.ZoomToExtent=class extends Lt{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target}),this.extent=e.extent?e.extent:null;const o=void 0!==e.className?e.className:"ol-zoom-extent",n=void 0!==e.label?e.label:"E",i=void 0!==e.tipLabel?e.tipLabel:"Fit to extent",t=document.createElement("button");t.setAttribute("type","button"),t.title=i,t.appendChild("string"==typeof n?document.createTextNode(n):n),t.addEventListener(Ht,this.handleClick_.bind(this),!1);const a=o+" "+At+" "+En,s=this.element;s.className=a,s.appendChild(t)}handleClick_(e){e.preventDefault(),this.handleZoomToExtent()}handleZoomToExtent(){const e=this.getMap().getView(),t=this.extent?Pe(this.extent,e.getProjection()):e.getProjection().getExtent();e.fitInternal(ps(t))}},e.control.defaults={},e.control.defaults.defaults=o6,e.coordinate={},e.coordinate.add=Jd,e.coordinate.closestOnCircle=o8,e.coordinate.closestOnSegment=ha,e.coordinate.createStringXY=function(e){return function(t){return t8(t,e)}},e.coordinate.degreesToStringHDMS=ga,e.coordinate.distance=Lo,e.coordinate.equals=at,e.coordinate.format=s8,e.coordinate.getWorldsAway=tu,e.coordinate.rotate=br,e.coordinate.scale=eu,e.coordinate.squaredDistance=nt,e.coordinate.squaredDistanceToSegment=vr,e.coordinate.toStringHDMS=function(e,t){return e?ga("NS",e[1],t)+" "+ga("EW",e[0],t):""},e.coordinate.toStringXY=t8,e.coordinate.wrapX=va,e.css={},e.css.CLASS_COLLAPSED=Ia,e.css.CLASS_CONTROL=En,e.css.CLASS_HIDDEN=Ra,e.css.CLASS_SELECTABLE=p0,e.css.CLASS_UNSELECTABLE=At,e.css.CLASS_UNSUPPORTED=i4,e.css.getFontParameters=I1,e.dom={},e.dom.createCanvasContext2D=K,e.dom.getSharedCanvasContext2D=Ei,e.dom.outerHeight=Y8,e.dom.outerWidth=$8,e.dom.releaseCanvas=zn,e.dom.removeChildren=ud,e.dom.removeNode=ki,e.dom.replaceChildren=hf,e.dom.replaceNode=Bs,e.easing={},e.easing.easeIn=Kl,e.easing.easeOut=Hn,e.easing.inAndOut=Wc,e.easing.linear=C3,e.easing.upAndDown=function(e){return e<.5?Wc(2*e):1-Wc(2*(e-.5))},e.events={},e.events.Event=ue,e.events.Event.preventDefault=function(e){e.preventDefault()},e.events.Event.stopPropagation=R4,e.events.SnapEvent={},e.events.SnapEvent.SnapEvent=Mm,e.events.Target=Ss,e.events.condition={},e.events.condition.all=vl,e.events.condition.altKeyOnly=U8,e.events.condition.altShiftKeysOnly=V8,e.events.condition.always=$s,e.events.condition.click=function(e){return e.type==C.CLICK},e.events.condition.doubleClick=function(e){return e.type==C.DBLCLICK},e.events.condition.focus=B8,e.events.condition.focusWithTabindex=rd,e.events.condition.mouseActionButton=od,e.events.condition.mouseOnly=Qs,e.events.condition.never=xl,e.events.condition.noModifierKeys=El,e.events.condition.penOnly=function(e){const t=e.originalEvent;return x(void 0!==t,"mapBrowserEvent must originate from a pointer event"),"pen"===t.pointerType},e.events.condition.platformModifierKey=P4,e.events.condition.platformModifierKeyOnly=function(e){const t=e.originalEvent;return!t.altKey&&(Ic?t.metaKey:t.ctrlKey)&&!t.shiftKey},e.events.condition.pointerMove=function(e){return"pointermove"==e.type},e.events.condition.primaryAction=Fl,e.events.condition.shiftKeyOnly=sa,e.events.condition.singleClick=Hl,e.events.condition.targetNotEditable=ju,e.events.condition.touchOnly=function(e){const t=e.originalEvent;return x(void 0!==t,"mapBrowserEvent must originate from a pointer event"),"touch"===t.pointerType},e.events.listen=m,e.events.listenOnce=Hs,e.events.unlistenByKey=T,e.expr={},e.expr.cpu={},e.expr.cpu.buildExpression=Wt,e.expr.cpu.newEvaluationContext=p5,e.expr.expression={},e.expr.expression.AnyType=Ee,e.expr.expression.BooleanType=Q,e.expr.expression.CallExpression=Uu,e.expr.expression.ColorType=B,e.expr.expression.LiteralExpression=jn,e.expr.expression.NoneType=Zn,e.expr.expression.NumberArrayType=be,e.expr.expression.NumberType=l,e.expr.expression.Ops=s,e.expr.expression.SizeType=ct,e.expr.expression.StringType=pe,e.expr.expression.computeGeometryType=Jr,e.expr.expression.includesType=H3,e.expr.expression.isType=Ho,e.expr.expression.newParsingContext=$r,e.expr.expression.overlapsType=vt,e.expr.expression.parse=V,e.expr.expression.typeName=fe,e.expr.gpu={},e.expr.gpu.PALETTE_TEXTURE_ARRAY=v1,e.expr.gpu.arrayToGlsl=ai,e.expr.gpu.buildExpression=I2,e.expr.gpu.colorToGlsl=gi,e.expr.gpu.getStringNumberEquivalent=ji,e.expr.gpu.newCompilationContext=G5,e.expr.gpu.numberToGlsl=ts,e.expr.gpu.sizeToGlsl=F2,e.expr.gpu.stringToGlsl=Zt,e.expr.gpu.uniformNameForVariable=tl,e.extent={},e.extent.applyTransform=Fs,e.extent.approximatelyEquals=Pf,e.extent.boundingExtent=oe,e.extent.buffer=Fe,e.extent.clone=_d,e.extent.closestSquaredDistanceXY=Gn,e.extent.containsCoordinate=qe,e.extent.containsExtent=xe,e.extent.containsXY=Zr,e.extent.coordinateRelationship=Qr,e.extent.createEmpty=If,e.extent.createOrUpdate=Ge,e.extent.createOrUpdateEmpty=mn,e.extent.createOrUpdateFromCoordinate=hs,e.extent.createOrUpdateFromCoordinates=function(e,t){return kd(mn(t),e)},e.extent.createOrUpdateFromFlatCoordinates=Gr,e.extent.createOrUpdateFromRings=function(e,t){return Tf(mn(t),e)},e.extent.equals=Ue,e.extent.extend=Cd,e.extent.extendCoordinate=vs,e.extent.extendCoordinates=kd,e.extent.extendFlatCoordinates=Td,e.extent.extendRings=Tf,e.extent.extendXY=Ff,e.extent.forEachCorner=Br,e.extent.getArea=Nn,e.extent.getBottomLeft=xn,e.extent.getBottomRight=Ws,e.extent.getCenter=_e,e.extent.getCorner=Mf,e.extent.getEnlargedArea=function(e,t){const n=Math.min(e[0],t[0]),s=Math.min(e[1],t[1]);return(Math.max(e[2],t[2])-n)*(Math.max(e[3],t[3])-s)},e.extent.getForViewAndSize=Po,e.extent.getHeight=W,e.extent.getIntersection=ce,e.extent.getIntersectionArea=function(e,t){return Nn(ce(e,t))},e.extent.getMargin=function(e){return b(e)+W(e)},e.extent.getRotatedViewport=Hr,e.extent.getSize=function(e){return[e[2]-e[0],e[3]-e[1]]},e.extent.getTopLeft=ht,e.extent.getTopRight=Rs,e.extent.getWidth=b,e.extent.intersects=U,e.extent.intersectsSegment=kf,e.extent.isEmpty=Ft,e.extent.returnOrUpdate=Sf,e.extent.scaleFromCenter=Rr,e.extent.wrapAndSliceX=Dr,e.extent.wrapX=Lr,e.featureloader={},e.featureloader.loadFeaturesXhr=Od,e.featureloader.setWithCredentials=function(e){Hf=e},e.featureloader.xhr=xd,e.format={},e.format.EsriJSON=class extends Ja{constructor(e){e=e||{},super(),this.geometryName_=e.geometryName}readFeatureFromObject(e,t,n){const o=e,i=Ym(o.geometry,t),s=new N;if(this.geometryName_&&s.setGeometryName(this.geometryName_),s.setGeometry(i),o.attributes){s.setProperties(o.attributes,!0);const e=o.attributes[n];void 0!==e&&s.setId(e)}return s}readFeaturesFromObject(e,t){if(t=t||{},e.features){const n=[],s=e.features;for(let o=0,i=s.length;o<i;++o)n.push(this.readFeatureFromObject(s[o],t,e.objectIdFieldName));return n}return[this.readFeatureFromObject(e,t)]}readGeometryFromObject(e,t){return Ym(e,t)}readProjectionFromObject(e){return e.spatialReference&&void 0!==e.spatialReference.wkid?d("EPSG:"+e.spatialReference.wkid):null}writeGeometryObject(e,t){return Qm(e,this.adaptOptions(t))}writeFeatureObject(e,t){t=this.adaptOptions(t);const n={};if(!e.hasProperties())return n.attributes={},n;const s=e.getProperties(),o=e.getGeometry();if(o){n.geometry=Qm(o,t);const i=t&&(t.dataProjection||t.featureProjection);i&&(n.geometry.spatialReference={wkid:Number(d(i).getCode().split(":").pop())}),delete s[e.getGeometryName()]}return it(s)?n.attributes={}:n.attributes=s,n}writeFeaturesObject(e,t){t=this.adaptOptions(t);const n=[];for(let s=0,o=e.length;s<o;++s)n.push(this.writeFeatureObject(e[s],t));return{features:n}}},e.format.Feature=xo,e.format.Feature.createGeometry=Xa,e.format.Feature.createRenderFeature=lu,e.format.Feature.transformExtentWithOptions=Ga,e.format.Feature.transformGeometryWithOptions=q,e.format.GML=qd,e.format.GML2=S,e.format.GML3=r,e.format.GML32=D,e.format.GMLBase=f,e.format.GMLBase.GMLNS=qt,e.format.GPX=class extends bs{constructor(e){super(),e=e||{},this.dataProjection=d("EPSG:4326"),this.readExtensions_=e.readExtensions}handleReadExtensions_(e){e||(e=[]);for(let t=0,s=e.length;t<s;++t){const n=e[t];if(this.readExtensions_){const e=n.get("extensionsNode_")||null;this.readExtensions_(n,e)}n.set("extensionsNode_",void 0)}}readMetadata(e){return e?"string"==typeof e?this.readMetadataFromDocument(et(e)):Xe(e)?this.readMetadataFromDocument(e):this.readMetadataFromNode(e):null}readMetadataFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType===Node.ELEMENT_NODE){const e=this.readMetadataFromNode(t);if(e)return e}return null}readMetadataFromNode(e){if(!te.includes(e.namespaceURI))return null;for(let t=e.firstElementChild;t;t=t.nextElementSibling)if(te.includes(t.namespaceURI)&&"metadata"===t.localName)return i({},Eg,t,[]);return null}readFeatureFromNode(e,t){if(!te.includes(e.namespaceURI))return null;const s=Fg[e.localName];if(!s)return null;const n=s(e,[this.getReadOptions(e,t)]);return n?(this.handleReadExtensions_([n]),n):null}readFeaturesFromNode(e,t){if(!te.includes(e.namespaceURI))return[];if("gpx"==e.localName){const n=i([],Mg,e,[this.getReadOptions(e,t)]);return n?(this.handleReadExtensions_(n),n):[]}return[]}writeFeaturesNode(e,t){t=this.adaptOptions(t);const n=w("http://www.topografix.com/GPX/1/1","gpx");return n.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xsi",Dn),n.setAttributeNS(Dn,"xsi:schemaLocation","http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd"),n.setAttribute("version","1.1"),n.setAttribute("creator","OpenLayers"),_({node:n},wg,Ep,e,[t]),n}},e.format.GeoJSON=class extends Ja{constructor(e){e=e||{},super(),this.dataProjection=d(e.dataProjection?e.dataProjection:"EPSG:4326"),e.featureProjection&&(this.defaultFeatureProjection=d(e.featureProjection)),e.featureClass&&(this.featureClass=e.featureClass),this.geometryName_=e.geometryName,this.extractGeometryName_=e.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(e,t){let n=null;n="Feature"===e.type?e:{type:"Feature",geometry:e,properties:null};const o=Ld(n.geometry);if(this.featureClass===Ce)return lu({geometry:o,id:n.id,properties:n.properties},t);const s=new N;return this.geometryName_?s.setGeometryName(this.geometryName_):this.extractGeometryName_&&n.geometry_name&&s.setGeometryName(n.geometry_name),s.setGeometry(Xa(o,t)),"id"in n&&s.setId(n.id),n.properties&&s.setProperties(n.properties,!0),s}readFeaturesFromObject(e,t){let n=null;if("FeatureCollection"===e.type){n=[];const s=e.features;for(let e=0,i=s.length;e<i;++e){const o=this.readFeatureFromObject(s[e],t);o&&n.push(o)}}else n=[this.readFeatureFromObject(e,t)];return n.flat()}readGeometryFromObject(e,t){return function(e,t){const n=Ld(e);return Xa(n,t)}(e,t)}readProjectionFromObject(e){const t=e.crs;let n;if(t)if("name"==t.type)n=d(t.properties.name);else{if("EPSG"!==t.type)throw new Error("Unknown SRS type");n=d("EPSG:"+t.properties.code)}else n=this.dataProjection;return n}writeFeatureObject(e,t){t=this.adaptOptions(t);const n={type:"Feature",geometry:null,properties:null},o=e.getId();if(void 0!==o&&(n.id=o),!e.hasProperties())return n;const s=e.getProperties(),i=e.getGeometry();return i&&(n.geometry=Nd(i,t),delete s[e.getGeometryName()]),it(s)||(n.properties=s),n}writeFeaturesObject(e,t){t=this.adaptOptions(t);const n=[];for(let s=0,o=e.length;s<o;++s)n.push(this.writeFeatureObject(e[s],t));return{type:"FeatureCollection",features:n}}writeGeometryObject(e,t){return Nd(e,this.adaptOptions(t))}},e.format.IGC=class extends Tr{constructor(e){super(),e=e||{},this.dataProjection=d("EPSG:4326"),this.altitudeMode_=e.altitudeMode?e.altitudeMode:"none",this.lad_=!1,this.lod_=!1,this.ladStart_=0,this.ladStop_=0,this.lodStart_=0,this.lodStop_=0}readFeatureFromText(e,t){const s=this.altitudeMode_,c=e.split(_p),l={},n=[];let o,d,i=2e3,a=0,r=1,u=-1;for(o=0,d=c.length;o<d;++o){const t=c[o];let e;if("B"==t.charAt(0)){if(e=Cp.exec(t),e){const d=parseInt(e[1],10),h=parseInt(e[2],10),m=parseInt(e[3],10);let o=parseInt(e[4],10)+parseInt(e[5],10)/6e4;this.lad_&&(o+=parseInt(t.slice(this.ladStart_,this.ladStop_),10)/6e4/10**(this.ladStop_-this.ladStart_)),"S"==e[6]&&(o=-o);let c=parseInt(e[7],10)+parseInt(e[8],10)/6e4;if(this.lod_&&(c+=parseInt(t.slice(this.lodStart_,this.lodStop_),10)/6e4/10**(this.lodStop_-this.lodStart_)),"W"==e[9]&&(c=-c),n.push(c,o),"none"!=s){let t;t="gps"==s?parseInt(e[11],10):"barometric"==s?parseInt(e[12],10):0,n.push(t)}let l=Date.UTC(i,a,r,d,h,m);l<u&&(l=Date.UTC(i,a,r+1,d,h,m)),n.push(l/1e3),u=l}}else if("H"==t.charAt(0))e=wp.exec(t),e?(r=parseInt(e[1],10),a=parseInt(e[2],10)-1,i=2e3+parseInt(e[3],10)):(e=Op.exec(t),e?(r=parseInt(e[1],10),a=parseInt(e[2],10)-1,i=2e3+parseInt(e[3],10)):(e=xp.exec(t),e&&(l[e[1]]=e[2].trim())));else if("I"==t.charAt(0)){const e=parseInt(t.slice(1,3),10);for(let n=0;n<e;n++){const s=t.slice(7+7*n,10+7*n);if("LAD"===s||"LOD"===s){const e=parseInt(t.slice(3+7*n,5+7*n),10)-1,o=parseInt(t.slice(5+7*n,7+7*n),10);"LAD"===s?(this.lad_=!0,this.ladStart_=e,this.ladStop_=o):"LOD"===s&&(this.lod_=!0,this.lodStart_=e,this.lodStop_=o)}}}}if(0===n.length)return null;const m=new ee(n,"none"==s?"XYM":"XYZM"),h=new N(q(m,!1,t));return h.setProperties(l,!0),h}readFeaturesFromText(e,t){const n=this.readFeatureFromText(e,t);return n?[n]:[]}},e.format.IIIFInfo=class{constructor(e){this.setImageInfo(e)}setImageInfo(e){this.imageInfo="string"==typeof e?JSON.parse(e):e}getImageApiVersion(){if(void 0===this.imageInfo)return;let e=this.imageInfo["@context"]||"ol-no-context";"string"==typeof e&&(e=[e]);for(let t=0;t<e.length;t++)switch(e[t]){case"http://library.stanford.edu/iiif/image-api/1.1/context.json":case"http://iiif.io/api/image/1/context.json":return _n;case"http://iiif.io/api/image/2/context.json":return ma;case"http://iiif.io/api/image/3/context.json":return zs;case"ol-no-context":if(this.getComplianceLevelEntryFromProfile(_n)&&this.imageInfo.identifier)return _n}x(!1,"Cannot determine IIIF Image API version from provided image information JSON")}getComplianceLevelEntryFromProfile(e){if(void 0!==this.imageInfo&&void 0!==this.imageInfo.profile)switch(void 0===e&&(e=this.getImageApiVersion()),e){case _n:if(q5.test(this.imageInfo.profile))return this.imageInfo.profile;break;case zs:if(Q5.test(this.imageInfo.profile))return this.imageInfo.profile;break;case ma:if("string"==typeof this.imageInfo.profile&&P2.test(this.imageInfo.profile))return this.imageInfo.profile;if(Array.isArray(this.imageInfo.profile)&&this.imageInfo.profile.length>0&&"string"==typeof this.imageInfo.profile[0]&&P2.test(this.imageInfo.profile[0]))return this.imageInfo.profile[0]}}getComplianceLevelFromProfile(e){const t=this.getComplianceLevelEntryFromProfile(e);if(void 0===t)return;const n=t.match(/level[0-2](?:\.json)?$/g);return Array.isArray(n)?n[0].replace(".json",""):void 0}getComplianceLevelSupportedFeatures(){if(void 0===this.imageInfo)return;const e=this.getImageApiVersion(),t=this.getComplianceLevelFromProfile(e);return void 0===t?Ts.none.none:Ts[e][t]}getTileSourceOptions(e){const n=e||{},s=this.getImageApiVersion();if(void 0===s)return;const t=void 0===s?void 0:hr[s](this);return void 0!==t?{url:t.url,version:s,size:[this.imageInfo.width,this.imageInfo.height],sizes:t.sizes,format:void 0!==n.format&&t.formats.includes(n.format)?n.format:void 0!==t.preferredFormat?t.preferredFormat:"jpg",supports:t.supports,quality:n.quality&&t.qualities.includes(n.quality)?n.quality:t.qualities.includes("native")?"native":"default",resolutions:Array.isArray(t.resolutions)?t.resolutions.sort(function(e,t){return t-e}):void 0,tileSize:t.tileSize}:void 0}},e.format.JSONFeature=Ja,e.format.KML=class extends bs{constructor(e){super(),e=e||{},ec||(ro=[255,255,255,1],ea=new ot({color:ro}),zd=[20,2],ni="pixels",na="pixels",ta=[64,64],Wr="https://maps.google.com/mapfiles/kml/pushpin/ylw-pushpin.png",Kr=new Vo({anchor:zd,anchorOrigin:"bottom-left",anchorXUnits:ni,anchorYUnits:na,crossOrigin:"anonymous",rotation:0,scale:tc(ta),size:ta,src:Wr}),Ad="NO_IMAGE",Yr=new Ze({color:ro,width:1}),Ed=new Ze({color:[51,51,51,1],width:2}),Bn=new Is({font:"bold 16px Helvetica",fill:ea,stroke:Ed,scale:.8}),wd=new ve({fill:ea,image:Kr,text:Bn,stroke:Yr,zIndex:0}),ec=[wd]),this.dataProjection=d("EPSG:4326"),this.defaultStyle_=e.defaultStyle?e.defaultStyle:ec,this.extractStyles_=void 0===e.extractStyles||e.extractStyles,this.writeStyles_=void 0===e.writeStyles||e.writeStyles,this.sharedStyles_={},this.showPointNames_=void 0===e.showPointNames||e.showPointNames,this.crossOrigin_=void 0!==e.crossOrigin?e.crossOrigin:"anonymous",this.iconUrlFunction_=e.iconUrlFunction?e.iconUrlFunction:Z6,this.supportedMediaTypes=["application/vnd.google-earth.kml+xml"]}readDocumentOrFolder_(e,t){const n=i([],o(p,{Document:fa(this.readDocumentOrFolder_,this),Folder:fa(this.readDocumentOrFolder_,this),Placemark:h(this.readPlacemark_,this),Style:this.readSharedStyle_.bind(this),StyleMap:this.readSharedStyleMap_.bind(this)}),e,t,this);if(n)return n}readPlacemark_(e,t){const n=i({geometry:null},fp,e,t,this);if(!n)return;const s=new N,a=e.getAttribute("id");null!==a&&s.setId(a);const r=t[0],o=n.geometry;if(o&&q(o,!1,r),s.setGeometry(o),delete n.geometry,this.extractStyles_){const e=function(e,t,n,s,o){return function(i){let r=o,l="",d=[];if(r){const e=i.getGeometry();if(e)if(e instanceof ge)d=e.getGeometriesArrayRecursive().filter(function(e){const t=e.getType();return"Point"===t||"MultiPoint"===t}),r=d.length>0;else{const t=e.getType();r="Point"===t||"MultiPoint"===t}}r&&(l=i.get("name"),r=r&&!!l,r&&/&[^&]+;/.test(l)&&(Xr||(Xr=document.createElement("textarea")),Xr.innerHTML=l,l=Xr.value));let c=n;if(e?c=e:t&&(c=Wf(t,n,s)),r){const e=function(e,t){const o=[0,0];let i="start";const s=e.getImage();if(s){const e=s.getSize();if(e&&2==e.length){const t=s.getScaleArray(),n=s.getAnchor();o[0]=t[0]*(e[0]-n[0]),o[1]=t[1]*(e[1]/2-n[1]),i="left"}}let n=e.getText();n?(n=n.clone(),n.setFont(n.getFont()||Bn.getFont()),n.setScale(n.getScale()||Bn.getScale()),n.setFill(n.getFill()||Bn.getFill()),n.setStroke(n.getStroke()||Ed)):n=Bn.clone(),n.setText(t),n.setOffsetX(o[0]),n.setOffsetY(o[1]),n.setTextAlign(i);const a=new ve({image:s,text:n});return a}(c[0],l);return d.length>0?(e.setGeometry(new ge(d)),[e,new ve({geometry:c[0].getGeometry(),image:null,fill:c[0].getFill(),stroke:c[0].getStroke(),text:null})].concat(c.slice(1))):e}return c}}(n.Style,n.styleUrl,this.defaultStyle_,this.sharedStyles_,this.showPointNames_);s.setStyle(e)}return delete n.Style,s.setProperties(n,!0),s}readSharedStyle_(e,t){const n=e.getAttribute("id");if(null!==n){const s=vd.call(this,e,t);if(s){let o,t=e.baseURI;t&&"about:blank"!=t||(t=window.location.href),t?o=new URL("#"+n,t).href:o="#"+n,this.sharedStyles_[o]=s}}}readSharedStyleMap_(e,t){const s=e.getAttribute("id");if(null===s)return;const i=Qf.call(this,e,t);if(!i)return;let o,n=e.baseURI;n&&"about:blank"!=n||(n=window.location.href),n?o=new URL("#"+s,n).href:o="#"+s,this.sharedStyles_[o]=i}readFeatureFromNode(e,t){if(!p.includes(e.namespaceURI))return null;const n=this.readPlacemark_(e,[this.getReadOptions(e,t)]);return n||null}readFeaturesFromNode(e,t){if(!p.includes(e.namespaceURI))return[];let n;const s=e.localName;if("Document"==s||"Folder"==s)return n=this.readDocumentOrFolder_(e,[this.getReadOptions(e,t)]),n||[];if("Placemark"==s){const n=this.readPlacemark_(e,[this.getReadOptions(e,t)]);return n?[n]:[]}if("kml"==s){n=[];for(let s=e.firstElementChild;s;s=s.nextElementSibling){const o=this.readFeaturesFromNode(s,t);o&&z(n,o)}return n}return[]}readName(e){if(e){if("string"==typeof e){const t=et(e);return this.readNameFromDocument(t)}return Xe(e)?this.readNameFromDocument(e):this.readNameFromNode(e)}}readNameFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE){const e=this.readNameFromNode(t);if(e)return e}}readNameFromNode(e){for(let t=e.firstElementChild;t;t=t.nextElementSibling)if(p.includes(t.namespaceURI)&&"name"==t.localName)return a(t);for(let t=e.firstElementChild;t;t=t.nextElementSibling){const n=t.localName;if(p.includes(t.namespaceURI)&&("Document"==n||"Folder"==n||"Placemark"==n||"kml"==n)){const e=this.readNameFromNode(t);if(e)return e}}}readNetworkLinks(e){const t=[];if("string"==typeof e){const n=et(e);z(t,this.readNetworkLinksFromDocument(n))}else Xe(e)?z(t,this.readNetworkLinksFromDocument(e)):z(t,this.readNetworkLinksFromNode(e));return t}readNetworkLinksFromDocument(e){const t=[];for(let n=e.firstChild;n;n=n.nextSibling)n.nodeType==Node.ELEMENT_NODE&&z(t,this.readNetworkLinksFromNode(n));return t}readNetworkLinksFromNode(e){const t=[];for(let n=e.firstElementChild;n;n=n.nextElementSibling)if(p.includes(n.namespaceURI)&&"NetworkLink"==n.localName){const e=i({},hp,n,[]);t.push(e)}for(let n=e.firstElementChild;n;n=n.nextElementSibling){const s=n.localName;!p.includes(n.namespaceURI)||"Document"!=s&&"Folder"!=s&&"kml"!=s||z(t,this.readNetworkLinksFromNode(n))}return t}readRegion(e){const t=[];if("string"==typeof e){const n=et(e);z(t,this.readRegionFromDocument(n))}else Xe(e)?z(t,this.readRegionFromDocument(e)):z(t,this.readRegionFromNode(e));return t}readRegionFromDocument(e){const t=[];for(let n=e.firstChild;n;n=n.nextSibling)n.nodeType==Node.ELEMENT_NODE&&z(t,this.readRegionFromNode(n));return t}readRegionFromNode(e){const t=[];for(let n=e.firstElementChild;n;n=n.nextElementSibling)if(p.includes(n.namespaceURI)&&"Region"==n.localName){const e=i({},xf,n,[]);t.push(e)}for(let n=e.firstElementChild;n;n=n.nextElementSibling){const s=n.localName;!p.includes(n.namespaceURI)||"Document"!=s&&"Folder"!=s&&"kml"!=s||z(t,this.readRegionFromNode(n))}return t}readCamera(e){const t=[];if("string"==typeof e){const n=et(e);z(t,this.readCameraFromDocument(n))}else Xe(e)?z(t,this.readCameraFromDocument(e)):z(t,this.readCameraFromNode(e));return t}readCameraFromDocument(e){const t=[];for(let n=e.firstChild;n;n=n.nextSibling)n.nodeType===Node.ELEMENT_NODE&&z(t,this.readCameraFromNode(n));return t}readCameraFromNode(e){const t=[];for(let n=e.firstElementChild;n;n=n.nextElementSibling)if(p.includes(n.namespaceURI)&&"Camera"===n.localName){const e=i({},p6,n,[]);t.push(e)}for(let n=e.firstElementChild;n;n=n.nextElementSibling){const s=n.localName;!p.includes(n.namespaceURI)||"Document"!==s&&"Folder"!==s&&"Placemark"!==s&&"kml"!==s||z(t,this.readCameraFromNode(n))}return t}writeFeaturesNode(e,t){t=this.adaptOptions(t);const n=w(p[4],"kml"),o="http://www.w3.org/2000/xmlns/";n.setAttributeNS(o,"xmlns:gx",sn[0]),n.setAttributeNS(o,"xmlns:xsi",Dn),n.setAttributeNS(Dn,"xsi:schemaLocation","http://www.opengis.net/kml/2.2 https://developers.google.com/kml/schema/kml22gx.xsd");const a={node:n},s={};e.length>1?s.Document=e:1==e.length&&(s.Placemark=e[0]);const i=op[n.namespaceURI],r=Ie(s,i);return _(a,tp,ye,r,[t],i,this),n}},e.format.KML.getDefaultFillStyle=function(){return ea},e.format.KML.getDefaultImageStyle=function(){return Kr},e.format.KML.getDefaultStrokeStyle=function(){return Yr},e.format.KML.getDefaultStyle=function(){return wd},e.format.KML.getDefaultStyleArray=function(){return ec},e.format.KML.getDefaultTextStyle=function(){return Bn},e.format.KML.readFlatCoordinates=jd,e.format.MVT=class extends xo{constructor(e){super(),e=e||{},this.dataProjection=new ns({code:"",units:"tile-pixels"}),this.featureClass=e.featureClass?e.featureClass:Ce,this.geometryName_=e.geometryName,this.layerName_=e.layerName?e.layerName:"layer",this.layers_=e.layers?e.layers:null,this.idProperty_=e.idProperty,this.supportedMediaTypes=["application/vnd.mapbox-vector-tile","application/x-protobuf"]}readRawGeometry_(e,t,n,s){e.pos=t.geometry;const d=e.readVarint()+e.pos;let a=1,r=0,c=0,l=0,o=0,i=0;for(;e.pos<d;){if(!r){const t=e.readVarint();a=7&t,r=t>>3}if(r--,1===a||2===a)c+=e.readSVarint(),l+=e.readSVarint(),1===a&&o>i&&(s.push(o),i=o),n.push(c,l),o+=2;else{if(7!==a)throw new Error("Invalid command found in the PBF");o>i&&(n.push(n[i],n[i+1]),o+=2)}}o>i&&(s.push(o),i=o)}createFeature_(e,t,n){const l=t.type;if(0===l)return null;let o;const r=t.properties;let c;this.idProperty_?(c=r[this.idProperty_],delete r[this.idProperty_]):c=t.id,r[this.layerName_]=t.layer.name;const s=[],i=[];this.readRawGeometry_(e,t,s,i);const a=function(e,t){let n;return 1===e?n=1===t?"Point":"MultiPoint":2===e?n=1===t?"LineString":"MultiLineString":3===e&&(n="Polygon"),n}(l,i.length);if(this.featureClass===Ce)o=new this.featureClass(a,s,i,2,r,c),o.transform(n.dataProjection);else{let e;if("Polygon"==a){const t=Pi(s,i);e=t.length>1?new Re(s,"XY",t):new ie(s,"XY",i)}else e="Point"===a?new Y(s,"XY"):"LineString"===a?new ee(s,"XY"):"MultiPoint"===a?new tt(s,"XY"):"MultiLineString"===a?new ke(s,"XY",i):null;o=new(0,this.featureClass),this.geometryName_&&o.setGeometryName(this.geometryName_);const t=q(e,!1,n);o.setGeometry(t),void 0!==c&&o.setId(c),o.setProperties(r,!0)}return o}getType(){return"arraybuffer"}readFeatures(e,t){const o=this.layers_,n=d((t=this.adaptOptions(t)).dataProjection);n.setWorldExtent(t.extent),t.dataProjection=n;const s=new K8(e),i=s.readFields(Ip,{}),a=[];for(const r in i){if(o&&!o.includes(r))continue;const e=i[r],c=e?[0,0,e.extent,e.extent]:null;n.setExtent(c);for(let n=0,i=e.length;n<i;++n){const r=$p(s,e,n),o=this.createFeature_(s,r,t);null!==o&&a.push(o)}}return a}readProjection(){return this.dataProjection}setLayers(e){this.layers_=e}},e.format.OSMXML=class extends bs{constructor(){super(),this.dataProjection=d("EPSG:4326")}readFeaturesFromNode(e,t){if(t=this.getReadOptions(e,t),"osm"==e.localName){const n=i({nodes:{},ways:[],features:[]},Kp,e,[t]);for(let o=0;o<n.ways.length;o++){const e=n.ways[o],s=e.flatCoordinates;if(!s.length)for(let t=0,o=e.ndrefs.length;t<o;t++)z(s,n.nodes[e.ndrefs[t]]);let i;i=e.ndrefs[0]==e.ndrefs[e.ndrefs.length-1]?new ie(s,"XY",[s.length]):new ee(s,"XY"),q(i,!1,t);const a=new N(i);void 0!==e.id&&a.setId(e.id),a.setProperties(e.tags,!0),n.features.push(a)}if(n.features)return n.features}return[]}},e.format.OWS=I8,e.format.Polyline=class extends Tr{constructor(e){super(),e=e||{},this.dataProjection=d("EPSG:4326"),this.factor_=e.factor?e.factor:1e5,this.geometryLayout_=e.geometryLayout?e.geometryLayout:"XY"}readFeatureFromText(e,t){const n=this.readGeometryFromText(e,t);return new N(n)}readFeaturesFromText(e,t){return[this.readFeatureFromText(e,t)]}readGeometryFromText(e,t){const s=mo(this.geometryLayout_),n=P8(e,s,this.factor_);uu(n,0,n.length,s,n);const o=Pt(n,0,n.length,s);return q(new ee(o,this.geometryLayout_),!1,this.adaptOptions(t))}writeFeatureText(e,t){const n=e.getGeometry();if(n)return this.writeGeometryText(n,t);throw new Error("Expected `feature` to have a geometry")}writeFeaturesText(e,t){return this.writeFeatureText(e[0],t)}writeGeometryText(e,t){const n=(e=q(e,!0,this.adaptOptions(t))).getFlatCoordinates(),s=e.getStride();return uu(n,0,n.length,s,n),H8(n,s,this.factor_)}},e.format.Polyline.decodeDeltas=P8,e.format.Polyline.decodeFloats=L8,e.format.Polyline.decodeSignedIntegers=D8,e.format.Polyline.decodeUnsignedIntegers=T8,e.format.Polyline.encodeDeltas=H8,e.format.Polyline.encodeFloats=R8,e.format.Polyline.encodeSignedIntegers=N8,e.format.Polyline.encodeUnsignedInteger=F8,e.format.Polyline.encodeUnsignedIntegers=z8,e.format.TextFeature=Tr,e.format.TopoJSON=class extends Ja{constructor(e){super(),e=e||{},this.layerName_=e.layerName,this.layers_=e.layers?e.layers:null,this.dataProjection=d(e.dataProjection?e.dataProjection:"EPSG:4326")}readFeaturesFromObject(e,t){if("Topology"==e.type){const n=e;let s,o=null,i=null;n.transform&&(s=n.transform,o=s.scale,i=s.translate);const l=n.arcs;s&&function(e,t,n){for(let s=0,o=e.length;s<o;++s)Kg(e[s],t,n)}(l,o,i);const a=[],r=n.objects,d=this.layerName_;let c;for(const e in r)this.layers_&&!this.layers_.includes(e)||("GeometryCollection"===r[e].type?(c=r[e],a.push.apply(a,Cg(c,l,o,i,d,e,t))):(c=r[e],a.push(S8(c,l,o,i,d,e,t))));return a}return[]}readProjectionFromObject(){return this.dataProjection}},e.format.WFS=class extends bs{constructor(e){super(),e=e||{},this.version_=e.version?e.version:"1.1.0",this.featureType_=e.featureType,this.featureNS_=e.featureNS,this.gmlFormat_=e.gmlFormat?e.gmlFormat:new Yl[this.version_],this.schemaLocation_=e.schemaLocation?e.schemaLocation:fh[this.version_]}getFeatureType(){return this.featureType_}setFeatureType(e){this.featureType_=e}readFeaturesFromNode(e,t){const n={node:e};Object.assign(n,{featureType:this.featureType_,featureNS:this.featureNS_}),Object.assign(n,this.getReadOptions(e,t||{}));const a=[n];let o;o="2.0.0"===this.version_?Yh:this.gmlFormat_.FEATURE_COLLECTION_PARSERS;let s=i([],o,e,a,this.gmlFormat_);return s||(s=[]),s}readTransactionResponse(e){if(e){if("string"==typeof e){const t=et(e);return this.readTransactionResponseFromDocument(t)}return Xe(e)?this.readTransactionResponseFromDocument(e):this.readTransactionResponseFromNode(e)}}readFeatureCollectionMetadata(e){if(e){if("string"==typeof e){const t=et(e);return this.readFeatureCollectionMetadataFromDocument(t)}return Xe(e)?this.readFeatureCollectionMetadataFromDocument(e):this.readFeatureCollectionMetadataFromNode(e)}}readFeatureCollectionMetadataFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFeatureCollectionMetadataFromNode(t)}readFeatureCollectionMetadataFromNode(e){const t={},n=Qt(e.getAttribute("numberOfFeatures"));return t.numberOfFeatures=n,i(t,Yh,e,[],this.gmlFormat_)}readTransactionResponseFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readTransactionResponseFromNode(t)}readTransactionResponseFromNode(e){return i({},o5,e,[])}writeGetFeature(e){const t=w(Xl[this.version_],"GetFeature");t.setAttribute("service","WFS"),t.setAttribute("version",this.version_),e.handle&&t.setAttribute("handle",e.handle),e.outputFormat&&t.setAttribute("outputFormat",e.outputFormat),void 0!==e.maxFeatures&&t.setAttribute("maxFeatures",String(e.maxFeatures)),e.resultType&&t.setAttribute("resultType",e.resultType),void 0!==e.startIndex&&t.setAttribute("startIndex",String(e.startIndex)),void 0!==e.count&&t.setAttribute("count",String(e.count)),void 0!==e.viewParams&&t.setAttribute("viewParams",e.viewParams),t.setAttributeNS(Dn,"xsi:schemaLocation",this.schemaLocation_);const n={node:t};if(Object.assign(n,{version:this.version_,srsName:e.srsName,featureNS:e.featureNS?e.featureNS:this.featureNS_,featurePrefix:e.featurePrefix,propertyNames:e.propertyNames?e.propertyNames:[]}),x(Array.isArray(e.featureTypes),"`options.featureTypes` must be an Array"),"string"==typeof e.featureTypes[0]){let s=e.filter;e.bbox&&(x(e.geometryName,"`options.geometryName` must also be provided when `options.bbox` is set"),s=this.combineBboxAndFilter(e.geometryName,e.bbox,e.srsName,s)),Object.assign(n,{geometryName:e.geometryName,filter:s}),U2(t,e.featureTypes,[n])}else e.featureTypes.forEach(s=>{const o=this.combineBboxAndFilter(s.geometryName,s.bbox,e.srsName,e.filter);Object.assign(n,{geometryName:s.geometryName,filter:o}),U2(t,[s.name],[n])});return t}combineBboxAndFilter(e,t,n,s){const o=Gh(e,t,n);return s?am(s,o):o}writeTransaction(e,t,n,s){const i=[],a=s.version?s.version:this.version_,o=w(Xl[a],"Transaction");let c;o.setAttribute("service","WFS"),o.setAttribute("version",a),s&&(c=s.gmlOptions?s.gmlOptions:{},s.handle&&o.setAttribute("handle",s.handle)),o.setAttributeNS(Dn,"xsi:schemaLocation",fh[a]);const r=function(e,t,n,s){const i=s.featurePrefix?s.featurePrefix:Vh;let o;"1.0.0"===n?o=2:"1.1.0"===n?o=3:"2.0.0"===n&&(o=3.2);const a=Object.assign({node:e},{version:n,featureNS:s.featureNS,featureType:s.featureType,featurePrefix:i,gmlVersion:o,hasZ:s.hasZ,srsName:s.srsName},t);return a}(o,c,a,s);return e&&Vc("Insert",e,i,r),t&&Vc("Update",t,i,r),n&&Vc("Delete",n,i,r),s.nativeElements&&Vc("Native",s.nativeElements,i,r),o}readProjectionFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readProjectionFromNode(t);return null}readProjectionFromNode(e){if(e.firstElementChild&&e.firstElementChild.firstElementChild)for(let t=(e=e.firstElementChild.firstElementChild).firstElementChild;t;t=t.nextElementSibling)if(0!==t.childNodes.length&&(1!==t.childNodes.length||3!==t.firstChild.nodeType)){const e=[{}];return this.gmlFormat_.readGeometryElement(t,e),d(e.pop().srsName)}return null}},e.format.WFS.writeFilter=function(e,t){const n=w(pi(t=t||"1.1.0"),"Filter"),s={node:n};return Object.assign(s,{version:t,filter:e}),O3(n,e,[s]),n},e.format.WKB=class extends xo{constructor(e){super(),e=e||{},this.splitCollection=Boolean(e.splitCollection),this.viewCache_=null,this.hex_=!1!==e.hex,this.littleEndian_=!1!==e.littleEndian,this.ewkb_=!1!==e.ewkb,this.layout_=e.geometryLayout,this.nodataZ_=e.nodataZ||0,this.nodataM_=e.nodataM||0,this.srid_=e.srid}getType(){return this.hex_?"text":"arraybuffer"}readFeature(e,t){return new N({geometry:this.readGeometry(e,t)})}readFeatures(e,t){let s=[];const n=this.readGeometry(e,t);return s=this.splitCollection&&n instanceof ge?n.getGeometriesArray():[n],s.map(e=>new N({geometry:e}))}readGeometry(e,t){const n=g2(e);if(!n)return null;const s=new w2(n).readGeometry();return this.viewCache_=n,t=this.getReadOptions(e,t),this.viewCache_=null,q(s,!1,t)}readProjection(e){const n=this.viewCache_||g2(e);if(!n)return;const t=new w2(n);return t.readWkbHeader(),t.getSrid()&&d("EPSG:"+t.getSrid())||void 0}writeFeature(e,t){return this.writeGeometry(e.getGeometry(),t)}writeFeatures(e,t){return this.writeGeometry(new ge(e.map(e=>e.getGeometry())),t)}writeGeometry(e,t){t=this.adaptOptions(t);const n=new s7({layout:this.layout_,littleEndian:this.littleEndian_,ewkb:this.ewkb_,nodata:{Z:this.nodataZ_,M:this.nodataM_}});let s=Number.isInteger(this.srid_)?Number(this.srid_):null;if(!1!==this.srid_&&!Number.isInteger(this.srid_)){const e=t.dataProjection&&d(t.dataProjection);if(e){const t=e.getCode();t.startsWith("EPSG:")&&(s=Number(t.substring(5)))}}n.writeGeometry(q(e,!0,t),s);const o=n.getBuffer();return this.hex_?function(e){const t=new Uint8Array(e);return Array.from(t.values()).map(e=>(e<16?"0":"")+Number(e).toString(16).toUpperCase()).join("")}(o):o}},e.format.WKT=class extends Tr{constructor(e){super(),e=e||{},this.splitCollection_=void 0!==e.splitCollection&&e.splitCollection}parse_(e){const t=new v7(e);return new b7(t).parse()}readFeatureFromText(e,t){const s=this.readGeometryFromText(e,t),n=new N;return n.setGeometry(s),n}readFeaturesFromText(e,t){let n=[];const s=this.readGeometryFromText(e,t);n=this.splitCollection_&&"GeometryCollection"==s.getType()?s.getGeometriesArray():[s];const o=[];for(let e=0,s=n.length;e<s;++e){const t=new N;t.setGeometry(n[e]),o.push(t)}return o}readGeometryFromText(e,t){return q(this.parse_(e),!1,t)}writeFeatureText(e,t){const n=e.getGeometry();return n?this.writeGeometryText(n,t):""}writeFeaturesText(e,t){if(1==e.length)return this.writeFeatureText(e[0],t);const n=[];for(let t=0,s=e.length;t<s;++t)n.push(e[t].getGeometry());const s=new ge(n);return this.writeGeometryText(s,t)}writeGeometryText(e,t){return H0(q(e,!0,t))}},e.format.WMSCapabilities=class extends Dc{constructor(){super(),this.version=void 0}readFromNode(e){this.version=e.getAttribute("version").trim();const t=i({version:this.version},C7,e,[]);return t||null}},e.format.WMSGetFeatureInfo=class extends bs{constructor(e){super(),e=e||{},this.featureNS_="http://mapserver.gis.umn.edu/mapserver",this.gmlFormat_=new S,this.layers_=e.layers?e.layers:null}getLayers(){return this.layers_}setLayers(e){this.layers_=e}readFeatures_(e,t){e.setAttribute("namespaceURI",this.featureNS_);const s=e.localName;let n=[];if(0===e.childNodes.length)return n;if("msGMLOutput"==s)for(let s=0,f=e.childNodes.length;s<f;s++){const c=e.childNodes[s];if(c.nodeType!==Node.ELEMENT_NODE)continue;const a=c,r=t[0],p="_layer",l=a.localName.replace(p,"");if(this.layers_&&!this.layers_.includes(l))continue;const d=l+"_feature";r.featureType=d,r.featureNS=this.featureNS_;const u={};u[d]=h(this.gmlFormat_.readFeatureElement,this.gmlFormat_);const g=o([r.featureNS,null],u);a.setAttribute("namespaceURI",this.featureNS_);const m=i([],g,a,t,this.gmlFormat_);m&&z(n,m)}if("FeatureCollection"==s){const t=i([],this.gmlFormat_.FEATURE_COLLECTION_PARSERS,e,[{}],this.gmlFormat_);t&&(n=t)}return n}readFeaturesFromNode(e,t){const n={};return t&&Object.assign(n,this.getReadOptions(e,t)),this.readFeatures_(e,[n])}},e.format.WMTSCapabilities=class extends Dc{constructor(){super(),this.owsParser_=new I8}readFromNode(e){let n=e.getAttribute("version");n&&(n=n.trim());let t=this.owsParser_.readFromNode(e);return t?(t.version=n,t=i(t,G7,e,[]),t||null):null}},e.format.XML=Dc,e.format.XMLFeature=bs,e.format.filter={},e.format.filter.And=C8,e.format.filter.Bbox=y8,e.format.filter.Comparison=Co,e.format.filter.ComparisonBinary=ls,e.format.filter.Contains=v8,e.format.filter.DWithin=g8,e.format.filter.Disjoint=p8,e.format.filter.During=Jm,e.format.filter.EqualTo=Km,e.format.filter.Filter=us,e.format.filter.GreaterThan=Bm,e.format.filter.GreaterThanOrEqualTo=Nm,e.format.filter.Intersects=Dm,e.format.filter.IsBetween=zm,e.format.filter.IsLike=Sm,e.format.filter.IsNull=km,e.format.filter.LessThan=Cm,e.format.filter.LessThanOrEqualTo=xm,e.format.filter.LogicalNary=Jl,e.format.filter.Not=_m,e.format.filter.NotEqualTo=bm,e.format.filter.Or=dm,e.format.filter.ResourceId=lm,e.format.filter.Spatial=Eo,e.format.filter.Within=rm,e.format.filter.and=am,e.format.filter.bbox=Gh,e.format.filter.between=function(e,t,n){return new zm(e,t,n)},e.format.filter.contains=function(e,t,n){return new v8(e,t,n)},e.format.filter.disjoint=function(e,t,n){return new p8(e,t,n)},e.format.filter.during=function(e,t,n){return new Jm(e,t,n)},e.format.filter.dwithin=function(e,t,n,s,o){return new g8(e,t,n,s,o)},e.format.filter.equalTo=function(e,t,n){return new Km(e,t,n)},e.format.filter.greaterThan=function(e,t){return new Bm(e,t)},e.format.filter.greaterThanOrEqualTo=function(e,t){return new Nm(e,t)},e.format.filter.intersects=function(e,t,n){return new Dm(e,t,n)},e.format.filter.isNull=function(e){return new km(e)},e.format.filter.lessThan=function(e,t){return new Cm(e,t)},e.format.filter.lessThanOrEqualTo=function(e,t){return new xm(e,t)},e.format.filter.like=function(e,t,n,s,o,i){return new Sm(e,t,n,s,o,i)},e.format.filter.not=function(e){return new _m(e)},e.format.filter.notEqualTo=function(e,t,n){return new bm(e,t,n)},e.format.filter.or=function(){const t=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(dm,t))},e.format.filter.resourceId=function(e){return new lm(e)},e.format.filter.within=function(e,t,n){return new rm(e,t,n)},e.format.xlink={},e.format.xlink.readHref=Cs,e.format.xsd={},e.format.xsd.readBoolean=vn,e.format.xsd.readBooleanString=Sn,e.format.xsd.readDateTime=ua,e.format.xsd.readDecimal=F,e.format.xsd.readDecimalString=Gt,e.format.xsd.readNonNegativeIntegerString=Qt,e.format.xsd.readPositiveInteger=ae,e.format.xsd.readString=a,e.format.xsd.writeBooleanTextNode=Zs,e.format.xsd.writeCDATASection=u8,e.format.xsd.writeDateTimeTextNode=h8,e.format.xsd.writeDecimalTextNode=Be,e.format.xsd.writeNonNegativeIntegerTextNode=ra,e.format.xsd.writeStringTextNode=j,e.functions={},e.functions.FALSE=Qn,e.functions.TRUE=Je,e.functions.VOID=is,e.functions.memoizeOne=Rl,e.functions.toPromise=yl,e.geom={},e.geom.Circle=Li,e.geom.Geometry=ur,e.geom.GeometryCollection=ge,e.geom.LineString=ee,e.geom.LinearRing=Tn,e.geom.MultiLineString=ke,e.geom.MultiPoint=tt,e.geom.MultiPolygon=Re,e.geom.Point=Y,e.geom.Polygon=ie,e.geom.Polygon.circular=V3,e.geom.Polygon.fromCircle=Ni,e.geom.Polygon.fromExtent=ps,e.geom.Polygon.makeRegular=Xu,e.geom.SimpleGeometry=jt,e.geom.SimpleGeometry.getLayoutForStride=Fn,e.geom.SimpleGeometry.getStrideForLayout=mo,e.geom.SimpleGeometry.transformGeom2D=Zh,e.geom.flat={},e.geom.flat.area={},e.geom.flat.area.linearRing=Ir,e.geom.flat.area.linearRings=Du,e.geom.flat.area.linearRingss=dh,e.geom.flat.center={},e.geom.flat.center.linearRingss=Ru,e.geom.flat.closest={},e.geom.flat.closest.arrayMaxSquaredDelta=gr,e.geom.flat.closest.assignClosestArrayPoint=_r,e.geom.flat.closest.assignClosestMultiArrayPoint=Bh,e.geom.flat.closest.assignClosestPoint=yr,e.geom.flat.closest.maxSquaredDelta=pr,e.geom.flat.closest.multiArrayMaxSquaredDelta=Xh,e.geom.flat.contains={},e.geom.flat.contains.linearRingContainsExtent=lh,e.geom.flat.contains.linearRingContainsXY=Pn,e.geom.flat.contains.linearRingsContainsXY=Ur,e.geom.flat.contains.linearRingssContainsXY=ch,e.geom.flat.deflate={},e.geom.flat.deflate.deflateCoordinate=wu,e.geom.flat.deflate.deflateCoordinates=io,e.geom.flat.deflate.deflateCoordinatesArray=oo,e.geom.flat.deflate.deflateMultiCoordinatesArray=xu,e.geom.flat.flip={},e.geom.flat.flip.flipXY=uu,e.geom.flat.geodesic={},e.geom.flat.geodesic.greatCircleArc=function(e,t,n,s,o,i){const m=d("EPSG:4326"),a=Math.cos(we(t)),r=Math.sin(we(t)),c=Math.cos(we(s)),l=Math.sin(we(s)),u=Math.cos(we(n-e)),f=Math.sin(we(n-e)),h=r*l+a*c*u;return Ou(function(t){if(1<=h)return[n,s];const o=t*Math.acos(h),i=Math.cos(o),d=Math.sin(o),g=f*c,v=a*l-r*c*u,m=Math.atan2(g,v),p=Math.asin(r*i+a*d*Math.cos(m));return[ca(we(e)+Math.atan2(Math.sin(m)*d*a,i-r*Math.sin(p))),ca(p)]},pt(m,o),i)},e.geom.flat.geodesic.meridian=Nh,e.geom.flat.geodesic.parallel=Lh,e.geom.flat.inflate={},e.geom.flat.inflate.inflateCoordinates=Pt,e.geom.flat.inflate.inflateCoordinatesArray=eo,e.geom.flat.inflate.inflateMultiCoordinatesArray=Pr,e.geom.flat.interiorpoint={},e.geom.flat.interiorpoint.getInteriorPointOfArray=qr,e.geom.flat.interiorpoint.getInteriorPointsOfMultiArray=Lu,e.geom.flat.interpolate={},e.geom.flat.interpolate.interpolatePoint=Hi,e.geom.flat.interpolate.lineStringCoordinateAtM=cc,e.geom.flat.interpolate.lineStringsCoordinateAtM=jh,e.geom.flat.intersectsextent={},e.geom.flat.intersectsextent.intersectsLineString=Qi,e.geom.flat.intersectsextent.intersectsLineStringArray=th,e.geom.flat.intersectsextent.intersectsLinearRing=Bu,e.geom.flat.intersectsextent.intersectsLinearRingArray=Ku,e.geom.flat.intersectsextent.intersectsLinearRingMultiArray=K3,e.geom.flat.length={},e.geom.flat.length.lineStringLength=rc,e.geom.flat.length.linearRingLength=function(e,t,n,s){let o=rc(e,t,n,s);const i=e[n-s]-e[t],a=e[n-s+1]-e[t+1];return o+=Math.sqrt(i*i+a*a),o},e.geom.flat.orient={},e.geom.flat.orient.inflateEnds=Pi,e.geom.flat.orient.linearRingIsClockwise=Ki,e.geom.flat.orient.linearRingsAreOriented=ac,e.geom.flat.orient.linearRingssAreOriented=qu,e.geom.flat.orient.orientLinearRings=Wi,e.geom.flat.orient.orientLinearRingsArray=fc,e.geom.flat.reverse={},e.geom.flat.reverse.coordinates=U3,e.geom.flat.segments={},e.geom.flat.segments.forEach=Pu,e.geom.flat.simplify={},e.geom.flat.simplify.douglasPeucker=so,e.geom.flat.simplify.douglasPeuckerArray=Er,e.geom.flat.simplify.douglasPeuckerMultiArray=function(e,t,n,s,o,i,a,r){for(let c=0,u=n.length;c<u;++c){const l=n[c],d=[];a=Er(e,t,l,s,o,i,a,d),r.push(d),t=l[l.length-1]}return a},e.geom.flat.simplify.quantize=wh,e.geom.flat.simplify.quantizeArray=Fr,e.geom.flat.simplify.quantizeMultiArray=vh,e.geom.flat.simplify.radialDistance=Mh,e.geom.flat.simplify.simplifyLineString=function(e,t,n,s,o,i,a){return a=void 0!==a?a:[],i||(n=Mh(e,t,n,s,o,a,0),e=a,t=0,s=2),a.length=so(e,t,n,s,o,a,0),a},e.geom.flat.simplify.snap=qn,e.geom.flat.straightchunk={},e.geom.flat.straightchunk.matchingChunk=eh,e.geom.flat.textpath={},e.geom.flat.textpath.drawTextOnPath=ih,e.geom.flat.topology={},e.geom.flat.topology.lineStringIsClosed=function(e,t,n,s){const o=n-s;return e[t]===e[o]&&e[t+1]===e[o+1]&&(n-t)/s>3&&!!Ir(e,t,n,s)},e.geom.flat.transform={},e.geom.flat.transform.rotate=or,e.geom.flat.transform.scale=im,e.geom.flat.transform.transform2D=bt,e.geom.flat.transform.translate=nm,e.has={},e.has.CREATE_IMAGE_BITMAP=M8,e.has.DEVICE_PIXEL_RATIO=Hc,e.has.FIREFOX=rh,e.has.IMAGE_DECODE=Pc,e.has.MAC=Ic,e.has.PASSIVE_EVENT_LISTENERS=cd,e.has.SAFARI=qm,e.has.SAFARI_BUG_237906=e8,e.has.WEBKIT=j8,e.has.WORKER_OFFSCREEN_CANVAS=ed,e.interaction={},e.interaction.DblClickDragZoom=class extends Rt{constructor(e){const t=e||{};super(t),t.stopDown&&(this.stopDown=t.stopDown),this.scaleDeltaByPixel_=t.delta?t.delta:.01,this.duration_=void 0!==t.duration?t.duration:250,this.handlingDownUpSequence_=!1,this.handlingDoubleDownSequence_=!1,this.doubleTapTimeoutId_=void 0,this.trackedPointers_={},this.targetPointers=[]}handleEvent(e){if(!e.originalEvent)return!0;let t=!1;if(this.updateTrackedPointers_(e),this.handlingDownUpSequence_){if(e.type==C.POINTERDRAG)this.handleDragEvent(e),e.originalEvent.preventDefault();else if(e.type==C.POINTERUP){const t=this.handleUpEvent(e);this.handlingDownUpSequence_=t}}else if(e.type==C.POINTERDOWN)if(this.handlingDoubleDownSequence_){this.handlingDoubleDownSequence_=!1;const n=this.handleDownEvent(e);this.handlingDownUpSequence_=n,t=this.stopDown(n)}else t=this.stopDown(!1),this.waitForDblTap_();return!t}handleDragEvent(e){let t=1;const o=this.targetPointers[0],i=this.down_.originalEvent,n=o.clientY-i.clientY;void 0!==this.lastDistance_&&(t=1-(this.lastDistance_-n)*this.scaleDeltaByPixel_),this.lastDistance_=n,1!=t&&(this.lastScaleDelta_=t);const s=e.map,a=s.getView();s.render(),a.adjustResolutionInternal(t)}handleDownEvent(e){if(1==this.targetPointers.length){const t=e.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.down_=e,this.handlingDownUpSequence_||t.getView().beginInteraction(),!0}return!1}handleUpEvent(e){if(0==this.targetPointers.length){const t=e.map.getView(),n=this.lastScaleDelta_>1?1:-1;return t.endInteraction(this.duration_,n),this.handlingDownUpSequence_=!1,this.handlingDoubleDownSequence_=!1,!1}return!0}stopDown(e){return e}updateTrackedPointers_(e){if(function(e){const t=e.type;return t===C.POINTERDOWN||t===C.POINTERDRAG||t===C.POINTERUP}(e)){const n=e.originalEvent,t=n.pointerId.toString();e.type==C.POINTERUP?delete this.trackedPointers_[t]:(e.type==C.POINTERDOWN||t in this.trackedPointers_)&&(this.trackedPointers_[t]=n),this.targetPointers=Object.values(this.trackedPointers_)}}waitForDblTap_(){void 0!==this.doubleTapTimeoutId_?(clearTimeout(this.doubleTapTimeoutId_),this.doubleTapTimeoutId_=void 0):(this.handlingDoubleDownSequence_=!0,this.doubleTapTimeoutId_=setTimeout(this.endInteraction_.bind(this),250))}endInteraction_(){this.handlingDoubleDownSequence_=!1,this.doubleTapTimeoutId_=void 0}},e.interaction.DoubleClickZoom=gf,e.interaction.DragAndDrop=class extends Rt{constructor(e){e=e||{},super({handleEvent:Je}),this.on,this.once,this.un,this.readAsBuffer_=!1,this.formats_=[];const t=e.formatConstructors?e.formatConstructors:[];for(let n=0,s=t.length;n<s;++n){let e=t[n];"function"==typeof e&&(e=new e),this.formats_.push(e),this.readAsBuffer_=this.readAsBuffer_||"arraybuffer"===e.getType()}this.projection_=e.projection?d(e.projection):null,this.dropListenKeys_=null,this.source_=e.source||null,this.target=e.target?e.target:null}handleResult_(e,t){const o=t.target.result,a=this.getMap();let s,n=this.projection_;!n&&(n=le(),!n)&&(n=a.getView().getProjection());const i=this.formats_;for(let a=0,l=i.length;a<l;++a){const r=i[a];let c=o;this.readAsBuffer_&&"arraybuffer"!==r.getType()&&(void 0===s&&(s=(new TextDecoder).decode(o)),c=s);const t=this.tryReadFeatures_(r,c,{featureProjection:n});if(t&&t.length>0){this.source_&&(this.source_.clear(),this.source_.addFeatures(t)),this.dispatchEvent(new Kh(a5,e,t,n));break}}}registerListeners_(){const e=this.getMap();if(e){const t=this.target?this.target:e.getViewport();this.dropListenKeys_=[m(t,H2,this.handleDrop,this),m(t,d7,this.handleStop,this),m(t,Y5,this.handleStop,this),m(t,H2,this.handleStop,this)]}}setActive(e){!this.getActive()&&e&&this.registerListeners_(),this.getActive()&&!e&&this.unregisterListeners_(),super.setActive(e)}setMap(e){this.unregisterListeners_(),super.setMap(e),this.getActive()&&this.registerListeners_()}tryReadFeatures_(e,t,n){try{return e.readFeatures(t,n)}catch{return null}}unregisterListeners_(){this.dropListenKeys_&&(this.dropListenKeys_.forEach(T),this.dropListenKeys_=null)}handleDrop(e){const t=e.dataTransfer.files;for(let e=0,o=t.length;e<o;++e){const n=t.item(e),s=new FileReader;s.addEventListener(W2,this.handleResult_.bind(this,n)),this.readAsBuffer_?s.readAsArrayBuffer(n):s.readAsText(n)}}handleStop(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"}},e.interaction.DragAndDrop.DragAndDropEvent=Kh,e.interaction.DragBox=G0,e.interaction.DragBox.DragBoxEvent=ri,e.interaction.DragPan=V4,e.interaction.DragRotate=W4,e.interaction.DragRotateAndZoom=class extends lt{constructor(e){super(e=e||{}),this.condition_=e.condition?e.condition:sa,this.lastAngle_=void 0,this.lastMagnitude_=void 0,this.lastScaleDelta_=0,this.duration_=void 0!==e.duration?e.duration:400}handleDragEvent(e){if(!Qs(e))return;const o=e.map,i=o.getSize(),a=e.pixel,t=a[0]-i[0]/2,n=i[1]/2-a[1],r=Math.atan2(n,t),s=Math.sqrt(t*t+n*n),c=o.getView();if(void 0!==this.lastAngle_){const e=this.lastAngle_-r;c.adjustRotationInternal(e)}this.lastAngle_=r,void 0!==this.lastMagnitude_&&c.adjustResolutionInternal(this.lastMagnitude_/s),void 0!==this.lastMagnitude_&&(this.lastScaleDelta_=this.lastMagnitude_/s),this.lastMagnitude_=s}handleUpEvent(e){if(!Qs(e))return!0;const t=e.map.getView(),n=this.lastScaleDelta_>1?1:-1;return t.endInteraction(this.duration_,n),this.lastScaleDelta_=0,!1}handleDownEvent(e){return!!Qs(e)&&!!this.condition_(e)&&(e.map.getView().beginInteraction(),this.lastAngle_=void 0,this.lastMagnitude_=void 0,!0)}},e.interaction.DragZoom=z2,e.interaction.Draw=class extends lt{constructor(e){const n=e;n.stopDown||(n.stopDown=Qn),super(n),this.on,this.once,this.un,this.shouldHandle_=!1,this.downPx_=null,this.downTimeout_,this.lastDragTime_,this.pointerType_,this.freehand_=!1,this.source_=e.source?e.source:null,this.features_=e.features?e.features:null,this.snapTolerance_=e.snapTolerance?e.snapTolerance:12,this.type_=e.type,this.mode_=function(e){switch(e){case"Point":case"MultiPoint":return"Point";case"LineString":case"MultiLineString":return"LineString";case"Polygon":case"MultiPolygon":return"Polygon";case"Circle":return"Circle";default:throw new Error("Invalid type: "+e)}}(this.type_),this.stopClick_=!!e.stopClick,this.minPoints_=e.minPoints?e.minPoints:"Polygon"===this.mode_?3:2,this.maxPoints_="Circle"===this.mode_?2:e.maxPoints?e.maxPoints:1/0,this.finishCondition_=e.finishCondition?e.finishCondition:Je,this.geometryLayout_=e.geometryLayout?e.geometryLayout:"XY";let t=e.geometryFunction;if(!t){const e=this.mode_;if("Circle"===e)t=function(e,t,n){const s=t||new Li([NaN,NaN]),o=I(e[0],n),a=nt(o,I(e[e.length-1],n));s.setCenterAndRadius(o,Math.sqrt(a),this.geometryLayout_);const i=le();return i&&s.transform(n,i),s};else{let n;"Point"===e?n=Y:"LineString"===e?n=ee:"Polygon"===e&&(n=ie),t=function(t,s){return s?"Polygon"===e?t[0].length?s.setCoordinates([t[0].concat([t[0][0]])],this.geometryLayout_):s.setCoordinates([],this.geometryLayout_):s.setCoordinates(t,this.geometryLayout_):s=new n(t,this.geometryLayout_),s}}}this.geometryFunction_=t,this.dragVertexDelay_=void 0!==e.dragVertexDelay?e.dragVertexDelay:500,this.finishCoordinate_=null,this.sketchFeature_=null,this.sketchPoint_=null,this.sketchCoords_=null,this.sketchLine_=null,this.sketchLineCoords_=null,this.squaredClickTolerance_=e.clickTolerance?e.clickTolerance*e.clickTolerance:36,this.overlay_=new Us({source:new ws({useSpatialIndex:!1,wrapX:!!e.wrapX&&e.wrapX}),style:e.style?e.style:e5(),updateWhileInteracting:!0}),this.geometryName_=e.geometryName,this.condition_=e.condition?e.condition:El,this.freehandCondition_,e.freehand?this.freehandCondition_=$s:this.freehandCondition_=e.freehandCondition?e.freehandCondition:sa,this.traceCondition_,this.setTrace(e.trace||!1),this.traceState_={active:!1},this.traceSource_=e.traceSource||e.source||null,this.addChangeListener(hi,this.updateState_)}setTrace(e){let t;t=e?!0===e?$s:e:xl,this.traceCondition_=t}setMap(e){super.setMap(e),this.updateState_()}getOverlay(){return this.overlay_}handleEvent(e){e.originalEvent.type===Il&&e.originalEvent.preventDefault(),this.freehand_="Point"!==this.mode_&&this.freehandCondition_(e);let n=e.type===C.POINTERMOVE,t=!0;return!this.freehand_&&this.lastDragTime_&&e.type===C.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=e.pixel,this.shouldHandle_=!this.freehand_,n=!0):this.lastDragTime_=void 0,this.shouldHandle_&&void 0!==this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0)),this.freehand_&&e.type===C.POINTERDRAG&&null!==this.sketchFeature_?(this.addToDrawing_(e.coordinate),t=!1):this.freehand_&&e.type===C.POINTERDOWN?t=!1:n&&this.getPointerCount()<2?(t=e.type===C.POINTERMOVE,t&&this.freehand_?(this.handlePointerMove_(e),this.shouldHandle_&&e.originalEvent.preventDefault()):("mouse"===e.originalEvent.pointerType||e.type===C.POINTERDRAG&&void 0===this.downTimeout_)&&this.handlePointerMove_(e)):e.type===C.DBLCLICK&&(t=!1),super.handleEvent(e)&&t}handleDownEvent(e){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=e.pixel,this.finishCoordinate_||this.startDrawing_(e.coordinate),!0):this.condition_(e)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(()=>{this.handlePointerMove_(new It(C.POINTERMOVE,e.map,e.originalEvent,!1,e.frameState))},this.dragVertexDelay_),this.downPx_=e.pixel,!0):(this.lastDragTime_=void 0,!1)}deactivateTrace_(){this.traceState_={active:!1}}toggleTraceState_(e){if(!this.traceSource_||!this.traceCondition_(e))return;if(this.traceState_.active)return void this.deactivateTrace_();const t=this.getMap(),o=oe([t.getCoordinateFromPixel([e.pixel[0]-this.snapTolerance_,e.pixel[1]+this.snapTolerance_]),t.getCoordinateFromPixel([e.pixel[0]+this.snapTolerance_,e.pixel[1]-this.snapTolerance_])]),n=this.traceSource_.getFeaturesInExtent(o);if(0===n.length)return;const s=function(e,t){const n=[];for(let s=0;s<t.length;++s)em(e,t[s].getGeometry(),n);return n}(e.coordinate,n);s.length&&(this.traceState_={active:!0,startPx:e.pixel.slice(),targets:s,targetIndex:-1})}addOrRemoveTracedCoordinates_(e,t){const n=e.startIndex<=e.endIndex;n===e.startIndex<=t?n&&t>e.endIndex||!n&&t<e.endIndex?this.addTracedCoordinates_(e,e.endIndex,t):(n&&t<e.endIndex||!n&&t>e.endIndex)&&this.removeTracedCoordinates_(t,e.endIndex):(this.removeTracedCoordinates_(e.startIndex,e.endIndex),this.addTracedCoordinates_(e,e.startIndex,t))}removeTracedCoordinates_(e,t){if(e===t)return;let n=0;if(e<t){const o=Math.ceil(e);let s=Math.floor(t);s===t&&(s-=1),n=s-o+1}else{const o=Math.floor(e);let s=Math.ceil(t);s===t&&(s+=1),n=o-s+1}n>0&&this.removeLastPoints_(n)}addTracedCoordinates_(e,t,n){if(t===n)return;const s=[];if(t<n){const i=Math.ceil(t);let o=Math.floor(n);o===n&&(o-=1);for(let t=i;t<=o;++t)s.push(ho(e.coordinates,t))}else{const i=Math.floor(t);let o=Math.ceil(n);o===n&&(o+=1);for(let t=i;t>=o;--t)s.push(ho(e.coordinates,t))}s.length&&this.appendCoordinates(s)}updateTrace_(e){const t=this.traceState_;if(!t.active)return;if(-1===t.targetIndex&&Lo(t.startPx,e.pixel)<this.snapTolerance_)return;const n=function(e,t,n,s){const l=e[0],d=e[1];let c=1/0,i=-1,o=NaN;for(let s=0;s<t.targets.length;++s){const e=t.targets[s],a=e.coordinates;let n,r=1/0;for(let e=0;e<a.length-1;++e){const t=om(l,d,a[e],a[e+1]);t.squaredDistance<r&&(r=t.squaredDistance,n=e+t.along)}r<c&&(c=r,e.ring&&t.targetIndex===s&&(e.endIndex>e.startIndex?n<e.startIndex&&(n+=a.length):e.endIndex<e.startIndex&&n>e.startIndex&&(n-=a.length)),o=n,i=s)}const a=t.targets[i];let r=a.ring;if(t.targetIndex===i&&r){const e=Js(a.coordinates,o);Lo(n.getPixelFromCoordinate(e),t.startPx)>s&&(r=!1)}if(r){const e=a.coordinates,s=e.length,t=a.startIndex,n=o;if(t<n){const i=lr(e,t,n);lr(e,t,n-s)<i&&(o-=s)}else{const i=lr(e,t,n);lr(e,t,n+s)<i&&(o+=s)}}return bu.index=i,bu.endIndex=o,bu}(e.coordinate,t,this.getMap(),this.snapTolerance_);if(t.targetIndex!==n.index){if(-1!==t.targetIndex){const e=t.targets[t.targetIndex];this.removeTracedCoordinates_(e.startIndex,e.endIndex)}const e=t.targets[n.index];this.addTracedCoordinates_(e,e.startIndex,n.endIndex)}else{const e=t.targets[t.targetIndex];this.addOrRemoveTracedCoordinates_(e,n.endIndex)}t.targetIndex=n.index;const s=t.targets[t.targetIndex];s.endIndex=n.endIndex;const o=Js(s.coordinates,s.endIndex),i=this.getMap().getPixelFromCoordinate(o);e.coordinate=o,e.pixel=[Math.round(i[0]),Math.round(i[1])]}handleUpEvent(e){let t=!0;if(0===this.getPointerCount()){this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(e);const n=this.traceState_.active;if(this.toggleTraceState_(e),this.shouldHandle_){const s=!this.finishCoordinate_;s&&this.startDrawing_(e.coordinate),!s&&this.freehand_?this.finishDrawing():this.freehand_||s&&"Point"!==this.mode_||(this.atFinish_(e.pixel,n)?this.finishCondition_(e)&&this.finishDrawing():this.addToDrawing_(e.coordinate)),t=!1}else this.freehand_&&this.abortDrawing()}return!t&&this.stopClick_&&e.preventDefault(),t}handlePointerMove_(e){if(this.pointerType_=e.originalEvent.pointerType,this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){const t=this.downPx_,n=e.pixel,s=t[0]-n[0],o=t[1]-n[1],i=s*s+o*o;if(this.shouldHandle_=this.freehand_?i>this.squaredClickTolerance_:i<=this.squaredClickTolerance_,!this.shouldHandle_)return}this.finishCoordinate_?(this.updateTrace_(e),this.modifyDrawing_(e.coordinate)):this.createOrUpdateSketchPoint_(e.coordinate.slice())}atFinish_(e,t){let n=!1;if(this.sketchFeature_){let i=!1,s=[this.finishCoordinate_];const o=this.mode_;if("Point"===o)n=!0;else if("Circle"===o)n=2===this.sketchCoords_.length;else if("LineString"===o)i=!t&&this.sketchCoords_.length>this.minPoints_;else if("Polygon"===o){const e=this.sketchCoords_;i=e[0].length>this.minPoints_,s=[e[0][0],e[0][e[0].length-2]],s=t?[e[0][0]]:[e[0][0],e[0][e[0].length-2]]}if(i){const t=this.getMap();for(let o=0,l=s.length;o<l;o++){const i=s[o],a=t.getPixelFromCoordinate(i),r=e[0]-a[0],c=e[1]-a[1],d=this.freehand_?1:this.snapTolerance_;if(n=Math.sqrt(r*r+c*c)<=d,n){this.finishCoordinate_=i;break}}}}return n}createOrUpdateSketchPoint_(e){this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(e):(this.sketchPoint_=new N(new Y(e)),this.updateSketchFeatures_())}createOrUpdateCustomSketchLine_(e){this.sketchLine_||(this.sketchLine_=new N);const n=e.getLinearRing(0);let t=this.sketchLine_.getGeometry();t?(t.setFlatCoordinates(n.getLayout(),n.getFlatCoordinates()),t.changed()):(t=new ee(n.getFlatCoordinates(),n.getLayout()),this.sketchLine_.setGeometry(t))}startDrawing_(e){const t=this.getMap().getView().getProjection(),n=mo(this.geometryLayout_);for(;e.length<n;)e.push(0);this.finishCoordinate_=e,"Point"===this.mode_?this.sketchCoords_=e.slice():"Polygon"===this.mode_?(this.sketchCoords_=[[e.slice(),e.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[e.slice(),e.slice()],this.sketchLineCoords_&&(this.sketchLine_=new N(new ee(this.sketchLineCoords_)));const s=this.geometryFunction_(this.sketchCoords_,void 0,t);this.sketchFeature_=new N,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(s),this.updateSketchFeatures_(),this.dispatchEvent(new pa(qh,this.sketchFeature_))}modifyDrawing_(e){const o=this.getMap(),s=this.sketchFeature_.getGeometry(),i=o.getView().getProjection(),a=mo(this.geometryLayout_);let t,n;for(;e.length<a;)e.push(0);("Point"===this.mode_?n=this.sketchCoords_:"Polygon"===this.mode_?(t=this.sketchCoords_[0],n=t[t.length-1],this.atFinish_(o.getPixelFromCoordinate(e))&&(e=this.finishCoordinate_.slice())):(t=this.sketchCoords_,n=t[t.length-1]),n[0]=e[0],n[1]=e[1],this.geometryFunction_(this.sketchCoords_,s,i),this.sketchPoint_)&&this.sketchPoint_.getGeometry().setCoordinates(e),"Polygon"===s.getType()&&"Polygon"!==this.mode_?this.createOrUpdateCustomSketchLine_(s):this.sketchLineCoords_&&this.sketchLine_.getGeometry().setCoordinates(this.sketchLineCoords_),this.updateSketchFeatures_()}addToDrawing_(e){const o=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection();let n,t;const s=this.mode_;return"LineString"===s||"Circle"===s?(this.finishCoordinate_=e.slice(),t=this.sketchCoords_,t.length>=this.maxPoints_&&(this.freehand_?t.pop():n=!0),t.push(e.slice()),this.geometryFunction_(t,o,i)):"Polygon"===s&&(t=this.sketchCoords_[0],t.length>=this.maxPoints_&&(this.freehand_?t.pop():n=!0),t.push(e.slice()),n&&(this.finishCoordinate_=t[0]),this.geometryFunction_(this.sketchCoords_,o,i)),this.createOrUpdateSketchPoint_(e.slice()),this.updateSketchFeatures_(),n?this.finishDrawing():this.sketchFeature_}removeLastPoints_(e){if(!this.sketchFeature_)return;const t=this.sketchFeature_.getGeometry(),s=this.getMap().getView().getProjection(),n=this.mode_;for(let i=0;i<e;++i){let o;if("LineString"===n||"Circle"===n){if(o=this.sketchCoords_,o.splice(-2,1),o.length>=2){this.finishCoordinate_=o[o.length-2].slice();const e=this.finishCoordinate_.slice();o[o.length-1]=e,this.createOrUpdateSketchPoint_(e)}this.geometryFunction_(o,t,s),"Polygon"===t.getType()&&this.sketchLine_&&this.createOrUpdateCustomSketchLine_(t)}else if("Polygon"===n){o=this.sketchCoords_[0],o.splice(-2,1);const e=this.sketchLine_.getGeometry();if(o.length>=2){const e=o[o.length-2].slice();o[o.length-1]=e,this.createOrUpdateSketchPoint_(e)}e.setCoordinates(o),this.geometryFunction_(this.sketchCoords_,t,s)}if(1===o.length){this.abortDrawing();break}}this.updateSketchFeatures_()}removeLastPoint(){this.removeLastPoints_(1)}finishDrawing(){const e=this.abortDrawing_();if(!e)return null;let t=this.sketchCoords_;const n=e.getGeometry(),s=this.getMap().getView().getProjection();return"LineString"===this.mode_?(t.pop(),this.geometryFunction_(t,n,s)):"Polygon"===this.mode_&&(t[0].pop(),this.geometryFunction_(t,n,s),t=n.getCoordinates()),"MultiPoint"===this.type_?e.setGeometry(new tt([t])):"MultiLineString"===this.type_?e.setGeometry(new ke([t])):"MultiPolygon"===this.type_&&e.setGeometry(new Re([t])),this.dispatchEvent(new pa(n5,e)),this.features_&&this.features_.push(e),this.source_&&this.source_.addFeature(e),e}abortDrawing_(){this.finishCoordinate_=null;const e=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),this.deactivateTrace_(),e}abortDrawing(){const e=this.abortDrawing_();e&&this.dispatchEvent(new pa(t5,e))}appendCoordinates(e){const n=this.mode_,s=!this.sketchFeature_;let t;if(s&&this.startDrawing_(e[0]),"LineString"===n||"Circle"===n)t=this.sketchCoords_;else{if("Polygon"!==n)return;t=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[]}s&&t.shift(),t.pop();for(let t=0;t<e.length;t++)this.addToDrawing_(e[t]);const o=e[e.length-1];this.sketchFeature_=this.addToDrawing_(o),this.modifyDrawing_(o)}extend(e){const n=e.getGeometry();this.sketchFeature_=e,this.sketchCoords_=n.getCoordinates();const t=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=t.slice(),this.sketchCoords_.push(t.slice()),this.sketchPoint_=new N(new Y(t)),this.updateSketchFeatures_(),this.dispatchEvent(new pa(qh,this.sketchFeature_))}updateSketchFeatures_(){const e=[];this.sketchFeature_&&e.push(this.sketchFeature_),this.sketchLine_&&e.push(this.sketchLine_),this.sketchPoint_&&e.push(this.sketchPoint_);const t=this.overlay_.getSource();t.clear(!0),t.addFeatures(e)}updateState_(){const e=this.getMap(),t=this.getActive();e&&t||this.abortDrawing(),this.overlay_.setMap(t?e:null)}},e.interaction.Draw.DrawEvent=pa,e.interaction.Draw.createBox=function(){return function(e,t,n){const s=oe([e[0],e[e.length-1]].map(function(e){return I(e,n)})),o=[[xn(s),Ws(s),Rs(s),ht(s),xn(s)]];t?t.setCoordinates(o):t=new ie(o);const i=le();return i&&t.transform(n,i),t}},e.interaction.Draw.createRegularPolygon=function(e,t){return function(n,s,o){const i=I(n[0],o),a=I(n[n.length-1],o),l=Math.sqrt(nt(i,a));s=s||Ni(new Li(i),e);let r=t;if(!t&&0!==t){const e=a[0]-i[0],t=a[1]-i[1];r=Math.atan2(t,e)}Xu(s,i,l,r);const c=le();return c&&s.transform(o,c),s}},e.interaction.Extent=class extends lt{constructor(e){super(e=e||{}),this.on,this.once,this.un,this.condition_=e.condition?e.condition:$s,this.extent_=null,this.pointerHandler_=null,this.pixelTolerance_=void 0!==e.pixelTolerance?e.pixelTolerance:10,this.snappedToVertex_=!1,this.extentFeature_=null,this.vertexFeature_=null,e||(e={}),this.extentOverlay_=new Us({source:new ws({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.boxStyle?e.boxStyle:Zg(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.vertexOverlay_=new Us({source:new ws({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.pointerStyle?e.pointerStyle:Qg(),updateWhileAnimating:!0,updateWhileInteracting:!0}),e.extent&&this.setExtent(e.extent)}snapToVertex_(e,t){const n=t.getCoordinateFromPixelInternal(e),o=function(e,t){return vr(n,e)-vr(n,t)},s=this.getExtentInternal();if(s){const c=function(e){return[[[e[0],e[1]],[e[0],e[3]]],[[e[0],e[3]],[e[2],e[3]]],[[e[2],e[3]],[e[2],e[1]]],[[e[2],e[1]],[e[0],e[1]]]]}(s);c.sort(o);const i=c[0];let a=ha(n,i);const r=t.getPixelFromCoordinateInternal(a);if(Lo(e,r)<=this.pixelTolerance_){const s=t.getPixelFromCoordinateInternal(i[0]),o=t.getPixelFromCoordinateInternal(i[1]),e=nt(r,s),n=nt(r,o),c=Math.sqrt(Math.min(e,n));return this.snappedToVertex_=c<=this.pixelTolerance_,this.snappedToVertex_&&(a=e>n?i[1]:i[0]),a}}return null}handlePointerMove_(e){const n=e.pixel,s=e.map;let t=this.snapToVertex_(n,s);t||(t=s.getCoordinateFromPixelInternal(n)),this.createOrUpdatePointerFeature_(t)}createOrUpdateExtentFeature_(e){let t=this.extentFeature_;return t?e?t.setGeometry(ps(e)):t.setGeometry(void 0):(t=new N(e?ps(e):{}),this.extentFeature_=t,this.extentOverlay_.getSource().addFeature(t)),t}createOrUpdatePointerFeature_(e){let t=this.vertexFeature_;return t?t.getGeometry().setCoordinates(e):(t=new N(new Y(e)),this.vertexFeature_=t,this.vertexOverlay_.getSource().addFeature(t)),t}handleEvent(e){return!e.originalEvent||!this.condition_(e)||(e.type!=C.POINTERMOVE||this.handlingDownUpSequence||this.handlePointerMove_(e),super.handleEvent(e),!1)}handleDownEvent(e){const o=e.pixel,i=e.map,t=this.getExtentInternal();let n=this.snapToVertex_(o,i);const s=function(e){let n=null,s=null;return e[0]==t[0]?n=t[2]:e[0]==t[2]&&(n=t[0]),e[1]==t[1]?s=t[3]:e[1]==t[3]&&(s=t[1]),null!==n&&null!==s?[n,s]:null};if(n&&t){const e=n[0]==t[0]||n[0]==t[2]?n[0]:null,o=n[1]==t[1]||n[1]==t[3]?n[1]:null;null!==e&&null!==o?this.pointerHandler_=um(s(n)):null!==e?this.pointerHandler_=hm(s([e,t[1]]),s([e,t[3]])):null!==o&&(this.pointerHandler_=hm(s([t[0],o]),s([t[2],o])))}else n=i.getCoordinateFromPixelInternal(o),this.setExtent([n[0],n[1],n[0],n[1]]),this.pointerHandler_=um(n);return!0}handleDragEvent(e){if(this.pointerHandler_){const t=e.coordinate;this.setExtent(this.pointerHandler_(t)),this.createOrUpdatePointerFeature_(t)}}handleUpEvent(){this.pointerHandler_=null;const t=this.getExtentInternal();return t&&0!==Nn(t)||this.setExtent(null),!1}setMap(e){this.extentOverlay_.setMap(e),this.vertexOverlay_.setMap(e),super.setMap(e)}getExtent(){return Tt(this.getExtentInternal(),this.getMap().getView().getProjection())}getExtentInternal(){return this.extent_}setExtent(e){this.extent_=e||null,this.createOrUpdateExtentFeature_(e),this.dispatchEvent(new cm(this.extent_))}},e.interaction.Extent.ExtentEvent=cm,e.interaction.Interaction=Rt,e.interaction.Interaction.pan=Ef,e.interaction.Interaction.zoomByDelta=ml,e.interaction.KeyboardPan=y3,e.interaction.KeyboardZoom=$3,e.interaction.Link=class extends Rt{constructor(e){let t;super(),t=!0===(e=Object.assign({animate:!0,params:["x","y","z","r","l"],replace:!1,prefix:""},e||{})).animate?{duration:250}:e.animate?e.animate:null,this.animationOptions_=t,this.params_=e.params.reduce((e,t)=>(e[t]=!0,e),{}),this.replace_=e.replace,this.prefix_=e.prefix,this.listenerKeys_=[],this.initial_=!0,this.updateState_=this.updateState_.bind(this),this.trackedCallbacks_={},this.trackedValues_={}}getParamName_(e){return this.prefix_?this.prefix_+e:e}get_(e,t){return e.get(this.getParamName_(t))}set_(e,t,n){t in this.params_&&e.set(this.getParamName_(t),n)}delete_(e,t){t in this.params_&&e.delete(this.getParamName_(t))}setMap(e){const t=this.getMap();super.setMap(e),e!==t&&(t&&this.unregisterListeners_(t),e&&(this.initial_=!0,this.updateState_(),this.registerListeners_(e)))}registerListeners_(e){this.listenerKeys_.push(m(e,_8,this.updateUrl_,this),m(e.getLayerGroup(),A,this.updateUrl_,this),m(e,"change:layergroup",this.handleChangeLayerGroup_,this)),this.replace_||addEventListener("popstate",this.updateState_)}unregisterListeners_(){for(let e=0,t=this.listenerKeys_.length;e<t;++e)T(this.listenerKeys_[e]);this.listenerKeys_.length=0,this.replace_||removeEventListener("popstate",this.updateState_);const n=new URL(window.location.href),t=n.searchParams;this.delete_(t,"x"),this.delete_(t,"y"),this.delete_(t,"z"),this.delete_(t,"r"),this.delete_(t,"l"),window.history.replaceState(null,"",n)}handleChangeLayerGroup_(){const e=this.getMap();e&&(this.unregisterListeners_(e),this.registerListeners_(e),this.initial_=!0,this.updateUrl_())}updateState_(){const n=new URL(window.location.href).searchParams;for(const e in this.trackedCallbacks_){const t=n.get(e);e in this.trackedCallbacks_&&t!==this.trackedValues_[e]&&(this.trackedValues_[e]=t,this.trackedCallbacks_[e](t))}const o=this.getMap();if(!o)return;const t=o.getView();if(!t)return;let s=!1;const e={},l=ka(this.get_(n,"z"));"z"in this.params_&&Qa(l,t.getZoom())&&(s=!0,e.zoom=l);const d=ka(this.get_(n,"r"));"r"in this.params_&&Qa(d,t.getRotation())&&(s=!0,e.rotation=d);const u=[ka(this.get_(n,"x")),ka(this.get_(n,"y"))];var i,a;("x"in this.params_||"y"in this.params_)&&(i=u,a=t.getCenter(),Qa(i[0],a[0])||Qa(i[1],a[1]))&&(s=!0,e.center=u),s&&(!this.initial_&&this.animationOptions_?t.animate(Object.assign(e,this.animationOptions_)):(e.center&&t.setCenter(e.center),"zoom"in e&&t.setZoom(e.zoom),"rotation"in e&&t.setRotation(e.rotation)));const r=o.getAllLayers(),c=this.get_(n,"l");if("l"in this.params_&&c&&c.length===r.length)for(let e=0,n=r.length;e<n;++e){const t=parseInt(c[e]);if(!isNaN(t)){const n=Boolean(t),s=r[e];s.getVisible()!==n&&s.setVisible(n)}}}track(e,t){this.trackedCallbacks_[e]=t;const n=new URL(window.location.href).searchParams.get(e);return this.trackedValues_[e]=n,n}update(e,t){const n=new URL(window.location.href),s=n.searchParams;null===t?s.delete(e):s.set(e,t),e in this.trackedValues_&&(this.trackedValues_[e]=t),this.updateHistory_(n)}updateUrl_(){const n=this.getMap();if(!n)return;const t=n.getView();if(!t)return;const o=t.getCenter(),r=t.getZoom(),c=t.getRotation(),s=n.getAllLayers(),i=new Array(s.length);for(let e=0,t=s.length;e<t;++e)i[e]=s[e].getVisible()?"1":"0";const a=new URL(window.location.href),e=a.searchParams;this.set_(e,"x",Sa(o[0])),this.set_(e,"y",Sa(o[1])),this.set_(e,"z",Sa(r)),this.set_(e,"r",Sa(c)),this.set_(e,"l",i.join("")),this.updateHistory_(a),this.initial_=!1}updateHistory_(e){e.href!==window.location.href&&(this.initial_||this.replace_?window.history.replaceState(history.state,"",e):window.history.pushState(null,"",e))}},e.interaction.Modify=class extends lt{constructor(e){let t;if(super(e),this.on,this.once,this.un,this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=e.condition?e.condition:Fl,this.defaultDeleteCondition_=function(e){return U8(e)&&Hl(e)},this.deleteCondition_=e.deleteCondition?e.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:$s,this.vertexFeature_=null,this.vertexSegments_=null,this.lastPixel_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new Di,this.pixelTolerance_=void 0!==e.pixelTolerance?e.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new Us({source:new ws({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:Yg(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.hitDetection_=null,e.features?t=e.features:e.source&&(this.source_=e.source,t=new me(this.source_.getFeatures()),this.source_.addEventListener($n,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(Ms,this.handleSourceRemove_.bind(this))),!t)throw new Error("The modify interaction requires features, a source or a layer");e.hitDetection&&(this.hitDetection_=e.hitDetection),this.features_=t,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(dt,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(ut,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=void 0===e.snapToPointer?!this.hitDetection_:e.snapToPointer}addFeature_(e){const t=e.getGeometry();if(t){const n=this.SEGMENT_WRITERS_[t.getType()];n&&n(e,t)}const n=this.getMap();n&&n.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastPixel_,n),e.addEventListener(A,this.boundHandleFeatureChange_)}willModifyFeatures_(e,t){if(!this.featuresBeingModified_){this.featuresBeingModified_=new me;const n=this.featuresBeingModified_.getArray();for(let e=0,o=t.length;e<o;++e){const s=t[e];for(let e=0,o=s.length;e<o;++e){const t=s[e].feature;t&&!n.includes(t)&&this.featuresBeingModified_.push(t)}}0===this.featuresBeingModified_.getLength()?this.featuresBeingModified_=null:this.dispatchEvent(new Ka(Xg,this.featuresBeingModified_,e))}}removeFeature_(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&0===this.features_.getLength()&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.removeEventListener(A,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(e){const n=this.rBush_,t=[];n.forEach(function(n){e===n.feature&&t.push(n)});for(let e=t.length-1;e>=0;--e){const s=t[e];for(let e=this.dragSegments_.length-1;e>=0;--e)this.dragSegments_[e][0]===s&&this.dragSegments_.splice(e,1);n.remove(s)}}setActive(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(e)}setMap(e){this.overlay_.setMap(e),super.setMap(e)}getOverlay(){return this.overlay_}handleSourceAdd_(e){e.feature&&this.features_.push(e.feature)}handleSourceRemove_(e){e.feature&&this.features_.remove(e.feature)}handleFeatureAdd_(e){this.addFeature_(e.element)}handleFeatureChange_(e){if(!this.changingFeature_){const t=e.target;this.removeFeature_(t),this.addFeature_(t)}}handleFeatureRemove_(e){this.removeFeature_(e.element)}writePointGeometry_(e,t){const n=t.getCoordinates(),s={feature:e,geometry:t,segment:[n,n]};this.rBush_.insert(t.getExtent(),s)}writeMultiPointGeometry_(e,t){const n=t.getCoordinates();for(let s=0,i=n.length;s<i;++s){const o=n[s],a={feature:e,geometry:t,depth:[s],index:s,segment:[o,o]};this.rBush_.insert(t.getExtent(),a)}}writeLineStringGeometry_(e,t){const n=t.getCoordinates();for(let s=0,i=n.length-1;s<i;++s){const o=n.slice(s,s+2),a={feature:e,geometry:t,index:s,segment:o};this.rBush_.insert(oe(o),a)}}writeMultiLineStringGeometry_(e,t){const n=t.getCoordinates();for(let s=0,i=n.length;s<i;++s){const o=n[s];for(let n=0,a=o.length-1;n<a;++n){const i=o.slice(n,n+2),r={feature:e,geometry:t,depth:[s],index:n,segment:i};this.rBush_.insert(oe(i),r)}}}writePolygonGeometry_(e,t){const n=t.getCoordinates();for(let s=0,i=n.length;s<i;++s){const o=n[s];for(let n=0,a=o.length-1;n<a;++n){const i=o.slice(n,n+2),r={feature:e,geometry:t,depth:[s],index:n,segment:i};this.rBush_.insert(oe(i),r)}}}writeMultiPolygonGeometry_(e,t){const n=t.getCoordinates();for(let s=0,i=n.length;s<i;++s){const o=n[s];for(let n=0,a=o.length;n<a;++n){const i=o[n];for(let o=0,r=i.length-1;o<r;++o){const a=i.slice(o,o+2),c={feature:e,geometry:t,depth:[n,s],index:o,segment:a};this.rBush_.insert(oe(a),c)}}}}writeCircleGeometry_(e,t){const n=t.getCenter(),o={feature:e,geometry:t,index:0,segment:[n,n]},i={feature:e,geometry:t,index:1,segment:[n,n]},r=[o,i];o.featureSegments=r,i.featureSegments=r,this.rBush_.insert(hs(n),o);let s=t;const a=le();if(a&&this.getMap()){const e=this.getMap().getView().getProjection();s=s.clone().transform(a,e),s=Ni(s).transform(e,a)}this.rBush_.insert(s.getExtent(),i)}writeGeometryCollectionGeometry_(e,t){const n=t.getGeometriesArray();for(let t=0;t<n.length;++t){const s=n[t];(0,this.SEGMENT_WRITERS_[s.getType()])(e,s)}}createOrUpdateVertexFeature_(e,t,n){let s=this.vertexFeature_;return s?s.getGeometry().setCoordinates(e):(s=new N(new Y(e)),this.vertexFeature_=s,this.overlay_.getSource().addFeature(s)),s.set("features",t),s.set("geometries",n),s}handleEvent(e){if(!e.originalEvent)return!0;let t;return this.lastPointerEvent_=e,e.map.getView().getInteracting()||e.type!=C.POINTERMOVE||this.handlingDownUpSequence||this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(t=e.type==C.SINGLECLICK&&!!this.ignoreNextSingleClick_||this.removePoint()),e.type==C.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(e)&&!t}handleDragEvent(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e,this.dragSegments_);const t=[e.coordinate[0]+this.delta_[0],e.coordinate[1]+this.delta_[1]],n=[],s=[];for(let l=0,m=this.dragSegments_.length;l<m;++l){const u=this.dragSegments_[l],r=u[0],h=r.feature;n.includes(h)||n.push(h);const o=r.geometry;s.includes(o)||s.push(o);const d=r.depth;let i;const a=r.segment,c=u[1];for(;t.length<o.getStride();)t.push(a[c][t.length]);switch(o.getType()){case"Point":i=t,a[0]=t,a[1]=t;break;case"MultiPoint":i=o.getCoordinates(),i[r.index]=t,a[0]=t,a[1]=t;break;case"LineString":i=o.getCoordinates(),i[r.index+c]=t,a[c]=t;break;case"MultiLineString":case"Polygon":i=o.getCoordinates(),i[d[0]][r.index+c]=t,a[c]=t;break;case"MultiPolygon":i=o.getCoordinates(),i[d[1]][d[0]][r.index+c]=t,a[c]=t;break;case"Circle":if(a[0]=t,a[1]=t,0===r.index)this.changingFeature_=!0,o.setCenter(t),this.changingFeature_=!1;else{this.changingFeature_=!0;const n=e.map.getView().getProjection();let s=Lo(I(o.getCenter(),n),I(t,n));const i=le();if(i){const e=o.clone().transform(i,n);e.setRadius(s),s=e.transform(n,i).getRadius()}o.setRadius(s),this.changingFeature_=!1}}i&&this.setGeometryCoordinates_(o,i)}this.createOrUpdateVertexFeature_(t,n,s)}handleDownEvent(e){if(!this.condition_(e))return!1;const t=e.coordinate;this.handlePointerAtPixel_(e.pixel,e.map,t),this.dragSegments_.length=0,this.featuresBeingModified_=null;const n=this.vertexFeature_;if(n){const r=e.map.getView().getProjection(),o=[],i=n.getGeometry().getCoordinates(),l=oe([i]),a=this.rBush_.getInExtent(l),s={};a.sort(Gg);for(let u=0,m=a.length;u<m;++u){const n=a[u],h=n.segment;let l=c(n.geometry);const d=n.depth;if(d&&(l+="-"+d.join("-")),s[l]||(s[l]=new Array(2)),"Circle"!==n.geometry.getType()||1!==n.index)if(!at(h[0],i)||s[l][0])if(!at(h[1],i)||s[l][1])c(h)in this.vertexSegments_&&!s[l][0]&&!s[l][1]&&this.insertVertexCondition_(e)&&o.push(n);else{if(s[l][0]&&0===s[l][0].index){let e=n.geometry.getCoordinates();switch(n.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":e=e[d[1]];case"Polygon":if(n.index!==e[d[0]].length-2)continue}}this.dragSegments_.push([n,1]),s[l][1]=n}else this.dragSegments_.push([n,0]),s[l][0]=n;else at(Om(t,n,r),i)&&!s[l][0]&&(this.dragSegments_.push([n,0]),s[l][0]=n)}o.length&&this.willModifyFeatures_(e,[o]);for(let e=o.length-1;e>=0;--e)this.insertVertex_(o[e],i)}return!!this.vertexFeature_}handleUpEvent(e){for(let n=this.dragSegments_.length-1;n>=0;--n){const t=this.dragSegments_[n][0],s=t.geometry;if("Circle"===s.getType()){const n=s.getCenter(),i=t.featureSegments[0],a=t.featureSegments[1];i.segment[0]=n,i.segment[1]=n,a.segment[0]=n,a.segment[1]=n,this.rBush_.update(hs(n),i);let o=s;const r=le();if(r){const t=e.map.getView().getProjection();o=o.clone().transform(r,t),o=Ni(o).transform(t,r)}this.rBush_.update(o.getExtent(),a)}else this.rBush_.update(oe(t.segment),t)}return this.featuresBeingModified_&&(this.dispatchEvent(new Ka(jm,this.featuresBeingModified_,e)),this.featuresBeingModified_=null),!1}handlePointerMove_(e){this.lastPixel_=e.pixel,this.handlePointerAtPixel_(e.pixel,e.map,e.coordinate)}handlePointerAtPixel_(e,t,n){const o=n||t.getCoordinateFromPixel(e),i=t.getView().getProjection(),r=function(e,t){return wm(o,e,i)-wm(o,t,i)};let s,a;if(this.hitDetection_){const n="object"==typeof this.hitDetection_?e=>e===this.hitDetection_:void 0;t.forEachFeatureAtPixel(e,(e,t,n)=>{n&&"Point"===n.getType()&&(n=new Y(un(n.getCoordinates(),i)));const o=n||e.getGeometry();if(e instanceof N&&this.features_.getArray().includes(e)){a=o;const t=e.getGeometry().getFlatCoordinates().slice(0,2);s=[{feature:e,geometry:a,segment:[t,t]}]}return!0},{layerFilter:n})}if(!s){const e=Tt(Fe(Pe(hs(o,gm),i),t.getView().getResolution()*this.pixelTolerance_,gm),i);s=this.rBush_.getInExtent(e)}if(s&&s.length>0){const n=s.sort(r)[0],l=n.segment;let d=Om(o,n,i);const u=t.getPixelFromCoordinate(d);let h=Lo(e,u);if(a||h<=this.pixelTolerance_){const e={};if(e[c(l)]=!0,this.snapToPointer_||(this.delta_[0]=d[0]-o[0],this.delta_[1]=d[1]-o[1]),"Circle"===n.geometry.getType()&&1===n.index)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(d,[n.feature],[n.geometry]);else{const r=t.getPixelFromCoordinate(l[0]),m=t.getPixelFromCoordinate(l[1]),i=nt(u,r),a=nt(u,m);h=Math.sqrt(Math.min(i,a)),this.snappedToVertex_=h<=this.pixelTolerance_,this.snappedToVertex_&&(d=i>a?l[1]:l[0]),this.createOrUpdateVertexFeature_(d,[n.feature],[n.geometry]);const o={};o[c(n.geometry)]=!0;for(let n=1,i=s.length;n<i;++n){const t=s[n].segment;if(!(at(l[0],t[0])&&at(l[1],t[1])||at(l[0],t[1])&&at(l[1],t[0])))break;{const i=c(s[n].geometry);i in o||(o[i]=!0,e[c(t)]=!0)}}}return void(this.vertexSegments_=e)}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(e,t){const l=e.segment,d=e.feature,n=e.geometry,o=e.depth,i=e.index;let s;for(;t.length<n.getStride();)t.push(0);switch(n.getType()){case"MultiLineString":case"Polygon":s=n.getCoordinates(),s[o[0]].splice(i+1,0,t);break;case"MultiPolygon":s=n.getCoordinates(),s[o[1]][o[0]].splice(i+1,0,t);break;case"LineString":s=n.getCoordinates(),s.splice(i+1,0,t);break;default:return}this.setGeometryCoordinates_(n,s);const a=this.rBush_;a.remove(e),this.updateSegmentIndices_(n,i,o,1);const r={segment:[l[0],t],feature:d,geometry:n,depth:o,index:i};a.insert(oe(r.segment),r),this.dragSegments_.push([r,1]);const c={segment:[t,l[1]],feature:d,geometry:n,depth:o,index:i+1};a.insert(oe(c.segment),c),this.dragSegments_.push([c,0]),this.ignoreNextSingleClick_=!0}removePoint(){if(this.lastPointerEvent_&&this.lastPointerEvent_.type!=C.POINTERDRAG){const e=this.lastPointerEvent_;this.willModifyFeatures_(e,this.dragSegments_);const t=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new Ka(jm,this.featuresBeingModified_,e)),this.featuresBeingModified_=null,t}return!1}removeVertex_(){const f=this.dragSegments_,s={};let t,i,m,u,h,o,a,d,r,e,n,l=!1;for(h=f.length-1;h>=0;--h)m=f[h],e=m[0],n=c(e.feature),e.depth&&(n+="-"+e.depth.join("-")),n in s||(s[n]={}),0===m[1]?(s[n].right=e,s[n].index=e.index):1==m[1]&&(s[n].left=e,s[n].index=e.index+1);for(n in s){switch(r=s[n].right,a=s[n].left,o=s[n].index,d=o-1,e=void 0!==a?a:r,d<0&&(d=0),u=e.geometry,i=u.getCoordinates(),t=i,l=!1,u.getType()){case"MultiLineString":i[e.depth[0]].length>2&&(i[e.depth[0]].splice(o,1),l=!0);break;case"LineString":i.length>2&&(i.splice(o,1),l=!0);break;case"MultiPolygon":t=t[e.depth[1]];case"Polygon":t=t[e.depth[0]],t.length>4&&(o==t.length-1&&(o=0),t.splice(o,1),l=!0,0===o&&(t.pop(),t.push(t[0]),d=t.length-1))}if(l){this.setGeometryCoordinates_(u,i);const t=[];if(void 0!==a&&(this.rBush_.remove(a),t.push(a.segment[0])),void 0!==r&&(this.rBush_.remove(r),t.push(r.segment[1])),void 0!==a&&void 0!==r){const n={depth:e.depth,feature:e.feature,geometry:e.geometry,index:d,segment:t};this.rBush_.insert(oe(n.segment),n)}this.updateSegmentIndices_(u,o,e.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),f.length=0}}return l}setGeometryCoordinates_(e,t){this.changingFeature_=!0,e.setCoordinates(t),this.changingFeature_=!1}updateSegmentIndices_(e,t,n,s){this.rBush_.forEachInExtent(e.getExtent(),function(o){o.geometry===e&&(void 0===n||void 0===o.depth||Ct(o.depth,n))&&o.index>t&&(o.index+=s)})}},e.interaction.Modify.ModifyEvent=Ka,e.interaction.MouseWheelZoom=mh,e.interaction.PinchRotate=kh,e.interaction.PinchZoom=Dh,e.interaction.Pointer=lt,e.interaction.Pointer.centroid=gl,e.interaction.Select=Am,e.interaction.Select.SelectEvent=Em,e.interaction.Snap=class extends lt{constructor(e){const t=e=e||{};t.handleDownEvent||(t.handleDownEvent=Je),t.stopDown||(t.stopDown=Qn),super(t),this.on,this.once,this.un,this.source_=e.source?e.source:null,this.vertex_=void 0===e.vertex||e.vertex,this.edge_=void 0===e.edge||e.edge,this.features_=e.features?e.features:null,this.featuresListenerKeys_=[],this.featureChangeListenerKeys_={},this.indexedFeaturesExtents_={},this.pendingFeatures_={},this.pixelTolerance_=void 0!==e.pixelTolerance?e.pixelTolerance:10,this.rBush_=new Di,this.GEOMETRY_SEGMENTERS_={Point:this.segmentPointGeometry_.bind(this),LineString:this.segmentLineStringGeometry_.bind(this),LinearRing:this.segmentLineStringGeometry_.bind(this),Polygon:this.segmentPolygonGeometry_.bind(this),MultiPoint:this.segmentMultiPointGeometry_.bind(this),MultiLineString:this.segmentMultiLineStringGeometry_.bind(this),MultiPolygon:this.segmentMultiPolygonGeometry_.bind(this),GeometryCollection:this.segmentGeometryCollectionGeometry_.bind(this),Circle:this.segmentCircleGeometry_.bind(this)}}addFeature(e,t){t=void 0===t||t;const s=c(e),n=e.getGeometry();if(n){const t=this.GEOMETRY_SEGMENTERS_[n.getType()];if(t){this.indexedFeaturesExtents_[s]=n.getExtent([1/0,1/0,-1/0,-1/0]);const o=[];if(t(o,n),1===o.length)this.rBush_.insert(oe(o[0]),{feature:e,segment:o[0]});else if(o.length>1){const t=o.map(e=>oe(e)),n=o.map(t=>({feature:e,segment:t}));this.rBush_.load(t,n)}}}t&&(this.featureChangeListenerKeys_[s]=m(e,A,this.handleFeatureChange_,this))}getFeatures_(){let e;return this.features_?e=this.features_:this.source_&&(e=this.source_.getFeatures()),e}handleEvent(e){const t=this.snapTo(e.pixel,e.coordinate,e.map);return t&&(e.coordinate=t.vertex.slice(0,2),e.pixel=t.vertexPixel,this.dispatchEvent(new Mm(rp,{vertex:e.coordinate,vertexPixel:e.pixel,feature:t.feature,segment:t.segment}))),super.handleEvent(e)}handleFeatureAdd_(e){const t=Fm(e);t&&this.addFeature(t)}handleFeatureRemove_(e){const t=Fm(e);t&&this.removeFeature(t)}handleFeatureChange_(e){const t=e.target;if(this.handlingDownUpSequence){const e=c(t);e in this.pendingFeatures_||(this.pendingFeatures_[e]=t)}else this.updateFeature_(t)}handleUpEvent(){const t=Object.values(this.pendingFeatures_);return t.length&&(t.forEach(this.updateFeature_.bind(this)),this.pendingFeatures_={}),!1}removeFeature(e,t){const o=void 0===t||t,n=c(e),s=this.indexedFeaturesExtents_[n];if(s){const n=this.rBush_,t=[];n.forEachInExtent(s,function(n){e===n.feature&&t.push(n)});for(let e=t.length-1;e>=0;--e)n.remove(t[e])}o&&(T(this.featureChangeListenerKeys_[n]),delete this.featureChangeListenerKeys_[n])}setMap(e){const n=this.getMap(),t=this.featuresListenerKeys_,s=this.getFeatures_();n&&(t.forEach(T),t.length=0,this.rBush_.clear(),Object.values(this.featureChangeListenerKeys_).forEach(T),this.featureChangeListenerKeys_={}),super.setMap(e),e&&(this.features_?t.push(m(this.features_,dt,this.handleFeatureAdd_,this),m(this.features_,ut,this.handleFeatureRemove_,this)):this.source_&&t.push(m(this.source_,$n,this.handleFeatureAdd_,this),m(this.source_,Ms,this.handleFeatureRemove_,this)),s.forEach(e=>this.addFeature(e)))}snapTo(e,t,n){const s=n.getView().getProjection(),o=I(t,s),h=Tt(Fe(oe([o]),n.getView().getResolution()*this.pixelTolerance_),s),r=this.rBush_.getInExtent(h),c=r.length;if(0===c)return null;let i,l,a=1/0,d=null;const m=this.pixelTolerance_*this.pixelTolerance_,u=()=>{if(i){const t=n.getPixelFromCoordinate(i);if(nt(e,t)<=m)return{vertex:i,vertexPixel:[Math.round(t[0]),Math.round(t[1])],feature:l,segment:d}}return null};if(this.vertex_){for(let e=0;e<c;++e){const t=r[e];"Circle"!==t.feature.getGeometry().getType()&&t.segment.forEach(e=>{const r=I(e,s),n=nt(o,r);n<a&&(i=e,a=n,l=t.feature)})}const e=u();if(e)return e}if(this.edge_){for(let n=0;n<c;++n){let t=null;const e=r[n];if("Circle"===e.feature.getGeometry().getType()){let n=e.feature.getGeometry();const i=le();i&&(n=n.clone().transform(i,s)),t=o8(o,n)}else{const[i,n]=e.segment;n&&(hu[0]=I(i,s),hu[1]=I(n,s),t=ha(o,hu))}if(t){const n=nt(o,t);n<a&&(i=un(t,s),d="Circle"===e.feature.getGeometry().getType()?null:e.segment,a=n,l=e.feature)}}const e=u();if(e)return e}return null}updateFeature_(e){this.removeFeature(e,!1),this.addFeature(e,!1)}segmentCircleGeometry_(e,t){const o=this.getMap().getView().getProjection();let s=t;const n=le();n&&(s=s.clone().transform(n,o));const i=Ni(s);n&&i.transform(o,n);const a=i.getCoordinates()[0];for(let t=0,n=a.length-1;t<n;++t)e.push(a.slice(t,t+2))}segmentGeometryCollectionGeometry_(e,t){const n=t.getGeometriesArray();for(let t=0;t<n.length;++t){const s=this.GEOMETRY_SEGMENTERS_[n[t].getType()];s&&s(e,n[t])}}segmentLineStringGeometry_(e,t){const n=t.getCoordinates();for(let t=0,s=n.length-1;t<s;++t)e.push(n.slice(t,t+2))}segmentMultiLineStringGeometry_(e,t){const n=t.getCoordinates();for(let t=0,o=n.length;t<o;++t){const s=n[t];for(let t=0,n=s.length-1;t<n;++t)e.push(s.slice(t,t+2))}}segmentMultiPointGeometry_(e,t){t.getCoordinates().forEach(t=>{e.push([t])})}segmentMultiPolygonGeometry_(e,t){const n=t.getCoordinates();for(let t=0,o=n.length;t<o;++t){const s=n[t];for(let t=0,o=s.length;t<o;++t){const n=s[t];for(let t=0,s=n.length-1;t<s;++t)e.push(n.slice(t,t+2))}}}segmentPointGeometry_(e,t){e.push([t.getCoordinates()])}segmentPolygonGeometry_(e,t){const n=t.getCoordinates();for(let t=0,o=n.length;t<o;++t){const s=n[t];for(let t=0,n=s.length-1;t<n;++t)e.push(s.slice(t,t+2))}}},e.interaction.Translate=class extends lt{constructor(e){let t;if(super(e=e||{}),this.on,this.once,this.un,this.lastCoordinate_=null,this.startCoordinate_=null,this.features_=void 0!==e.features?e.features:null,e.layers&&!this.features_)if("function"==typeof e.layers)t=e.layers;else{const n=e.layers;t=function(e){return n.includes(e)}}else t=Je;this.layerFilter_=t,this.filter_=e.filter&&!this.features_?e.filter:Je,this.hitTolerance_=e.hitTolerance?e.hitTolerance:0,this.condition_=e.condition?e.condition:$s,this.lastFeature_=null,this.addChangeListener(hi,this.handleActiveChanged_)}handleDownEvent(e){if(!e.originalEvent||!this.condition_(e))return!1;if(this.lastFeature_=this.featuresAtPixel_(e.pixel,e.map),!this.lastCoordinate_&&this.lastFeature_){this.startCoordinate_=e.coordinate,this.lastCoordinate_=e.coordinate,this.handleMoveEvent(e);const t=this.features_||new me([this.lastFeature_]);return this.dispatchEvent(new Ba(A5,t,e.coordinate,this.startCoordinate_,e)),!0}return!1}handleUpEvent(e){if(this.lastCoordinate_){this.lastCoordinate_=null,this.handleMoveEvent(e);const t=this.features_||new me([this.lastFeature_]);return this.dispatchEvent(new Ba(Vg,t,e.coordinate,this.startCoordinate_,e)),this.startCoordinate_=null,!0}return!1}handleDragEvent(e){if(this.lastCoordinate_){const n=e.coordinate,t=e.map.getView().getProjection(),o=I(n,t),i=I(this.lastCoordinate_,t),a=o[0]-i[0],r=o[1]-i[1],c=this.features_||new me([this.lastFeature_]),s=le();c.forEach(function(e){const n=e.getGeometry();s?(n.transform(s,t),n.translate(a,r),n.transform(t,s)):n.translate(a,r),e.setGeometry(n)}),this.lastCoordinate_=n,this.dispatchEvent(new Ba($g,c,n,this.startCoordinate_,e))}}handleMoveEvent(e){const t=e.map.getViewport();this.featuresAtPixel_(e.pixel,e.map)?(t.classList.remove(this.lastCoordinate_?"ol-grab":"ol-grabbing"),t.classList.add(this.lastCoordinate_?"ol-grabbing":"ol-grab")):t.classList.remove("ol-grab","ol-grabbing")}featuresAtPixel_(e,t){return t.forEachFeatureAtPixel(e,(e,t)=>{if(e instanceof N&&this.filter_(e,t)&&(!this.features_||this.features_.getArray().includes(e)))return e},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_})}getHitTolerance(){return this.hitTolerance_}setHitTolerance(e){this.hitTolerance_=e}setMap(e){const t=this.getMap();super.setMap(e),this.updateState_(t)}handleActiveChanged_(){this.updateState_(null)}updateState_(e){let t=this.getMap();const n=this.getActive();(!t||!n)&&(t=t||e,t)&&t.getViewport().classList.remove("ol-grab","ol-grabbing")}},e.interaction.Translate.TranslateEvent=Ba,e.interaction.defaults={},e.interaction.defaults.defaults=Rh,e.layer={},e.layer.Base=$1,e.layer.BaseImage=S0,e.layer.BaseTile=u4,e.layer.BaseVector=Un,e.layer.Graticule=class extends Us{constructor(e){e=e||{};const t=Object.assign({updateWhileAnimating:!0,updateWhileInteracting:!0,renderBuffer:0},e);delete t.maxLines,delete t.strokeStyle,delete t.targetSize,delete t.showLabels,delete t.lonLabelFormatter,delete t.latLabelFormatter,delete t.lonLabelPosition,delete t.latLabelPosition,delete t.lonLabelStyle,delete t.latLabelStyle,delete t.intervals,super(t),this.projection_=null,this.maxLat_=1/0,this.maxLon_=1/0,this.minLat_=-1/0,this.minLon_=-1/0,this.maxX_=1/0,this.maxY_=1/0,this.minX_=-1/0,this.minY_=-1/0,this.targetSize_=void 0!==e.targetSize?e.targetSize:100,this.maxLines_=void 0!==e.maxLines?e.maxLines:100,this.meridians_=[],this.parallels_=[],this.strokeStyle_=void 0!==e.strokeStyle?e.strokeStyle:l5,this.fromLonLatTransform_=void 0,this.toLonLatTransform_=void 0,this.projectionCenterLonLat_=null,this.bottomLeft_=null,this.bottomRight_=null,this.topLeft_=null,this.topRight_=null,this.meridiansLabels_=null,this.parallelsLabels_=null,e.showLabels&&(this.lonLabelFormatter_=null==e.lonLabelFormatter?ga.bind(this,"EW"):e.lonLabelFormatter,this.latLabelFormatter_=null==e.latLabelFormatter?ga.bind(this,"NS"):e.latLabelFormatter,this.lonLabelPosition_=null==e.lonLabelPosition?0:e.lonLabelPosition,this.latLabelPosition_=null==e.latLabelPosition?1:e.latLabelPosition,this.lonLabelStyleBase_=new ve({text:void 0!==e.lonLabelStyle?e.lonLabelStyle.clone():new Is({font:"12px Calibri,sans-serif",textBaseline:"bottom",fill:new ot({color:"rgba(0,0,0,1)"}),stroke:new Ze({color:"rgba(255,255,255,1)",width:3})})}),this.lonLabelStyle_=e=>{const t=e.get("graticule_label");return this.lonLabelStyleBase_.getText().setText(t),this.lonLabelStyleBase_},this.latLabelStyleBase_=new ve({text:void 0!==e.latLabelStyle?e.latLabelStyle.clone():new Is({font:"12px Calibri,sans-serif",textAlign:"right",fill:new ot({color:"rgba(0,0,0,1)"}),stroke:new Ze({color:"rgba(255,255,255,1)",width:3})})}),this.latLabelStyle_=e=>{const t=e.get("graticule_label");return this.latLabelStyleBase_.getText().setText(t),this.latLabelStyleBase_},this.meridiansLabels_=[],this.parallelsLabels_=[],this.addEventListener(ui,this.drawLabels_.bind(this))),this.intervals_=void 0!==e.intervals?e.intervals:c5,this.setSource(new ws({loader:this.loaderFunction.bind(this),strategy:this.strategyFunction.bind(this),features:new me,overlaps:!1,useSpatialIndex:!1,wrapX:e.wrapX})),this.featurePool_=[],this.lineStyle_=new ve({stroke:this.strokeStyle_}),this.loadedExtent_=null,this.renderedExtent_=null,this.renderedResolution_=null,this.setRenderOrder(null)}strategyFunction(e,t){let n=e.slice();return this.projection_&&this.getSource().getWrapX()&&Lr(n,this.projection_),this.loadedExtent_&&(Pf(this.loadedExtent_,n,t)?n=this.loadedExtent_.slice():this.getSource().removeLoadedExtent(this.loadedExtent_)),[n]}loaderFunction(e,t,n){this.loadedExtent_=e;const d=this.getSource(),i=ce(this.getExtent()||[-1/0,-1/0,1/0,1/0],e);if(this.renderedExtent_&&Ue(this.renderedExtent_,i)&&this.renderedResolution_===t)return;if(this.renderedExtent_=i,this.renderedResolution_=t,Ft(i))return;const u=_e(i),h=t*t/4;(!this.projection_||!Oe(this.projection_,n))&&this.updateProjectionInfo_(n),this.createGraticule_(i,u,t,h);let s,r=this.meridians_.length+this.parallels_.length;for(this.meridiansLabels_&&(r+=this.meridians_.length),this.parallelsLabels_&&(r+=this.parallels_.length);r>this.featurePool_.length;)s=new N,this.featurePool_.push(s);const c=d.getFeaturesCollection();c.clear();let o,a,l=0;for(o=0,a=this.meridians_.length;o<a;++o)s=this.featurePool_[l++],s.setGeometry(this.meridians_[o]),s.setStyle(this.lineStyle_),c.push(s);for(o=0,a=this.parallels_.length;o<a;++o)s=this.featurePool_[l++],s.setGeometry(this.parallels_[o]),s.setStyle(this.lineStyle_),c.push(s)}addMeridian_(e,t,n,s,o,i){const a=this.getMeridian_(e,t,n,s,i);if(U(a.getExtent(),o)){if(this.meridiansLabels_){const t=this.lonLabelFormatter_(e);i in this.meridiansLabels_?this.meridiansLabels_[i].text=t:this.meridiansLabels_[i]={geom:new Y([]),text:t}}this.meridians_[i++]=a}return i}addParallel_(e,t,n,s,o,i){const a=this.getParallel_(e,t,n,s,i);if(U(a.getExtent(),o)){if(this.parallelsLabels_){const t=this.latLabelFormatter_(e);i in this.parallelsLabels_?this.parallelsLabels_[i].text=t:this.parallelsLabels_[i]={geom:new Y([]),text:t}}this.parallels_[i++]=a}return i}drawLabels_(e){const t=e.frameState.viewState.rotation,d=e.frameState.viewState.resolution,u=e.frameState.size,s=e.frameState.extent,n=_e(s);let r=s;if(t){const e=u[0]*d,t=u[1]*d;r=[n[0]-e/2,n[1]-t/2,n[0]+e/2,n[1]+t/2]}let c=0,l=0,o=this.latLabelPosition_<.5;const i=this.projection_.getExtent(),a=b(i);this.getSource().getWrapX()&&this.projection_.canWrapX()&&!xe(i,s)&&(c=Math.floor((s[0]-i[0])/a),l=Math.ceil((s[2]-i[2])/a),o=o!==Math.abs(t)>Math.PI/2);const h=af(e);for(let d=c;d<=l;++d){let i,e,m,u,f=this.meridians_.length+this.parallels_.length;if(this.meridiansLabels_)for(e=0,m=this.meridiansLabels_.length;e<m;++e){const o=this.meridians_[e];if(t||0!==d){const s=o.clone();s.translate(d*a,0),s.rotate(-t,n),u=this.getMeridianPoint_(s,r,e),u.rotate(t,n)}else u=this.getMeridianPoint_(o,s,e);i=this.featurePool_[f++],i.setGeometry(u),i.set("graticule_label",this.meridiansLabels_[e].text),h.drawFeature(i,this.lonLabelStyle_(i))}if(this.parallelsLabels_&&(d===c&&o||d===l&&!o))for(e=0,m=this.parallels_.length;e<m;++e){const o=this.parallels_[e];if(t||0!==d){const s=o.clone();s.translate(d*a,0),s.rotate(-t,n),u=this.getParallelPoint_(s,r,e),u.rotate(t,n)}else u=this.getParallelPoint_(o,s,e);i=this.featurePool_[f++],i.setGeometry(u),i.set("graticule_label",this.parallelsLabels_[e].text),h.drawFeature(i,this.latLabelStyle_(i))}}}createGraticule_(e,t,n,s){const r=this.getInterval_(n);if(-1==r)return this.meridians_.length=0,this.parallels_.length=0,this.meridiansLabels_&&(this.meridiansLabels_.length=0),void(this.parallelsLabels_&&(this.parallelsLabels_.length=0));let v=!1;const w=this.projection_.getExtent(),x=b(w);this.getSource().getWrapX()&&this.projection_.canWrapX()&&!xe(w,e)&&(b(e)>=x?(e[0]=w[0],e[2]=w[2]):v=!0);const O=[y(t[0],this.minX_,this.maxX_),y(t[1],this.minY_,this.maxY_)],j=this.toLonLatTransform_(O);isNaN(j[1])&&(j[1]=Math.abs(this.maxLat_)>=Math.abs(this.minLat_)?this.maxLat_:this.minLat_);let p=y(j[0],this.minLon_,this.maxLon_),f=y(j[1],this.minLat_,this.maxLat_);const m=this.maxLines_;let c,o,a,i,g=e;v||(g=[y(e[0],this.minX_,this.maxX_),y(e[1],this.minY_,this.maxY_),y(e[2],this.minX_,this.maxX_),y(e[3],this.minY_,this.maxY_)]);const _=Fs(g,this.toLonLatTransform_,void 0,8);let d=_[3],h=_[2],l=_[1],u=_[0];if(v||(qe(g,this.bottomLeft_)&&(u=this.minLon_,l=this.minLat_),qe(g,this.bottomRight_)&&(h=this.maxLon_,l=this.minLat_),qe(g,this.topLeft_)&&(u=this.minLon_,d=this.maxLat_),qe(g,this.topRight_)&&(h=this.maxLon_,d=this.maxLat_),d=y(d,f,this.maxLat_),h=y(h,p,this.maxLon_),l=y(l,this.minLat_,f),u=y(u,this.minLon_,p)),p=Math.floor(p/r)*r,i=y(p,this.minLon_,this.maxLon_),o=this.addMeridian_(i,l,d,s,e,0),c=0,v)for(;(i-=r)>=u&&c++<m;)o=this.addMeridian_(i,l,d,s,e,o);else for(;i!=this.minLon_&&c++<m;)i=Math.max(i-r,this.minLon_),o=this.addMeridian_(i,l,d,s,e,o);if(i=y(p,this.minLon_,this.maxLon_),c=0,v)for(;(i+=r)<=h&&c++<m;)o=this.addMeridian_(i,l,d,s,e,o);else for(;i!=this.maxLon_&&c++<m;)i=Math.min(i+r,this.maxLon_),o=this.addMeridian_(i,l,d,s,e,o);for(this.meridians_.length=o,this.meridiansLabels_&&(this.meridiansLabels_.length=o),f=Math.floor(f/r)*r,a=y(f,this.minLat_,this.maxLat_),o=this.addParallel_(a,u,h,s,e,0),c=0;a!=this.minLat_&&c++<m;)a=Math.max(a-r,this.minLat_),o=this.addParallel_(a,u,h,s,e,o);for(a=y(f,this.minLat_,this.maxLat_),c=0;a!=this.maxLat_&&c++<m;)a=Math.min(a+r,this.maxLat_),o=this.addParallel_(a,u,h,s,e,o);this.parallels_.length=o,this.parallelsLabels_&&(this.parallelsLabels_.length=o)}getInterval_(e){const s=this.projectionCenterLonLat_[0],i=this.projectionCenterLonLat_[1];let o=-1;const a=Math.pow(this.targetSize_*e,2),t=[],n=[];for(let r=0,l=this.intervals_.length;r<l;++r){const e=y(this.intervals_[r]/2,0,90),c=y(i,-90+e,90-e);if(t[0]=s-e,t[1]=c-e,n[0]=s+e,n[1]=c+e,this.fromLonLatTransform_(t,t),this.fromLonLatTransform_(n,n),Math.pow(n[0]-t[0],2)+Math.pow(n[1]-t[1],2)<=a)break;o=this.intervals_[r]}return o}getMeridian_(e,t,n,s,o){const a=Nh(e,t,n,this.projection_,s);let i=this.meridians_[o];return i?(i.setFlatCoordinates("XY",a),i.changed()):(i=new ee(a,"XY"),this.meridians_[o]=i),i}getMeridianPoint_(e,t,n){const s=e.getFlatCoordinates();let o=1,i=s.length-1;s[o]>s[i]&&(o=i,i=1);const c=Math.max(t[1],s[o]),l=Math.min(t[3],s[i]),a=y(t[1]+Math.abs(t[1]-t[3])*this.lonLabelPosition_,c,l),d=[s[o-1]+(s[i-1]-s[o-1])*(a-s[o])/(s[i]-s[o]),a],r=this.meridiansLabels_[n].geom;return r.setCoordinates(d),r}getMeridians(){return this.meridians_}getParallel_(e,t,n,s,o){const a=Lh(e,t,n,this.projection_,s);let i=this.parallels_[o];return i?(i.setFlatCoordinates("XY",a),i.changed()):i=new ee(a,"XY"),i}getParallelPoint_(e,t,n){const s=e.getFlatCoordinates();let o=0,i=s.length-2;s[o]>s[i]&&(o=i,i=0);const c=Math.max(t[0],s[o]),l=Math.min(t[2],s[i]),a=y(t[0]+Math.abs(t[0]-t[2])*this.latLabelPosition_,c,l),d=[a,s[o+1]+(s[i+1]-s[o+1])*(a-s[o])/(s[i]-s[o])],r=this.parallelsLabels_[n].geom;return r.setCoordinates(d),r}getParallels(){return this.parallels_}updateProjectionInfo_(e){const s=d("EPSG:4326"),t=e.getWorldExtent();this.maxLat_=t[3],this.maxLon_=t[2],this.minLat_=t[1],this.minLon_=t[0];const o=pt(e,s);if(this.minLon_<this.maxLon_)this.toLonLatTransform_=o;else{const e=this.minLon_+this.maxLon_/2;this.maxLon_+=360,this.toLonLatTransform_=function(t,n,s){const i=o(t,n,s=s||2);for(let t=0,n=i.length;t<n;t+=s)i[t]<e&&(i[t]+=360);return i}}this.fromLonLatTransform_=pt(s,e);const n=Fs([this.minLon_,this.minLat_,this.maxLon_,this.maxLat_],this.fromLonLatTransform_,void 0,8);this.minX_=n[0],this.maxX_=n[2],this.minY_=n[1],this.maxY_=n[3],this.bottomLeft_=this.fromLonLatTransform_([this.minLon_,this.minLat_]),this.bottomRight_=this.fromLonLatTransform_([this.maxLon_,this.minLat_]),this.topLeft_=this.fromLonLatTransform_([this.minLon_,this.maxLat_]),this.topRight_=this.fromLonLatTransform_([this.maxLon_,this.maxLat_]),this.projectionCenterLonLat_=this.toLonLatTransform_(_e(e.getExtent())),isNaN(this.projectionCenterLonLat_[1])&&(this.projectionCenterLonLat_[1]=Math.abs(this.maxLat_)>=Math.abs(this.minLat_)?this.maxLat_:this.minLat_),this.projection_=e}},e.layer.Group=No,e.layer.Group.GroupEvent=gn,e.layer.Heatmap=class extends Un{constructor(e){e=e||{};const t=Object.assign({},e);delete t.gradient,delete t.radius,delete t.blur,delete t.weight,super(t),this.gradient_=null,this.addChangeListener(yu,this.handleGradientChanged_),this.setGradient(e.gradient?e.gradient:r5),this.setBlur(void 0!==e.blur?e.blur:15),this.setRadius(void 0!==e.radius?e.radius:8);const n=e.weight?e.weight:"weight";this.weightFunction_="string"==typeof n?function(e){return e.get(n)}:n,this.setRenderOrder(null)}getBlur(){return this.get(Cr)}getGradient(){return this.get(yu)}getRadius(){return this.get(Or)}handleGradientChanged_(){this.gradient_=function(e){const n=1,s=256,t=K(n,s),o=t.createLinearGradient(0,0,n,s),i=1/(e.length-1);for(let t=0,n=e.length;t<n;++t)o.addColorStop(t*i,e[t]);return t.fillStyle=o,t.fillRect(0,0,n,s),t.canvas}(this.getGradient())}setBlur(e){this.set(Cr,e)}setGradient(e){this.set(yu,e)}setRadius(e){this.set(Or,e)}createRenderer(){const e=(new Yc).addAttribute("float a_prop_weight").addVarying("v_prop_weight","float","a_prop_weight").addUniform("float u_size").addUniform("float u_blurSlope").setSymbolSizeExpression("vec2(u_size)").setSymbolColorExpression("vec4(smoothstep(0., 1., (1. - length(coordsPx * 2. / v_quadSizePx)) * u_blurSlope) * v_prop_weight)");return new t1(this,{className:this.getClassName(),attributes:[{name:"weight",callback:e=>{const t=this.weightFunction_(e);return void 0!==t?y(t,0,1):1}}],uniforms:{u_size:()=>2*(this.get(Or)+this.get(Cr)),u_blurSlope:()=>this.get(Or)/Math.max(1,this.get(Cr))},hitDetectionEnabled:!0,vertexShader:e.getSymbolVertexShader(),fragmentShader:e.getSymbolFragmentShader(),postProcesses:[{fragmentShader:`
            precision mediump float;

            uniform sampler2D u_image;
            uniform sampler2D u_gradientTexture;
            uniform float u_opacity;

            varying vec2 v_texCoord;

            void main() {
              vec4 color = texture2D(u_image, v_texCoord);
              gl_FragColor.a = color.a * u_opacity;
              gl_FragColor.rgb = texture2D(u_gradientTexture, vec2(0.5, color.a)).rgb;
              gl_FragColor.rgb *= gl_FragColor.a;
            }`,uniforms:{u_gradientTexture:()=>this.gradient_,u_opacity:()=>this.getOpacity()}}]})}renderDeclutter(){}},e.layer.Image=f0,e.layer.Layer=ss,e.layer.Layer.inView=pc,e.layer.Tile=i0,e.layer.Vector=Us,e.layer.VectorImage=class extends Un{constructor(e){e=e||{};const t=Object.assign({},e);delete t.imageRatio,super(t),this.imageRatio_=void 0!==e.imageRatio?e.imageRatio:1}getImageRatio(){return this.imageRatio_}createRenderer(){return new Eh(this)}},e.layer.VectorTile=class extends Un{constructor(e){e=e||{};const t=Object.assign({},e);delete t.preload,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un;const n=e.renderMode||"hybrid";x("hybrid"==n||"vector"==n,"`renderMode` must be `'hybrid'` or `'vector'`"),this.renderMode_=n,this.setPreload(e.preload?e.preload:0),this.setUseInterimTilesOnError(void 0===e.useInterimTilesOnError||e.useInterimTilesOnError),this.getBackground,this.setBackground}createRenderer(){return new Sh(this)}getFeatures(e){return super.getFeatures(e)}getRenderMode(){return this.renderMode_}getPreload(){return this.get(Da)}getUseInterimTilesOnError(){return this.get(Ma)}setPreload(e){this.set(Da,e)}setUseInterimTilesOnError(e){this.set(Ma,e)}},e.layer.WebGLPoints=class extends ss{constructor(e){super(Object.assign({},e)),this.parseResult_=xc(e.style),this.styleVariables_=e.style.variables||{},this.hitDetectionDisabled_=!!e.disableHitDetection}createRenderer(){const e=Object.keys(this.parseResult_.attributes).map(e=>({name:e,...this.parseResult_.attributes[e]}));return new t1(this,{vertexShader:this.parseResult_.builder.getSymbolVertexShader(),fragmentShader:this.parseResult_.builder.getSymbolFragmentShader(),hitDetectionEnabled:!this.hitDetectionDisabled_,uniforms:this.parseResult_.uniforms,attributes:e})}updateStyleVariables(e){Object.assign(this.styleVariables_,e),this.changed()}},e.layer.WebGLTile=Wh,e.loadingstrategy={},e.loadingstrategy.all=Rf,e.loadingstrategy.bbox=function(e){return[e]},e.loadingstrategy.tile=function(e){return function(t,n,s){const a=e.getZForResolution(pm(n,s)),i=e.getTileRangeForExtentAndZ(Pe(t,s),a),r=[],o=[a,0,0];for(o[1]=i.minX;o[1]<=i.maxX;++o[1])for(o[2]=i.minY;o[2]<=i.maxY;++o[2])r.push(Tt(e.getTileCoordExtent(o),s));return r}},e.math={},e.math.ceil=en,e.math.clamp=y,e.math.floor=Ps,e.math.lerp=$e,e.math.modulo=ft,e.math.round=la,e.math.solveLinearSystem=a8,e.math.squaredDistance=wt,e.math.squaredSegmentDistance=Zd,e.math.toDegrees=ca,e.math.toFixed=kn,e.math.toRadians=we,e.net={},e.net.ClientError=Df,e.net.ResponseError=Nf,e.net.getJSON=Sd,e.net.jsonp=rl,e.net.overrideXHR=function(e){"undefined"!=typeof XMLHttpRequest&&(Vf=XMLHttpRequest),global.XMLHttpRequest=e},e.net.resolveUrl=Md,e.net.restoreXHR=function(){global.XMLHttpRequest=Vf},e.obj={},e.obj.clear=Kn,e.obj.isEmpty=it,e.proj={},e.proj.Projection=ns,e.proj.Units={},e.proj.Units.METERS_PER_UNIT=rs,e.proj.Units.fromCode=Dd,e.proj.addCommon=mm,e.proj.addCoordinateTransforms=Lm,e.proj.addEquivalentProjections=qa,e.proj.addEquivalentTransforms=Hm,e.proj.addProjection=cu,e.proj.addProjections=Im,e.proj.clearAllProjections=function(){f8(),l8()},e.proj.clearUserProjection=function(){Ne=null},e.proj.cloneTransform=Za,e.proj.createProjection=Ua,e.proj.createSafeCoordinateTransform=gu,e.proj.createTransformFromCoordinateTransform=du,e.proj.disableCoordinateWarning=au,e.proj.epsg3857={},e.proj.epsg3857.EXTENT=uf,e.proj.epsg3857.HALF_SIZE=js,e.proj.epsg3857.MAX_SAFE_Y=ia,e.proj.epsg3857.PROJECTIONS=Vd,e.proj.epsg3857.RADIUS=To,e.proj.epsg3857.WORLD_EXTENT=df,e.proj.epsg3857.fromEPSG4326=z4,e.proj.epsg3857.toEPSG4326=x8,e.proj.epsg4326={},e.proj.epsg4326.EXTENT=Yd,e.proj.epsg4326.METERS_PER_UNIT=b8,e.proj.epsg4326.PROJECTIONS=Xd,e.proj.epsg4326.RADIUS=O8,e.proj.equivalent=Oe,e.proj.fromLonLat=function(e,t){return au(),Jn(e,"EPSG:4326",void 0!==t?t:"EPSG:3857")},e.proj.fromUserCoordinate=I,e.proj.fromUserExtent=Pe,e.proj.fromUserResolution=pm,e.proj.get=d,e.proj.getPointResolution=Na,e.proj.getTransform=pt,e.proj.getTransformFromProjections=De,e.proj.getUserProjection=le,e.proj.identityTransform=Ta,e.proj.proj4={},e.proj.proj4.epsgLookupMapTiler=function(e){return async function(t){const n=await fetch(`https://api.maptiler.com/coordinates/search/code:${t}.json?transformations=true&exports=true&key=${e}`);if(!n.ok)throw new Error(`Unexpected response from maptiler.com: ${n.status}`);return n.json().then(e=>{const n=e.results;if(n?.length>0){const e=n.filter(e=>"EPSG"===e.id?.authority&&e.id?.code===t)[0];if(e){const t=e.transformations;if(t?.length>0){const n=e.default_transformation;if(t.filter(e=>e.id?.authority===n?.authority&&e.id?.code===n?.code&&0===e.grids?.length).length>0)return e.exports?.proj4;const s=t.filter(e=>0===e.grids?.length&&"EPSG"===e.target_crs?.authority&&4326===e.target_crs?.code&&!1===e.deprecated&&!0===e.usable).sort((e,t)=>e.accuracy-t.accuracy)[0]?.exports?.proj4;if(s)return s}return e.exports?.proj4}}})}},e.proj.proj4.fromEPSGCode=async function(e){"string"==typeof e&&(e=parseInt(e.split(":").pop(),10));const t=Sr;if(!t)throw new Error("Proj4 must be registered first with register(proj4)");const n="EPSG:"+e;return t.defs(n)||(t.defs(n,await Cu(e)),Fh(t)),d(n)},e.proj.proj4.getEPSGLookup=function(){return Cu},e.proj.proj4.isRegistered=function(){return!!Sr},e.proj.proj4.register=Fh,e.proj.proj4.setEPSGLookup=function(e){Cu=e},e.proj.proj4.unregister=function(){Sr=null},e.proj.projections={},e.proj.projections.add=d8,e.proj.projections.clear=f8,e.proj.projections.get=m8,e.proj.setUserProjection=ym,e.proj.toLonLat=mu,e.proj.toUserCoordinate=un,e.proj.toUserExtent=Tt,e.proj.toUserResolution=fu,e.proj.transform=Jn,e.proj.transformExtent=Ha,e.proj.transformWithProjections=function(e,t,n){return De(t,n)(e)},e.proj.transforms={},e.proj.transforms.add=Gs,e.proj.transforms.clear=l8,e.proj.transforms.get=Qd,e.proj.transforms.remove=function(e,t){const n=e.getCode(),s=t.getCode(),o=yt[n][s];return delete yt[n][s],it(yt[n])&&delete yt[n],o},e.proj.useGeographic=function(){ym("EPSG:4326")},e.render={},e.render.Box=Q4,e.render.Event=$o,e.render.Feature=Ce,e.render.Feature.toFeature=function(e,t){const s=e.getId(),o=G3(e),i=e.getProperties(),n=new N;return void 0!==t&&n.setGeometryName(t),n.setGeometry(o),void 0!==s&&n.setId(s),n.setProperties(i,!0),n},e.render.Feature.toGeometry=G3,e.render.VectorContext=Fd,e.render.canvas={},e.render.canvas.Builder=vo,e.render.canvas.BuilderGroup=Hu,e.render.canvas.Executor=ph,e.render.canvas.ExecutorGroup=Tu,e.render.canvas.ExecutorGroup.ALL=Ks,e.render.canvas.ExecutorGroup.DECLUTTER=oa,e.render.canvas.ExecutorGroup.NON_DECLUTTER=bh,e.render.canvas.ExecutorGroup.getPixelIndexArray=_h,e.render.canvas.ImageBuilder=X3,e.render.canvas.Immediate=al,e.render.canvas.Instruction={},e.render.canvas.Instruction.beginPathInstruction=Rn,e.render.canvas.Instruction.closePathInstruction=Vu,e.render.canvas.Instruction.fillInstruction=Gi,e.render.canvas.Instruction.strokeInstruction=fn,e.render.canvas.LineStringBuilder=Q3,e.render.canvas.PolygonBuilder=Iu,e.render.canvas.TextBuilder=nh,e.render.canvas.TextBuilder.TEXT_ALIGN=Xi,e.render.canvas.ZIndexContext=$a,e.render.canvas.checkedFonts=Vt,e.render.canvas.defaultFillStyle=He,e.render.canvas.defaultFont=R1,e.render.canvas.defaultLineCap=ds,e.render.canvas.defaultLineDash=Bt,e.render.canvas.defaultLineDashOffset=0,e.render.canvas.defaultLineJoin=ms,e.render.canvas.defaultLineWidth=1,e.render.canvas.defaultMiterLimit=ko,e.render.canvas.defaultPadding=Yn,e.render.canvas.defaultStrokeStyle=Ao,e.render.canvas.defaultTextAlign=So,e.render.canvas.defaultTextBaseline=Fa,e.render.canvas.drawImageOrLabel=T2,e.render.canvas.getTextDimensions=S2,e.render.canvas.hitdetect={},e.render.canvas.hitdetect.HIT_DETECT_RESOLUTION=Ve,e.render.canvas.hitdetect.createHitDetectionImageData=Au,e.render.canvas.hitdetect.hitDetect=ku,e.render.canvas.measureAndCacheTextWidth=O1,e.render.canvas.measureTextHeight=f2,e.render.canvas.measureTextWidth=Oa,e.render.canvas.registerFont=h2,e.render.canvas.rotateAtOffset=function(e,t,n,s){0!==t&&(e.translate(n,s),e.rotate(t),e.translate(-n,-s))},e.render.canvas.style={},e.render.canvas.style.buildRuleSet=yh,e.render.canvas.style.buildStyle=lc,e.render.canvas.style.flatStylesToStyleFunction=zu,e.render.canvas.style.rulesToStyleFunction=gh,e.render.canvas.textHeights=ir,e.render.getRenderPixel=function(e,t){return R(e.inversePixelTransform,t.slice(0))},e.render.getVectorContext=af,e.render.toContext=function(e,t){const n=e.canvas,s=(t=t||{}).pixelRatio||Hc,o=t.size;o&&(n.width=o[0]*s,n.height=o[1]*s,n.style.width=o[0]+"px",n.style.height=o[1]+"px");const i=[0,0,n.width,n.height],a=qs([1,0,0,1,0,0],s,s);return new al(e,s,i,a,0)},e.render.webgl={},e.render.webgl.MixedGeometryBatch=u1,e.render.webgl.VectorStyleRenderer=Zu,e.render.webgl.renderinstructions={},e.render.webgl.renderinstructions.generateLineStringRenderInstructions=g3,e.render.webgl.renderinstructions.generatePointRenderInstructions=p3,e.render.webgl.renderinstructions.generatePolygonRenderInstructions=v3,e.render.webgl.renderinstructions.getCustomAttributesSize=zi,e.render.webgl.utils={},e.render.webgl.utils.LINESTRING_ANGLE_COSINE_CUTOFF=P1,e.render.webgl.utils.colorDecodeId=z1,e.render.webgl.utils.colorEncodeId=D1,e.render.webgl.utils.getBlankImageData=function(){const e=document.createElement("canvas").getContext("2d").createImageData(1,1);return e.data[0]=255,e.data[1]=255,e.data[2]=255,e.data[3]=255,e},e.render.webgl.utils.writeLineSegmentToBuffers=function(e,t,n,s,o,i,a,r,c,l,d){const w=8+r.length,p=i.length/w,u=[e[t+0],e[t+1]],h=[e[n],e[n+1]],g=R(c,[...u]),v=R(c,[...h]);function _(e,t,n){const i=Math.sqrt((t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])),s=[(t[0]-e[0])/i,(t[1]-e[1])/i],r=[-s[1],s[0]],a=Math.sqrt((n[0]-e[0])*(n[0]-e[0])+(n[1]-e[1])*(n[1]-e[1])),o=[(n[0]-e[0])/a,(n[1]-e[1])/a],c=0===i||0===a?0:Math.acos(y(o[0]*s[0]+o[1]*s[1],-1,1));return o[0]*r[0]+o[1]*r[1]>0?c:2*Math.PI-c}let m=-1,f=-1,j=d;const O=null!==o;null!==s&&(m=_(g,v,R(c,[...[e[s],e[s+1]]])),Math.cos(m)<=P1&&(j+=Math.tan((m-Math.PI)/2))),O&&(f=_(v,g,R(c,[...[e[o],e[o+1]]])),Math.cos(f)<=P1&&(j+=Math.tan((Math.PI-f)/2)));function b(e,t){return 0===t?1e4*e:Math.sign(t)*(1e4*e+Math.abs(t))}return i.push(u[0],u[1],h[0],h[1],m,f,l,b(0,d)),i.push(...r),i.push(u[0],u[1],h[0],h[1],m,f,l,b(1,d)),i.push(...r),i.push(u[0],u[1],h[0],h[1],m,f,l,b(2,d)),i.push(...r),i.push(u[0],u[1],h[0],h[1],m,f,l,b(3,d)),i.push(...r),a.push(p,p+1,p+2,p+1,p+3,p+2),{length:l+Math.sqrt((v[0]-g[0])*(v[0]-g[0])+(v[1]-g[1])*(v[1]-g[1])),angle:j}},e.render.webgl.utils.writePointFeatureToBuffers=function(e,t,n,s,o,i){const d=3+o,u=e[t+0],h=e[t+1],r=r7;r.length=o;for(let n=0;n<r.length;n++)r[n]=e[t+2+n];let a=i?i.vertexPosition:0,c=i?i.indexPosition:0;const l=a/d;return wl(n,a,u,h,0),r.length&&n.set(r,a+3),a+=d,wl(n,a,u,h,1),r.length&&n.set(r,a+3),a+=d,wl(n,a,u,h,2),r.length&&n.set(r,a+3),a+=d,wl(n,a,u,h,3),r.length&&n.set(r,a+3),a+=d,s[c++]=l,s[c++]=l+1,s[c++]=l+3,s[c++]=l+1,s[c++]=l+2,s[c++]=l+3,L1.vertexPosition=a,L1.indexPosition=c,L1},e.render.webgl.utils.writePolygonTrianglesToBuffers=function(e,t,n,s,o){const u=2+o;let i=t;const h=e.slice(i,i+o);i+=o;const c=e[i++];let a=0;const l=new Array(c-1);for(let t=0;t<c;t++)a+=e[i++],t<c-1&&(l[t]=a);const r=e.slice(i,i+2*a),d=s2(r,l,2);for(let e=0;e<d.length;e++)s.push(d[e]+n.length/u);for(let e=0;e<r.length;e+=2)n.push(r[e],r[e+1],...h);return i+2*a},e.renderer={},e.renderer.Composite=Pm,e.renderer.Layer=n4,e.renderer.Map=vm,e.renderer.canvas={},e.renderer.canvas.ImageLayer=r4,e.renderer.canvas.Layer=Wa,e.renderer.canvas.Layer.canvasPool=o4,e.renderer.canvas.TileLayer=h4,e.renderer.canvas.VectorImageLayer=Eh,e.renderer.canvas.VectorLayer=Eu,e.renderer.canvas.VectorTileLayer=Sh,e.renderer.vector={},e.renderer.vector.defaultOrder=lf,e.renderer.vector.getSquaredTolerance=vi,e.renderer.vector.getTolerance=Rd,e.renderer.vector.renderFeature=bi,e.renderer.webgl={},e.renderer.webgl.Layer=ii,e.renderer.webgl.PointsLayer=t1,e.renderer.webgl.TileLayer=k2,e.renderer.webgl.TileLayer.Attributes=Ti,e.renderer.webgl.TileLayer.Uniforms=k,e.renderer.webgl.TileLayerBase=C1,e.renderer.webgl.TileLayerBase.Uniforms=A1,e.renderer.webgl.TileLayerBase.getCacheKey=kl,e.renderer.webgl.TileLayerBase.newTileRepresentationLookup=b2,e.renderer.webgl.VectorLayer=class extends ii{constructor(e,t){super(e,{uniforms:{[_s.RENDER_EXTENT]:[0,0,0,0],[_s.PATTERN_ORIGIN]:[0,0],[_s.GLOBAL_ALPHA]:1},postProcesses:t.postProcesses}),this.hitDetectionEnabled_=!t.disableHitDetection,this.hitRenderTarget_,this.sourceRevision_=-1,this.previousExtent_=[1/0,1/0,-1/0,-1/0],this.currentTransform_=[1,0,0,1,0,0],this.tmpCoords_=[0,0],this.tmpTransform_=[1,0,0,1,0,0],this.tmpMat4_=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.currentFrameStateTransform_=[1,0,0,1,0,0],this.styles_=[],this.styleRenderers_=[],this.buffers_=[],this.applyOptions_(t),this.batch_=new u1,this.initialFeaturesAdded_=!1,this.sourceListenKeys_=null}addInitialFeatures_(e){const t=this.getLayer().getSource(),s=le();let n;s&&(n=De(s,e.viewState.projection)),this.batch_.addFeatures(t.getFeatures(),n),this.sourceListenKeys_=[m(t,$n,this.handleSourceFeatureAdded_.bind(this,n),this),m(t,$u,this.handleSourceFeatureChanged_,this),m(t,Ms,this.handleSourceFeatureDelete_,this),m(t,Wu,this.handleSourceFeatureClear_,this)]}applyOptions_(e){this.styles_=Array.isArray(e.style)?e.style:[e.style]}createRenderers_(){this.buffers_=[],this.styleRenderers_=this.styles_.map(e=>new Zu(e,this.helper,this.hitDetectionEnabled_))}reset(e){this.applyOptions_(e),this.helper&&this.createRenderers_(),super.reset(e)}afterHelperCreated(){this.createRenderers_(),this.hitDetectionEnabled_&&(this.hitRenderTarget_=new Fc(this.helper))}handleSourceFeatureAdded_(e,t){const n=t.feature;this.batch_.addFeature(n,e)}handleSourceFeatureChanged_(e){const t=e.feature;this.batch_.changeFeature(t)}handleSourceFeatureDelete_(e){const t=e.feature;this.batch_.removeFeature(t)}handleSourceFeatureClear_(){this.batch_.clear()}applyUniforms_(e){Ui(this.tmpTransform_,this.currentFrameStateTransform_),dn(this.tmpTransform_,e),this.helper.setUniformMatrixValue(_s.PROJECTION_MATRIX,ln(this.tmpMat4_,this.tmpTransform_)),Kt(this.tmpTransform_,this.tmpTransform_),this.helper.setUniformMatrixValue(_s.SCREEN_TO_WORLD_MATRIX,ln(this.tmpMat4_,this.tmpTransform_)),this.tmpCoords_[0]=0,this.tmpCoords_[1]=0,Kt(this.tmpTransform_,e),R(this.tmpTransform_,this.tmpCoords_),this.helper.setUniformFloatVec2(_s.PATTERN_ORIGIN,this.tmpCoords_)}renderFrame(e){const n=this.helper.getGL();this.preRender(n,e);const[s,o,i]=u3(e,this.getLayer());this.helper.prepareDraw(e),this.renderWorlds(e,!1,s,o,i),this.helper.finalizeDraw(e);const t=this.helper.getCanvas(),a=e.layerStatesArray[e.layerIndex].opacity;return a!==parseFloat(t.style.opacity)&&(t.style.opacity=String(a)),this.hitDetectionEnabled_&&(this.renderWorlds(e,!0,s,o,i),this.hitRenderTarget_.clearCachedData()),this.postRender(n,e),t}prepareFrameInternal(e){this.initialFeaturesAdded_||(this.addInitialFeatures_(e),this.initialFeaturesAdded_=!0);const n=this.getLayer(),t=n.getSource(),s=e.viewState,i=!e.viewHints[Ae]&&!e.viewHints[ze],a=!Ue(this.previousExtent_,e.extent),o=this.sourceRevision_<t.getRevision();if(o&&(this.sourceRevision_=t.getRevision()),i&&(a||o)){const a=s.projection,o=s.resolution,c=n instanceof Un?n.getRenderBuffer():0,r=Fe(e.extent,c*o),i=le();i?t.loadFeatures(Tt(r,i),fu(o,a),i):t.loadFeatures(r,o,a),this.ready=!1;const l=this.helper.makeProjectionTransform(e,[1,0,0,1,0,0]),d=this.styleRenderers_.map((e,t)=>e.generateBuffers(this.batch_,l).then(e=>{this.buffers_[t]=e}));Promise.all(d).then(()=>{this.ready=!0,this.getLayer().changed()}),this.previousExtent_=e.extent.slice()}return!0}renderWorlds(e,t,n,s,o){let i=n;t&&(this.hitRenderTarget_.setSize([Math.floor(e.size[0]/2),Math.floor(e.size[1]/2)]),this.helper.prepareDrawToRenderTarget(e,this.hitRenderTarget_,!0));do{this.helper.makeProjectionTransform(e,this.currentFrameStateTransform_),Ko(this.currentFrameStateTransform_,i*o,0);for(let n=0,o=this.styleRenderers_.length;n<o;n++){const i=this.styleRenderers_[n],s=this.buffers_[n];s&&i.render(s,e,()=>{this.applyUniforms_(s.invertVerticesTransform),this.helper.applyHitDetectionUniform(t)})}}while(++i<s)}forEachFeatureAtCoordinate(e,t,n,s){if(x(this.hitDetectionEnabled_,"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has been disabled using the `disableHitDetection: true` option."),!this.styleRenderers_.length||!this.hitDetectionEnabled_)return;const a=R(t.coordinateToPixelTransform,e.slice()),i=this.hitRenderTarget_.readPixel(a[0]/2,a[1]/2),c=z1([i[0]/255,i[1]/255,i[2]/255,i[3]/255]),r=this.batch_.getFeatureFromRef(c);return r?s(r,this.getLayer(),null):void 0}disposeInternal(){this.sourceListenKeys_&&(this.sourceListenKeys_.forEach(function(e){T(e)}),this.sourceListenKeys_=null),super.disposeInternal()}},e.renderer.webgl.VectorLayer.Uniforms=_s,e.renderer.webgl.VectorTileLayer=class extends C1{constructor(e,t){super(e,{cacheSize:t.cacheSize,uniforms:{[de.PATTERN_ORIGIN]:[0,0],[de.TILE_MASK_TEXTURE]:()=>this.tileMaskTarget_.getTexture()}}),this.hitDetectionEnabled_=!t.disableHitDetection,this.styles_=[],this.styleRenderers_=[],this.currentFrameStateTransform_=[1,0,0,1,0,0],this.tmpTransform_=[1,0,0,1,0,0],this.tmpMat4_=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.tileMaskTarget_=null,this.tileMaskIndices_=new on(As,go),this.tileMaskIndices_.fromArray([0,1,3,1,2,3]),this.tileMaskAttributes_=[{name:F3.POSITION,size:2,type:he.FLOAT}],this.tileMaskProgram_,this.applyOptions_(t)}reset(e){super.reset(e),this.applyOptions_(e),this.helper&&(this.createRenderers_(),this.initTileMask_())}applyOptions_(e){this.styles_=Array.isArray(e.style)?e.style:[e.style]}createRenderers_(){function e(e){const t=e.getFragmentDiscardExpression(),n=`texture2D(${de.TILE_MASK_TEXTURE}, gl_FragCoord.xy / u_pixelRatio / u_viewportSizePx).r * 50. > ${de.TILE_ZOOM_LEVEL} + 0.5`;e.setFragmentDiscardExpression("false"!==t?`(${t}) || (${n})`:n),e.addUniform(`sampler2D ${de.TILE_MASK_TEXTURE}`),e.addUniform(`float ${de.TILE_ZOOM_LEVEL}`)}this.styleRenderers_=this.styles_.map(t=>{let n;if("builder"in t)e(t.builder),n=t;else{const s=xc(t);e(s.builder),n={builder:s.builder,attributes:s.attributes,uniforms:s.uniforms}}return new Zu(n,this.helper,this.hitDetectionEnabled_)})}initTileMask_(){this.tileMaskTarget_=new Fc(this.helper);const e=(new Yc).setFillColorExpression(`vec4(${de.TILE_ZOOM_LEVEL} / 50., 0., 0., 1.)`).addUniform(`float ${de.TILE_ZOOM_LEVEL}`);this.tileMaskProgram_=this.helper.getProgram(e.getFillFragmentShader(),e.getFillVertexShader()),this.helper.flushBufferData(this.tileMaskIndices_)}afterHelperCreated(){this.createRenderers_(),this.initTileMask_()}createTileRepresentation(e){const t=new X2(e,this.styleRenderers_),n=()=>{t.ready&&(this.getLayer().changed(),t.removeEventListener(A,n))};return t.addEventListener(A,n),t}beforeTilesRender(e){super.beforeTilesRender(e,!0),this.helper.makeProjectionTransform(e,this.currentFrameStateTransform_)}beforeTilesMaskRender(e){this.helper.makeProjectionTransform(e,this.currentFrameStateTransform_);const t=e.pixelRatio,n=e.size;return this.tileMaskTarget_.setSize([n[0]*t,n[1]*t]),this.helper.prepareDrawToRenderTarget(e,this.tileMaskTarget_,!0,!0),this.helper.useProgram(this.tileMaskProgram_,e),Ui(this.tmpTransform_,this.currentFrameStateTransform_),this.helper.setUniformMatrixValue(de.PROJECTION_MATRIX,ln(this.tmpMat4_,this.tmpTransform_)),Kt(this.tmpTransform_,this.currentFrameStateTransform_),this.helper.setUniformMatrixValue(de.SCREEN_TO_WORLD_MATRIX,ln(this.tmpMat4_,this.tmpTransform_)),!0}renderTileMask(e,t,n,s){if(!e.ready)return;this.helper.setUniformFloatValue(de.DEPTH,s),this.helper.setUniformFloatValue(de.TILE_ZOOM_LEVEL,t),this.helper.setUniformFloatVec4(de.RENDER_EXTENT,n),this.helper.setUniformFloatValue(de.GLOBAL_ALPHA,1),this.helper.bindBuffer(e.maskVertices),this.helper.bindBuffer(this.tileMaskIndices_),this.helper.enableAttributes(this.tileMaskAttributes_);const o=this.tileMaskIndices_.getSize();this.helper.drawElements(0,o)}applyUniforms_(e,t,n,s,o){Ui(this.tmpTransform_,this.currentFrameStateTransform_),dn(this.tmpTransform_,n),this.helper.setUniformMatrixValue(de.PROJECTION_MATRIX,ln(this.tmpMat4_,this.tmpTransform_)),Kt(this.tmpTransform_,this.currentFrameStateTransform_),this.helper.setUniformMatrixValue(de.SCREEN_TO_WORLD_MATRIX,ln(this.tmpMat4_,this.tmpTransform_)),this.helper.setUniformFloatValue(de.GLOBAL_ALPHA,e),this.helper.setUniformFloatValue(de.DEPTH,o),this.helper.setUniformFloatValue(de.TILE_ZOOM_LEVEL,s),this.helper.setUniformFloatVec4(de.RENDER_EXTENT,t)}renderTile(e,t,n,s,o,i,a,r,c,l,d){const u=ce(r,s,r),h=e.tile.getTileCoord()[0];for(let t=0,o=this.styleRenderers_.length;t<o;t++){const i=this.styleRenderers_[t],s=e.buffers[t];i.render(s,n,()=>{this.applyUniforms_(d,u,s.invertVerticesTransform,h,c)})}}renderDeclutter(){}disposeInternal(){super.disposeInternal()}},e.renderer.webgl.VectorTileLayer.Attributes=F3,e.renderer.webgl.VectorTileLayer.Uniforms=de,e.reproj={},e.reproj.DataTile=Nr,e.reproj.Image=C2,e.reproj.Tile=Es,e.reproj.Triangulation=qc,e.reproj.calculateSourceExtentResolution=Kd,e.reproj.calculateSourceResolution=uo,e.reproj.canvasPool=Nt,e.reproj.common={},e.reproj.common.ERROR_THRESHOLD=Gd,e.reproj.render=Gc,e.resolution={},e.resolution.fromResolutionLike=xi,e.resolutionconstraint={},e.resolutionconstraint.createMinMaxResolution=J1,e.resolutionconstraint.createSnapToPower=F0,e.resolutionconstraint.createSnapToResolutions=z0,e.rotationconstraint={},e.rotationconstraint.createSnapToN=A0,e.rotationconstraint.createSnapToZero=_0,e.rotationconstraint.disable=zc,e.rotationconstraint.none=t4,e.size={},e.size.buffer=function(e,t,n){return void 0===n&&(n=[0,0]),n[0]=e[0]+2*t,n[1]=e[1]+2*t,n},e.size.hasArea=j4,e.size.scale=y4,e.size.toSize=X,e.source={},e.source.BingMaps=class extends Dt{constructor(e){const t=void 0!==e.hidpi&&e.hidpi;super({cacheSize:e.cacheSize,crossOrigin:"anonymous",interpolate:e.interpolate,opaque:!0,projection:d("EPSG:3857"),reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,tilePixelRatio:t?2:1,wrapX:void 0===e.wrapX||e.wrapX,transition:e.transition,zDirection:e.zDirection}),this.hidpi_=t,this.culture_=void 0!==e.culture?e.culture:"en-us",this.maxZoom_=void 0!==e.maxZoom?e.maxZoom:-1,this.apiKey_=e.key,this.imagerySet_=e.imagerySet,this.placeholderTiles_=e.placeholderTiles;const n="https://dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this.imagerySet_+"?uriScheme=https&include=ImageryProviders&key="+this.apiKey_+"&c="+this.culture_;fetch(n).then(e=>e.json()).then(e=>this.handleImageryMetadataResponse(e))}getApiKey(){return this.apiKey_}getImagerySet(){return this.imagerySet_}handleImageryMetadataResponse(e){if(200!=e.statusCode||"OK"!=e.statusDescription||"ValidCredentials"!=e.authenticationResultCode||1!=e.resourceSets.length||1!=e.resourceSets[0].resources.length)return void this.setState("error");const t=e.resourceSets[0].resources[0],o=-1==this.maxZoom_?t.zoomMax:this.maxZoom_,i=Yt(this.getProjection()),n=this.hidpi_?2:1,a=t.imageWidth==t.imageHeight?t.imageWidth/n:[t.imageWidth/n,t.imageHeight/n],r=Mn({extent:i,minZoom:t.zoomMin,maxZoom:o,tileSize:a});this.tileGrid=r;const c=this.culture_,l=this.hidpi_,s=this.placeholderTiles_;if(this.tileUrlFunction=Xo(t.imageUrlSubdomains.map(function(e){const n=[0,0,0],o=t.imageUrl.replace("{subdomain}",e).replace("{culture}",c);return function(e){if(!e)return;wo(e[0],e[1],e[2],n);const r=new URL(o.replace("{quadkey}",zh(n))),a=r.searchParams;return l&&(a.set("dpi","d1"),a.set("device","mobile")),!0===s?a.delete("n"):!1===s&&a.set("n","z"),r.toString()}})),t.imageryProviders){const e=De(d("EPSG:4326"),this.getProjection());this.setAttributions(n=>{const s=[],o=n.viewState,i=this.getTileGrid(),r=i.getZForResolution(o.resolution,this.zDirection),a=i.getTileCoordForCoordAndZ(o.center,r)[0];return t.imageryProviders.map(function(t){let o=!1;const i=t.coverageAreas;for(let t=0,r=i.length;t<r;++t){const s=i[t];if(a>=s.zoomMin&&a<=s.zoomMax){const t=s.bbox;if(U(Fs([t[1],t[0],t[3],t[2]],e),n.extent)){o=!0;break}}}o&&s.push(t.attribution)}),s.push('<a class="ol-attribution-bing-tos" href="https://www.microsoft.com/maps/product/terms.html" target="_blank">Terms of Use</a>'),s})}this.setState("ready")}},e.source.BingMaps.quadKey=zh,e.source.CartoDB=class extends si{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,maxZoom:void 0!==e.maxZoom?e.maxZoom:18,minZoom:e.minZoom,projection:e.projection,transition:e.transition,wrapX:e.wrapX,zDirection:e.zDirection}),this.account_=e.account,this.mapId_=e.map||"",this.config_=e.config||{},this.templateCache_={},this.initializeMap_()}getConfig(){return this.config_}updateConfig(e){Object.assign(this.config_,e),this.initializeMap_()}setConfig(e){this.config_=e||{},this.initializeMap_()}initializeMap_(){const t=JSON.stringify(this.config_);if(this.templateCache_[t])return void this.applyTemplate_(this.templateCache_[t]);let n="https://"+this.account_+".carto.com/api/v1/map";this.mapId_&&(n+="/named/"+this.mapId_);const e=new XMLHttpRequest;e.addEventListener("load",this.handleInitResponse_.bind(this,t)),e.addEventListener("error",this.handleInitError_.bind(this)),e.open("POST",n),e.setRequestHeader("Content-type","application/json"),e.send(JSON.stringify(this.config_))}handleInitResponse_(e,t){const n=t.target;if(!n.status||n.status>=200&&n.status<300){let t;try{t=JSON.parse(n.responseText)}catch{return void this.setState("error")}this.applyTemplate_(t),this.templateCache_[e]=t,this.setState("ready")}else this.setState("error")}handleInitError_(){this.setState("error")}applyTemplate_(e){const t="https://"+e.cdn_url.https+"/"+this.account_+"/api/v1/map/"+e.layergroupid+"/{z}/{x}/{y}.png";this.setUrl(t)}},e.source.Cluster=class extends ws{constructor(e){super({attributions:(e=e||{}).attributions,wrapX:e.wrapX}),this.resolution=void 0,this.distance=void 0!==e.distance?e.distance:20,this.minDistance=e.minDistance||0,this.interpolationRatio=0,this.features=[],this.geometryFunction=e.geometryFunction||function(e){const t=e.getGeometry();return x(!t||"Point"===t.getType(),"The default `geometryFunction` can only handle `Point` or null geometries"),t},this.createCustomCluster_=e.createCluster,this.source=null,this.boundRefresh_=this.refresh.bind(this),this.updateDistance(this.distance,this.minDistance),this.setSource(e.source||null)}clear(e){this.features.length=0,super.clear(e)}getDistance(){return this.distance}getSource(){return this.source}loadFeatures(e,t,n){this.source?.loadFeatures(e,t,n),t!==this.resolution&&(this.resolution=t,this.refresh())}setDistance(e){this.updateDistance(e,this.minDistance)}setMinDistance(e){this.updateDistance(this.distance,e)}getMinDistance(){return this.minDistance}setSource(e){this.source&&this.source.removeEventListener(A,this.boundRefresh_),this.source=e,e&&e.addEventListener(A,this.boundRefresh_),this.refresh()}refresh(){this.clear(),this.cluster(),this.addFeatures(this.features)}updateDistance(e,t){const n=0===e?0:Math.min(t,e)/e,s=e!==this.distance||this.interpolationRatio!==n;this.distance=e,this.minDistance=t,this.interpolationRatio=n,s&&this.refresh()}cluster(){if(void 0===this.resolution||!this.source)return;const e=[1/0,1/0,-1/0,-1/0],s=this.distance*this.resolution,n=this.source.getFeatures(),t={};for(let o=0,a=n.length;o<a;o++){const i=n[o];if(!(c(i)in t)){const n=this.geometryFunction(i);if(n){hs(n.getCoordinates(),e),Fe(e,s,e);const o=this.source.getFeaturesInExtent(e).filter(function(e){const n=c(e);return!(n in t)&&(t[n]=!0,!0)});this.features.push(this.createCluster(o,e))}}}}createCluster(e,t){const n=[0,0];for(let t=e.length-1;t>=0;--t){const s=this.geometryFunction(e[t]);s?Jd(n,s.getCoordinates()):e.splice(t,1)}eu(n,1/e.length);const o=_e(t),s=this.interpolationRatio,i=new Y([n[0]*(1-s)+o[0]*s,n[1]*(1-s)+o[1]*s]);return this.createCustomCluster_?this.createCustomCluster_(i,e):new N({geometry:i,features:e})}},e.source.DataTile=A3,e.source.GeoTIFF=Y2,e.source.Google=class extends Dt{constructor(e){const n=!!e.highDpi,s=!0!==e.overlay;super({attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:"anonymous",interpolate:e.interpolate,opaque:s,projection:"EPSG:3857",reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,tilePixelRatio:n?2:1,wrapX:void 0===e.wrapX||e.wrapX,transition:e.transition,zDirection:e.zDirection}),this.apiKey_=e.key,this.error_=null;const t={mapType:e.mapType||"roadmap",language:e.language||"en-US",region:e.region||"US"};e.imageFormat&&(t.imageFormat=e.imageFormat),e.scale&&(t.scale=e.scale),n&&(t.highDpi=!0),e.layerTypes&&(t.layerTypes=e.layerTypes),e.styles&&(t.styles=e.styles),!0===e.overlay&&(t.overlay=!0),this.sessionTokenRequest_=t,this.sessionTokenValue_,this.sessionRefreshId_,this.previousViewportAttribution_,this.previousViewportExtent_,this.createSession_()}getError(){return this.error_}fetchSessionToken(e,t){return fetch(e,t)}async createSession_(){const o="https://tile.googleapis.com/v1/createSession?key="+this.apiKey_,i={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.sessionTokenRequest_)},t=await this.fetchSessionToken(o,i);if(!t.ok){try{const e=await t.json();this.error_=new Error(e.error.message)}catch{this.error_=new Error("Error fetching session token")}return void this.setState("error")}const e=await t.json(),n=this.getTilePixelRatio(1),a=[e.tileWidth/n,e.tileHeight/n];this.tileGrid=Mn({extent:Yt(this.getProjection()),maxZoom:22,tileSize:a});const s=e.session;this.sessionTokenValue_=s;const r=this.apiKey_;this.tileUrlFunction=function(e){return`https://tile.googleapis.com/v1/2dtiles/${e[0]}/${e[1]}/${e[2]}?session=${s}&key=${r}`};const c=1e3*parseInt(e.expiry,10),l=Math.max(c-Date.now()-6e4,1);this.sessionRefreshId_=setTimeout(()=>this.createSession_(),l),this.setAttributions(this.fetchAttributions_.bind(this)),this.setState("ready")}async fetchAttributions_(e){if(e.viewHints[Ae]||e.viewHints[ze]||e.animate)return this.previousViewportAttribution_;const[n,s]=mu(xn(e.extent),e.viewState.projection),[o,i]=mu(Rs(e.extent),e.viewState.projection),t=`zoom=${this.getTileGrid().getZForResolution(e.viewState.resolution,this.zDirection)}&north=${i}&south=${s}&east=${o}&west=${n}`;if(this.previousViewportExtent_==t)return this.previousViewportAttribution_;this.previousViewportExtent_=t;const a=`https://tile.googleapis.com/tile/v1/viewport?session=${this.sessionTokenValue_}&key=${this.apiKey_}&${t}`;return this.previousViewportAttribution_=await fetch(a).then(e=>e.json()).then(e=>e.copyright),this.previousViewportAttribution_}disposeInternal(){clearTimeout(this.sessionRefreshId_),super.disposeInternal()}},e.source.IIIF=class extends Dt{constructor(e){const n=e||{};let h=n.url||"";h+=h.lastIndexOf("/")===h.length-1||""===h?"":"/";const f=n.version||ma,l=n.sizes||[],d=n.size;x(d!=null&&Array.isArray(d)&&2==d.length&&!isNaN(d[0])&&d[0]>0&&!isNaN(d[1])&&d[1]>0,"Missing or invalid `size`");const o=d[0],r=d[1],t=n.tileSize,y=n.tilePixelRatio||1,j=n.format||"jpg",b=n.quality||(n.version==_n?"native":"default");let c=n.resolutions||[];const s=n.supports||[],v=n.extent||[0,-r,o,0],g=l!=null&&Array.isArray(l)&&l.length>0,p=void 0!==t&&("number"==typeof t&&Number.isInteger(t)&&t>0||Array.isArray(t)&&t.length>0),m=s!=null&&Array.isArray(s)&&(s.includes("regionByPx")||s.includes("regionByPct"))&&(s.includes("sizeByWh")||s.includes("sizeByH")||s.includes("sizeByW")||s.includes("sizeByPct"));let i,a,u;if(c.sort(function(e,t){return t-e}),p||m)if(t!=null&&("number"==typeof t&&Number.isInteger(t)&&t>0?(i=t,a=t):Array.isArray(t)&&t.length>0&&((1==t.length||null==t[1]&&Number.isInteger(t[0]))&&(i=t[0],a=t[0]),2==t.length&&(Number.isInteger(t[0])&&Number.isInteger(t[1])?(i=t[0],a=t[1]):null==t[0]&&Number.isInteger(t[1])&&(i=t[1],a=t[1])))),void 0!==i&&void 0!==a||(i=Ys,a=Ys),0==c.length){u=Math.max(Math.ceil(Math.log(o/i)/Math.LN2),Math.ceil(Math.log(r/a)/Math.LN2));for(let e=u;e>=0;e--)c.push(Math.pow(2,e))}else{const e=Math.max(...c);u=Math.round(Math.log(e)/Math.LN2)}else if(i=o,a=r,c=[],g){{l.sort(function(e,t){return e[0]-t[0]}),u=-1;const e=[];for(let t=0;t<l.length;t++){const n=o/l[t][0];c.length>0&&c[c.length-1]==n?e.push(t):(c.push(n),u++)}if(e.length>0)for(let t=0;t<e.length;t++)l.splice(e[t]-t,1)}}else c.push(1),l.push([o,r]),u=0;const _=new tn({tileSize:[i,a],extent:v,origin:ht(v),resolutions:c}),w=h1.bind(null,X(t||256).map(function(e){return e*y}));super({attributions:n.attributions,attributionsCollapsible:n.attributionsCollapsible,cacheSize:n.cacheSize,crossOrigin:n.crossOrigin,interpolate:n.interpolate,projection:n.projection,reprojectionErrorThreshold:n.reprojectionErrorThreshold,state:n.state,tileClass:w,tileGrid:_,tilePixelRatio:n.tilePixelRatio,tileUrlFunction:function(e){let y,v;const _=e[0];if(_>u)return;const w=e[1],O=e[2],d=c[_];if(!(void 0===w||void 0===O||void 0===d||w<0||Math.ceil(o/d/i)<=w||O<0||Math.ceil(r/d/a)<=O)){if(m||p){const e=w*i*d,t=O*a*d;let n=i*d,c=a*d,l=i,u=a;e+n>o&&(n=o-e),t+c>r&&(c=r-t),e+i*d>o&&(l=Math.floor((o-e+d-1)/d)),t+a*d>r&&(u=Math.floor((r-t+d-1)/d)),0==e&&n==o&&0==t&&c==r?y="full":!m||s.includes("regionByPx")?y=e+","+t+","+n+","+c:s.includes("regionByPct")&&(y="pct:"+_a(e/o*100)+","+_a(t/r*100)+","+_a(n/o*100)+","+_a(c/r*100)),f!=zs||m&&!s.includes("sizeByWh")?!m||s.includes("sizeByW")?v=l+",":s.includes("sizeByH")?v=","+u:s.includes("sizeByWh")?v=l+","+u:s.includes("sizeByPct")&&(v="pct:"+_a(100/d)):v=l+","+u}else if(y="full",g){const e=l[_][0],t=l[_][1];v=f==zs?e==o&&t==r?"max":e+","+t:e==o?"full":e+","}else v=f==zs?"max":"full";return h+y+"/"+v+"/0/"+b+"."+j}},transition:n.transition}),this.zDirection=n.zDirection}},e.source.Image=Vn,e.source.Image.ImageSourceEvent=_2,e.source.Image.defaultImageLoadFunction=xa,e.source.Image.getRequestExtent=Ca,e.source.ImageArcGISRest=class extends Vn{constructor(e){super({attributions:(e=e||{}).attributions,interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions}),this.crossOrigin_=void 0!==e.crossOrigin?e.crossOrigin:null,this.hidpi_=void 0===e.hidpi||e.hidpi,this.url_=e.url,this.imageLoadFunction_=void 0!==e.imageLoadFunction?e.imageLoadFunction:xa,this.params_=Object.assign({},e.params),this.imageSize_=[0,0],this.renderedRevision_=0,this.ratio_=void 0!==e.ratio?e.ratio:1.5,this.loaderProjection_=null}getParams(){return this.params_}getImageInternal(e,t,n,s){return void 0===this.url_?null:(this.loader&&this.loaderProjection_===s||(this.loaderProjection_=s,this.loader=l2({crossOrigin:this.crossOrigin_,params:this.params_,projection:s,hidpi:this.hidpi_,url:this.url_,ratio:this.ratio_,load:(e,t)=>(this.image.setImage(e),this.imageLoadFunction_(this.image,t),hn(e))})),super.getImageInternal(e,t,n,s))}getImageLoadFunction(){return this.imageLoadFunction_}getUrl(){return this.url_}setImageLoadFunction(e){this.imageLoadFunction_=e,this.changed()}setUrl(e){e!=this.url_&&(this.url_=e,this.loader=null,this.changed())}updateParams(e){Object.assign(this.params_,e),this.changed()}changed(){this.image=null,super.changed()}},e.source.ImageCanvas=class extends Vn{constructor(e){super({attributions:(e=e||{}).attributions,interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions,state:e.state}),this.canvasFunction_=e.canvasFunction,this.canvas_=null,this.renderedRevision_=0,this.ratio_=void 0!==e.ratio?e.ratio:1.5}getImageInternal(e,t,n,s){t=this.findNearestResolution(t);let o=this.canvas_;if(o&&this.renderedRevision_==this.getRevision()&&o.getResolution()==t&&o.getPixelRatio()==n&&xe(o.getExtent(),e))return o;Rr(e=e.slice(),this.ratio_);const a=[b(e)/t*n,W(e)/t*n],i=this.canvasFunction_.call(this,e,t,n,a,s);return i&&(o=new ol(e,t,n,i)),this.canvas_=o,this.renderedRevision_=this.getRevision(),o}},e.source.ImageMapGuide=class extends Vn{constructor(e){super({interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions}),this.crossOrigin_=void 0!==e.crossOrigin?e.crossOrigin:null,this.displayDpi_=void 0!==e.displayDpi?e.displayDpi:96,this.params_=Object.assign({},e.params),this.url_=e.url,this.imageLoadFunction_=void 0!==e.imageLoadFunction?e.imageLoadFunction:xa,this.hidpi_=void 0===e.hidpi||e.hidpi,this.metersPerUnit_=void 0!==e.metersPerUnit?e.metersPerUnit:1,this.ratio_=void 0!==e.ratio?e.ratio:1,this.useOverlay_=void 0!==e.useOverlay&&e.useOverlay,this.renderedRevision_=0,this.loaderProjection_=null}getParams(){return this.params_}getImageInternal(e,t,n,s){return void 0===this.url_?null:(this.loader&&this.loaderProjection_===s||(this.loaderProjection_=s,this.loader=r2({crossOrigin:this.crossOrigin_,params:this.params_,hidpi:this.hidpi_,metersPerUnit:this.metersPerUnit_,url:this.url_,useOverlay:this.useOverlay_,ratio:this.ratio_,load:(e,t)=>(this.image.setImage(e),this.imageLoadFunction_(this.image,t),hn(e))})),super.getImageInternal(e,t,n,s))}getImageLoadFunction(){return this.imageLoadFunction_}updateParams(e){Object.assign(this.params_,e),this.changed()}setImageLoadFunction(e){this.imageLoadFunction_=e,this.changed()}changed(){this.image=null,super.changed()}},e.source.ImageStatic=class extends Vn{constructor(e){const t=void 0!==e.crossOrigin?e.crossOrigin:null,n=void 0!==e.imageLoadFunction?e.imageLoadFunction:xa;super({attributions:e.attributions,interpolate:e.interpolate,projection:d(e.projection)}),this.url_=e.url,this.imageExtent_=e.imageExtent,this.image=null,this.image=new wi(this.imageExtent_,void 0,1,a2({url:e.url,imageExtent:e.imageExtent,crossOrigin:t,load:(e,t)=>(this.image.setImage(e),n(this.image,t),hn(e))})),this.image.addEventListener(A,this.handleImageChange.bind(this))}getImageExtent(){return this.imageExtent_}getImageInternal(e){return U(e,this.image.getExtent())?this.image:null}getUrl(){return this.url_}},e.source.ImageWMS=class extends Vn{constructor(e){super({attributions:(e=e||{}).attributions,interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions}),this.crossOrigin_=void 0!==e.crossOrigin?e.crossOrigin:null,this.url_=e.url,this.imageLoadFunction_=void 0!==e.imageLoadFunction?e.imageLoadFunction:xa,this.params_=Object.assign({},e.params),this.serverType_=e.serverType,this.hidpi_=void 0===e.hidpi||e.hidpi,this.renderedRevision_=0,this.ratio_=void 0!==e.ratio?e.ratio:1.5,this.loaderProjection_=null}getFeatureInfoUrl(e,t,n,s){const i=d(n),o=this.getProjection();return o&&o!==i&&(t=uo(o,i,e,t),e=Jn(e,i,o)),e2({url:this.url_,params:{...this.params_,...s},projection:o||i},e,t)}getLegendUrl(e,t){return Q0({url:this.url_,params:{...this.params_,...t}},e)}getParams(){return this.params_}getImageInternal(e,t,n,s){return void 0===this.url_?null:(this.loader&&this.loaderProjection_===s||(this.loaderProjection_=s,this.loader=t2({crossOrigin:this.crossOrigin_,params:this.params_,projection:s,serverType:this.serverType_,hidpi:this.hidpi_,url:this.url_,ratio:this.ratio_,load:(e,t)=>(this.image.setImage(e),this.imageLoadFunction_(this.image,t),hn(e))})),super.getImageInternal(e,t,n,s))}getImageLoadFunction(){return this.imageLoadFunction_}getUrl(){return this.url_}setImageLoadFunction(e){this.imageLoadFunction_=e,this.changed()}setUrl(e){e!=this.url_&&(this.url_=e,this.loader=null,this.changed())}updateParams(e){Object.assign(this.params_,e),this.changed()}changed(){this.image=null,super.changed()}},e.source.OGCMapTile=class extends Dt{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,wrapX:void 0===e.wrapX||e.wrapX,transition:e.transition}),Q1({url:e.url,projection:this.getProjection(),mediaType:e.mediaType,context:e.context||null,collections:e.collections}).then(this.handleTileSetInfo_.bind(this)).catch(this.handleError_.bind(this))}handleTileSetInfo_(e){this.tileGrid=e.grid,this.setTileUrlFunction(e.urlFunction,e.urlTemplate),this.setState("ready")}handleError_(e){Mo(e),this.setState("error")}},e.source.OGCVectorTile=class extends D0{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,format:e.format,overlaps:e.overlaps,projection:e.projection,tileClass:e.tileClass,transition:e.transition,wrapX:e.wrapX,zDirection:e.zDirection,state:"loading"}),Q1({url:e.url,projection:this.getProjection(),mediaType:e.mediaType,supportedMediaTypes:e.format.supportedMediaTypes,context:e.context||null,collections:e.collections}).then(this.handleTileSetInfo_.bind(this)).catch(this.handleError_.bind(this))}handleTileSetInfo_(e){this.tileGrid=e.grid,this.setTileUrlFunction(e.urlFunction,e.urlTemplate),this.setState("ready")}handleError_(e){Mo(e),this.setState("error")}},e.source.OSM=class extends si{constructor(e){let t;t=void 0!==(e=e||{}).attributions?e.attributions:[e4];const n=void 0!==e.crossOrigin?e.crossOrigin:"anonymous",s=void 0!==e.url?e.url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png";super({attributions:t,attributionsCollapsible:!1,cacheSize:e.cacheSize,crossOrigin:n,interpolate:e.interpolate,maxZoom:void 0!==e.maxZoom?e.maxZoom:19,opaque:void 0===e.opaque||e.opaque,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileLoadFunction:e.tileLoadFunction,transition:e.transition,url:s,wrapX:e.wrapX,zDirection:e.zDirection})}},e.source.OSM.ATTRIBUTION=e4,e.source.Raster=K4,e.source.Raster.Processor=G4,e.source.Raster.RasterSourceEvent=w4,e.source.Raster.newImageData=e0,e.source.Source=jo,e.source.StadiaMaps=class extends si{constructor(e){const n=e.layer.indexOf("-"),a=-1==n?e.layer:e.layer.slice(0,n),t=Ov[a]||{minZoom:0,maxZoom:20,retina:!0},s=wv[e.layer],r=e.apiKey?"?api_key="+e.apiKey:"",o=t.retina&&e.retina?"@2x":"",c=void 0!==e.url?e.url:"https://tiles.stadiamaps.com/tiles/"+e.layer+"/{z}/{x}/{y}"+o+"."+s.extension+r,i=['&copy; <a href="https://www.stadiamaps.com/" target="_blank">Stadia Maps</a>','&copy; <a href="https://openmaptiles.org/" target="_blank">OpenMapTiles</a>',e4];e.layer.startsWith("stamen_")&&i.splice(1,0,'&copy; <a href="https://stamen.com/" target="_blank">Stamen Design</a>'),super({attributions:i,cacheSize:e.cacheSize,crossOrigin:"anonymous",interpolate:e.interpolate,maxZoom:void 0!==e.maxZoom?e.maxZoom:t.maxZoom,minZoom:void 0!==e.minZoom?e.minZoom:t.minZoom,opaque:s.opaque,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileLoadFunction:e.tileLoadFunction,transition:e.transition,url:c,tilePixelRatio:o?2:1,wrapX:e.wrapX,zDirection:e.zDirection})}},e.source.Tile=Ai,e.source.Tile.TileSourceEvent=pu,e.source.TileArcGISRest=class extends Dt{constructor(e){super({attributions:(e=e||{}).attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction,url:e.url,urls:e.urls,wrapX:void 0===e.wrapX||e.wrapX,transition:e.transition,zDirection:e.zDirection}),this.params_=Object.assign({},e.params),this.hidpi_=void 0===e.hidpi||e.hidpi,this.tmpExtent_=[1/0,1/0,-1/0,-1/0],this.setKey(this.getKeyForParams_())}getKeyForParams_(){let t=0;const e=[];for(const n in this.params_)e[t++]=n+"-"+this.params_[n];return e.join("/")}getParams(){return this.params_}getRequestUrl_(e,t,n,s,o,i){const a=this.urls;if(!a)return;let r;return 1==a.length?r=a[0]:r=a[ft(fl(e),a.length)],T1(r,n,(this.tileGrid||this.getTileGridForProjection(o)).getResolution(e[0]),s,o,i)}getTilePixelRatio(e){return this.hidpi_?e:1}updateParams(e){Object.assign(this.params_,e),this.setKey(this.getKeyForParams_())}tileUrlFunction(e,t,n){let s=this.getTileGrid();if(s||(s=this.getTileGridForProjection(n)),s.getResolutions().length<=e[0])return;1==t||this.hidpi_||(t=1);const a=s.getTileCoordExtent(e,this.tmpExtent_);let o=X(s.getTileSize(e[0]),this.tmpSize);1!=t&&(o=y4(o,t,this.tmpSize));const i={F:"image",FORMAT:"PNG32",TRANSPARENT:!0};return Object.assign(i,this.params_),this.getRequestUrl_(e,o,a,t,n,i)}},e.source.TileDebug=class extends si{constructor(e){super({opaque:!1,projection:(e=e||{}).projection,tileGrid:e.tileGrid,wrapX:void 0===e.wrapX||e.wrapX,zDirection:e.zDirection,url:e.template||"z:{z} x:{x} y:{y}",tileLoadFunction:(e,t)=>{const o=e.getTileCoord()[0],s=X(this.tileGrid.getTileSize(o)),n=K(s[0],s[1]);n.strokeStyle="grey",n.strokeRect(.5,.5,s[0]+.5,s[1]+.5),n.fillStyle="grey",n.strokeStyle="white",n.textAlign="center",n.textBaseline="middle",n.font="24px sans-serif",n.lineWidth=4,n.strokeText(t,s[0]/2,s[1]/2,s[0]),n.fillText(t,s[0]/2,s[1]/2,s[0]),e.setImage(n.canvas)}})}},e.source.TileImage=Dt,e.source.TileJSON=class extends Dt{constructor(e){if(super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:d("EPSG:3857"),reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,wrapX:void 0===e.wrapX||e.wrapX,transition:e.transition,zDirection:e.zDirection}),this.tileJSON_=null,this.tileSize_=e.tileSize,e.url)if(e.jsonp)rl(e.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{const t=new XMLHttpRequest;t.addEventListener("load",this.onXHRLoad_.bind(this)),t.addEventListener("error",this.onXHRError_.bind(this)),t.open("GET",e.url),t.send()}else{if(!e.tileJSON)throw new Error("Either `url` or `tileJSON` options must be provided");this.handleTileJSONResponse(e.tileJSON)}}onXHRLoad_(e){const t=e.target;if(!t.status||t.status>=200&&t.status<300){let e;try{e=JSON.parse(t.responseText)}catch{return void this.handleTileJSONError()}this.handleTileJSONResponse(e)}else this.handleTileJSONError()}onXHRError_(){this.handleTileJSONError()}getTileJSON(){return this.tileJSON_}handleTileJSONResponse(e){const i=d("EPSG:4326"),n=this.getProjection();let t;if(void 0!==e.bounds){const s=De(i,n);t=Fs(e.bounds,s)}const s=Yt(n),a=e.minzoom||0,o=Mn({extent:s,maxZoom:e.maxzoom||22,minZoom:a,tileSize:this.tileSize_});if(this.tileGrid=o,this.tileUrlFunction=Sc(e.tiles,o),e.attribution&&!this.getAttributions()){const n=void 0!==t?t:s;this.setAttributions(function(t){return U(n,t.extent)?[e.attribution]:null})}this.tileJSON_=e,this.setState("ready")}handleTileJSONError(){this.setState("error")}},e.source.TileWMS=class extends Dt{constructor(e){e=e||{};const t=Object.assign({},e.params),n=!("TRANSPARENT"in t)||t.TRANSPARENT;super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,opaque:!n,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:e.tileClass,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction,url:e.url,urls:e.urls,wrapX:void 0===e.wrapX||e.wrapX,transition:e.transition,zDirection:e.zDirection}),this.gutter_=void 0!==e.gutter?e.gutter:0,this.params_=t,this.v13_=!0,this.serverType_=e.serverType,this.hidpi_=void 0===e.hidpi||e.hidpi,this.tmpExtent_=[1/0,1/0,-1/0,-1/0],this.updateV13_(),this.setKey(this.getKeyForParams_())}getFeatureInfoUrl(e,t,n,s){const a=d(n),r=this.getProjection()||a;let o=this.getTileGrid();o||(o=this.getTileGridForProjection(r));const h=Jn(e,a,r),p=uo(r,a,e,t),m=o.getZForResolution(p,this.zDirection),l=o.getResolution(m),u=o.getTileCoordForCoordAndZ(h,m);if(o.getResolutions().length<=u[0])return;let i=o.getTileCoordExtent(u,this.tmpExtent_);const f=this.gutter_;0!==f&&(i=Fe(i,l*f,i));const c={QUERY_LAYERS:this.params_.LAYERS};Object.assign(c,Pa(this.params_,"GetFeatureInfo"),s);const g=Math.floor((h[0]-i[0])/l),v=Math.floor((i[3]-h[1])/l);return c[this.v13_?"I":"X"]=g,c[this.v13_?"J":"Y"]=v,this.getRequestUrl_(u,i,1,r||a,c)}getLegendUrl(e,t){if(void 0===this.urls[0])return;const n={SERVICE:"WMS",VERSION:La,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(void 0===t||void 0===t.LAYER){const e=this.params_.LAYERS;if(!!Array.isArray(e)&&1!==e.length)return;n.LAYER=e}if(void 0!==e){const t=this.getProjection()?this.getProjection().getMetersPerUnit():1,s=28e-5;n.SCALE=e*t/s}return Object.assign(n,t),Wn(this.urls[0],n)}getGutter(){return this.gutter_}getParams(){return this.params_}getRequestUrl_(e,t,n,s,o){const i=this.urls;if(!i)return;let a;return 1==i.length?a=i[0]:a=i[ft(fl(e),i.length)],Al(t,(this.tileGrid||this.getTileGridForProjection(s)).getResolution(e[0]),n,s,a,o,this.serverType_)}getTilePixelRatio(e){return this.hidpi_&&void 0!==this.serverType_?e:1}getKeyForParams_(){let t=0;const e=[];for(const n in this.params_)e[t++]=n+"-"+this.params_[n];return e.join("/")}updateParams(e){Object.assign(this.params_,e),this.updateV13_(),this.setKey(this.getKeyForParams_())}updateV13_(){const e=this.params_.VERSION||La;this.v13_=xr(e,"1.3")>=0}tileUrlFunction(e,t,n){let s=this.getTileGrid();if(s||(s=this.getTileGridForProjection(n)),s.getResolutions().length<=e[0])return;1==t||this.hidpi_&&void 0!==this.serverType_||(t=1);const a=s.getResolution(e[0]);let o=s.getTileCoordExtent(e,this.tmpExtent_);const i=this.gutter_;0!==i&&(o=Fe(o,a*i,o));const r=Object.assign({},Pa(this.params_,"GetMap"));return this.getRequestUrl_(e,o,t,n,r)}},e.source.UTFGrid=class extends Ai{constructor(e){if(super({projection:d("EPSG:3857"),state:"loading",wrapX:void 0===e.wrapX||e.wrapX,zDirection:e.zDirection}),this.preemptive_=void 0===e.preemptive||e.preemptive,this.tileUrlFunction_=Qh,this.template_=void 0,this.jsonp_=e.jsonp||!1,e.url)if(this.jsonp_)rl(e.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{const t=new XMLHttpRequest;t.addEventListener("load",this.onXHRLoad_.bind(this)),t.addEventListener("error",this.onXHRError_.bind(this)),t.open("GET",e.url),t.send()}else{if(!e.tileJSON)throw new Error("Either `url` or `tileJSON` options must be provided");this.handleTileJSONResponse(e.tileJSON)}}onXHRLoad_(e){const t=e.target;if(!t.status||t.status>=200&&t.status<300){let e;try{e=JSON.parse(t.responseText)}catch{return void this.handleTileJSONError()}this.handleTileJSONResponse(e)}else this.handleTileJSONError()}onXHRError_(){this.handleTileJSONError()}getTemplate(){return this.template_}forDataAtCoordinateAndResolution(e,t,n,s){if(this.tileGrid){const i=this.tileGrid.getZForResolution(t,this.zDirection),o=this.tileGrid.getTileCoordForCoordAndZ(e,i);this.getTile(o[0],o[1],o[2],1,this.getProjection()).forDataAtCoordinate(e,n,s)}else!0===s?setTimeout(function(){n(null)},0):n(null)}handleTileJSONError(){this.setState("error")}handleTileJSONResponse(e){const a=d("EPSG:4326"),n=this.getProjection();let t;if(void 0!==e.bounds){const s=De(a,n);t=Fs(e.bounds,s)}const s=Yt(n),r=e.minzoom||0,o=Mn({extent:s,maxZoom:e.maxzoom||22,minZoom:r});this.tileGrid=o,this.template_=e.template;const i=e.grids;if(i){if(this.tileUrlFunction_=Sc(i,o),e.attribution){const n=void 0!==t?t:s;this.setAttributions(function(t){return U(n,t.extent)?[e.attribution]:null})}this.setState("ready")}else this.setState("error")}getTile(e,t,n,s,o){const i=St(e,t,n);if(this.tileCache.containsKey(i))return this.tileCache.get(i);const a=[e,t,n],l=this.getTileCoordForTileUrlFunction(a,o),r=this.tileUrlFunction_(l,s,o),c=new L4(a,void 0!==r?ne:J,void 0!==r?r:"",this.tileGrid.getTileCoordExtent(a),this.preemptive_,this.jsonp_);return this.tileCache.set(i,c),c}useTile(e,t,n){const s=St(e,t,n);this.tileCache.containsKey(s)&&this.tileCache.get(s)}},e.source.UTFGrid.CustomTile=L4,e.source.UrlTile=Ec,e.source.Vector=ws,e.source.Vector.VectorSourceEvent=cn,e.source.VectorTile=D0,e.source.VectorTile.defaultLoadFunction=M0,e.source.WMTS=class extends Dt{constructor(e){const n=void 0!==e.requestEncoding?e.requestEncoding:"KVP",s=e.tileGrid;let t=e.urls;void 0===t&&void 0!==e.url&&(t=kc(e.url)),super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:e.tileClass,tileGrid:s,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,urls:t,wrapX:void 0!==e.wrapX&&e.wrapX,transition:e.transition,zDirection:e.zDirection}),this.version_=void 0!==e.version?e.version:"1.0.0",this.format_=void 0!==e.format?e.format:"image/jpeg",this.dimensions_=void 0!==e.dimensions?e.dimensions:{},this.layer_=e.layer,this.matrixSet_=e.matrixSet,this.style_=e.style,this.requestEncoding_=n,this.setKey(this.getKeyForDimensions_()),t&&t.length>0&&(this.tileUrlFunction=Xo(t.map(this.createFromWMTSTemplate.bind(this))))}setUrls(e){this.urls=e;const t=e.join(`
`);this.setTileUrlFunction(Xo(e.map(this.createFromWMTSTemplate.bind(this))),t)}getDimensions(){return this.dimensions_}getFormat(){return this.format_}getLayer(){return this.layer_}getMatrixSet(){return this.matrixSet_}getRequestEncoding(){return this.requestEncoding_}getStyle(){return this.style_}getVersion(){return this.version_}getKeyForDimensions_(){const e=this.urls?this.urls.slice(0):[];for(const t in this.dimensions_)e.push(t+"-"+this.dimensions_[t]);return e.join("/")}updateDimensions(e){Object.assign(this.dimensions_,e),this.setKey(this.getKeyForDimensions_())}createFromWMTSTemplate(e){const n=this.requestEncoding_,t={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};"KVP"==n&&Object.assign(t,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_}),e="KVP"==n?Wn(e,t):e.replace(/\{(\w+?)\}/g,function(e,n){return n.toLowerCase()in t?t[n.toLowerCase()]:e});const s=this.tileGrid,o=this.dimensions_;return function(t){if(!t)return;const c={TileMatrix:s.getMatrixId(t[0]),TileCol:t[1],TileRow:t[2]};Object.assign(c,o);let r=e;return r="KVP"==n?Wn(r,c):r.replace(/\{(\w+?)\}/g,function(e,t){return c[t]}),r}}},e.source.WMTS.optionsFromCapabilities=function(e,t){const x=e.Contents.Layer,n=x?.find(function(e){return e.Identifier==t.layer});if(!n)return null;const k=e.Contents.TileMatrixSet;let a;a=n.TileMatrixSetLink.length>1?"projection"in t?n.TileMatrixSetLink.findIndex(function(e){const n=k.find(function(t){return t.Identifier==e.TileMatrixSet}).SupportedCRS,s=d(n),o=d(t.projection);return s&&o?Oe(s,o):n==t.projection}):n.TileMatrixSetLink.findIndex(function(e){return e.TileMatrixSet==t.matrixSet}):0,a<0&&(a=0);const O=n.TileMatrixSetLink[a].TileMatrixSet,h=n.TileMatrixSetLink[a].TileMatrixSetLimits;let p=n.Format[0];"format"in t&&(p=t.format),a=n.Style.findIndex(function(e){return"style"in t?e.Title==t.style:e.isDefault}),a<0&&(a=0);const C=n.Style[a].Identifier,v={};"Dimension"in n&&n.Dimension.forEach(function(e){const o=e.Identifier;let s=e.Default;void 0===s&&(s=e.Value[0]),v[o]=s});const c=e.Contents.TileMatrixSet.find(function(e){return e.Identifier==O});let l;const _=c.SupportedCRS;if(_&&(l=d(_)),"projection"in t){const e=d(t.projection);e&&(l&&!Oe(e,l)||(l=e))}let f=!1;const w="ne"==l.getAxisOrientation().substr(0,2);let o=c.TileMatrix[0],r={MinTileCol:0,MinTileRow:0,MaxTileCol:o.MatrixWidth-1,MaxTileRow:o.MatrixHeight-1};if(h){r=h[h.length-1];const e=c.TileMatrix.find(e=>e.Identifier===r.TileMatrix||c.Identifier+":"+e.Identifier===r.TileMatrix);e&&(o=e)}const b=28e-5*o.ScaleDenominator/l.getMetersPerUnit(),m=w?[o.TopLeftCorner[1],o.TopLeftCorner[0]]:o.TopLeftCorner,j=o.TileWidth*b,y=o.TileHeight*b;let s=c.BoundingBox;s&&w&&(s=[s[1],s[0],s[3],s[2]]);let g=[m[0]+j*r.MinTileCol,m[1]-y*(1+r.MaxTileRow),m[0]+j*(1+r.MaxTileCol),m[1]-y*r.MinTileRow];if(void 0!==s&&!xe(s,g)){const t=n.WGS84BoundingBox,e=d("EPSG:4326").getExtent();if(g=s,t)f=t[0]===e[0]&&t[2]===e[2];else{const t=Ha(s,c.SupportedCRS,"EPSG:4326");f=t[0]-1e-10<=e[0]&&t[2]+1e-10>=e[2]}}const E=Wm(c,g,h),u=[];let i=t.requestEncoding;if(i=void 0!==i?i:"","OperationsMetadata"in e&&"GetTile"in e.OperationsMetadata){const t=e.OperationsMetadata.GetTile.DCP.HTTP.Get;for(let e=0,n=t.length;e<n;++e)if(t[e].Constraint){const n=t[e].Constraint.find(function(e){return"GetEncoding"==e.name}).AllowedValues.Value;if(""===i&&(i=n[0]),"KVP"!==i)break;n.includes("KVP")&&u.push(t[e].href)}else t[e].href&&(i="KVP",u.push(t[e].href))}return 0===u.length&&(i="REST",n.ResourceURL.forEach(function(e){"tile"===e.resourceType&&(p=e.format,u.push(e.template))})),{urls:u,layer:t.layer,matrixSet:O,format:p,projection:l,requestEncoding:i,tileGrid:E,style:C,dimensions:v,wrapX:f,crossOrigin:t.crossOrigin}},e.source.XYZ=si,e.source.Zoomify=class extends Dt{constructor(e){const u=e.size,p=void 0!==e.tierSizeCalculation?e.tierSizeCalculation:"default",s=e.tilePixelRatio||1,c=u[0],r=u[1],n=[],o=e.tileSize||Ys;let t=o*s;switch(p){case"default":for(;c>t||r>t;)n.push([Math.ceil(c/t),Math.ceil(r/t)]),t+=t;break;case"truncated":let e=c,s=r;for(;e>t||s>t;)n.push([Math.ceil(e/t),Math.ceil(s/t)]),e>>=1,s>>=1;break;default:throw new Error("Unknown `tierSizeCalculation` configured")}n.push([1,1]),n.reverse();const a=[s],l=[0];for(let e=1,t=n.length;e<t;e++)a.push(s<<e),l.push(n[e-1][0]*n[e-1][1]+l[e-1]);a.reverse();const d=new tn({tileSize:o,extent:e.extent||[0,-r,c,0],resolutions:a});let i=e.url;!i||i.includes("{TileGroup}")||i.includes("{tileIndex}")||(i+="{TileGroup}/{z}-{x}-{y}.jpg");const g=kc(i);let h=o*s;const m=Xo(g.map(function(e){return function(t){if(!t)return;const i=t[0],a=t[1],r=t[2],c=a+r*n[i][0],d={z:i,x:a,y:r,tileIndex:c,TileGroup:"TileGroup"+((c+l[i])/h|0)};return e.replace(/\{(\w+?)\}/g,function(e,t){return d[t]})}})),v=h1.bind(null,X(o*s));super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,tilePixelRatio:s,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:v,tileGrid:d,tileUrlFunction:m,transition:e.transition}),this.zDirection=e.zDirection;const b=m(d.getTileCoordForCoordAndResolution(_e(d.getExtent()),a[a.length-1]),1,null),f=new Image;f.addEventListener("error",()=>{h=o,this.changed()}),f.src=b}},e.source.Zoomify.CustomTile=h1,e.source.arcgisRest={},e.source.arcgisRest.createLoader=l2,e.source.arcgisRest.getRequestUrl=T1,e.source.common={},e.source.common.DECIMALS=Et,e.source.common.DEFAULT_WMS_VERSION="1.3.0",e.source.mapguide={},e.source.mapguide.createLoader=r2,e.source.ogcTileUtil={},e.source.ogcTileUtil.appendCollectionsQueryParam=q1,e.source.ogcTileUtil.getMapTileUrlTemplate=q0,e.source.ogcTileUtil.getTileSetInfo=Q1,e.source.ogcTileUtil.getVectorTileUrlTemplate=W0,e.source.sourcesFromTileGrid=function(e,t){const n=new _l(32),s=e.getExtent();return function(o,i){n.expireCache(),s&&(o=ce(s,o));const r=e.getZForResolution(i),a=[];return e.forEachTileCoord(o,r,e=>{const s=e.toString();if(!n.containsKey(s)){const o=t(e);n.set(s,o)}a.push(n.get(s))}),a}},e.source.static={},e.source.static.createLoader=a2,e.source.wms={},e.source.wms.DEFAULT_VERSION=La,e.source.wms.createLoader=t2,e.source.wms.getFeatureInfoUrl=e2,e.source.wms.getImageSrc=Al,e.source.wms.getLegendUrl=Q0,e.source.wms.getRequestParams=Pa,e.source.wms.getRequestUrl=H1,e.sphere={},e.sphere.DEFAULT_RADIUS=ba,e.sphere.getArea=function e(t,n){const r=(n=n||{}).radius||ba,h=n.projection||"EPSG:3857",d=t.getType();"GeometryCollection"!==d&&(t=t.clone().transform(h,"EPSG:4326"));let o,c,s,i,l,u,a=0;switch(d){case"Point":case"MultiPoint":case"LineString":case"MultiLineString":case"LinearRing":break;case"Polygon":for(o=t.getCoordinates(),a=Math.abs(cr(o[0],r)),s=1,i=o.length;s<i;++s)a-=Math.abs(cr(o[s],r));break;case"MultiPolygon":for(o=t.getCoordinates(),s=0,i=o.length;s<i;++s)for(c=o[s],a+=Math.abs(cr(c[0],r)),l=1,u=c.length;l<u;++l)a-=Math.abs(cr(c[l],r));break;case"GeometryCollection":{const o=t.getGeometries();for(s=0,i=o.length;s<i;++s)a+=e(o[s],n);break}default:throw new Error("Unsupported geometry type: "+d)}return a},e.sphere.getDistance=dr,e.sphere.getLength=function e(t,n){const c=(n=n||{}).radius||ba,h=n.projection||"EPSG:3857",l=t.getType();"GeometryCollection"!==l&&(t=t.clone().transform(h,"EPSG:4326"));let o,d,s,i,r,u,a=0;switch(l){case"Point":case"MultiPoint":break;case"LineString":case"LinearRing":o=t.getCoordinates(),a=nu(o,c);break;case"MultiLineString":case"Polygon":for(o=t.getCoordinates(),s=0,i=o.length;s<i;++s)a+=nu(o[s],c);break;case"MultiPolygon":for(o=t.getCoordinates(),s=0,i=o.length;s<i;++s)for(d=o[s],r=0,u=d.length;r<u;++r)a+=nu(d[r],c);break;case"GeometryCollection":{const o=t.getGeometries();for(s=0,i=o.length;s<i;++s)a+=e(o[s],n);break}default:throw new Error("Unsupported geometry type: "+l)}return a},e.sphere.offset=Xm,e.string={},e.string.compareVersions=xr,e.string.padNumber=On,e.structs={},e.structs.LRUCache=_l,e.structs.LinkedList=class{constructor(e){this.first_,this.last_,this.head_,this.circular_=void 0===e||e,this.length_=0}insertItem(e){const t={prev:void 0,next:void 0,data:e},n=this.head_;if(n){const e=n.next;t.prev=n,t.next=e,n.next=t,e&&(e.prev=t),n===this.last_&&(this.last_=t)}else this.first_=t,this.last_=t,this.circular_&&(t.next=t,t.prev=t);this.head_=t,this.length_++}removeItem(){const e=this.head_;if(e){const n=e.next,t=e.prev;n&&(n.prev=t),t&&(t.next=n),this.head_=n||t,this.first_===this.last_?(this.head_=void 0,this.first_=void 0,this.last_=void 0):this.first_===e?this.first_=this.head_:this.last_===e&&(this.last_=t?this.head_.prev:this.head_),this.length_--}}firstItem(){if(this.head_=this.first_,this.head_)return this.head_.data}lastItem(){if(this.head_=this.last_,this.head_)return this.head_.data}nextItem(){if(this.head_&&this.head_.next)return this.head_=this.head_.next,this.head_.data}getNextItem(){if(this.head_&&this.head_.next)return this.head_.next.data}prevItem(){if(this.head_&&this.head_.prev)return this.head_=this.head_.prev,this.head_.data}getPrevItem(){if(this.head_&&this.head_.prev)return this.head_.prev.data}getCurrItem(){if(this.head_)return this.head_.data}setFirstItem(){this.circular_&&this.head_&&(this.first_=this.head_,this.last_=this.head_.prev)}concat(e){if(e.head_){if(this.head_){const t=this.head_.next;this.head_.next=e.first_,e.first_.prev=this.head_,t.prev=e.last_,e.last_.next=t,this.length_+=e.length_}else this.head_=e.head_,this.first_=e.first_,this.last_=e.last_,this.length_=e.length_;e.head_=void 0,e.first_=void 0,e.last_=void 0,e.length_=0}}getLength(){return this.length_}},e.structs.PriorityQueue=ef,e.structs.PriorityQueue.DROP=_i,e.structs.RBush=Di,e.style={},e.style.Circle=ja,e.style.Fill=ot,e.style.Icon=Vo,e.style.IconImage=h0,e.style.IconImage.get=Ya,e.style.IconImageCache=d0,e.style.IconImageCache.getCacheKey=er,e.style.IconImageCache.shared=zt,e.style.Image=kr,e.style.RegularShape=mr,e.style.Stroke=Ze,e.style.Style=ve,e.style.Style.createDefaultStyle=f1,e.style.Style.createEditingStyle=Ro,e.style.Style.toFunction=$2,e.style.Text=Is,e.style.flat={},e.style.flat.createDefaultStyle=U5,e.tilecoord={},e.tilecoord.createOrUpdate=wo,e.tilecoord.fromKey=hd,e.tilecoord.getCacheKeyForTileKey=G8,e.tilecoord.getKey=an,e.tilecoord.getKeyZXY=St,e.tilecoord.hash=fl,e.tilecoord.withinExtentAndZ=Of,e.tilegrid={},e.tilegrid.TileGrid=tn,e.tilegrid.WMTS=Um,e.tilegrid.WMTS.createFromCapabilitiesMatrixSet=Wm,e.tilegrid.common={},e.tilegrid.common.DEFAULT_MAX_ZOOM=K1,e.tilegrid.common.DEFAULT_TILE_SIZE=Ys,e.tilegrid.createForExtent=Vm,e.tilegrid.createForProjection=Tm,e.tilegrid.createXYZ=Mn,e.tilegrid.extentFromProjection=Yt,e.tilegrid.getForProjection=Lc,e.tilegrid.wrapX=$m,e.tileurlfunction={},e.tileurlfunction.createFromTemplate=fm,e.tileurlfunction.createFromTemplates=Sc,e.tileurlfunction.createFromTileUrlFunctions=Xo,e.tileurlfunction.expandUrl=kc,e.tileurlfunction.nullTileUrlFunction=Qh,e.transform={},e.transform.apply=R,e.transform.compose=Le,e.transform.composeCssTransform=function(e,t,n,s,o,i,a){return yd(Le([1,0,0,1,0,0],e,t,n,s,o,i,a))},e.transform.create=T6,e.transform.determinant=d6,e.transform.invert=function(e){return Kt(e,e)},e.transform.makeInverse=Kt,e.transform.makeScale=function(e,t,n){return Yo(e,t,0,0,n,0,0)},e.transform.multiply=dn,e.transform.reset=hc,e.transform.rotate=e6,e.transform.scale=qs,e.transform.set=Yo,e.transform.setFromArray=Ui,e.transform.toString=yd,e.transform.translate=Ko,e.uri={},e.uri.appendParams=Wn,e.util={},e.util.VERSION="9.2.4",e.util.abstract=g,e.util.getUid=c,e.vec={},e.vec.mat4={},e.vec.mat4.create=K7,e.vec.mat4.fromTransform=ln,e.webgl={},e.webgl.ARRAY_BUFFER=xs,e.webgl.BaseTileRepresentation=d4,e.webgl.Buffer=on,e.webgl.Buffer.getArrayClassForType=bc,e.webgl.DYNAMIC_DRAW=wa,e.webgl.ELEMENT_ARRAY_BUFFER=As,e.webgl.FLOAT=F4,e.webgl.Helper=x0,e.webgl.Helper.computeAttributesStride=C0,e.webgl.PaletteTexture=k0,e.webgl.PostProcessingPass=s4,e.webgl.RenderTarget=Fc,e.webgl.STATIC_DRAW=go,e.webgl.STREAM_DRAW=35040,e.webgl.ShaderBuilder={},e.webgl.ShaderBuilder.COMMON_HEADER=Ns,e.webgl.ShaderBuilder.ShaderBuilder=Yc,e.webgl.TileGeometry=X2,e.webgl.TileTexture=m2,e.webgl.UNSIGNED_BYTE=5121,e.webgl.UNSIGNED_INT=5125,e.webgl.UNSIGNED_SHORT=5123,e.webgl.getContext=S4,e.webgl.getSupportedExtensions=function(){if(!A4){const e=S4(document.createElement("canvas"));e&&(A4=e.getSupportedExtensions())}return A4},e.webgl.styleparser={},e.webgl.styleparser.computeHash=Si,e.webgl.styleparser.expressionToGlsl=O,e.webgl.styleparser.packColor=d1,e.webgl.styleparser.parseLiteralStyle=xc,e.xml={},e.xml.OBJECT_PROPERTY_NODE_FACTORY=ye,e.xml.XML_SCHEMA_INSTANCE_URI=Dn,e.xml.createElementNS=w,e.xml.getAllTextContent=Me,e.xml.getAllTextContent_=E4,e.xml.getAttributeNS=$4,e.xml.getDocument=os,e.xml.getXMLSerializer=c0,e.xml.isDocument=Xe,e.xml.makeArrayExtender=fa,e.xml.makeArrayPusher=h,e.xml.makeArraySerializer=b4,e.xml.makeChildAppender=n,e.xml.makeObjectPropertyPusher=G,e.xml.makeObjectPropertySetter=t,e.xml.makeReplacer=v,e.xml.makeSequence=Ie,e.xml.makeSimpleNodeFactory=se,e.xml.makeStructureNS=o,e.xml.parse=et,e.xml.parseNode=Te,e.xml.pushParseAndPop=i,e.xml.pushSerializeAndPop=_,e.xml.registerDocument=function(e){uc=e},e.xml.registerXMLSerializer=function(e){dc=e},e.xml.serialize=p4,e}()